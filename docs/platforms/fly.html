<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-platforms/fly" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Fly.io | Moltbot Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/moltbot-doc/docs/platforms/fly"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Fly.io | Moltbot Docs"><meta data-rh="true" name="description" content="在 Fly.io 上部署 Moltbot"><meta data-rh="true" property="og:description" content="在 Fly.io 上部署 Moltbot"><link data-rh="true" rel="icon" href="/moltbot-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/moltbot-doc/docs/platforms/fly"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/platforms/fly" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/platforms/fly" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/moltbot-doc/blog/rss.xml" title="Moltbot Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/moltbot-doc/blog/atom.xml" title="Moltbot Docs Atom Feed"><link rel="stylesheet" href="/moltbot-doc/assets/css/styles.484b4c98.css">
<script src="/moltbot-doc/assets/js/runtime~main.6cf495cf.js" defer="defer"></script>
<script src="/moltbot-doc/assets/js/main.f9205183.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/moltbot-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Moltbot</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/claude-doc/docs" class="dropdownMenuItem_VBaP">Claude</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/moltbot-doc/docs">Docs</a><a class="navLink_RnnM" href="/moltbot-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Fly.io 部署</h1></header>
<p><strong>目标：</strong> 在 <a href="https://fly.io" target="_blank" rel="noopener noreferrer" class="">Fly.io</a> 机器上运行 Moltbot 网关，具有持久存储、自动 HTTPS 和 Discord/频道访问。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="您需要什么">您需要什么<a href="#您需要什么" class="hash-link" aria-label="您需要什么的直接链接" title="您需要什么的直接链接" translate="no">​</a></h2>
<ul>
<li class="">已安装 <a href="https://fly.io/docs/hands-on/install-flyctl/" target="_blank" rel="noopener noreferrer" class="">flyctl CLI</a></li>
<li class="">Fly.io 账户（免费套餐可用）</li>
<li class="">模型认证：Anthropic API 密钥（或其他提供商密钥）</li>
<li class="">频道凭据：Discord 机器人令牌、Telegram 令牌等。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="初学者快速路径">初学者快速路径<a href="#初学者快速路径" class="hash-link" aria-label="初学者快速路径的直接链接" title="初学者快速路径的直接链接" translate="no">​</a></h2>
<ol>
<li class="">克隆仓库 → 自定义 <code>fly.toml</code></li>
<li class="">创建应用 + 卷 → 设置密钥</li>
<li class="">使用 <code>fly deploy</code> 部署</li>
<li class="">SSH 登录创建配置或使用控制界面</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-创建-fly-应用">1) 创建 Fly 应用<a href="#1-创建-fly-应用" class="hash-link" aria-label="1) 创建 Fly 应用的直接链接" title="1) 创建 Fly 应用的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 克隆仓库</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">git clone https://github.com/moltbot/moltbot.git</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">cd moltbot</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 创建新的 Fly 应用（选择您自己的名称）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly apps create my-moltbot</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 创建持久卷（1GB 通常足够）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly volumes create moltbot_data --size 1 --region iad</span><br></span></code></pre></div></div>
<p><strong>提示：</strong> 选择靠近您的区域。常用选项：<code>lhr</code>（伦敦）、<code>iad</code>（弗吉尼亚）、<code>sjc</code>（圣何塞）。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-配置-flytoml">2) 配置 fly.toml<a href="#2-配置-flytoml" class="hash-link" aria-label="2) 配置 fly.toml的直接链接" title="2) 配置 fly.toml的直接链接" translate="no">​</a></h2>
<p>编辑 <code>fly.toml</code> 以匹配您的应用名称和需求。</p>
<p><strong>安全说明：</strong> 默认配置暴露公共 URL。对于无公共 IP 的加固部署，请参见 <a href="#private-deployment-hardened" class="">私有部署</a> 或使用 <code>fly.private.toml</code>。</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">app = &quot;my-moltbot&quot;  # 您的应用名称</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">primary_region = &quot;iad&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">[build]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  dockerfile = &quot;Dockerfile&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">[env]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  NODE_ENV = &quot;production&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  CLAWDBOT_PREFER_PNPM = &quot;1&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  CLAWDBOT_STATE_DIR = &quot;/data&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  NODE_OPTIONS = &quot;--max-old-space-size=1536&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">[processes]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  app = &quot;node dist/index.js gateway --allow-unconfigured --port 3000 --bind lan&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">[http_service]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  internal_port = 3000</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  force_https = true</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  auto_stop_machines = false</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  auto_start_machines = true</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  min_machines_running = 1</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  processes = [&quot;app&quot;]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">[[vm]]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  size = &quot;shared-cpu-2x&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  memory = &quot;2048mb&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">[mounts]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  source = &quot;moltbot_data&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  destination = &quot;/data&quot;</span><br></span></code></pre></div></div>
<p><strong>关键设置：</strong></p>





























<table><thead><tr><th>设置</th><th>原因</th></tr></thead><tbody><tr><td><code>--bind lan</code></td><td>绑定到 <code>0.0.0.0</code> 以便 Fly 的代理可以访问网关</td></tr><tr><td><code>--allow-unconfigured</code></td><td>在没有配置文件的情况下启动（您之后会创建一个）</td></tr><tr><td><code>internal_port = 3000</code></td><td>必须与 <code>--port 3000</code>（或 <code>CLAWDBOT_GATEWAY_PORT</code>）匹配以进行 Fly 健康检查</td></tr><tr><td><code>memory = &quot;2048mb&quot;</code></td><td>512MB 太小；建议 2GB</td></tr><tr><td><code>CLAWDBOT_STATE_DIR = &quot;/data&quot;</code></td><td>在卷上持久化状态</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-设置密钥">3) 设置密钥<a href="#3-设置密钥" class="hash-link" aria-label="3) 设置密钥的直接链接" title="3) 设置密钥的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 必需：网关令牌（用于非回环绑定）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly secrets set CLAWDBOT_GATEWAY_TOKEN=$(openssl rand -hex 32)</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 模型提供商 API 密钥</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly secrets set ANTHROPIC_API_KEY=sk-ant-...</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 可选：其他提供商</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly secrets set OPENAI_API_KEY=sk-...</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly secrets set GOOGLE_API_KEY=...</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 频道令牌</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly secrets set DISCORD_BOT_TOKEN=MTQ...</span><br></span></code></pre></div></div>
<p><strong>说明：</strong></p>
<ul>
<li class="">非回环绑定（<code>--bind lan</code>）需要 <code>CLAWDBOT_GATEWAY_TOKEN</code> 以确保安全。</li>
<li class="">将这些令牌视为密码。</li>
<li class=""><strong>优先使用环境变量而非配置文件</strong> 用于所有 API 密钥和令牌。这可防止密钥进入 <code>moltbot.json</code>，避免意外暴露或记录。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-部署">4) 部署<a href="#4-部署" class="hash-link" aria-label="4) 部署的直接链接" title="4) 部署的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly deploy</span><br></span></code></pre></div></div>
<p>首次部署构建 Docker 镜像（约 2-3 分钟）。后续部署更快。</p>
<p>部署后验证：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly status</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly logs</span><br></span></code></pre></div></div>
<p>您应该看到：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">[gateway] listening on ws://0.0.0.0:3000 (PID xxx)</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">[discord] logged in to discord as xxx</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-创建配置文件">5) 创建配置文件<a href="#5-创建配置文件" class="hash-link" aria-label="5) 创建配置文件的直接链接" title="5) 创建配置文件的直接链接" translate="no">​</a></h2>
<p>SSH 登录机器以创建适当的配置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ssh console</span><br></span></code></pre></div></div>
<p>创建配置目录和文件：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">mkdir -p /data</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">cat &gt; /data/moltbot.json &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;agents&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;defaults&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;model&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        &quot;primary&quot;: &quot;anthropic/claude-opus-4-5&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        &quot;fallbacks&quot;: [&quot;anthropic/claude-sonnet-4-5&quot;, &quot;openai/gpt-4o&quot;]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;maxConcurrent&quot;: 4</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;list&quot;: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        &quot;id&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        &quot;default&quot;: true</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;auth&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;profiles&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;anthropic:default&quot;: { &quot;mode&quot;: &quot;token&quot;, &quot;provider&quot;: &quot;anthropic&quot; },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;openai:default&quot;: { &quot;mode&quot;: &quot;token&quot;, &quot;provider&quot;: &quot;openai&quot; }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;bindings&quot;: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;agentId&quot;: &quot;main&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;match&quot;: { &quot;channel&quot;: &quot;discord&quot; }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;channels&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;discord&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;enabled&quot;: true,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;groupPolicy&quot;: &quot;allowlist&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;guilds&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        &quot;YOUR_GUILD_ID&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          &quot;channels&quot;: { &quot;general&quot;: { &quot;allow&quot;: true } },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          &quot;requireMention&quot;: false</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;gateway&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;mode&quot;: &quot;local&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;bind&quot;: &quot;auto&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;meta&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;lastTouchedVersion&quot;: &quot;2026.1.27-beta.1&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<p><strong>注意：</strong> 使用 <code>CLAWDBOT_STATE_DIR=/data</code>，配置路径为 <code>/data/moltbot.json</code>。</p>
<p><strong>注意：</strong> Discord 令牌可以来自：</p>
<ul>
<li class="">环境变量：<code>DISCORD_BOT_TOKEN</code>（推荐用于密钥）</li>
<li class="">配置文件：<code>channels.discord.token</code></li>
</ul>
<p>如果使用环境变量，无需将令牌添加到配置中。网关会自动读取 <code>DISCORD_BOT_TOKEN</code>。</p>
<p>重启以应用：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">exit</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly machine restart &lt;machine-id&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-访问网关">6) 访问网关<a href="#6-访问网关" class="hash-link" aria-label="6) 访问网关的直接链接" title="6) 访问网关的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="控制界面">控制界面<a href="#控制界面" class="hash-link" aria-label="控制界面的直接链接" title="控制界面的直接链接" translate="no">​</a></h3>
<p>在浏览器中打开：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly open</span><br></span></code></pre></div></div>
<p>或访问 <code>https://my-moltbot.fly.dev/</code></p>
<p>粘贴您的网关令牌（来自 <code>CLAWDBOT_GATEWAY_TOKEN</code>）进行身份验证。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="日志">日志<a href="#日志" class="hash-link" aria-label="日志的直接链接" title="日志的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly logs              # 实时日志</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly logs --no-tail    # 最近日志</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-控制台">SSH 控制台<a href="#ssh-控制台" class="hash-link" aria-label="SSH 控制台的直接链接" title="SSH 控制台的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ssh console</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="故障排除">故障排除<a href="#故障排除" class="hash-link" aria-label="故障排除的直接链接" title="故障排除的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="app-is-not-listening-on-expected-address">&quot;App is not listening on expected address&quot;<a href="#app-is-not-listening-on-expected-address" class="hash-link" aria-label="&quot;App is not listening on expected address&quot;的直接链接" title="&quot;App is not listening on expected address&quot;的直接链接" translate="no">​</a></h3>
<p>网关绑定到 <code>127.0.0.1</code> 而不是 <code>0.0.0.0</code>。</p>
<p><strong>修复：</strong> 在 <code>fly.toml</code> 中的进程命令中添加 <code>--bind lan</code>。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="健康检查失败--连接被拒绝">健康检查失败 / 连接被拒绝<a href="#健康检查失败--连接被拒绝" class="hash-link" aria-label="健康检查失败 / 连接被拒绝的直接链接" title="健康检查失败 / 连接被拒绝的直接链接" translate="no">​</a></h3>
<p>Fly 无法在配置的端口上访问网关。</p>
<p><strong>修复：</strong> 确保 <code>internal_port</code> 与网关端口匹配（设置 <code>--port 3000</code> 或 <code>CLAWDBOT_GATEWAY_PORT=3000</code>）。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="oom--内存问题">OOM / 内存问题<a href="#oom--内存问题" class="hash-link" aria-label="OOM / 内存问题的直接链接" title="OOM / 内存问题的直接链接" translate="no">​</a></h3>
<p>容器不断重启或被终止。迹象：<code>SIGABRT</code>、<code>v8::internal::Runtime_AllocateInYoungGeneration</code> 或静默重启。</p>
<p><strong>修复：</strong> 在 <code>fly.toml</code> 中增加内存：</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">[[vm]]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  memory = &quot;2048mb&quot;</span><br></span></code></pre></div></div>
<p>或更新现有机器：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly machine update &lt;machine-id&gt; --vm-memory 2048 -y</span><br></span></code></pre></div></div>
<p><strong>注意：</strong> 512MB 太小。1GB 可能可行但在负载或详细日志记录下可能会 OOM。<strong>建议使用 2GB。</strong></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="网关锁问题">网关锁问题<a href="#网关锁问题" class="hash-link" aria-label="网关锁问题的直接链接" title="网关锁问题的直接链接" translate="no">​</a></h3>
<p>网关拒绝启动并显示&quot;已在运行&quot;错误。</p>
<p>这发生在容器重启但 PID 锁文件仍在卷上保留时。</p>
<p><strong>修复：</strong> 删除锁文件：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ssh console --command &quot;rm -f /data/gateway.*.lock&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly machine restart &lt;machine-id&gt;</span><br></span></code></pre></div></div>
<p>锁文件位于 <code>/data/gateway.*.lock</code>（不在子目录中）。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="配置未被读取">配置未被读取<a href="#配置未被读取" class="hash-link" aria-label="配置未被读取的直接链接" title="配置未被读取的直接链接" translate="no">​</a></h3>
<p>如果使用 <code>--allow-unconfigured</code>，网关会创建最小配置。您的自定义配置在 <code>/data/moltbot.json</code> 应在重启时被读取。</p>
<p>验证配置是否存在：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ssh console --command &quot;cat /data/moltbot.json&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="通过-ssh-编写配置">通过 SSH 编写配置<a href="#通过-ssh-编写配置" class="hash-link" aria-label="通过 SSH 编写配置的直接链接" title="通过 SSH 编写配置的直接链接" translate="no">​</a></h3>
<p><code>fly ssh console -C</code> 命令不支持 shell 重定向。要编写配置文件：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 使用 echo + tee（从本地到远程的管道）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">echo &#x27;{&quot;your&quot;:&quot;config&quot;}&#x27; | fly ssh console -C &quot;tee /data/moltbot.json&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 或使用 sftp</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly sftp shell</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">&gt; put /local/path/config.json /data/moltbot.json</span><br></span></code></pre></div></div>
<p><strong>注意：</strong> 如果文件已存在，<code>fly sftp</code> 可能会失败。先删除：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ssh console --command &quot;rm /data/moltbot.json&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="状态未持久化">状态未持久化<a href="#状态未持久化" class="hash-link" aria-label="状态未持久化的直接链接" title="状态未持久化的直接链接" translate="no">​</a></h3>
<p>如果重启后丢失凭据或会话，状态目录正在写入容器文件系统。</p>
<p><strong>修复：</strong> 确保在 <code>fly.toml</code> 中设置了 <code>CLAWDBOT_STATE_DIR=/data</code> 并重新部署。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="更新">更新<a href="#更新" class="hash-link" aria-label="更新的直接链接" title="更新的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 拉取最新更改</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">git pull</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 重新部署</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly deploy</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 检查健康状况</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly status</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly logs</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="更新机器命令">更新机器命令<a href="#更新机器命令" class="hash-link" aria-label="更新机器命令的直接链接" title="更新机器命令的直接链接" translate="no">​</a></h3>
<p>如果您需要在不完全重新部署的情况下更改启动命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 获取机器 ID</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly machines list</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 更新命令</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly machine update &lt;machine-id&gt; --command &quot;node dist/index.js gateway --port 3000 --bind lan&quot; -y</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 或增加内存</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly machine update &lt;machine-id&gt; --vm-memory 2048 --command &quot;node dist/index.js gateway --port 3000 --bind lan&quot; -y</span><br></span></code></pre></div></div>
<p><strong>注意：</strong> 在 <code>fly deploy</code> 之后，机器命令可能会重置为 <code>fly.toml</code> 中的内容。如果您进行了手动更改，请在部署后重新应用它们。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="私有部署加固">私有部署（加固）<a href="#私有部署加固" class="hash-link" aria-label="私有部署（加固）的直接链接" title="私有部署（加固）的直接链接" translate="no">​</a></h2>
<p>默认情况下，Fly 分配公共 IP，使您的网关可通过 <code>https://your-app.fly.dev</code> 访问。这很方便，但意味着您的部署可被互联网扫描器（Shodan、Censys 等）发现。</p>
<p>对于<strong>无公共暴露</strong>的加固部署，请使用私有模板。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="何时使用私有部署">何时使用私有部署<a href="#何时使用私有部署" class="hash-link" aria-label="何时使用私有部署的直接链接" title="何时使用私有部署的直接链接" translate="no">​</a></h3>
<ul>
<li class="">您只进行<strong>出站</strong>呼叫/消息（无入站 webhooks）</li>
<li class="">您为任何 webhook 回调使用<strong>ngrok 或 Tailscale</strong> 隧道</li>
<li class="">您通过<strong>SSH、代理或 WireGuard</strong> 而不是浏览器访问网关</li>
<li class="">您希望部署<strong>对互联网扫描器隐藏</strong></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="设置">设置<a href="#设置" class="hash-link" aria-label="设置的直接链接" title="设置的直接链接" translate="no">​</a></h3>
<p>使用 <code>fly.private.toml</code> 而不是标准配置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 使用私有配置部署</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly deploy -c fly.private.toml</span><br></span></code></pre></div></div>
<p>或转换现有部署：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 列出现有 IP</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ips list -a my-moltbot</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 释放公共 IP</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ips release &lt;public-ipv4&gt; -a my-moltbot</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ips release &lt;public-ipv6&gt; -a my-moltbot</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 切换到私有配置，以便未来部署不会重新分配公共 IP</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># （删除 [http_service] 或使用私有模板部署）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly deploy -c fly.private.toml</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 分配仅私有 IPv6</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ips allocate-v6 --private -a my-moltbot</span><br></span></code></pre></div></div>
<p>此后，<code>fly ips list</code> 应该只显示 <code>private</code> 类型 IP：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">VERSION  IP                   TYPE             REGION</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">v6       fdaa:x:x:x:x::x      private          global</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="访问私有部署">访问私有部署<a href="#访问私有部署" class="hash-link" aria-label="访问私有部署的直接链接" title="访问私有部署的直接链接" translate="no">​</a></h3>
<p>由于没有公共 URL，请使用以下方法之一：</p>
<p><strong>选项 1：本地代理（最简单）</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 将本地端口 3000 转发到应用</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly proxy 3000:3000 -a my-moltbot</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 然后在浏览器中打开 http://localhost:3000</span><br></span></code></pre></div></div>
<p><strong>选项 2：WireGuard VPN</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 创建 WireGuard 配置（一次性）</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly wireguard create</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 导入到 WireGuard 客户端，然后通过内部 IPv6 访问</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"># 示例：http://[fdaa:x:x:x:x::x]:3000</span><br></span></code></pre></div></div>
<p><strong>选项 3：仅 SSH</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">fly ssh console -a my-moltbot</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="私有部署的-webhooks">私有部署的 Webhooks<a href="#私有部署的-webhooks" class="hash-link" aria-label="私有部署的 Webhooks的直接链接" title="私有部署的 Webhooks的直接链接" translate="no">​</a></h3>
<p>如果您需要 webhook 回调（Twilio、Telnyx 等）而不公开暴露：</p>
<ol>
<li class=""><strong>ngrok 隧道</strong> - 在容器内或作为边车运行 ngrok</li>
<li class=""><strong>Tailscale Funnel</strong> - 通过 Tailscale 暴露特定路径</li>
<li class=""><strong>仅出站</strong> - 某些提供商（Twilio）在没有 webhooks 的情况下也可以正常进行出站呼叫</li>
</ol>
<p>使用 ngrok 的语音通话配置示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;plugins&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;entries&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;voice-call&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token property" style="color:#F78C6C">&quot;enabled&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token property" style="color:#F78C6C">&quot;config&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;provider&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;twilio&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;tunnel&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;provider&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;ngrok&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>ngrok 隧道在容器内运行，提供公共 webhook URL，而无需暴露 Fly 应用本身。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="安全优势">安全优势<a href="#安全优势" class="hash-link" aria-label="安全优势的直接链接" title="安全优势的直接链接" translate="no">​</a></h3>






























<table><thead><tr><th>方面</th><th>公共</th><th>私有</th></tr></thead><tbody><tr><td>互联网扫描器</td><td>可发现</td><td>隐藏</td></tr><tr><td>直接攻击</td><td>可能</td><td>阻止</td></tr><tr><td>控制界面访问</td><td>浏览器</td><td>代理/VPN</td></tr><tr><td>Webhook 传递</td><td>直接</td><td>通过隧道</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="注意事项">注意事项<a href="#注意事项" class="hash-link" aria-label="注意事项的直接链接" title="注意事项的直接链接" translate="no">​</a></h2>
<ul>
<li class="">Fly.io 使用 <strong>x86 架构</strong>（非 ARM）</li>
<li class="">Dockerfile 与两种架构兼容</li>
<li class="">对于 WhatsApp/Telegram 入职，请使用 <code>fly ssh console</code></li>
<li class="">持久数据保存在 <code>/data</code> 的卷上</li>
<li class="">Signal 需要 Java + signal-cli；使用自定义镜像并保持内存在 2GB+。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="成本">成本<a href="#成本" class="hash-link" aria-label="成本的直接链接" title="成本的直接链接" translate="no">​</a></h2>
<p>使用推荐配置（<code>shared-cpu-2x</code>，2GB RAM）：</p>
<ul>
<li class="">根据使用情况约为 $10-15/月</li>
<li class="">免费套餐包括一些配额</li>
</ul>
<p>详情请参见 <a href="https://fly.io/docs/about/pricing/" target="_blank" rel="noopener noreferrer" class="">Fly.io 定价</a>。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#您需要什么" class="table-of-contents__link toc-highlight">您需要什么</a></li><li><a href="#初学者快速路径" class="table-of-contents__link toc-highlight">初学者快速路径</a></li><li><a href="#1-创建-fly-应用" class="table-of-contents__link toc-highlight">1) 创建 Fly 应用</a></li><li><a href="#2-配置-flytoml" class="table-of-contents__link toc-highlight">2) 配置 fly.toml</a></li><li><a href="#3-设置密钥" class="table-of-contents__link toc-highlight">3) 设置密钥</a></li><li><a href="#4-部署" class="table-of-contents__link toc-highlight">4) 部署</a></li><li><a href="#5-创建配置文件" class="table-of-contents__link toc-highlight">5) 创建配置文件</a></li><li><a href="#6-访问网关" class="table-of-contents__link toc-highlight">6) 访问网关</a><ul><li><a href="#控制界面" class="table-of-contents__link toc-highlight">控制界面</a></li><li><a href="#日志" class="table-of-contents__link toc-highlight">日志</a></li><li><a href="#ssh-控制台" class="table-of-contents__link toc-highlight">SSH 控制台</a></li></ul></li><li><a href="#故障排除" class="table-of-contents__link toc-highlight">故障排除</a><ul><li><a href="#app-is-not-listening-on-expected-address" class="table-of-contents__link toc-highlight">&quot;App is not listening on expected address&quot;</a></li><li><a href="#健康检查失败--连接被拒绝" class="table-of-contents__link toc-highlight">健康检查失败 / 连接被拒绝</a></li><li><a href="#oom--内存问题" class="table-of-contents__link toc-highlight">OOM / 内存问题</a></li><li><a href="#网关锁问题" class="table-of-contents__link toc-highlight">网关锁问题</a></li><li><a href="#配置未被读取" class="table-of-contents__link toc-highlight">配置未被读取</a></li><li><a href="#通过-ssh-编写配置" class="table-of-contents__link toc-highlight">通过 SSH 编写配置</a></li><li><a href="#状态未持久化" class="table-of-contents__link toc-highlight">状态未持久化</a></li></ul></li><li><a href="#更新" class="table-of-contents__link toc-highlight">更新</a><ul><li><a href="#更新机器命令" class="table-of-contents__link toc-highlight">更新机器命令</a></li></ul></li><li><a href="#私有部署加固" class="table-of-contents__link toc-highlight">私有部署（加固）</a><ul><li><a href="#何时使用私有部署" class="table-of-contents__link toc-highlight">何时使用私有部署</a></li><li><a href="#设置" class="table-of-contents__link toc-highlight">设置</a></li><li><a href="#访问私有部署" class="table-of-contents__link toc-highlight">访问私有部署</a></li><li><a href="#私有部署的-webhooks" class="table-of-contents__link toc-highlight">私有部署的 Webhooks</a></li><li><a href="#安全优势" class="table-of-contents__link toc-highlight">安全优势</a></li></ul></li><li><a href="#注意事项" class="table-of-contents__link toc-highlight">注意事项</a></li><li><a href="#成本" class="table-of-contents__link toc-highlight">成本</a></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Moltbot Docs.</div></div></div></footer></div>
</body>
</html>