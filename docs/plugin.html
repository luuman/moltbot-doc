<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-plugin" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">插件（扩展） | Moltbot Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/moltbot-doc/docs/plugin"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="插件（扩展） | Moltbot Docs"><meta data-rh="true" name="description" content="快速入门（插件新手？）"><meta data-rh="true" property="og:description" content="快速入门（插件新手？）"><link data-rh="true" rel="icon" href="/moltbot-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/moltbot-doc/docs/plugin"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/plugin" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/plugin" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/moltbot-doc/blog/rss.xml" title="Moltbot Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/moltbot-doc/blog/atom.xml" title="Moltbot Docs Atom Feed"><link rel="stylesheet" href="/moltbot-doc/assets/css/styles.484b4c98.css">
<script src="/moltbot-doc/assets/js/runtime~main.6cf495cf.js" defer="defer"></script>
<script src="/moltbot-doc/assets/js/main.f9205183.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/moltbot-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Moltbot</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/claude-doc/docs" class="dropdownMenuItem_VBaP">Claude</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/moltbot-doc/docs">Docs</a><a class="navLink_RnnM" href="/moltbot-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>插件（扩展）</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="快速入门插件新手">快速入门（插件新手？）<a href="#快速入门插件新手" class="hash-link" aria-label="快速入门（插件新手？）的直接链接" title="快速入门（插件新手？）的直接链接" translate="no">​</a></h2>
<p>插件只是一个 <strong>小型代码模块</strong>，通过额外功能（命令、工具和网关 RPC）扩展 Moltbot。</p>
<p>大多数时候，当您想要一个尚未内置到核心 Moltbot 中的功能时（或者您想将可选功能保留在主安装之外），您会使用插件。</p>
<p>快速路径：</p>
<ol>
<li class="">查看已加载的内容：</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins list</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">安装官方插件（示例：语音通话）：</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins install @moltbot/voice-call</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">重启网关，然后在 <code>plugins.entries.&lt;id&gt;.config</code> 下配置。</li>
</ol>
<p>请参见 <a class="" href="/moltbot-doc/plugins/voice-call">语音通话</a> 了解具体的插件示例。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="可用插件官方">可用插件（官方）<a href="#可用插件官方" class="hash-link" aria-label="可用插件（官方）的直接链接" title="可用插件（官方）的直接链接" translate="no">​</a></h2>
<ul>
<li class="">Microsoft Teams 从 2026.1.15 开始仅作为插件；如果您使用 Teams，请安装 <code>@moltbot/msteams</code>。</li>
<li class="">Memory（核心）— 捆绑的内存搜索插件（默认通过 <code>plugins.slots.memory</code> 启用）</li>
<li class="">Memory（LanceDB）— 捆绑的长期内存插件（自动回忆/捕获；设置 <code>plugins.slots.memory = &quot;memory-lancedb&quot;</code>）</li>
<li class=""><a class="" href="/moltbot-doc/plugins/voice-call">语音通话</a> — <code>@moltbot/voice-call</code></li>
<li class=""><a class="" href="/moltbot-doc/plugins/zalouser">Zalo 个人</a> — <code>@moltbot/zalouser</code></li>
<li class=""><a class="" href="/moltbot-doc/channels/matrix">Matrix</a> — <code>@moltbot/matrix</code></li>
<li class=""><a class="" href="/moltbot-doc/channels/nostr">Nostr</a> — <code>@moltbot/nostr</code></li>
<li class=""><a class="" href="/moltbot-doc/channels/zalo">Zalo</a> — <code>@moltbot/zalo</code></li>
<li class=""><a class="" href="/moltbot-doc/channels/msteams">Microsoft Teams</a> — <code>@moltbot/msteams</code></li>
<li class="">Google Antigravity OAuth（提供者认证）— 捆绑为 <code>google-antigravity-auth</code>（默认禁用）</li>
<li class="">Gemini CLI OAuth（提供者认证）— 捆绑为 <code>google-gemini-cli-auth</code>（默认禁用）</li>
<li class="">Qwen OAuth（提供者认证）— 捆绑为 <code>qwen-portal-auth</code>（默认禁用）</li>
<li class="">Copilot Proxy（提供者认证）— 本地 VS Code Copilot Proxy 桥接；与内置的 <code>github-copilot</code> 设备登录不同（捆绑，但默认禁用）</li>
</ul>
<p>Moltbot 插件是通过 jiti 在运行时加载的 <strong>TypeScript 模块</strong>。<strong>配置验证不会执行插件代码</strong>；而是使用插件清单和 JSON Schema。请参见 <a class="" href="/moltbot-doc/plugins/manifest">插件清单</a>。</p>
<p>插件可以注册：</p>
<ul>
<li class="">网关 RPC 方法</li>
<li class="">网关 HTTP 处理器</li>
<li class="">代理工具</li>
<li class="">CLI 命令</li>
<li class="">后台服务</li>
<li class="">可选配置验证</li>
<li class=""><strong>技能</strong>（通过在插件清单中列出 <code>skills</code> 目录）</li>
<li class=""><strong>自动回复命令</strong>（无需调用 AI 代理即可执行）</li>
</ul>
<p>插件与网关在 <strong>进程中</strong> 运行，因此将它们视为可信代码。
工具编写指南：<a class="" href="/moltbot-doc/plugins/agent-tools">插件代理工具</a>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="运行时助手">运行时助手<a href="#运行时助手" class="hash-link" aria-label="运行时助手的直接链接" title="运行时助手的直接链接" translate="no">​</a></h2>
<p>插件可以通过 <code>api.runtime</code> 访问选定的核心助手。对于电话 TTS：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token keyword" style="color:#C792EA">const</span><span class="token plain"> result </span><span class="token operator" style="color:#7FDBCA">=</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">await</span><span class="token plain"> api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">runtime</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">tts</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">textToSpeechTelephony</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  text</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;Hello from Moltbot&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  cfg</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">config</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><br></span></code></pre></div></div>
<p>注意事项：</p>
<ul>
<li class="">使用核心 <code>messages.tts</code> 配置（OpenAI 或 ElevenLabs）。</li>
<li class="">返回 PCM 音频缓冲区 + 采样率。插件必须为提供者重新采样/编码。</li>
<li class="">边缘 TTS 不支持电话。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="发现与优先级">发现与优先级<a href="#发现与优先级" class="hash-link" aria-label="发现与优先级的直接链接" title="发现与优先级的直接链接" translate="no">​</a></h2>
<p>Moltbot 按顺序扫描：</p>
<ol>
<li class="">配置路径</li>
</ol>
<ul>
<li class=""><code>plugins.load.paths</code>（文件或目录）</li>
</ul>
<ol start="2">
<li class="">工作区扩展</li>
</ol>
<ul>
<li class=""><code>&lt;workspace&gt;/.clawdbot/extensions/*.ts</code></li>
<li class=""><code>&lt;workspace&gt;/.clawdbot/extensions/*/index.ts</code></li>
</ul>
<ol start="3">
<li class="">全球扩展</li>
</ol>
<ul>
<li class=""><code>~/.clawdbot/extensions/*.ts</code></li>
<li class=""><code>~/.clawdbot/extensions/*/index.ts</code></li>
</ul>
<ol start="4">
<li class="">捆绑扩展（随 Moltbot 一起发布，<strong>默认禁用</strong>）</li>
</ol>
<ul>
<li class=""><code>&lt;moltbot&gt;/extensions/*</code></li>
</ul>
<p>必须通过 <code>plugins.entries.&lt;id&gt;.enabled</code> 或 <code>moltbot plugins enable &lt;id&gt;</code> 明确启用捆绑插件。安装的插件默认启用，但可以通过相同方式禁用。</p>
<p>每个插件必须在其根目录包含 <code>moltbot.plugin.json</code> 文件。如果路径指向文件，插件根目录是文件的目录，且必须包含清单。</p>
<p>如果多个插件解析为相同的 id，上述顺序中的第一个匹配项获胜，较低优先级的副本将被忽略。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="包集合">包集合<a href="#包集合" class="hash-link" aria-label="包集合的直接链接" title="包集合的直接链接" translate="no">​</a></h3>
<p>插件目录可能包含带有 <code>moltbot.extensions</code> 的 <code>package.json</code>：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;name&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;my-pack&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;moltbot&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;extensions&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;./src/safety.ts&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;./src/tools.ts&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>每个条目成为一个插件。如果包列出了多个扩展，插件 id 变为 <code>name/&lt;fileBase&gt;</code>。</p>
<p>如果您的插件导入 npm 依赖项，请在该目录中安装它们，以便 <code>node_modules</code> 可用（<code>npm install</code> / <code>pnpm install</code>）。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="频道目录元数据">频道目录元数据<a href="#频道目录元数据" class="hash-link" aria-label="频道目录元数据的直接链接" title="频道目录元数据的直接链接" translate="no">​</a></h3>
<p>频道插件可以通过 <code>moltbot.channel</code> 广告入职元数据，并通过 <code>moltbot.install</code> 提供安装提示。这使核心目录保持无数据状态。</p>
<p>示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;name&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;@moltbot/nextcloud-talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;moltbot&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;extensions&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;./index.ts&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;channel&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;id&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;nextcloud-talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;label&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;Nextcloud Talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;selectionLabel&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;Nextcloud Talk (self-hosted)&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;docsPath&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/channels/nextcloud-talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;docsLabel&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;nextcloud-talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;blurb&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;通过 Nextcloud Talk webhook 机器人进行自托管聊天。&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;order&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">65</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;aliases&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;nc-talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;nc&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;install&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;npmSpec&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;@moltbot/nextcloud-talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;localPath&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;extensions/nextcloud-talk&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;defaultChoice&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;npm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>Moltbot 还可以合并 <strong>外部频道目录</strong>（例如，MPM 注册表导出）。在以下位置之一放置 JSON 文件：</p>
<ul>
<li class=""><code>~/.clawdbot/mpm/plugins.json</code></li>
<li class=""><code>~/.clawdbot/mpm/catalog.json</code></li>
<li class=""><code>~/.clawdbot/plugins/catalog.json</code></li>
</ul>
<p>或指向 <code>CLAWDBOT_PLUGIN_CATALOG_PATHS</code>（或 <code>CLAWDBOT_MPM_CATALOG_PATHS</code>）的一个或多个 JSON 文件（逗号/分号/<code>PATH</code> 分隔）。每个文件应包含 <code>{ &quot;entries&quot;: [ { &quot;name&quot;: &quot;@scope/pkg&quot;, &quot;moltbot&quot;: { &quot;channel&quot;: {...}, &quot;install&quot;: {...} } } ] }</code>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="插件-id">插件 ID<a href="#插件-id" class="hash-link" aria-label="插件 ID的直接链接" title="插件 ID的直接链接" translate="no">​</a></h2>
<p>默认插件 ID：</p>
<ul>
<li class="">包集合：<code>package.json</code> <code>name</code></li>
<li class="">独立文件：文件基本名称（<code>~/.../voice-call.ts</code> → <code>voice-call</code>）</li>
</ul>
<p>如果插件导出 <code>id</code>，Moltbot 使用它，但如果与配置的 ID 不匹配则会发出警告。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="配置">配置<a href="#配置" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接" translate="no">​</a></h2>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  plugins: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    enabled: true,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    allow: [&quot;voice-call&quot;],</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    deny: [&quot;untrusted-plugin&quot;],</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    load: { paths: [&quot;~/Projects/oss/voice-call-extension&quot;] },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    entries: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;voice-call&quot;: { enabled: true, config: { provider: &quot;twilio&quot; } }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>字段：</p>
<ul>
<li class=""><code>enabled</code>：主开关（默认：true）</li>
<li class=""><code>allow</code>：白名单（可选）</li>
<li class=""><code>deny</code>：黑名单（可选；拒绝优先）</li>
<li class=""><code>load.paths</code>：额外的插件文件/目录</li>
<li class=""><code>entries.&lt;id&gt;</code>：每个插件的开关 + 配置</li>
</ul>
<p>配置更改 <strong>需要重启网关</strong>。</p>
<p>验证规则（严格）：</p>
<ul>
<li class=""><code>entries</code>、<code>allow</code>、<code>deny</code> 或 <code>slots</code> 中的未知插件 ID 是 <strong>错误</strong>。</li>
<li class="">未知的 <code>channels.&lt;id&gt;</code> 键是 <strong>错误</strong>，除非插件清单声明频道 ID。</li>
<li class="">插件配置使用嵌入在 <code>moltbot.plugin.json</code>（<code>configSchema</code>）中的 JSON Schema 进行验证。</li>
<li class="">如果插件被禁用，其配置将被保留并发出 <strong>警告</strong>。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="插件槽独占类别">插件槽（独占类别）<a href="#插件槽独占类别" class="hash-link" aria-label="插件槽（独占类别）的直接链接" title="插件槽（独占类别）的直接链接" translate="no">​</a></h2>
<p>某些插件类别是 <strong>独占的</strong>（一次只能激活一个）。使用 <code>plugins.slots</code> 选择哪个插件拥有该槽：</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  plugins: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    slots: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      memory: &quot;memory-core&quot; // 或 &quot;none&quot; 以禁用内存插件</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>如果多个插件声明 <code>kind: &quot;memory&quot;</code>，只有选定的插件会加载。其他插件被禁用并显示诊断信息。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="控制界面模式--标签">控制界面（模式 + 标签）<a href="#控制界面模式--标签" class="hash-link" aria-label="控制界面（模式 + 标签）的直接链接" title="控制界面（模式 + 标签）的直接链接" translate="no">​</a></h2>
<p>控制界面使用 <code>config.schema</code>（JSON Schema + <code>uiHints</code>）来渲染更好的表单。</p>
<p>Moltbot 在运行时根据发现的插件增强 <code>uiHints</code>：</p>
<ul>
<li class="">为 <code>plugins.entries.&lt;id&gt;</code> / <code>.enabled</code> / <code>.config</code> 添加每个插件的标签</li>
<li class="">在以下位置合并插件提供的可选配置字段提示：
<code>plugins.entries.&lt;id&gt;.config.&lt;field&gt;</code></li>
</ul>
<p>如果您希望插件配置字段显示良好的标签/占位符（并将秘密标记为敏感），请在插件清单中提供 <code>uiHints</code> 与 JSON Schema 一起。</p>
<p>示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;id&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;my-plugin&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;configSchema&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;type&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;object&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;additionalProperties&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">false</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;properties&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;apiKey&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;type&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;region&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;type&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;uiHints&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;apiKey&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;label&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;API Key&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;sensitive&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;region&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;label&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;Region&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;placeholder&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;us-east-1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="cli">CLI<a href="#cli" class="hash-link" aria-label="CLI的直接链接" title="CLI的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins list</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins info &lt;id&gt;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins install &lt;path&gt;                 # 将本地文件/目录复制到 ~/.clawdbot/extensions/&lt;id&gt;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins install ./extensions/voice-call # 相对路径可以</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins install ./plugin.tgz           # 从本地 tarball 安装</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins install ./plugin.zip           # 从本地 zip 安装</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins install -l ./extensions/voice-call # 链接（无复制）用于开发</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins install @moltbot/voice-call # 从 npm 安装</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins update &lt;id&gt;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins update --all</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins enable &lt;id&gt;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins disable &lt;id&gt;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot plugins doctor</span><br></span></code></pre></div></div>
<p><code>plugins update</code> 仅适用于在 <code>plugins.installs</code> 下跟踪的 npm 安装。</p>
<p>插件还可以注册自己的顶级命令（示例：<code>moltbot voicecall</code>）。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="插件-api概述">插件 API（概述）<a href="#插件-api概述" class="hash-link" aria-label="插件 API（概述）的直接链接" title="插件 API（概述）的直接链接" translate="no">​</a></h2>
<p>插件导出以下任一项：</p>
<ul>
<li class="">函数：<code>(api) =&gt; { ... }</code></li>
<li class="">对象：<code>{ id, name, configSchema, register(api) { ... } }</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="插件钩子">插件钩子<a href="#插件钩子" class="hash-link" aria-label="插件钩子的直接链接" title="插件钩子的直接链接" translate="no">​</a></h2>
<p>插件可以分发钩子并在运行时注册它们。这允许插件捆绑事件驱动的自动化，而无需单独的钩子包安装。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="示例">示例<a href="#示例" class="hash-link" aria-label="示例的直接链接" title="示例的直接链接" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">import { registerPluginHooksFromDir } from &quot;moltbot/plugin-sdk&quot;;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">export default function register(api) {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  registerPluginHooksFromDir(api, &quot;./hooks&quot;);</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>注意事项：</p>
<ul>
<li class="">钩子目录遵循正常的钩子结构（<code>HOOK.md</code> + <code>handler.ts</code>）。</li>
<li class="">钩子资格规则仍然适用（操作系统/二进制文件/环境/配置要求）。</li>
<li class="">插件管理的钩子在 <code>moltbot hooks list</code> 中显示为 <code>plugin:&lt;id&gt;</code>。</li>
<li class="">您无法通过 <code>moltbot hooks</code> 启用/禁用插件管理的钩子；而是启用/禁用插件。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="提供者插件模型认证">提供者插件（模型认证）<a href="#提供者插件模型认证" class="hash-link" aria-label="提供者插件（模型认证）的直接链接" title="提供者插件（模型认证）的直接链接" translate="no">​</a></h2>
<p>插件可以注册 <strong>模型提供者认证</strong> 流程，以便用户可以在 Moltbot 内部运行 OAuth 或 API 密钥设置（无需外部脚本）。</p>
<p>通过 <code>api.registerProvider(...)</code> 注册提供者。每个提供者公开一个或多个认证方法（OAuth、API 密钥、设备代码等）。这些方法支持：</p>
<ul>
<li class=""><code>moltbot models auth login --provider &lt;id&gt; [--method &lt;id&gt;]</code></li>
</ul>
<p>示例：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerProvider</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acme&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  label</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;AcmeAI&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  auth</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;oauth&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      label</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;OAuth&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      kind</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;oauth&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token function-variable function" style="color:#82AAFF">run</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token comment" style="color:#637777;font-style:italic">// 运行 OAuth 流程并返回认证配置文件。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token keyword" style="color:#C792EA">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          profiles</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">            </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">              profileId</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acme:default&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">              credential</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">                type</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;oauth&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">                provider</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acme&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">                access</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;...&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">                refresh</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;...&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">                expires</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">now</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">+</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">3600</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">*</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">1000</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">              </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">            </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          defaultModel</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acme/opus-1&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><br></span></code></pre></div></div>
<p>注意事项：</p>
<ul>
<li class=""><code>run</code> 接收带有 <code>prompter</code>、<code>runtime</code>、<code>openUrl</code> 和 <code>oauth.createVpsAwareHandlers</code> 助手的 <code>ProviderAuthContext</code>。</li>
<li class="">当您需要添加默认模型或提供者配置时返回 <code>configPatch</code>。</li>
<li class="">返回 <code>defaultModel</code> 以便 <code>--set-default</code> 可以更新代理默认值。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="注册消息通道">注册消息通道<a href="#注册消息通道" class="hash-link" aria-label="注册消息通道的直接链接" title="注册消息通道的直接链接" translate="no">​</a></h3>
<p>插件可以注册行为类似于内置通道的 <strong>通道插件</strong>（WhatsApp、Telegram 等）。通道配置位于 <code>channels.&lt;id&gt;</code> 下，并由您的通道插件代码验证。</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token keyword" style="color:#C792EA">const</span><span class="token plain"> myChannel </span><span class="token operator" style="color:#7FDBCA">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acmechat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  meta</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acmechat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    label</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;AcmeChat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    selectionLabel</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;AcmeChat (API)&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    docsPath</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/channels/acmechat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    blurb</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;演示通道插件。&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    aliases</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;acme&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  capabilities</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> chatTypes</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;direct&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  config</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">listAccountIds</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">keys</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">channels</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">acmechat</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">accounts </span><span class="token operator" style="color:#7FDBCA">??</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">resolveAccount</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> accountId</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">channels</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">acmechat</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">accounts</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain">accountId </span><span class="token operator" style="color:#7FDBCA">??</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;default&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">??</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> accountId </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  outbound</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    deliveryMode</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;direct&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">sendText</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> ok</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token keyword" style="color:#C792EA">export</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">default</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerChannel</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> plugin</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> myChannel </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>注意事项：</p>
<ul>
<li class="">将配置放在 <code>channels.&lt;id&gt;</code> 下（不在 <code>plugins.entries</code> 中）。</li>
<li class=""><code>meta.label</code> 用于 CLI/UI 列表中的标签。</li>
<li class=""><code>meta.aliases</code> 添加备用 ID 用于规范化和 CLI 输入。</li>
<li class=""><code>meta.preferOver</code> 列出当两者都配置时要跳过的通道 ID。</li>
<li class=""><code>meta.detailLabel</code> 和 <code>meta.systemImage</code> 让 UI 显示更丰富的通道标签/图标。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="编写新消息通道逐步指南">编写新消息通道（逐步指南）<a href="#编写新消息通道逐步指南" class="hash-link" aria-label="编写新消息通道（逐步指南）的直接链接" title="编写新消息通道（逐步指南）的直接链接" translate="no">​</a></h3>
<p>当您想要 <strong>新聊天界面</strong>（&quot;消息通道&quot;）而不是模型提供者时使用此方法。
模型提供者文档位于 <code>/providers/*</code> 下。</p>
<ol>
<li class="">选择 ID + 配置形状</li>
</ol>
<ul>
<li class="">所有通道配置都位于 <code>channels.&lt;id&gt;</code> 下。</li>
<li class="">对于多账户设置，优先使用 <code>channels.&lt;id&gt;.accounts.&lt;accountId&gt;</code>。</li>
</ul>
<ol start="2">
<li class="">定义通道元数据</li>
</ol>
<ul>
<li class=""><code>meta.label</code>、<code>meta.selectionLabel</code>、<code>meta.docsPath</code>、<code>meta.blurb</code> 控制 CLI/UI 列表。</li>
<li class=""><code>meta.docsPath</code> 应指向像 <code>/channels/&lt;id&gt;</code> 这样的文档页面。</li>
<li class=""><code>meta.preferOver</code> 让插件替换另一个通道（自动启用优先考虑它）。</li>
<li class=""><code>meta.detailLabel</code> 和 <code>meta.systemImage</code> 由 UI 用于详细文本/图标。</li>
</ul>
<ol start="3">
<li class="">实现必需的适配器</li>
</ol>
<ul>
<li class=""><code>config.listAccountIds</code> + <code>config.resolveAccount</code></li>
<li class=""><code>capabilities</code>（聊天类型、媒体、线程等）</li>
<li class=""><code>outbound.deliveryMode</code> + <code>outbound.sendText</code>（用于基本发送）</li>
</ul>
<ol start="4">
<li class="">根据需要添加可选适配器</li>
</ol>
<ul>
<li class=""><code>setup</code>（向导）、<code>security</code>（DM 策略）、<code>status</code>（健康/诊断）</li>
<li class=""><code>gateway</code>（启动/停止/登录）、<code>mentions</code>、<code>threading</code>、<code>streaming</code></li>
<li class=""><code>actions</code>（消息操作）、<code>commands</code>（原生命令行为）</li>
</ul>
<ol start="5">
<li class="">在您的插件中注册通道</li>
</ol>
<ul>
<li class=""><code>api.registerChannel({ plugin })</code></li>
</ul>
<p>最小配置示例：</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  channels: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    acmechat: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      accounts: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        default: { token: &quot;ACME_TOKEN&quot;, enabled: true }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>最小通道插件（仅出站）：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token keyword" style="color:#C792EA">const</span><span class="token plain"> plugin </span><span class="token operator" style="color:#7FDBCA">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acmechat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  meta</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;acmechat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    label</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;AcmeChat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    selectionLabel</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;AcmeChat (API)&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    docsPath</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/channels/acmechat&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    blurb</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;AcmeChat 消息通道。&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    aliases</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;acme&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  capabilities</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> chatTypes</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;direct&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  config</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">listAccountIds</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> Object</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">keys</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">channels</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">acmechat</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">accounts </span><span class="token operator" style="color:#7FDBCA">??</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">resolveAccount</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> accountId</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">channels</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">acmechat</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token plain">accounts</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain">accountId </span><span class="token operator" style="color:#7FDBCA">??</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;default&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">??</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> accountId </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  outbound</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    deliveryMode</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;direct&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">sendText</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> text </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token comment" style="color:#637777;font-style:italic">// 在此处将 `text` 交付到您的通道</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token keyword" style="color:#C792EA">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> ok</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token keyword" style="color:#C792EA">export</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">default</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerChannel</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> plugin </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>加载插件（扩展目录或 <code>plugins.load.paths</code>），重启网关，
然后在配置中配置 <code>channels.&lt;id&gt;</code>。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="代理工具">代理工具<a href="#代理工具" class="hash-link" aria-label="代理工具的直接链接" title="代理工具的直接链接" translate="no">​</a></h3>
<p>请参见专用指南：<a class="" href="/moltbot-doc/plugins/agent-tools">插件代理工具</a>。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="注册网关-rpc-方法">注册网关 RPC 方法<a href="#注册网关-rpc-方法" class="hash-link" aria-label="注册网关 RPC 方法的直接链接" title="注册网关 RPC 方法的直接链接" translate="no">​</a></h3>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token keyword" style="color:#C792EA">export</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">default</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerGatewayMethod</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token string" style="color:#ECC48D">&quot;myplugin.status&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> respond </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function" style="color:#82AAFF">respond</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token boolean" style="color:#F78C6C">true</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> ok</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="注册-cli-命令">注册 CLI 命令<a href="#注册-cli-命令" class="hash-link" aria-label="注册 CLI 命令的直接链接" title="注册 CLI 命令的直接链接" translate="no">​</a></h3>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token keyword" style="color:#C792EA">export</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">default</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerCli</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> program </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    program</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">command</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token string" style="color:#ECC48D">&quot;mycmd&quot;</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">action</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token builtin" style="color:#ADDB67">console</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">log</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token string" style="color:#ECC48D">&quot;Hello&quot;</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> commands</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;mycmd&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="注册自动回复命令">注册自动回复命令<a href="#注册自动回复命令" class="hash-link" aria-label="注册自动回复命令的直接链接" title="注册自动回复命令的直接链接" translate="no">​</a></h3>
<p>插件可以注册在 <strong>不调用 AI 代理</strong> 的情况下执行的自定义斜杠命令。这对于切换命令、状态检查或不需要 LLM 处理的快速操作很有用。</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token keyword" style="color:#C792EA">export</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">default</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerCommand</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    name</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;mystatus&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    description</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;显示插件状态&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">handler</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      text</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#ECC48D">`</span><span class="token template-string string" style="color:#ECC48D">插件正在运行！通道：</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#C792EA">${</span><span class="token template-string interpolation">ctx</span><span class="token template-string interpolation punctuation" style="color:#C792EA">.</span><span class="token template-string interpolation">channel</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#C792EA">}</span><span class="token template-string template-punctuation string" style="color:#ECC48D">`</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>命令处理程序上下文：</p>
<ul>
<li class=""><code>senderId</code>：发送者 ID（如果可用）</li>
<li class=""><code>channel</code>：发送命令的通道</li>
<li class=""><code>isAuthorizedSender</code>：发送者是否为授权用户</li>
<li class=""><code>args</code>：命令后传递的参数（如果 <code>acceptsArgs: true</code>）</li>
<li class=""><code>commandBody</code>：完整的命令文本</li>
<li class=""><code>config</code>：当前 Moltbot 配置</li>
</ul>
<p>命令选项：</p>
<ul>
<li class=""><code>name</code>：命令名称（不带前导 <code>/</code>）</li>
<li class=""><code>description</code>：在命令列表中显示的帮助文本</li>
<li class=""><code>acceptsArgs</code>：命令是否接受参数（默认：false）。如果为 false 并提供了参数，则命令不会匹配，消息会传递给其他处理程序</li>
<li class=""><code>requireAuth</code>：是否需要授权发送者（默认：true）</li>
<li class=""><code>handler</code>：返回 <code>{ text: string }</code> 的函数（可以是异步的）</li>
</ul>
<p>带授权和参数的示例：</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerCommand</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  name</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;setmode&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  description</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;设置插件模式&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  acceptsArgs</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  requireAuth</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token function-variable function" style="color:#82AAFF">handler</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token keyword" style="color:#C792EA">const</span><span class="token plain"> mode </span><span class="token operator" style="color:#7FDBCA">=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">args</span><span class="token operator" style="color:#7FDBCA">?.</span><span class="token function" style="color:#82AAFF">trim</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">||</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;default&quot;</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token keyword" style="color:#C792EA">await</span><span class="token plain"> </span><span class="token function" style="color:#82AAFF">saveMode</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">mode</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token keyword" style="color:#C792EA">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> text</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#ECC48D">`</span><span class="token template-string string" style="color:#ECC48D">模式设置为：</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#C792EA">${</span><span class="token template-string interpolation">mode</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#C792EA">}</span><span class="token template-string template-punctuation string" style="color:#ECC48D">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><br></span></code></pre></div></div>
<p>注意事项：</p>
<ul>
<li class="">插件命令在 <strong>内置命令和 AI 代理之前</strong> 处理</li>
<li class="">命令是全局注册的，在所有通道中都有效</li>
<li class="">命令名称不区分大小写（<code>/MyStatus</code> 匹配 <code>/mystatus</code>）</li>
<li class="">命令名称必须以字母开头，只能包含字母、数字、连字符和下划线</li>
<li class="">保留命令名称（如 <code>help</code>、<code>status</code>、<code>reset</code> 等）不能被插件覆盖</li>
<li class="">跨插件的重复命令注册将因诊断错误而失败</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="注册后台服务">注册后台服务<a href="#注册后台服务" class="hash-link" aria-label="注册后台服务的直接链接" title="注册后台服务的直接链接" translate="no">​</a></h3>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token keyword" style="color:#C792EA">export</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">default</span><span class="token plain"> </span><span class="token keyword" style="color:#C792EA">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token plain">api</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">registerService</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;my-service&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">start</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">info</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token string" style="color:#ECC48D">&quot;ready&quot;</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token function-variable function" style="color:#82AAFF">stop</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">(</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token plain"> </span><span class="token operator" style="color:#7FDBCA">=&gt;</span><span class="token plain"> api</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:#C792EA">.</span><span class="token function" style="color:#82AAFF">info</span><span class="token punctuation" style="color:#C792EA">(</span><span class="token string" style="color:#ECC48D">&quot;bye&quot;</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">)</span><span class="token punctuation" style="color:#C792EA">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="命名约定">命名约定<a href="#命名约定" class="hash-link" aria-label="命名约定的直接链接" title="命名约定的直接链接" translate="no">​</a></h2>
<ul>
<li class="">网关方法：<code>pluginId.action</code>（示例：<code>voicecall.status</code>）</li>
<li class="">工具：<code>snake_case</code>（示例：<code>voice_call</code>）</li>
<li class="">CLI 命令：连字符或驼峰，但避免与核心命令冲突</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="技能">技能<a href="#技能" class="hash-link" aria-label="技能的直接链接" title="技能的直接链接" translate="no">​</a></h2>
<p>插件可以在仓库中分发技能（<code>skills/&lt;name&gt;/SKILL.md</code>）。
使用 <code>plugins.entries.&lt;id&gt;.enabled</code>（或其他配置门）启用它，并确保它存在于您的工作区/管理技能位置。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="分发npm">分发（npm）<a href="#分发npm" class="hash-link" aria-label="分发（npm）的直接链接" title="分发（npm）的直接链接" translate="no">​</a></h2>
<p>推荐的打包：</p>
<ul>
<li class="">主包：<code>moltbot</code>（此仓库）</li>
<li class="">插件：在 <code>@moltbot/*</code> 下的单独 npm 包（示例：<code>@moltbot/voice-call</code>）</li>
</ul>
<p>发布合同：</p>
<ul>
<li class="">插件 <code>package.json</code> 必须包含 <code>moltbot.extensions</code> 和一个或多个入口文件。</li>
<li class="">入口文件可以是 <code>.js</code> 或 <code>.ts</code>（jiti 在运行时加载 TS）。</li>
<li class=""><code>moltbot plugins install &lt;npm-spec&gt;</code> 使用 <code>npm pack</code>，提取到 <code>~/.clawdbot/extensions/&lt;id&gt;/</code>，并在配置中启用它。</li>
<li class="">配置键稳定性：作用域包被规范化为 <strong>无作用域</strong> ID 用于 <code>plugins.entries.*</code>。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="示例插件语音通话">示例插件：语音通话<a href="#示例插件语音通话" class="hash-link" aria-label="示例插件：语音通话的直接链接" title="示例插件：语音通话的直接链接" translate="no">​</a></h2>
<p>此仓库包含一个语音通话插件（Twilio 或日志回退）：</p>
<ul>
<li class="">源码：<code>extensions/voice-call</code></li>
<li class="">技能：<code>skills/voice-call</code></li>
<li class="">CLI：<code>moltbot voicecall start|status</code></li>
<li class="">工具：<code>voice_call</code></li>
<li class="">RPC：<code>voicecall.start</code>, <code>voicecall.status</code></li>
<li class="">配置（twilio）：<code>provider: &quot;twilio&quot;</code> + <code>twilio.accountSid/authToken/from</code>（可选 <code>statusCallbackUrl</code>, <code>twimlUrl</code>）</li>
<li class="">配置（开发）：<code>provider: &quot;log&quot;</code>（无网络）</li>
</ul>
<p>请参见 <a class="" href="/moltbot-doc/plugins/voice-call">语音通话</a> 和 <code>extensions/voice-call/README.md</code> 了解设置和使用。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="安全注意事项">安全注意事项<a href="#安全注意事项" class="hash-link" aria-label="安全注意事项的直接链接" title="安全注意事项的直接链接" translate="no">​</a></h2>
<p>插件与网关在进程中运行。将它们视为可信代码：</p>
<ul>
<li class="">只安装您信任的插件。</li>
<li class="">优先使用 <code>plugins.allow</code> 白名单。</li>
<li class="">更改后重启网关。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="测试插件">测试插件<a href="#测试插件" class="hash-link" aria-label="测试插件的直接链接" title="测试插件的直接链接" translate="no">​</a></h2>
<p>插件可以（并且应该）分发测试：</p>
<ul>
<li class="">仓库内的插件可以在 <code>src/**</code> 下保留 Vitest 测试（示例：<code>src/plugins/voice-call.plugin.test.ts</code>）。</li>
<li class="">单独发布的插件应运行自己的 CI（lint/build/test）并验证 <code>moltbot.extensions</code> 指向构建的入口点（<code>dist/index.js</code>）。</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#快速入门插件新手" class="table-of-contents__link toc-highlight">快速入门（插件新手？）</a></li><li><a href="#可用插件官方" class="table-of-contents__link toc-highlight">可用插件（官方）</a></li><li><a href="#运行时助手" class="table-of-contents__link toc-highlight">运行时助手</a></li><li><a href="#发现与优先级" class="table-of-contents__link toc-highlight">发现与优先级</a><ul><li><a href="#包集合" class="table-of-contents__link toc-highlight">包集合</a></li><li><a href="#频道目录元数据" class="table-of-contents__link toc-highlight">频道目录元数据</a></li></ul></li><li><a href="#插件-id" class="table-of-contents__link toc-highlight">插件 ID</a></li><li><a href="#配置" class="table-of-contents__link toc-highlight">配置</a></li><li><a href="#插件槽独占类别" class="table-of-contents__link toc-highlight">插件槽（独占类别）</a></li><li><a href="#控制界面模式--标签" class="table-of-contents__link toc-highlight">控制界面（模式 + 标签）</a></li><li><a href="#cli" class="table-of-contents__link toc-highlight">CLI</a></li><li><a href="#插件-api概述" class="table-of-contents__link toc-highlight">插件 API（概述）</a></li><li><a href="#插件钩子" class="table-of-contents__link toc-highlight">插件钩子</a><ul><li><a href="#示例" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#提供者插件模型认证" class="table-of-contents__link toc-highlight">提供者插件（模型认证）</a><ul><li><a href="#注册消息通道" class="table-of-contents__link toc-highlight">注册消息通道</a></li><li><a href="#编写新消息通道逐步指南" class="table-of-contents__link toc-highlight">编写新消息通道（逐步指南）</a></li><li><a href="#代理工具" class="table-of-contents__link toc-highlight">代理工具</a></li><li><a href="#注册网关-rpc-方法" class="table-of-contents__link toc-highlight">注册网关 RPC 方法</a></li><li><a href="#注册-cli-命令" class="table-of-contents__link toc-highlight">注册 CLI 命令</a></li><li><a href="#注册自动回复命令" class="table-of-contents__link toc-highlight">注册自动回复命令</a></li><li><a href="#注册后台服务" class="table-of-contents__link toc-highlight">注册后台服务</a></li></ul></li><li><a href="#命名约定" class="table-of-contents__link toc-highlight">命名约定</a></li><li><a href="#技能" class="table-of-contents__link toc-highlight">技能</a></li><li><a href="#分发npm" class="table-of-contents__link toc-highlight">分发（npm）</a></li><li><a href="#示例插件语音通话" class="table-of-contents__link toc-highlight">示例插件：语音通话</a></li><li><a href="#安全注意事项" class="table-of-contents__link toc-highlight">安全注意事项</a></li><li><a href="#测试插件" class="table-of-contents__link toc-highlight">测试插件</a></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Moltbot Docs.</div></div></div></footer></div>
</body>
</html>