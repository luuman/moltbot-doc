<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-concepts/multi-agent" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">多代理路由 | Moltbot Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/moltbot-doc/docs/concepts/multi-agent"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="多代理路由 | Moltbot Docs"><meta data-rh="true" name="description" content="目标：多个 隔离 代理（单独的工作区 + agentDir + 会话），以及一个运行网关中的多个通道账户（例如两个 WhatsApp）。入站通过绑定路由到代理。"><meta data-rh="true" property="og:description" content="目标：多个 隔离 代理（单独的工作区 + agentDir + 会话），以及一个运行网关中的多个通道账户（例如两个 WhatsApp）。入站通过绑定路由到代理。"><link data-rh="true" rel="icon" href="/moltbot-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/moltbot-doc/docs/concepts/multi-agent"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/concepts/multi-agent" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/concepts/multi-agent" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/moltbot-doc/blog/rss.xml" title="Moltbot Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/moltbot-doc/blog/atom.xml" title="Moltbot Docs Atom Feed"><link rel="stylesheet" href="/moltbot-doc/assets/css/styles.484b4c98.css">
<script src="/moltbot-doc/assets/js/runtime~main.6cf495cf.js" defer="defer"></script>
<script src="/moltbot-doc/assets/js/main.f9205183.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/moltbot-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Moltbot</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/claude-doc/docs" class="dropdownMenuItem_VBaP">Claude</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/moltbot-doc/docs">Docs</a><a class="navLink_RnnM" href="/moltbot-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>多代理路由</h1></header>
<p>目标：多个 <em>隔离</em> 代理（单独的工作区 + <code>agentDir</code> + 会话），以及一个运行网关中的多个通道账户（例如两个 WhatsApp）。入站通过绑定路由到代理。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="什么是一个代理">什么是&quot;一个代理&quot;？<a href="#什么是一个代理" class="hash-link" aria-label="什么是&quot;一个代理&quot;？的直接链接" title="什么是&quot;一个代理&quot;？的直接链接" translate="no">​</a></h2>
<p>一个 <strong>代理</strong> 是一个完全作用域的大脑，拥有自己的：</p>
<ul>
<li class=""><strong>工作区</strong>（文件、AGENTS.md/SOUL.md/USER.md、本地注释、个性规则）。</li>
<li class=""><strong>状态目录</strong>（<code>agentDir</code>）用于认证配置文件、模型注册表和每个代理配置。</li>
<li class=""><strong>会话存储</strong>（聊天历史 + 路由状态）在 <code>~/.clawdbot/agents/&lt;agentId&gt;/sessions</code> 下。</li>
</ul>
<p>认证配置文件是 <strong>每个代理</strong>。每个代理从自己的读取：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">~/.clawdbot/agents/&lt;agentId&gt;/agent/auth-profiles.json</span><br></span></code></pre></div></div>
<p>主代理凭证 <strong>不</strong> 自动共享。切勿在代理间重用 <code>agentDir</code>
（它会导致认证/会话冲突）。如果您想共享凭证，
将 <code>auth-profiles.json</code> 复制到另一个代理的 <code>agentDir</code>。</p>
<p>技能通过每个工作区的 <code>skills/</code> 文件夹每个代理，共享技能
从 <code>~/.clawdbot/skills</code> 可用。参见 <a class="" href="/moltbot-doc/tools/skills#per-agent-vs-shared-skills">技能：每个代理 vs 共享</a>。</p>
<p>网关可以托管 <strong>一个代理</strong>（默认）或 <strong>多个代理</strong> 并排。</p>
<p><strong>工作区说明：</strong> 每个代理的工作区是 <strong>默认 cwd</strong>，不是一个硬
沙盒。相对路径在工作区内解析，但绝对路径可以
到达其他主机位置，除非启用了沙盒。参见
<a class="" href="/moltbot-doc/gateway/sandboxing">沙盒</a>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="路径快速映射">路径（快速映射）<a href="#路径快速映射" class="hash-link" aria-label="路径（快速映射）的直接链接" title="路径（快速映射）的直接链接" translate="no">​</a></h2>
<ul>
<li class="">配置：<code>~/.clawdbot/moltbot.json</code>（或 <code>CLAWDBOT_CONFIG_PATH</code>）</li>
<li class="">状态目录：<code>~/.clawdbot</code>（或 <code>CLAWDBOT_STATE_DIR</code>）</li>
<li class="">工作区：<code>~/clawd</code>（或 <code>~/clawd-&lt;agentId&gt;</code>）</li>
<li class="">代理目录：<code>~/.clawdbot/agents/&lt;agentId&gt;/agent</code>（或 <code>agents.list[].agentDir</code>）</li>
<li class="">会话：<code>~/.clawdbot/agents/&lt;agentId&gt;/sessions</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="单代理模式默认">单代理模式（默认）<a href="#单代理模式默认" class="hash-link" aria-label="单代理模式（默认）的直接链接" title="单代理模式（默认）的直接链接" translate="no">​</a></h3>
<p>如果您什么都不做，Moltbot 运行单个代理：</p>
<ul>
<li class=""><code>agentId</code> 默认为 <strong><code>main</code></strong>。</li>
<li class="">会话键入为 <code>agent:main:&lt;mainKey&gt;</code>。</li>
<li class="">工作区默认为 <code>~/clawd</code>（或当设置 <code>CLAWDBOT_PROFILE</code> 时为 <code>~/clawd-&lt;profile&gt;</code>）。</li>
<li class="">状态默认为 <code>~/.clawdbot/agents/main/agent</code>。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="代理助手">代理助手<a href="#代理助手" class="hash-link" aria-label="代理助手的直接链接" title="代理助手的直接链接" translate="no">​</a></h2>
<p>使用代理向导添加新的隔离代理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot agents add work</span><br></span></code></pre></div></div>
<p>然后添加 <code>bindings</code>（或让向导执行）以路由入站消息。</p>
<p>验证：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot agents list --bindings</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="多个代理--多个人多个个性">多个代理 = 多个人，多个个性<a href="#多个代理--多个人多个个性" class="hash-link" aria-label="多个代理 = 多个人，多个个性的直接链接" title="多个代理 = 多个人，多个个性的直接链接" translate="no">​</a></h2>
<p>使用 <strong>多个代理</strong>，每个 <code>agentId</code> 成为一个 <strong>完全隔离的个性</strong>：</p>
<ul>
<li class=""><strong>不同电话号码/账户</strong>（每个通道 <code>accountId</code>）。</li>
<li class=""><strong>不同个性</strong>（每个代理工作区文件如 <code>AGENTS.md</code> 和 <code>SOUL.md</code>）。</li>
<li class=""><strong>分离认证 + 会话</strong>（除非明确启用，否则无交叉通信）。</li>
</ul>
<p>这允许 <strong>多个人</strong> 共享一个网关服务器，同时保持他们的 AI&quot;大脑&quot;和数据隔离。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="一个-whatsapp-号码多个人dm-分割">一个 WhatsApp 号码，多个人（DM 分割）<a href="#一个-whatsapp-号码多个人dm-分割" class="hash-link" aria-label="一个 WhatsApp 号码，多个人（DM 分割）的直接链接" title="一个 WhatsApp 号码，多个人（DM 分割）的直接链接" translate="no">​</a></h2>
<p>您可以在 <strong>一个 WhatsApp 账户</strong> 上路由 <strong>不同的 WhatsApp DM</strong> 到不同代理。按发送者 E.164（如 <code>+15551234567</code>）匹配，使用 <code>peer.kind: &quot;dm&quot;</code>。回复仍来自同一个 WhatsApp 号码（无每个代理发送者身份）。</p>
<p>重要细节：直接聊天合并到代理的 <strong>主会话键</strong>，所以真正的隔离需要 <strong>每个人一个代理</strong>。</p>
<p>示例：</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  agents: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    list: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      { id: &quot;alex&quot;, workspace: &quot;~/clawd-alex&quot; },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      { id: &quot;mia&quot;, workspace: &quot;~/clawd-mia&quot; }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  bindings: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    { agentId: &quot;alex&quot;, match: { channel: &quot;whatsapp&quot;, peer: { kind: &quot;dm&quot;, id: &quot;+15551230001&quot; } } },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    { agentId: &quot;mia&quot;,  match: { channel: &quot;whatsapp&quot;, peer: { kind: &quot;dm&quot;, id: &quot;+15551230002&quot; } } }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  channels: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    whatsapp: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      dmPolicy: &quot;allowlist&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      allowFrom: [&quot;+15551230001&quot;, &quot;+15551230002&quot;]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>说明：</p>
<ul>
<li class="">DM 访问控制是 <strong>每个 WhatsApp 账户全局</strong>（配对/白名单），不是每个代理。</li>
<li class="">对于共享群组，将群组绑定到一个代理或使用 <a class="" href="/moltbot-doc/broadcast-groups">广播组</a>。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="路由规则消息如何选择代理">路由规则（消息如何选择代理）<a href="#路由规则消息如何选择代理" class="hash-link" aria-label="路由规则（消息如何选择代理）的直接链接" title="路由规则（消息如何选择代理）的直接链接" translate="no">​</a></h2>
<p>绑定是 <strong>确定性的</strong> 和 <strong>最具体获胜</strong>：</p>
<ol>
<li class=""><code>peer</code> 匹配（确切的 DM/群组/通道 id）</li>
<li class=""><code>guildId</code>（Discord）</li>
<li class=""><code>teamId</code>（Slack）</li>
<li class="">通道的 <code>accountId</code> 匹配</li>
<li class="">通道级匹配（<code>accountId: &quot;*&quot;</code>）</li>
<li class="">回退到默认代理（<code>agents.list[].default</code>，否则是第一个列表条目，默认：<code>main</code>）</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="多个账户电话号码">多个账户/电话号码<a href="#多个账户电话号码" class="hash-link" aria-label="多个账户/电话号码的直接链接" title="多个账户/电话号码的直接链接" translate="no">​</a></h2>
<p>支持 <strong>多个账户</strong>（例如 WhatsApp）的通道使用 <code>accountId</code> 来识别
每个登录。每个 <code>accountId</code> 可以路由到不同的代理，所以一台服务器可以托管
多个电话号码而不混合会话。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="概念">概念<a href="#概念" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><code>agentId</code>：一个&quot;大脑&quot;（工作区、每个代理认证、每个代理会话存储）。</li>
<li class=""><code>accountId</code>：一个通道账户实例（例如 WhatsApp 账户 &quot;personal&quot; vs &quot;biz&quot;）。</li>
<li class=""><code>binding</code>：通过 <code>(channel, accountId, peer)</code> 将入站消息路由到 <code>agentId</code>，可选地还有公会/团队 id。</li>
<li class="">直接聊天合并到 <code>agent:&lt;agentId&gt;:&lt;mainKey&gt;</code>（每个代理&quot;主&quot;；<code>session.mainKey</code>）。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="示例两个-whatsapp--两个代理">示例：两个 WhatsApp → 两个代理<a href="#示例两个-whatsapp--两个代理" class="hash-link" aria-label="示例：两个 WhatsApp → 两个代理的直接链接" title="示例：两个 WhatsApp → 两个代理的直接链接" translate="no">​</a></h2>
<p><code>~/.clawdbot/moltbot.json</code>（JSON5）：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token literal-property property" style="color:#F78C6C">agents</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token literal-property property" style="color:#F78C6C">list</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;home&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token keyword module" style="color:#C792EA">default</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">name</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;Home&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">workspace</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/clawd-home&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">agentDir</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/.clawdbot/agents/home/agent&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;work&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">name</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;Work&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">workspace</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/clawd-work&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">agentDir</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/.clawdbot/agents/work/agent&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token comment" style="color:#637777;font-style:italic">// 确定性路由：第一个匹配获胜（最具体的优先）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token literal-property property" style="color:#F78C6C">bindings</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">agentId</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;home&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">match</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">channel</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;whatsapp&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">accountId</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;personal&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">agentId</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;work&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">match</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">channel</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;whatsapp&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">accountId</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;biz&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token comment" style="color:#637777;font-style:italic">// 可选的每个对等覆盖（示例：将特定群组发送到工作代理）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token literal-property property" style="color:#F78C6C">agentId</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;work&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token literal-property property" style="color:#F78C6C">match</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">channel</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;whatsapp&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">accountId</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;personal&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">peer</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">kind</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;group&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F78C6C">id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;1203630...@g.us&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token comment" style="color:#637777;font-style:italic">// 默认关闭：代理到代理消息必须明确启用 + 白名单。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token literal-property property" style="color:#F78C6C">tools</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token literal-property property" style="color:#F78C6C">agentToAgent</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token literal-property property" style="color:#F78C6C">enabled</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">false</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token literal-property property" style="color:#F78C6C">allow</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;home&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;work&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token literal-property property" style="color:#F78C6C">channels</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token literal-property property" style="color:#F78C6C">whatsapp</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token literal-property property" style="color:#F78C6C">accounts</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">personal</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token comment" style="color:#637777;font-style:italic">// 可选覆盖。默认：~/.clawdbot/credentials/whatsapp/personal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token comment" style="color:#637777;font-style:italic">// authDir: &quot;~/.clawdbot/credentials/whatsapp/personal&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">biz</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token comment" style="color:#637777;font-style:italic">// 可选覆盖。默认：~/.clawdbot/credentials/whatsapp/biz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token comment" style="color:#637777;font-style:italic">// authDir: &quot;~/.clawdbot/credentials/whatsapp/biz&quot;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="示例whatsapp-日常聊天--telegram-深度工作">示例：WhatsApp 日常聊天 + Telegram 深度工作<a href="#示例whatsapp-日常聊天--telegram-深度工作" class="hash-link" aria-label="示例：WhatsApp 日常聊天 + Telegram 深度工作的直接链接" title="示例：WhatsApp 日常聊天 + Telegram 深度工作的直接链接" translate="no">​</a></h2>
<p>按通道分割：将 WhatsApp 路由到快速日常代理，将 Telegram 路由到 Opus 代理。</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  agents: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    list: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        id: &quot;chat&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        name: &quot;Everyday&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        workspace: &quot;~/clawd-chat&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        model: &quot;anthropic/claude-sonnet-4-5&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        id: &quot;opus&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        name: &quot;Deep Work&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        workspace: &quot;~/clawd-opus&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        model: &quot;anthropic/claude-opus-4-5&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  bindings: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    { agentId: &quot;chat&quot;, match: { channel: &quot;whatsapp&quot; } },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    { agentId: &quot;opus&quot;, match: { channel: &quot;telegram&quot; } }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>说明：</p>
<ul>
<li class="">如果您有通道的多个账户，请在绑定中添加 <code>accountId</code>（例如 <code>{ channel: &quot;whatsapp&quot;, accountId: &quot;personal&quot; }</code>）。</li>
<li class="">要将单个 DM/群组路由到 Opus，同时保持其余在聊天上，请为该对等添加 <code>match.peer</code> 绑定；对等匹配总是胜过通道范围规则。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="示例相同通道一个对等到-opus">示例：相同通道，一个对等到 Opus<a href="#示例相同通道一个对等到-opus" class="hash-link" aria-label="示例：相同通道，一个对等到 Opus的直接链接" title="示例：相同通道，一个对等到 Opus的直接链接" translate="no">​</a></h2>
<p>保持 WhatsApp 在快速代理上，但将一个 DM 路由到 Opus：</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  agents: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    list: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      { id: &quot;chat&quot;, name: &quot;Everyday&quot;, workspace: &quot;~/clawd-chat&quot;, model: &quot;anthropic/claude-sonnet-4-5&quot; },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      { id: &quot;opus&quot;, name: &quot;Deep Work&quot;, workspace: &quot;~/clawd-opus&quot;, model: &quot;anthropic/claude-opus-4-5&quot; }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  bindings: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    { agentId: &quot;opus&quot;, match: { channel: &quot;whatsapp&quot;, peer: { kind: &quot;dm&quot;, id: &quot;+15551234567&quot; } } },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    { agentId: &quot;chat&quot;, match: { channel: &quot;whatsapp&quot; } }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>对等绑定总是获胜，所以将它们保持在通道范围规则之上。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="家庭代理绑定到-whatsapp-群组">家庭代理绑定到 WhatsApp 群组<a href="#家庭代理绑定到-whatsapp-群组" class="hash-link" aria-label="家庭代理绑定到 WhatsApp 群组的直接链接" title="家庭代理绑定到 WhatsApp 群组的直接链接" translate="no">​</a></h2>
<p>将专用家庭代理绑定到单个 WhatsApp 群组，带有提及门控
和更严格的工具策略：</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  agents: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    list: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        id: &quot;family&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        name: &quot;Family&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        workspace: &quot;~/clawd-family&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        identity: { name: &quot;Family Bot&quot; },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        groupChat: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          mentionPatterns: [&quot;@family&quot;, &quot;@familybot&quot;, &quot;@Family Bot&quot;]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        sandbox: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          mode: &quot;all&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          scope: &quot;agent&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        tools: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          allow: [&quot;exec&quot;, &quot;read&quot;, &quot;sessions_list&quot;, &quot;sessions_history&quot;, &quot;sessions_send&quot;, &quot;sessions_spawn&quot;, &quot;session_status&quot;],</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          deny: [&quot;write&quot;, &quot;edit&quot;, &quot;apply_patch&quot;, &quot;browser&quot;, &quot;canvas&quot;, &quot;nodes&quot;, &quot;cron&quot;]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  bindings: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      agentId: &quot;family&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      match: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        channel: &quot;whatsapp&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        peer: { kind: &quot;group&quot;, id: &quot;120363999999999999@g.us&quot; }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>说明：</p>
<ul>
<li class="">工具允许/拒绝列表是 <strong>工具</strong>，不是技能。如果技能需要运行
二进制文件，请确保允许 <code>exec</code> 并且二进制文件在沙盒中存在。</li>
<li class="">为了更严格的门控，设置 <code>agents.list[].groupChat.mentionPatterns</code> 并保持
通道的群组白名单启用。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="每代理沙盒和工具配置">每代理沙盒和工具配置<a href="#每代理沙盒和工具配置" class="hash-link" aria-label="每代理沙盒和工具配置的直接链接" title="每代理沙盒和工具配置的直接链接" translate="no">​</a></h2>
<p>从 v2026.1.6 开始，每个代理可以有自己的沙盒和工具限制：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token literal-property property" style="color:#F78C6C">agents</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token literal-property property" style="color:#F78C6C">list</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;personal&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">workspace</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/clawd-personal&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">sandbox</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token literal-property property" style="color:#F78C6C">mode</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;off&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain">  </span><span class="token comment" style="color:#637777;font-style:italic">// 个人代理无沙盒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token comment" style="color:#637777;font-style:italic">// 无工具限制 - 所有工具可用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">id</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;family&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">workspace</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/clawd-family&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">sandbox</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token literal-property property" style="color:#F78C6C">mode</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;all&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain">     </span><span class="token comment" style="color:#637777;font-style:italic">// 始终沙盒化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token literal-property property" style="color:#F78C6C">scope</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;agent&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain">  </span><span class="token comment" style="color:#637777;font-style:italic">// 每个代理一个容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token literal-property property" style="color:#F78C6C">docker</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">            </span><span class="token comment" style="color:#637777;font-style:italic">// 容器创建后可选的一次性设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">            </span><span class="token literal-property property" style="color:#F78C6C">setupCommand</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;apt-get update &amp;&amp; apt-get install -y git curl&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token literal-property property" style="color:#F78C6C">tools</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token literal-property property" style="color:#F78C6C">allow</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;read&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain">                    </span><span class="token comment" style="color:#637777;font-style:italic">// 仅读取工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token literal-property property" style="color:#F78C6C">deny</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;exec&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;write&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;edit&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;apply_patch&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain">    </span><span class="token comment" style="color:#637777;font-style:italic">// 拒绝其他</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>注意：<code>setupCommand</code> 位于 <code>sandbox.docker</code> 下，在容器创建时运行一次。
当解析的作用域为 &quot;shared&quot; 时，每个代理的 <code>sandbox.docker.*</code> 覆盖被忽略。</p>
<p><strong>好处：</strong></p>
<ul>
<li class=""><strong>安全隔离</strong>：为不受信任的代理限制工具</li>
<li class=""><strong>资源控制</strong>：沙盒特定代理，同时保持其他在主机上</li>
<li class=""><strong>灵活策略</strong>：每个代理不同权限</li>
</ul>
<p>注意：<code>tools.elevated</code> 是 <strong>全局</strong> 和基于发送者的；不能为每个代理配置。
如果您需要每个代理边界，请使用 <code>agents.list[].tools</code> 拒绝 <code>exec</code>。
对于群组定位，请使用 <code>agents.list[].groupChat.mentionPatterns</code>，以便 @提及清晰地映射到预期的代理。</p>
<p>参见 <a class="" href="/moltbot-doc/multi-agent-sandbox-tools">多代理沙盒和工具</a> 获取详细示例。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是一个代理" class="table-of-contents__link toc-highlight">什么是&quot;一个代理&quot;？</a></li><li><a href="#路径快速映射" class="table-of-contents__link toc-highlight">路径（快速映射）</a><ul><li><a href="#单代理模式默认" class="table-of-contents__link toc-highlight">单代理模式（默认）</a></li></ul></li><li><a href="#代理助手" class="table-of-contents__link toc-highlight">代理助手</a></li><li><a href="#多个代理--多个人多个个性" class="table-of-contents__link toc-highlight">多个代理 = 多个人，多个个性</a></li><li><a href="#一个-whatsapp-号码多个人dm-分割" class="table-of-contents__link toc-highlight">一个 WhatsApp 号码，多个人（DM 分割）</a></li><li><a href="#路由规则消息如何选择代理" class="table-of-contents__link toc-highlight">路由规则（消息如何选择代理）</a></li><li><a href="#多个账户电话号码" class="table-of-contents__link toc-highlight">多个账户/电话号码</a></li><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#示例两个-whatsapp--两个代理" class="table-of-contents__link toc-highlight">示例：两个 WhatsApp → 两个代理</a></li><li><a href="#示例whatsapp-日常聊天--telegram-深度工作" class="table-of-contents__link toc-highlight">示例：WhatsApp 日常聊天 + Telegram 深度工作</a></li><li><a href="#示例相同通道一个对等到-opus" class="table-of-contents__link toc-highlight">示例：相同通道，一个对等到 Opus</a></li><li><a href="#家庭代理绑定到-whatsapp-群组" class="table-of-contents__link toc-highlight">家庭代理绑定到 WhatsApp 群组</a></li><li><a href="#每代理沙盒和工具配置" class="table-of-contents__link toc-highlight">每代理沙盒和工具配置</a></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Moltbot Docs.</div></div></div></footer></div>
</body>
</html>