---
summary: "上下文窗口 + 压缩：Moltbot 如何保持会话在模型限制内"
read_when:
  - 您想了解自动压缩和 /compact 时
  - 您正在调试长时间会话达到上下文限制时
---
# 上下文窗口和压缩

每个模型都有一个 **上下文窗口**（它可以看到的最大 token 数）。长时间运行的聊天累积消息和工具结果；一旦窗口变紧，Moltbot **压缩** 较旧的历史记录以保持在限制内。

## 什么是压缩
压缩 **总结较早的对话** 到一个紧凑的摘要条目，并保持最近的消息不变。摘要存储在会话历史中，因此未来的请求使用：
- 压缩摘要
- 压缩点之后的最近消息

压缩 **持久化** 在会话的 JSONL 历史中。

## 配置
有关 `agents.defaults.compaction` 设置，请参阅 [压缩配置和模式](/concepts/compaction)。

## 自动压缩（默认开启）
当会话接近或超过模型的上下文窗口时，Moltbot 触发自动压缩，并可能使用压缩后的上下文重试原始请求。

您将看到：
- 详细模式下的 `🧹 自动压缩完成`
- `/status` 显示 `🧹 压缩次数: <count>`

压缩前，Moltbot 可以运行一个 **静默内存刷新** 回合以将持久性笔记存储到磁盘。详情和配置请参阅 [内存](/concepts/memory)。

## 手动压缩
使用 `/compact`（可选地附带指令）强制执行压缩：
```
/compact 关注决策和开放问题
```

## 上下文窗口来源
上下文窗口是模型特定的。Moltbot 使用来自配置提供程序目录的模型定义来确定限制。

## 压缩与修剪
- **压缩**：总结并 **持久化** 在 JSONL 中。
- **会话修剪**：仅修剪旧的 **工具结果**，**内存中**，按请求。

详情请参阅 [/concepts/session-pruning](/concepts/session-pruning) 了解修剪。

## 提示
- 当会话感觉陈旧或上下文膨胀时使用 `/compact`。
- 大型工具输出已经截断；修剪可以进一步减少工具结果积累。
- 如果您需要全新的开始，`/new` 或 `/reset` 开始一个新会话 id。