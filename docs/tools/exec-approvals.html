<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tools/exec-approvals" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">执行审批 | Moltbot Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/moltbot-doc/docs/tools/exec-approvals"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="执行审批 | Moltbot Docs"><meta data-rh="true" name="description" content="执行审批是配套应用/节点主机的安全保障，允许沙箱代理在真实主机上运行"><meta data-rh="true" property="og:description" content="执行审批是配套应用/节点主机的安全保障，允许沙箱代理在真实主机上运行"><link data-rh="true" rel="icon" href="/moltbot-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/moltbot-doc/docs/tools/exec-approvals"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/tools/exec-approvals" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/tools/exec-approvals" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/moltbot-doc/blog/rss.xml" title="Moltbot Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/moltbot-doc/blog/atom.xml" title="Moltbot Docs Atom Feed"><link rel="stylesheet" href="/moltbot-doc/assets/css/styles.484b4c98.css">
<script src="/moltbot-doc/assets/js/runtime~main.6cf495cf.js" defer="defer"></script>
<script src="/moltbot-doc/assets/js/main.f9205183.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/moltbot-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Moltbot</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/claude-doc/docs" class="dropdownMenuItem_VBaP">Claude</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/moltbot-doc/docs">Docs</a><a class="navLink_RnnM" href="/moltbot-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>执行审批</h1></header>
<p>执行审批是<strong>配套应用/节点主机</strong>的安全保障，允许沙箱代理在真实主机上运行
命令（<code>gateway</code> 或 <code>node</code>）。可以将其想象为安全联锁：
仅当策略 + 白名单 +（可选的）用户审批都同意时才允许命令。
执行审批<strong>除了</strong>工具策略和提升权限网关之外（除非提升权限设置为 <code>full</code>，这会跳过审批）。
有效策略是 <code>tools.exec.*</code> 和审批默认值中<strong>更严格</strong>的那个；如果省略审批字段，则使用 <code>tools.exec</code> 值。</p>
<p>如果配套应用 UI <strong>不可用</strong>，任何需要提示的请求都将通过
<strong>询问回退</strong>（默认：拒绝）解决。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="应用位置">应用位置<a href="#应用位置" class="hash-link" aria-label="应用位置的直接链接" title="应用位置的直接链接" translate="no">​</a></h2>
<p>执行审批在执行主机上本地强制执行：</p>
<ul>
<li class=""><strong>网关主机</strong> → 网关机器上的 <code>moltbot</code> 进程</li>
<li class=""><strong>节点主机</strong> → 节点运行器（macOS 配套应用或无头节点主机）</li>
</ul>
<p>macOS 分割：</p>
<ul>
<li class=""><strong>节点主机服务</strong> 通过本地 IPC 将 <code>system.run</code> 转发到 <strong>macOS 应用</strong>。</li>
<li class=""><strong>macOS 应用</strong> 强制审批 + 在 UI 上下文中执行命令。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="设置和存储">设置和存储<a href="#设置和存储" class="hash-link" aria-label="设置和存储的直接链接" title="设置和存储的直接链接" translate="no">​</a></h2>
<p>审批存储在执行主机上的本地 JSON 文件中：</p>
<p><code>~/.clawdbot/exec-approvals.json</code></p>
<p>示例架构：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;version&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">1</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;socket&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;path&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/.clawdbot/exec-approvals.sock&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;token&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;base64url-token&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;defaults&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;security&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;deny&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;ask&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;on-miss&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;askFallback&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;deny&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;autoAllowSkills&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;agents&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;main&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;security&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;allowlist&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;ask&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;on-miss&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;askFallback&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;deny&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;autoAllowSkills&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;allowlist&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;id&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;B0C8C0B3-2C2D-4F8A-9A3C-5A4B3C2D1E0F&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;pattern&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;~/Projects/**/bin/bird&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;lastUsedAt&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">1737150000000</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;lastUsedCommand&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;rg -n TODO&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;lastResolvedPath&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/Users/user/Projects/.../bin/rg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="策略旋钮">策略旋钮<a href="#策略旋钮" class="hash-link" aria-label="策略旋钮的直接链接" title="策略旋钮的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="安全性-execsecurity">安全性 (<code>exec.security</code>)<a href="#安全性-execsecurity" class="hash-link" aria-label="安全性-execsecurity的直接链接" title="安全性-execsecurity的直接链接" translate="no">​</a></h3>
<ul>
<li class=""><strong>deny</strong>: 阻止所有主机执行请求。</li>
<li class=""><strong>allowlist</strong>: 仅允许列入白名单的命令。</li>
<li class=""><strong>full</strong>: 允许所有内容（等同于提升权限）。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="询问-execask">询问 (<code>exec.ask</code>)<a href="#询问-execask" class="hash-link" aria-label="询问-execask的直接链接" title="询问-execask的直接链接" translate="no">​</a></h3>
<ul>
<li class=""><strong>off</strong>: 从不提示。</li>
<li class=""><strong>on-miss</strong>: 仅当白名单不匹配时提示。</li>
<li class=""><strong>always</strong>: 每个命令都提示。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="询问回退-askfallback">询问回退 (<code>askFallback</code>)<a href="#询问回退-askfallback" class="hash-link" aria-label="询问回退-askfallback的直接链接" title="询问回退-askfallback的直接链接" translate="no">​</a></h3>
<p>如果需要提示但无法到达 UI，则回退决定：</p>
<ul>
<li class=""><strong>deny</strong>: 阻止。</li>
<li class=""><strong>allowlist</strong>: 仅当白名单匹配时允许。</li>
<li class=""><strong>full</strong>: 允许。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="白名单每个代理">白名单（每个代理）<a href="#白名单每个代理" class="hash-link" aria-label="白名单（每个代理）的直接链接" title="白名单（每个代理）的直接链接" translate="no">​</a></h2>
<p>白名单是<strong>每个代理</strong>的。如果有多个代理，在 macOS 应用中切换您正在
编辑的代理。模式是<strong>不区分大小写的 glob 匹配</strong>。
模式应解析为<strong>二进制路径</strong>（仅 basename 条目被忽略）。
遗留的 <code>agents.default</code> 条目在加载时迁移到 <code>agents.main</code>。</p>
<p>示例：</p>
<ul>
<li class=""><code>~/Projects/**/bin/bird</code></li>
<li class=""><code>~/.local/bin/*</code></li>
<li class=""><code>/opt/homebrew/bin/rg</code></li>
</ul>
<p>每个白名单条目跟踪：</p>
<ul>
<li class=""><strong>id</strong> 用于 UI 身份的稳定 UUID（可选）</li>
<li class=""><strong>最后使用</strong> 时间戳</li>
<li class=""><strong>最后使用命令</strong></li>
<li class=""><strong>最后解析路径</strong></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="自动允许技能-cli">自动允许技能 CLI<a href="#自动允许技能-cli" class="hash-link" aria-label="自动允许技能 CLI的直接链接" title="自动允许技能 CLI的直接链接" translate="no">​</a></h2>
<p>当<strong>自动允许技能 CLI</strong> 启用时，已知技能引用的可执行文件
在节点上被视为已列入白名单（macOS 节点或无头节点主机）。这使用
<code>skills.bins</code> 通过网关 RPC 获取技能二进制文件列表。如果您想要严格的手动白名单，请禁用此功能。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="安全二进制文件仅-stdin">安全二进制文件（仅 stdin）<a href="#安全二进制文件仅-stdin" class="hash-link" aria-label="安全二进制文件（仅 stdin）的直接链接" title="安全二进制文件（仅 stdin）的直接链接" translate="no">​</a></h2>
<p><code>tools.exec.safeBins</code> 定义了一个小列表的<strong>仅 stdin</strong> 二进制文件（例如 <code>jq</code>）
可以在白名单模式下<strong>无需</strong>显式白名单条目运行。安全二进制文件拒绝
位置文件参数和类路径标记，因此只能对传入流进行操作。
在白名单模式下，shell 链接和重定向不会自动允许。</p>
<p>当每个顶级段满足白名单时（包括安全二进制文件或技能自动允许），shell 链接（<code>&amp;&amp;</code>、<code>||</code>、<code>;</code>）是允许的。
在白名单模式下，重定向仍然不受支持。</p>
<p>默认安全二进制文件：<code>jq</code>、<code>grep</code>、<code>cut</code>、<code>sort</code>、<code>uniq</code>、<code>head</code>、<code>tail</code>、<code>tr</code>、<code>wc</code>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="控制-ui-编辑">控制 UI 编辑<a href="#控制-ui-编辑" class="hash-link" aria-label="控制 UI 编辑的直接链接" title="控制 UI 编辑的直接链接" translate="no">​</a></h2>
<p>使用<strong>控制 UI → 节点 → 执行审批</strong>卡片编辑默认值、每个代理
覆盖和白名单。选择范围（默认值或代理），调整策略，
添加/删除白名单模式，然后<strong>保存</strong>。UI 显示每个模式的<strong>最后使用</strong>元数据
以便您可以保持列表整洁。</p>
<p>目标选择器选择<strong>网关</strong>（本地审批）或<strong>节点</strong>。节点
必须广播 <code>system.execApprovals.get/set</code>（macOS 应用或无头节点主机）。
如果节点尚未广播执行审批，请直接编辑其本地
<code>~/.clawdbot/exec-approvals.json</code>。</p>
<p>CLI: <code>moltbot approvals</code> 支持网关或节点编辑（参见 <a class="" href="/moltbot-doc/cli/approvals">审批 CLI</a>）。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="审批流程">审批流程<a href="#审批流程" class="hash-link" aria-label="审批流程的直接链接" title="审批流程的直接链接" translate="no">​</a></h2>
<p>当需要提示时，网关向操作员客户端广播 <code>exec.approval.requested</code>。
控制 UI 和 macOS 应用通过 <code>exec.approval.resolve</code> 解决，然后网关将
批准的请求转发到节点主机。</p>
<p>当需要审批时，执行工具立即返回审批 ID。使用该 ID
关联后续系统事件（<code>Exec finished</code> / <code>Exec denied</code>）。如果在
超时前没有到达决策，则请求被视为审批超时并显示为拒绝原因。</p>
<p>确认对话框包括：</p>
<ul>
<li class="">命令 + 参数</li>
<li class="">当前工作目录</li>
<li class="">代理 ID</li>
<li class="">解析的可执行文件路径</li>
<li class="">主机 + 策略元数据</li>
</ul>
<p>操作：</p>
<ul>
<li class=""><strong>允许一次</strong> → 现在运行</li>
<li class=""><strong>始终允许</strong> → 添加到白名单 + 运行</li>
<li class=""><strong>拒绝</strong> → 阻止</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="审批转发到聊天频道">审批转发到聊天频道<a href="#审批转发到聊天频道" class="hash-link" aria-label="审批转发到聊天频道的直接链接" title="审批转发到聊天频道的直接链接" translate="no">​</a></h2>
<p>您可以将执行审批提示转发到任何聊天频道（包括插件频道）并批准
它们与 <code>/approve</code>。这使用正常的出站交付管道。</p>
<p>配置：</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  approvals: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    exec: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      enabled: true,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      mode: &quot;session&quot;, // &quot;session&quot; | &quot;targets&quot; | &quot;both&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      agentFilter: [&quot;main&quot;],</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      sessionFilter: [&quot;discord&quot;], // 子字符串或正则表达式</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      targets: [</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        { channel: &quot;slack&quot;, to: &quot;U12345678&quot; },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        { channel: &quot;telegram&quot;, to: &quot;123456789&quot; }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>在聊天中回复：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">/approve &lt;id&gt; allow-once</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/approve &lt;id&gt; allow-always</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">/approve &lt;id&gt; deny</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="macos-ipc-流程">macOS IPC 流程<a href="#macos-ipc-流程" class="hash-link" aria-label="macOS IPC 流程的直接链接" title="macOS IPC 流程的直接链接" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">网关 -&gt; 节点服务 (WS)</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">                 |  IPC (UDS + 令牌 + HMAC + TTL)</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">                 v</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">             Mac 应用 (UI + 审批 + system.run)</span><br></span></code></pre></div></div>
<p>安全注意事项：</p>
<ul>
<li class="">Unix 套接字模式 <code>0600</code>，令牌存储在 <code>exec-approvals.json</code> 中。</li>
<li class="">相同 UID 对等检查。</li>
<li class="">挑战/响应（随机数 + HMAC 令牌 + 请求哈希）+ 短 TTL。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="系统事件">系统事件<a href="#系统事件" class="hash-link" aria-label="系统事件的直接链接" title="系统事件的直接链接" translate="no">​</a></h2>
<p>执行生命周期显示为系统消息：</p>
<ul>
<li class=""><code>Exec running</code>（仅当命令超过运行通知阈值时）</li>
<li class=""><code>Exec finished</code></li>
<li class=""><code>Exec denied</code></li>
</ul>
<p>这些在节点报告事件后发布到代理的会话。网关主机执行审批在命令完成时（以及可选地在运行时间超过阈值时）发出相同的生命周期事件。
审批控制的执行在这些消息中重用审批 ID 作为 <code>runId</code> 以便轻松关联。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="影响">影响<a href="#影响" class="hash-link" aria-label="影响的直接链接" title="影响的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><strong>full</strong> 是强大的；尽可能优先使用白名单。</li>
<li class=""><strong>ask</strong> 让您参与其中，同时仍允许快速审批。</li>
<li class="">每个代理的白名单防止一个代理的审批泄露到其他代理。</li>
<li class="">审批仅适用于来自<strong>授权发送者</strong>的主机执行请求。未经授权的发送者无法发出 <code>/exec</code>。</li>
<li class=""><code>/exec security=full</code> 是授权操作员的会话级便利，设计上跳过审批。
要硬阻塞主机执行，请将审批安全性设置为 <code>deny</code> 或通过工具策略拒绝 <code>exec</code> 工具。</li>
</ul>
<p>相关：</p>
<ul>
<li class=""><a class="" href="/moltbot-doc/tools/exec">执行工具</a></li>
<li class=""><a class="" href="/moltbot-doc/tools/elevated">提升模式</a></li>
<li class=""><a class="" href="/moltbot-doc/tools/skills">技能</a></li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#应用位置" class="table-of-contents__link toc-highlight">应用位置</a></li><li><a href="#设置和存储" class="table-of-contents__link toc-highlight">设置和存储</a></li><li><a href="#策略旋钮" class="table-of-contents__link toc-highlight">策略旋钮</a><ul><li><a href="#安全性-execsecurity" class="table-of-contents__link toc-highlight">安全性 (<code>exec.security</code>)</a></li><li><a href="#询问-execask" class="table-of-contents__link toc-highlight">询问 (<code>exec.ask</code>)</a></li><li><a href="#询问回退-askfallback" class="table-of-contents__link toc-highlight">询问回退 (<code>askFallback</code>)</a></li></ul></li><li><a href="#白名单每个代理" class="table-of-contents__link toc-highlight">白名单（每个代理）</a></li><li><a href="#自动允许技能-cli" class="table-of-contents__link toc-highlight">自动允许技能 CLI</a></li><li><a href="#安全二进制文件仅-stdin" class="table-of-contents__link toc-highlight">安全二进制文件（仅 stdin）</a></li><li><a href="#控制-ui-编辑" class="table-of-contents__link toc-highlight">控制 UI 编辑</a></li><li><a href="#审批流程" class="table-of-contents__link toc-highlight">审批流程</a></li><li><a href="#审批转发到聊天频道" class="table-of-contents__link toc-highlight">审批转发到聊天频道</a><ul><li><a href="#macos-ipc-流程" class="table-of-contents__link toc-highlight">macOS IPC 流程</a></li></ul></li><li><a href="#系统事件" class="table-of-contents__link toc-highlight">系统事件</a></li><li><a href="#影响" class="table-of-contents__link toc-highlight">影响</a></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Moltbot Docs.</div></div></div></footer></div>
</body>
</html>