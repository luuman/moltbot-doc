<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tools/exec" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Exec 工具 | Moltbot Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/moltbot-doc/docs/tools/exec"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Exec 工具 | Moltbot Docs"><meta data-rh="true" name="description" content="在工作区中运行 shell 命令。通过 process 支持前台 + 后台执行。"><meta data-rh="true" property="og:description" content="在工作区中运行 shell 命令。通过 process 支持前台 + 后台执行。"><link data-rh="true" rel="icon" href="/moltbot-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/moltbot-doc/docs/tools/exec"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/tools/exec" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/tools/exec" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/moltbot-doc/blog/rss.xml" title="Moltbot Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/moltbot-doc/blog/atom.xml" title="Moltbot Docs Atom Feed"><link rel="stylesheet" href="/moltbot-doc/assets/css/styles.484b4c98.css">
<script src="/moltbot-doc/assets/js/runtime~main.6cf495cf.js" defer="defer"></script>
<script src="/moltbot-doc/assets/js/main.f9205183.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/moltbot-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Moltbot</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/claude-doc/docs" class="dropdownMenuItem_VBaP">Claude</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/moltbot-doc/docs">Docs</a><a class="navLink_RnnM" href="/moltbot-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Exec 工具</h1></header>
<p>在工作区中运行 shell 命令。通过 <code>process</code> 支持前台 + 后台执行。
如果 <code>process</code> 不被允许，<code>exec</code> 同步运行并忽略 <code>yieldMs</code>/<code>background</code>。
后台会话按代理范围划分；<code>process</code> 只能看到来自同一代理的会话。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="参数">参数<a href="#参数" class="hash-link" aria-label="参数的直接链接" title="参数的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><code>command</code> (必需)</li>
<li class=""><code>workdir</code> (默认为当前工作目录)</li>
<li class=""><code>env</code> (键/值覆盖)</li>
<li class=""><code>yieldMs</code> (默认 10000): 延迟后自动后台化</li>
<li class=""><code>background</code> (布尔值): 立即后台化</li>
<li class=""><code>timeout</code> (秒，默认 1800): 到期时终止</li>
<li class=""><code>pty</code> (布尔值): 在可用时在伪终端中运行 (仅 TTY CLIs、编码代理、终端 UI)</li>
<li class=""><code>host</code> (<code>sandbox | gateway | node</code>): 执行位置</li>
<li class=""><code>security</code> (<code>deny | allowlist | full</code>): <code>gateway</code>/<code>node</code> 的强制模式</li>
<li class=""><code>ask</code> (<code>off | on-miss | always</code>): <code>gateway</code>/<code>node</code> 的审批提示</li>
<li class=""><code>node</code> (字符串): <code>host=node</code> 的节点 ID/名称</li>
<li class=""><code>elevated</code> (布尔值): 请求提升模式 (网关主机); 仅当提升解析为 <code>full</code> 时才强制 <code>security=full</code></li>
</ul>
<p>注意事项:</p>
<ul>
<li class=""><code>host</code> 默认为 <code>sandbox</code>。</li>
<li class="">当沙盒化关闭时，<code>elevated</code> 被忽略 (exec 已在主机上运行)。</li>
<li class=""><code>gateway</code>/<code>node</code> 审批由 <code>~/.clawdbot/exec-approvals.json</code> 控制。</li>
<li class=""><code>node</code> 需要配对节点 (伴侣应用或无头节点主机)。</li>
<li class="">如果有多个节点可用，设置 <code>exec.node</code> 或 <code>tools.exec.node</code> 来选择一个。</li>
<li class="">在非 Windows 主机上，exec 使用 <code>SHELL</code> (如果设置); 如果 <code>SHELL</code> 是 <code>fish</code>，它优先使用 <code>PATH</code> 中的 <code>bash</code> (或 <code>sh</code>)
以避免与 fish 不兼容的脚本，如果两者都不存在则回退到 <code>SHELL</code>。</li>
<li class="">重要: 沙盒化默认是<strong>关闭的</strong>。如果沙盒化关闭，<code>host=sandbox</code> 直接在
网关主机上运行 (无容器) 并且<strong>不需要审批</strong>。要需要审批，请使用
<code>host=gateway</code> 并配置 exec 审批 (或启用沙盒化)。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="配置">配置<a href="#配置" class="hash-link" aria-label="配置的直接链接" title="配置的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><code>tools.exec.notifyOnExit</code> (默认: true): 为真时，后台 exec 会话在退出时加入系统事件队列并请求心跳。</li>
<li class=""><code>tools.exec.approvalRunningNoticeMs</code> (默认: 10000): 当需要审批的 exec 运行时间超过此值时发出单个&quot;运行中&quot;通知 (0 禁用)。</li>
<li class=""><code>tools.exec.host</code> (默认: <code>sandbox</code>)</li>
<li class=""><code>tools.exec.security</code> (默认: 沙盒为 <code>deny</code>，网关 + 节点未设置时为 <code>allowlist</code>)</li>
<li class=""><code>tools.exec.ask</code> (默认: <code>on-miss</code>)</li>
<li class=""><code>tools.exec.node</code> (默认: 未设置)</li>
<li class=""><code>tools.exec.pathPrepend</code>: 为 exec 运行预添加到 <code>PATH</code> 的目录列表。</li>
<li class=""><code>tools.exec.safeBins</code>: 可在没有显式白名单条目的情况下运行的仅 stdin 安全二进制文件。</li>
</ul>
<p>示例:</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  tools: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    exec: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      pathPrepend: [&quot;~/bin&quot;, &quot;/opt/oss/bin&quot;]</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="path-处理">PATH 处理<a href="#path-处理" class="hash-link" aria-label="PATH 处理的直接链接" title="PATH 处理的直接链接" translate="no">​</a></h3>
<ul>
<li class=""><code>host=gateway</code>: 将您的登录 shell <code>PATH</code> 合并到 exec 环境中 (除非 exec 调用
已经设置了 <code>env.PATH</code>)。守护进程本身仍使用最小 <code>PATH</code> 运行:
<ul>
<li class="">macOS: <code>/opt/homebrew/bin</code>, <code>/usr/local/bin</code>, <code>/usr/bin</code>, <code>/bin</code></li>
<li class="">Linux: <code>/usr/local/bin</code>, <code>/usr/bin</code>, <code>/bin</code></li>
</ul>
</li>
<li class=""><code>host=sandbox</code>: 在容器内运行 <code>sh -lc</code> (登录 shell)，所以 <code>/etc/profile</code> 可能重置 <code>PATH</code>。
Moltbot 在配置文件源后通过内部环境变量预添加 <code>env.PATH</code> (无 shell 插值);
<code>tools.exec.pathPrepend</code> 在这里也适用。</li>
<li class=""><code>host=node</code>: 只有您传递的环境覆盖被发送到节点。<code>tools.exec.pathPrepend</code> 仅在
exec 调用已设置 <code>env.PATH</code> 时适用。无头节点主机仅在接受 <code>PATH</code> 时预添加
节点主机 PATH (无替换)。macOS 节点完全丢弃 <code>PATH</code> 覆盖。</li>
</ul>
<p>每代理节点绑定 (在配置中使用代理列表索引):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot config get agents.list</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">moltbot config set agents.list[0].tools.exec.node &quot;node-id-or-name&quot;</span><br></span></code></pre></div></div>
<p>控制界面: 节点标签页包含一个小的&quot;Exec 节点绑定&quot;面板用于相同设置。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="会话覆盖-exec">会话覆盖 (<code>/exec</code>)<a href="#会话覆盖-exec" class="hash-link" aria-label="会话覆盖-exec的直接链接" title="会话覆盖-exec的直接链接" translate="no">​</a></h2>
<p>使用 <code>/exec</code> 为 <code>host</code>、<code>security</code>、<code>ask</code> 和 <code>node</code> 设置<strong>每会话</strong>默认值。
发送不带参数的 <code>/exec</code> 以显示当前值。</p>
<p>示例:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">/exec host=gateway security=allowlist ask=on-miss node=mac-1</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="授权模型">授权模型<a href="#授权模型" class="hash-link" aria-label="授权模型的直接链接" title="授权模型的直接链接" translate="no">​</a></h2>
<p><code>/exec</code> 仅适用于<strong>授权发送者</strong> (渠道白名单/配对加上 <code>commands.useAccessGroups</code>)。
它仅更新<strong>会话状态</strong>，不写入配置。要硬禁用 exec，请通过工具
策略拒绝它 (<code>tools.deny: [&quot;exec&quot;]</code> 或按代理)。主机审批仍然适用，除非您显式设置
<code>security=full</code> 并且 <code>ask=off</code>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="exec-审批-伴侣应用--节点主机">Exec 审批 (伴侣应用 / 节点主机)<a href="#exec-审批-伴侣应用--节点主机" class="hash-link" aria-label="Exec 审批 (伴侣应用 / 节点主机)的直接链接" title="Exec 审批 (伴侣应用 / 节点主机)的直接链接" translate="no">​</a></h2>
<p>沙盒代理可以在 exec 在网关或节点主机上运行前要求每请求审批。
参见 <a class="" href="/moltbot-doc/tools/exec-approvals">Exec 审批</a> 了解策略、白名单和 UI 流程。</p>
<p>当需要审批时，exec 工具立即返回
<code>status: &quot;approval-pending&quot;</code> 和一个审批 ID。一旦批准 (或拒绝 / 超时)，
网关发出系统事件 (<code>Exec finished</code> / <code>Exec denied</code>)。如果命令在
<code>tools.exec.approvalRunningNoticeMs</code> 后仍在运行，会发出单个 <code>Exec running</code> 通知。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="白名单--安全二进制文件">白名单 + 安全二进制文件<a href="#白名单--安全二进制文件" class="hash-link" aria-label="白名单 + 安全二进制文件的直接链接" title="白名单 + 安全二进制文件的直接链接" translate="no">​</a></h2>
<p>白名单强制仅匹配<strong>解析的二进制路径</strong> (无基本名称匹配)。当
<code>security=allowlist</code> 时，shell 命令仅在每个管道段都是
白名单或安全二进制文件时自动允许。链式 (<code>;</code>, <code>&amp;&amp;</code>, <code>||</code>) 和重定向在
白名单模式下被拒绝。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="示例">示例<a href="#示例" class="hash-link" aria-label="示例的直接链接" title="示例的直接链接" translate="no">​</a></h2>
<p>前台:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;exec&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;command&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;ls -la&quot;</span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>后台 + 轮询:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;exec&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;command&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;npm run build&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;yieldMs&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token number" style="color:#F78C6C">1000</span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;process&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;poll&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;sessionId&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;&lt;id&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>发送按键 (tmux 风格):</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;process&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;send-keys&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;sessionId&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;&lt;id&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;keys&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;Enter&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;process&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;send-keys&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;sessionId&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;&lt;id&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;keys&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;C-c&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;process&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;send-keys&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;sessionId&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;&lt;id&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;keys&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;Up&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token string" style="color:#ECC48D">&quot;Up&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token string" style="color:#ECC48D">&quot;Enter&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>提交 (仅发送回车):</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;process&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;submit&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;sessionId&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;&lt;id&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>粘贴 (默认带括号):</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token property" style="color:#F78C6C">&quot;tool&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;process&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;paste&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;sessionId&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;&lt;id&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token property" style="color:#F78C6C">&quot;text&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token string" style="color:#ECC48D">&quot;line1\nline2\n&quot;</span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="apply_patch-实验性">apply_patch (实验性)<a href="#apply_patch-实验性" class="hash-link" aria-label="apply_patch (实验性)的直接链接" title="apply_patch (实验性)的直接链接" translate="no">​</a></h2>
<p><code>apply_patch</code> 是用于结构化多文件编辑的 <code>exec</code> 子工具。
显式启用它:</p>
<div class="language-json5 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json5 codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  tools: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    exec: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      applyPatch: { enabled: true, allowModels: [&quot;gpt-5.2&quot;] }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>注意事项:</p>
<ul>
<li class="">仅适用于 OpenAI/OpenAI Codex 模型。</li>
<li class="">工具策略仍然适用；<code>allow: [&quot;exec&quot;]</code> 隐式允许 <code>apply_patch</code>。</li>
<li class="">配置位于 <code>tools.exec.applyPatch</code> 下。</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#参数" class="table-of-contents__link toc-highlight">参数</a></li><li><a href="#配置" class="table-of-contents__link toc-highlight">配置</a><ul><li><a href="#path-处理" class="table-of-contents__link toc-highlight">PATH 处理</a></li></ul></li><li><a href="#会话覆盖-exec" class="table-of-contents__link toc-highlight">会话覆盖 (<code>/exec</code>)</a></li><li><a href="#授权模型" class="table-of-contents__link toc-highlight">授权模型</a></li><li><a href="#exec-审批-伴侣应用--节点主机" class="table-of-contents__link toc-highlight">Exec 审批 (伴侣应用 / 节点主机)</a></li><li><a href="#白名单--安全二进制文件" class="table-of-contents__link toc-highlight">白名单 + 安全二进制文件</a></li><li><a href="#示例" class="table-of-contents__link toc-highlight">示例</a></li><li><a href="#apply_patch-实验性" class="table-of-contents__link toc-highlight">apply_patch (实验性)</a></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Moltbot Docs.</div></div></div></footer></div>
</body>
</html>