<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tools/lobster" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Lobster | Moltbot Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://luuman.github.io/moltbot-doc/docs/tools/lobster"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lobster | Moltbot Docs"><meta data-rh="true" name="description" content="Typed workflow runtime for Moltbot — composable pipelines with approval gates."><meta data-rh="true" property="og:description" content="Typed workflow runtime for Moltbot — composable pipelines with approval gates."><link data-rh="true" rel="icon" href="/moltbot-doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luuman.github.io/moltbot-doc/docs/tools/lobster"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/tools/lobster" hreflang="zh"><link data-rh="true" rel="alternate" href="https://luuman.github.io/moltbot-doc/docs/tools/lobster" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/moltbot-doc/blog/rss.xml" title="Moltbot Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/moltbot-doc/blog/atom.xml" title="Moltbot Docs Atom Feed"><link rel="stylesheet" href="/moltbot-doc/assets/css/styles.484b4c98.css">
<script src="/moltbot-doc/assets/js/runtime~main.6cf495cf.js" defer="defer"></script>
<script src="/moltbot-doc/assets/js/main.f9205183.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar_MONK" role="navigation" aria-label="Main"><div class="navbarInner_ASTH"><div class="navbarLeft_pUmY"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="brand_SXL9" href="/moltbot-doc/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="var(--ifm-color-primary)"></rect><path d="M7 8.5h10M7 12h7M7 15.5h10" stroke="white" stroke-width="1.8" stroke-linecap="round"></path></svg><span class="brandTitle_XbyU">Moltbot</span></a><div class="dropdown_GrgZ"><button class="dropdownToggle_Nf_z">全部站点<svg class="dropdownArrow_Eka8" viewBox="0 0 12 12" fill="none"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><ul class="dropdownMenu_zsxH"><li><a href="https://luuman.github.io/docs-workspace/docs" class="dropdownMenuItem_VBaP">Workspace</a></li><li><a href="https://luuman.github.io/claude-doc/docs" class="dropdownMenuItem_VBaP">Claude</a></li><li><a href="https://luuman.github.io/electron-doc/docs" class="dropdownMenuItem_VBaP">Electron</a></li><li><a href="https://luuman.github.io/tauri-doc/docs" class="dropdownMenuItem_VBaP">Tauri</a></li><li><a href="https://luuman.github.io/matrx-doc/docs" class="dropdownMenuItem_VBaP">Matrx</a></li><li><a href="https://luuman.github.io/brainboard-doc/docs" class="dropdownMenuItem_VBaP">Brainboard</a></li><li><a href="https://luuman.github.io/synology-doc/docs" class="dropdownMenuItem_VBaP">Synology</a></li><li><a href="https://luuman.github.io/codex-doc/docs" class="dropdownMenuItem_VBaP">Codex</a></li><li><a href="https://luuman.github.io/ai-doc/docs" class="dropdownMenuItem_VBaP">AI</a></li></ul></div></div><div class="navbarCenter_Zdr3"><div class="root_OF3s"><span class="icon_UcOK" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg></span><div class="slot__FGx"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div class="navbarRight_q16u"><a class="navLink_RnnM" href="/moltbot-doc/docs">Docs</a><a class="navLink_RnnM" href="/moltbot-doc/blog">Blog</a><button class="themeToggle_zD_x" aria-label="Switch to light theme" title="Light"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></div></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Lobster</h1></header>
<p>Lobster 是一个工作流 shell，让 Moltbot 将多步工具序列作为单一、确定性的操作运行，具有显式审批检查点。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="hook">Hook<a href="#hook" class="hash-link" aria-label="Hook的直接链接" title="Hook的直接链接" translate="no">​</a></h2>
<p>您的助手可以构建管理自身的工具。要求一个工作流，30 分钟后您就有了一个 CLI 加上作为一次调用运行的管道。Lobster 是缺失的一环：确定性管道、显式审批和可恢复状态。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="为什么">为什么<a href="#为什么" class="hash-link" aria-label="为什么的直接链接" title="为什么的直接链接" translate="no">​</a></h2>
<p>今天，复杂的工作流需要许多来回的工具调用。每次调用都会消耗令牌，LLM 必须协调每一步。Lobster 将这种协调移到了一个类型化的运行时中：</p>
<ul>
<li class=""><strong>一次调用代替多次</strong>: Moltbot 运行一个 Lobster 工具调用并获得结构化结果。</li>
<li class=""><strong>内置审批</strong>: 副作用（发送邮件、发布评论）会使工作流暂停，直到明确批准。</li>
<li class=""><strong>可恢复</strong>: 暂停的工作流返回一个令牌；批准并恢复而无需重新运行所有内容。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="为什么是-dsl-而不是普通程序">为什么是 DSL 而不是普通程序？<a href="#为什么是-dsl-而不是普通程序" class="hash-link" aria-label="为什么是 DSL 而不是普通程序？的直接链接" title="为什么是 DSL 而不是普通程序？的直接链接" translate="no">​</a></h2>
<p>Lobster 故意做得很小。目标不是&quot;一种新语言&quot;，而是可预测的、AI 友好的管道规范，具有一级审批和恢复令牌。</p>
<ul>
<li class=""><strong>内置批准/恢复</strong>: 普通程序可以提示人类，但它不能<em>暂停和恢复</em>并带有持久令牌，除非您自己发明那个运行时。</li>
<li class=""><strong>确定性 + 可审计性</strong>: 管道是数据，所以它们易于记录、差异比较、重播和审查。</li>
<li class=""><strong>AI 的受限表面</strong>: 小语法 + JSON 管道减少了&quot;创造性&quot;代码路径，使验证变得现实。</li>
<li class=""><strong>内置安全策略</strong>: 超时、输出上限、沙箱检查和白名单由运行时强制执行，而不是每个脚本。</li>
<li class=""><strong>仍可编程</strong>: 每个步骤都可以调用任何 CLI 或脚本。如果您想要 JS/TS，请从代码生成 <code>.lobster</code> 文件。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="工作原理">工作原理<a href="#工作原理" class="hash-link" aria-label="工作原理的直接链接" title="工作原理的直接链接" translate="no">​</a></h2>
<p>Moltbot 在<strong>工具模式</strong>下启动本地 <code>lobster</code> CLI 并从 stdout 解析 JSON 包封。
如果管道暂停等待审批，工具返回一个 <code>resumeToken</code>，以便您稍后继续。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="模式小型-cli--json-管道--审批">模式：小型 CLI + JSON 管道 + 审批<a href="#模式小型-cli--json-管道--审批" class="hash-link" aria-label="模式：小型 CLI + JSON 管道 + 审批的直接链接" title="模式：小型 CLI + JSON 管道 + 审批的直接链接" translate="no">​</a></h2>
<p>构建说 JSON 的小型命令，然后将它们链接到单个 Lobster 调用中。（下面的示例命令名称 — 替换为您自己的。）</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">inbox list --json</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">inbox categorize --json</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">inbox apply --json</span><br></span></code></pre></div></div>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;run&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;pipeline&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;exec --json --shell &#x27;inbox list --json&#x27; | exec --stdin json --shell &#x27;inbox categorize --json&#x27; | exec --stdin json --shell &#x27;inbox apply --json&#x27; | approve --preview-from-stdin --limit 5 --prompt &#x27;Apply changes?&#x27;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;timeoutMs&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">30000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>如果管道请求审批，请使用令牌恢复：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;resume&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;token&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;&lt;resumeToken&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;approve&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>AI 触发工作流；Lobster 执行步骤。审批闸门保持副作用明确和可审计。</p>
<p>示例：将输入项映射到工具调用：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">gog.gmail.search --query &#x27;newer_than:1d&#x27; \</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  | clawd.invoke --tool message --action send --each --item-key message --args-json &#x27;{&quot;provider&quot;:&quot;telegram&quot;,&quot;to&quot;:&quot;...&quot;}&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="仅-json-llm-步骤-llm-task">仅 JSON LLM 步骤 (llm-task)<a href="#仅-json-llm-步骤-llm-task" class="hash-link" aria-label="仅 JSON LLM 步骤 (llm-task)的直接链接" title="仅 JSON LLM 步骤 (llm-task)的直接链接" translate="no">​</a></h2>
<p>对于需要<strong>结构化 LLM 步骤</strong>的工作流，启用可选的
<code>llm-task</code> 插件工具并从 Lobster 调用它。这保持了工作流
的确定性，同时仍让您使用模型进行分类/摘要/起草。</p>
<p>启用工具：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;plugins&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;entries&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token property" style="color:#F78C6C">&quot;llm-task&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;enabled&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;agents&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;list&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token property" style="color:#F78C6C">&quot;id&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;main&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token property" style="color:#F78C6C">&quot;tools&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;allow&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;llm-task&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>在管道中使用它：</p>
<div class="language-lobster codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lobster codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">clawd.invoke --tool llm-task --action json --args-json &#x27;{</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;prompt&quot;: &quot;Given the input email, return intent and draft.&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;input&quot;: { &quot;subject&quot;: &quot;Hello&quot;, &quot;body&quot;: &quot;Can you help?&quot; },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  &quot;schema&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;type&quot;: &quot;object&quot;,</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;intent&quot;: { &quot;type&quot;: &quot;string&quot; },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      &quot;draft&quot;: { &quot;type&quot;: &quot;string&quot; }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;required&quot;: [&quot;intent&quot;, &quot;draft&quot;],</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    &quot;additionalProperties&quot;: false</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">}&#x27;</span><br></span></code></pre></div></div>
<p>详情和配置选项请参见 <a class="" href="/moltbot-doc/tools/llm-task">LLM Task</a>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="工作流文件-lobster">工作流文件 (.lobster)<a href="#工作流文件-lobster" class="hash-link" aria-label="工作流文件 (.lobster)的直接链接" title="工作流文件 (.lobster)的直接链接" translate="no">​</a></h2>
<p>Lobster 可以运行带有 <code>name</code>、<code>args</code>、<code>steps</code>、<code>env</code>、<code>condition</code> 和 <code>approval</code> 字段的 YAML/JSON 工作流文件。在 Moltbot 工具调用中，将 <code>pipeline</code> 设置为文件路径。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token key atrule" style="color:#C792EA">name</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> inbox</span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain">triage</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token key atrule" style="color:#C792EA">args</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token key atrule" style="color:#C792EA">tag</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">default</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;family&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token key atrule" style="color:#C792EA">steps</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#C792EA">id</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> collect</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">command</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> inbox list </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain">json</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#C792EA">id</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> categorize</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">command</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> inbox categorize </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain">json</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">stdin</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> $collect.stdout</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#C792EA">id</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> approve</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">command</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> inbox apply </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain">approve</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">stdin</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> $categorize.stdout</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">approval</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> required</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#C792EA">id</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> execute</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">command</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> inbox apply </span><span class="token punctuation" style="color:#C792EA">-</span><span class="token punctuation" style="color:#C792EA">-</span><span class="token plain">execute</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">stdin</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> $categorize.stdout</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token key atrule" style="color:#C792EA">condition</span><span class="token punctuation" style="color:#C792EA">:</span><span class="token plain"> $approve.approved</span><br></span></code></pre></div></div>
<p>注意事项：</p>
<ul>
<li class=""><code>stdin: $step.stdout</code> 和 <code>stdin: $step.json</code> 传递先前步骤的输出。</li>
<li class=""><code>condition</code> (或 <code>when</code>) 可以在 <code>$step.approved</code> 上限制步骤。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="安装-lobster">安装 Lobster<a href="#安装-lobster" class="hash-link" aria-label="安装 Lobster的直接链接" title="安装 Lobster的直接链接" translate="no">​</a></h2>
<p>在运行 Moltbot 网关的<strong>同一主机</strong>上安装 Lobster CLI（参见 <a href="https://github.com/moltbot/lobster" target="_blank" rel="noopener noreferrer" class="">Lobster 仓库</a>），并确保 <code>lobster</code> 在 <code>PATH</code> 中。
如果您想使用自定义二进制文件位置，请在工具调用中传递<strong>绝对</strong>的 <code>lobsterPath</code>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="启用工具">启用工具<a href="#启用工具" class="hash-link" aria-label="启用工具的直接链接" title="启用工具的直接链接" translate="no">​</a></h2>
<p>Lobster 是一个<strong>可选</strong>的插件工具（默认未启用）。</p>
<p>推荐（累加，安全）：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;tools&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;alsoAllow&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;lobster&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>或按代理：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;agents&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;list&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token property" style="color:#F78C6C">&quot;id&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;main&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token property" style="color:#F78C6C">&quot;tools&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">          </span><span class="token property" style="color:#F78C6C">&quot;alsoAllow&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token string" style="color:#ECC48D">&quot;lobster&quot;</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">        </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">      </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token punctuation" style="color:#C792EA">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>除非您打算在限制性白名单模式下运行，否则避免使用 <code>tools.allow: [&quot;lobster&quot;]</code>。</p>
<p>注意：可选插件的白名单是可选的。如果您的白名单只命名了
插件工具（如 <code>lobster</code>），Moltbot 保持核心工具启用。要限制核心
工具，请在白名单中包含您想要的核心工具或组。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="示例邮件分类">示例：邮件分类<a href="#示例邮件分类" class="hash-link" aria-label="示例：邮件分类的直接链接" title="示例：邮件分类的直接链接" translate="no">​</a></h2>
<p>没有 Lobster：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token plain">用户：&quot;检查我的邮件并起草回复&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">→ clawd 调用 gmail.list</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">→ LLM 摘要</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">→ 用户：&quot;起草对 #2 和 #5 的回复&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">→ LLM 起草</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">→ 用户：&quot;发送 #2&quot;</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">→ clawd 调用 gmail.send</span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">（每天重复，没有分类记忆）</span><br></span></code></pre></div></div>
<p>有了 Lobster：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;run&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;pipeline&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;email.triage --limit 20&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;timeoutMs&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">30000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>返回一个 JSON 包封（截断）：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;ok&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;status&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;needs_approval&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;output&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"> </span><span class="token property" style="color:#F78C6C">&quot;summary&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;5 需要回复，2 需要操作&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;requiresApproval&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;type&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;approval_request&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;prompt&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;发送 2 个草稿回复？&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;items&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#C792EA">[</span><span class="token punctuation" style="color:#C792EA">]</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">    </span><span class="token property" style="color:#F78C6C">&quot;resumeToken&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token punctuation" style="color:#C792EA">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>用户批准 → 恢复：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;resume&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;token&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;&lt;resumeToken&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;approve&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>一个工作流。确定性。安全。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="工具参数">工具参数<a href="#工具参数" class="hash-link" aria-label="工具参数的直接链接" title="工具参数的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="run"><code>run</code><a href="#run" class="hash-link" aria-label="run的直接链接" title="run的直接链接" translate="no">​</a></h3>
<p>在工具模式下运行管道。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;run&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;pipeline&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;gog.gmail.search --query &#x27;newer_than:1d&#x27; | email.triage&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;cwd&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/path/to/workspace&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;timeoutMs&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">30000</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;maxStdoutBytes&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token number" style="color:#F78C6C">512000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<p>使用参数运行工作流文件：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;run&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;pipeline&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;/path/to/inbox-triage.lobster&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;argsJson&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;{\&quot;tag\&quot;:\&quot;family\&quot;}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="resume"><code>resume</code><a href="#resume" class="hash-link" aria-label="resume的直接链接" title="resume的直接链接" translate="no">​</a></h3>
<p>在审批后继续暂停的工作流。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#D6DEEB;--prism-background-color:#001122"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#D6DEEB;background-color:#001122"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#D6DEEB"><span class="token punctuation" style="color:#C792EA">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;action&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;resume&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;token&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token string" style="color:#ECC48D">&quot;&lt;resumeToken&gt;&quot;</span><span class="token punctuation" style="color:#C792EA">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain">  </span><span class="token property" style="color:#F78C6C">&quot;approve&quot;</span><span class="token operator" style="color:#7FDBCA">:</span><span class="token plain"> </span><span class="token boolean" style="color:#F78C6C">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#D6DEEB"><span class="token plain"></span><span class="token punctuation" style="color:#C792EA">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="可选输入">可选输入<a href="#可选输入" class="hash-link" aria-label="可选输入的直接链接" title="可选输入的直接链接" translate="no">​</a></h3>
<ul>
<li class=""><code>lobsterPath</code>: Lobster 二进制文件的绝对路径（省略以使用 <code>PATH</code>）。</li>
<li class=""><code>cwd</code>: 管道的工作目录（默认为当前进程工作目录）。</li>
<li class=""><code>timeoutMs</code>: 如果子进程超过此持续时间则终止（默认：20000）。</li>
<li class=""><code>maxStdoutBytes</code>: 如果 stdout 超过此大小则终止子进程（默认：512000）。</li>
<li class=""><code>argsJson</code>: 传递给 <code>lobster run --args-json</code> 的 JSON 字符串（仅工作流文件）。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="输出包封">输出包封<a href="#输出包封" class="hash-link" aria-label="输出包封的直接链接" title="输出包封的直接链接" translate="no">​</a></h2>
<p>Lobster 返回一个 JSON 包封，具有三种状态之一：</p>
<ul>
<li class=""><code>ok</code> → 成功完成</li>
<li class=""><code>needs_approval</code> → 暂停；<code>requiresApproval.resumeToken</code> 需要恢复</li>
<li class=""><code>cancelled</code> → 明确拒绝或取消</li>
</ul>
<p>该工具在 <code>content</code>（漂亮 JSON）和 <code>details</code>（原始对象）中显示包封。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="审批">审批<a href="#审批" class="hash-link" aria-label="审批的直接链接" title="审批的直接链接" translate="no">​</a></h2>
<p>如果存在 <code>requiresApproval</code>，请检查提示并决定：</p>
<ul>
<li class=""><code>approve: true</code> → 恢复并继续副作用</li>
<li class=""><code>approve: false</code> → 取消并完成工作流</li>
</ul>
<p>使用 <code>approve --preview-from-stdin --limit N</code> 为审批请求附加 JSON 预览，无需自定义 jq/heredoc 粘合。恢复令牌现在是紧凑的：Lobster 在其状态目录下存储工作流恢复状态并返回一个小令牌键。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="openprose">OpenProse<a href="#openprose" class="hash-link" aria-label="OpenProse的直接链接" title="OpenProse的直接链接" translate="no">​</a></h2>
<p>OpenProse 与 Lobster 配合得很好：使用 <code>/prose</code> 协调多代理准备，然后运行 Lobster 管道以获得确定性审批。如果 Prose 程序需要 Lobster，请通过 <code>tools.subagents.tools</code> 为子代理允许 <code>lobster</code> 工具。参见 <a class="" href="/moltbot-doc/prose">OpenProse</a>。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="安全">安全<a href="#安全" class="hash-link" aria-label="安全的直接链接" title="安全的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><strong>仅本地子进程</strong> — 插件本身没有网络调用。</li>
<li class=""><strong>无秘密</strong> — Lobster 不管理 OAuth；它调用执行此操作的 clawd 工具。</li>
<li class=""><strong>沙箱感知</strong> — 当工具上下文是沙箱时禁用。</li>
<li class=""><strong>加固</strong> — 如果指定了 <code>lobsterPath</code>，则必须是绝对路径；强制执行超时和输出上限。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="故障排除">故障排除<a href="#故障排除" class="hash-link" aria-label="故障排除的直接链接" title="故障排除的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><strong><code>lobster 子进程超时</code></strong> → 增加 <code>timeoutMs</code>，或拆分长管道。</li>
<li class=""><strong><code>lobster 输出超出 maxStdoutBytes</code></strong> → 提高 <code>maxStdoutBytes</code> 或减少输出大小。</li>
<li class=""><strong><code>lobster 返回无效 JSON</code></strong> → 确保管道在工具模式下运行并只打印 JSON。</li>
<li class=""><strong><code>lobster 失败 (代码 …)</code></strong> → 在终端中运行相同的管道以检查 stderr。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="了解更多">了解更多<a href="#了解更多" class="hash-link" aria-label="了解更多的直接链接" title="了解更多的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><a class="" href="/moltbot-doc/plugin">插件</a></li>
<li class=""><a class="" href="/moltbot-doc/plugins/agent-tools">插件工具创作</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="案例研究社区工作流">案例研究：社区工作流<a href="#案例研究社区工作流" class="hash-link" aria-label="案例研究：社区工作流的直接链接" title="案例研究：社区工作流的直接链接" translate="no">​</a></h2>
<p>一个公共示例：一个&quot;第二大脑&quot; CLI + Lobster 管道，管理三个 Markdown 保险库（个人、伙伴、共享）。CLI 为统计、收件箱列表和陈旧扫描发出 JSON；Lobster 将这些命令链接到工作流中，如 <code>weekly-review</code>、<code>inbox-triage</code>、<code>memory-consolidation</code> 和 <code>shared-task-sync</code>，每个都有审批闸门。AI 在可用时处理判断（分类），在不可用时回落到确定性规则。</p>
<ul>
<li class="">线程：<a href="https://x.com/plattenschieber/status/2014508656335770033" target="_blank" rel="noopener noreferrer" class="">https://x.com/plattenschieber/status/2014508656335770033</a></li>
<li class="">仓库：<a href="https://github.com/bloomedai/brain-cli" target="_blank" rel="noopener noreferrer" class="">https://github.com/bloomedai/brain-cli</a></li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tocWrapper_xKoj"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hook" class="table-of-contents__link toc-highlight">Hook</a></li><li><a href="#为什么" class="table-of-contents__link toc-highlight">为什么</a></li><li><a href="#为什么是-dsl-而不是普通程序" class="table-of-contents__link toc-highlight">为什么是 DSL 而不是普通程序？</a></li><li><a href="#工作原理" class="table-of-contents__link toc-highlight">工作原理</a></li><li><a href="#模式小型-cli--json-管道--审批" class="table-of-contents__link toc-highlight">模式：小型 CLI + JSON 管道 + 审批</a></li><li><a href="#仅-json-llm-步骤-llm-task" class="table-of-contents__link toc-highlight">仅 JSON LLM 步骤 (llm-task)</a></li><li><a href="#工作流文件-lobster" class="table-of-contents__link toc-highlight">工作流文件 (.lobster)</a></li><li><a href="#安装-lobster" class="table-of-contents__link toc-highlight">安装 Lobster</a></li><li><a href="#启用工具" class="table-of-contents__link toc-highlight">启用工具</a></li><li><a href="#示例邮件分类" class="table-of-contents__link toc-highlight">示例：邮件分类</a></li><li><a href="#工具参数" class="table-of-contents__link toc-highlight">工具参数</a><ul><li><a href="#run" class="table-of-contents__link toc-highlight"><code>run</code></a></li><li><a href="#resume" class="table-of-contents__link toc-highlight"><code>resume</code></a></li><li><a href="#可选输入" class="table-of-contents__link toc-highlight">可选输入</a></li></ul></li><li><a href="#输出包封" class="table-of-contents__link toc-highlight">输出包封</a></li><li><a href="#审批" class="table-of-contents__link toc-highlight">审批</a></li><li><a href="#openprose" class="table-of-contents__link toc-highlight">OpenProse</a></li><li><a href="#安全" class="table-of-contents__link toc-highlight">安全</a></li><li><a href="#故障排除" class="table-of-contents__link toc-highlight">故障排除</a></li><li><a href="#了解更多" class="table-of-contents__link toc-highlight">了解更多</a></li><li><a href="#案例研究社区工作流" class="table-of-contents__link toc-highlight">案例研究：社区工作流</a></li></ul></div><div class="tocFooter_Fu2z"><div class="themeGroup_RzWV" role="group" aria-label="Theme"><button class="themeBtn_tGr6" aria-label="Light theme" title="Light"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button><button class="themeBtn_tGr6 themeBtnActive_A6tm" aria-label="Dark theme" title="Dark"><svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor" aria-hidden="true"><path d="M11.38 2.019a7.5 7.5 0 1 0 10.6 10.6C21.83 17.963 17.315 22 12.002 22 6.477 22 2 17.523 2 12c0-5.314 4.038-9.827 9.38-10.28z"></path></svg></button></div></div></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Moltbot Docs.</div></div></div></footer></div>
</body>
</html>