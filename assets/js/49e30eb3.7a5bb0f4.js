"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[5990],{41756(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"nodes/location-command","title":"Location command (nodes)","description":"TL;DR","source":"@site/content/moltbot/docs/nodes/location-command.md","sourceDirName":"nodes","slug":"/nodes/location-command","permalink":"/moltbot-doc/docs/nodes/location-command","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Location command for nodes (location.get), permission modes, and background behavior","read_when":["Adding location node support or permissions UI","Designing background location + push flows"]}}');var o=s(74848),l=s(28453);const r={summary:"Location command for nodes (location.get), permission modes, and background behavior",read_when:["Adding location node support or permissions UI","Designing background location + push flows"]},d="Location command (nodes)",c={},t=[{value:"TL;DR",id:"tldr",level:2},{value:"Why a selector (not just a switch)",id:"why-a-selector-not-just-a-switch",level:2},{value:"Settings model",id:"settings-model",level:2},{value:"Permissions mapping (node.permissions)",id:"permissions-mapping-nodepermissions",level:2},{value:"Command: <code>location.get</code>",id:"command-locationget",level:2},{value:"Background behavior (future)",id:"background-behavior-future",level:2},{value:"Model/tooling integration",id:"modeltooling-integration",level:2},{value:"UX copy (suggested)",id:"ux-copy-suggested",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"location-command-nodes",children:"Location command (nodes)"})}),"\n",(0,o.jsx)(n.h2,{id:"tldr",children:"TL;DR"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"location.get"})," is a node command (via ",(0,o.jsx)(n.code,{children:"node.invoke"}),")."]}),"\n",(0,o.jsx)(n.li,{children:"Off by default."}),"\n",(0,o.jsx)(n.li,{children:"Settings use a selector: Off / While Using / Always."}),"\n",(0,o.jsx)(n.li,{children:"Separate toggle: Precise Location."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"why-a-selector-not-just-a-switch",children:"Why a selector (not just a switch)"}),"\n",(0,o.jsx)(n.p,{children:"OS permissions are multi-level. We can expose a selector in-app, but the OS still decides the actual grant."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["iOS/macOS: user can choose ",(0,o.jsx)(n.strong,{children:"While Using"})," or ",(0,o.jsx)(n.strong,{children:"Always"})," in system prompts/Settings. App can request upgrade, but OS may require Settings."]}),"\n",(0,o.jsx)(n.li,{children:"Android: background location is a separate permission; on Android 10+ it often requires a Settings flow."}),"\n",(0,o.jsx)(n.li,{children:"Precise location is a separate grant (iOS 14+ \u201cPrecise\u201d, Android \u201cfine\u201d vs \u201ccoarse\u201d)."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Selector in UI drives our requested mode; actual grant lives in OS settings."}),"\n",(0,o.jsx)(n.h2,{id:"settings-model",children:"Settings model"}),"\n",(0,o.jsx)(n.p,{children:"Per node device:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"location.enabledMode"}),": ",(0,o.jsx)(n.code,{children:"off | whileUsing | always"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"location.preciseEnabled"}),": bool"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"UI behavior:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Selecting ",(0,o.jsx)(n.code,{children:"whileUsing"})," requests foreground permission."]}),"\n",(0,o.jsxs)(n.li,{children:["Selecting ",(0,o.jsx)(n.code,{children:"always"})," first ensures ",(0,o.jsx)(n.code,{children:"whileUsing"}),", then requests background (or sends user to Settings if required)."]}),"\n",(0,o.jsx)(n.li,{children:"If OS denies requested level, revert to the highest granted level and show status."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"permissions-mapping-nodepermissions",children:"Permissions mapping (node.permissions)"}),"\n",(0,o.jsxs)(n.p,{children:["Optional. macOS node reports ",(0,o.jsx)(n.code,{children:"location"})," via the permissions map; iOS/Android may omit it."]}),"\n",(0,o.jsxs)(n.h2,{id:"command-locationget",children:["Command: ",(0,o.jsx)(n.code,{children:"location.get"})]}),"\n",(0,o.jsxs)(n.p,{children:["Called via ",(0,o.jsx)(n.code,{children:"node.invoke"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Params (suggested):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "timeoutMs": 10000,\n  "maxAgeMs": 15000,\n  "desiredAccuracy": "coarse|balanced|precise"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Response payload:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "lat": 48.20849,\n  "lon": 16.37208,\n  "accuracyMeters": 12.5,\n  "altitudeMeters": 182.0,\n  "speedMps": 0.0,\n  "headingDeg": 270.0,\n  "timestamp": "2026-01-03T12:34:56.000Z",\n  "isPrecise": true,\n  "source": "gps|wifi|cell|unknown"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Errors (stable codes):"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LOCATION_DISABLED"}),": selector is off."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LOCATION_PERMISSION_REQUIRED"}),": permission missing for requested mode."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LOCATION_BACKGROUND_UNAVAILABLE"}),": app is backgrounded but only While Using allowed."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LOCATION_TIMEOUT"}),": no fix in time."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LOCATION_UNAVAILABLE"}),": system failure / no providers."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"background-behavior-future",children:"Background behavior (future)"}),"\n",(0,o.jsx)(n.p,{children:"Goal: model can request location even when node is backgrounded, but only when:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["User selected ",(0,o.jsx)(n.strong,{children:"Always"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"OS grants background location."}),"\n",(0,o.jsx)(n.li,{children:"App is allowed to run in background for location (iOS background mode / Android foreground service or special allowance)."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Push-triggered flow (future):"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Gateway sends a push to the node (silent push or FCM data)."}),"\n",(0,o.jsx)(n.li,{children:"Node wakes briefly and requests location from the device."}),"\n",(0,o.jsx)(n.li,{children:"Node forwards payload to Gateway."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Notes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"iOS: Always permission + background location mode required. Silent push may be throttled; expect intermittent failures."}),"\n",(0,o.jsx)(n.li,{children:"Android: background location may require a foreground service; otherwise, expect denial."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"modeltooling-integration",children:"Model/tooling integration"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Tool surface: ",(0,o.jsx)(n.code,{children:"nodes"})," tool adds ",(0,o.jsx)(n.code,{children:"location_get"})," action (node required)."]}),"\n",(0,o.jsxs)(n.li,{children:["CLI: ",(0,o.jsx)(n.code,{children:"moltbot nodes location get --node <id>"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"Agent guidelines: only call when user enabled location and understands the scope."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"ux-copy-suggested",children:"UX copy (suggested)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Off: \u201cLocation sharing is disabled.\u201d"}),"\n",(0,o.jsx)(n.li,{children:"While Using: \u201cOnly when Moltbot is open.\u201d"}),"\n",(0,o.jsx)(n.li,{children:"Always: \u201cAllow background location. Requires system permission.\u201d"}),"\n",(0,o.jsx)(n.li,{children:"Precise: \u201cUse precise GPS location. Toggle off to share approximate location.\u201d"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>r,x:()=>d});var i=s(96540);const o={},l=i.createContext(o);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);