"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[3810],{51047(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"gateway/configuration","title":"Configuration \ud83d\udd27","description":"Moltbot reads an optional JSON5 config from ~/.clawdbot/moltbot.json (comments + trailing commas allowed).","source":"@site/content/moltbot/docs/gateway/configuration.md","sourceDirName":"gateway","slug":"/gateway/configuration","permalink":"/moltbot-doc/docs/gateway/configuration","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"All configuration options for ~/.clawdbot/moltbot.json with examples","read_when":["Adding or modifying config fields"]},"sidebar":"tutorialSidebar","previous":{"title":"\u6a21\u578b\u6545\u969c\u8f6c\u79fb","permalink":"/moltbot-doc/docs/concepts/model-failover"},"next":{"title":"\u914d\u7f6e\u793a\u4f8b","permalink":"/moltbot-doc/docs/gateway/configuration-examples"}}');var i=s(74848),o=s(28453);const d={summary:"All configuration options for ~/.clawdbot/moltbot.json with examples",read_when:["Adding or modifying config fields"]},r="Configuration \ud83d\udd27",c={},a=[{value:"Strict config validation",id:"strict-config-validation",level:2},{value:"Schema + UI hints",id:"schema--ui-hints",level:2},{value:"Apply + restart (RPC)",id:"apply--restart-rpc",level:2},{value:"Partial updates (RPC)",id:"partial-updates-rpc",level:2},{value:"Minimal config (recommended starting point)",id:"minimal-config-recommended-starting-point",level:2},{value:"Self-chat mode (recommended for group control)",id:"self-chat-mode-recommended-for-group-control",level:2},{value:"Config Includes (<code>$include</code>)",id:"config-includes-include",level:2},{value:"Basic usage",id:"basic-usage",level:3},{value:"Merge behavior",id:"merge-behavior",level:3},{value:"Nested includes",id:"nested-includes",level:3},{value:"Path resolution",id:"path-resolution",level:3},{value:"Error handling",id:"error-handling",level:3},{value:"Example: Multi-client legal setup",id:"example-multi-client-legal-setup",level:3},{value:"Common options",id:"common-options",level:2},{value:"Env vars + <code>.env</code>",id:"env-vars--env",level:3},{value:"<code>env.shellEnv</code> (optional)",id:"envshellenv-optional",level:3},{value:"Env var substitution in config",id:"env-var-substitution-in-config",level:3},{value:"Auth storage (OAuth + API keys)",id:"auth-storage-oauth--api-keys",level:3},{value:"<code>auth</code>",id:"auth",level:3},{value:"<code>agents.list[].identity</code>",id:"agentslistidentity",level:3},{value:"<code>wizard</code>",id:"wizard",level:3},{value:"<code>logging</code>",id:"logging",level:3},{value:"<code>channels.whatsapp.dmPolicy</code>",id:"channelswhatsappdmpolicy",level:3},{value:"<code>channels.whatsapp.allowFrom</code>",id:"channelswhatsappallowfrom",level:3},{value:"<code>channels.whatsapp.sendReadReceipts</code>",id:"channelswhatsappsendreadreceipts",level:3},{value:"<code>channels.whatsapp.accounts</code> (multi-account)",id:"channelswhatsappaccounts-multi-account",level:3},{value:"<code>channels.telegram.accounts</code> / <code>channels.discord.accounts</code> / <code>channels.googlechat.accounts</code> / <code>channels.slack.accounts</code> / <code>channels.mattermost.accounts</code> / <code>channels.signal.accounts</code> / <code>channels.imessage.accounts</code>",id:"channelstelegramaccounts--channelsdiscordaccounts--channelsgooglechataccounts--channelsslackaccounts--channelsmattermostaccounts--channelssignalaccounts--channelsimessageaccounts",level:3},{value:"Group chat mention gating (<code>agents.list[].groupChat</code> + <code>messages.groupChat</code>)",id:"group-chat-mention-gating-agentslistgroupchat--messagesgroupchat",level:3},{value:"DM history limits",id:"dm-history-limits",level:4},{value:"Group policy (per channel)",id:"group-policy-per-channel",level:3},{value:"Multi-agent routing (<code>agents.list</code> + <code>bindings</code>)",id:"multi-agent-routing-agentslist--bindings",level:3},{value:"Per-agent access profiles (multi-agent)",id:"per-agent-access-profiles-multi-agent",level:4},{value:"<code>tools.agentToAgent</code> (optional)",id:"toolsagenttoagent-optional",level:3},{value:"<code>messages.queue</code>",id:"messagesqueue",level:3},{value:"<code>messages.inbound</code>",id:"messagesinbound",level:3},{value:"<code>commands</code> (chat command handling)",id:"commands-chat-command-handling",level:3},{value:"<code>web</code> (WhatsApp web channel runtime)",id:"web-whatsapp-web-channel-runtime",level:3},{value:"<code>channels.telegram</code> (bot transport)",id:"channelstelegram-bot-transport",level:3},{value:"<code>channels.discord</code> (bot transport)",id:"channelsdiscord-bot-transport",level:3},{value:"<code>channels.googlechat</code> (Chat API webhook)",id:"channelsgooglechat-chat-api-webhook",level:3},{value:"<code>channels.slack</code> (socket mode)",id:"channelsslack-socket-mode",level:3},{value:"<code>channels.mattermost</code> (bot token)",id:"channelsmattermost-bot-token",level:3},{value:"<code>channels.signal</code> (signal-cli)",id:"channelssignal-signal-cli",level:3},{value:"<code>channels.imessage</code> (imsg CLI)",id:"channelsimessage-imsg-cli",level:3},{value:"<code>agents.defaults.workspace</code>",id:"agentsdefaultsworkspace",level:3},{value:"<code>agents.defaults.repoRoot</code>",id:"agentsdefaultsreporoot",level:3},{value:"<code>agents.defaults.skipBootstrap</code>",id:"agentsdefaultsskipbootstrap",level:3},{value:"<code>agents.defaults.bootstrapMaxChars</code>",id:"agentsdefaultsbootstrapmaxchars",level:3},{value:"<code>agents.defaults.userTimezone</code>",id:"agentsdefaultsusertimezone",level:3},{value:"<code>agents.defaults.timeFormat</code>",id:"agentsdefaultstimeformat",level:3},{value:"<code>messages</code>",id:"messages",level:3},{value:"Template variables",id:"template-variables",level:4},{value:"<code>messages.tts</code>",id:"messagestts",level:4},{value:"<code>talk</code>",id:"talk",level:3},{value:"<code>agents.defaults</code>",id:"agentsdefaults",level:3},{value:"<code>agents.defaults.cliBackends</code> (CLI fallback)",id:"agentsdefaultsclibackends-cli-fallback",level:4},{value:"<code>agents.defaults.contextPruning</code> (tool-result pruning)",id:"agentsdefaultscontextpruning-tool-result-pruning",level:4},{value:"<code>agents.defaults.compaction</code> (reserve headroom + memory flush)",id:"agentsdefaultscompaction-reserve-headroom--memory-flush",level:4},{value:"<code>agents.defaults.sandbox</code>",id:"agentsdefaultssandbox",level:3},{value:"<code>models</code> (custom providers + base URLs)",id:"models-custom-providers--base-urls",level:3},{value:"OpenCode Zen (multi-model proxy)",id:"opencode-zen-multi-model-proxy",level:3},{value:"Z.AI (GLM-4.7) \u2014 provider alias support",id:"zai-glm-47--provider-alias-support",level:3},{value:"Moonshot AI (Kimi)",id:"moonshot-ai-kimi",level:3},{value:"Kimi Code",id:"kimi-code",level:3},{value:"Synthetic (Anthropic-compatible)",id:"synthetic-anthropic-compatible",level:3},{value:"Local models (LM Studio) \u2014 recommended setup",id:"local-models-lm-studio--recommended-setup",level:3},{value:"MiniMax M2.1",id:"minimax-m21",level:3},{value:"Cerebras (GLM 4.6 / 4.7)",id:"cerebras-glm-46--47",level:3},{value:"<code>session</code>",id:"session",level:3},{value:"<code>skills</code> (skills config)",id:"skills-skills-config",level:3},{value:"<code>plugins</code> (extensions)",id:"plugins-extensions",level:3},{value:"<code>browser</code> (clawd-managed browser)",id:"browser-clawd-managed-browser",level:3},{value:"<code>ui</code> (Appearance)",id:"ui-appearance",level:3},{value:"<code>gateway</code> (Gateway server mode + bind)",id:"gateway-gateway-server-mode--bind",level:3},{value:"<code>gateway.reload</code> (Config hot reload)",id:"gatewayreload-config-hot-reload",level:3},{value:"Hot reload matrix (files + impact)",id:"hot-reload-matrix-files--impact",level:4},{value:"Multi-instance isolation",id:"multi-instance-isolation",level:3},{value:"<code>hooks</code> (Gateway webhooks)",id:"hooks-gateway-webhooks",level:3},{value:"<code>canvasHost</code> (LAN/tailnet Canvas file server + live reload)",id:"canvashost-lantailnet-canvas-file-server--live-reload",level:3},{value:"<code>bridge</code> (legacy TCP bridge, removed)",id:"bridge-legacy-tcp-bridge-removed",level:3},{value:"<code>discovery.mdns</code> (Bonjour / mDNS broadcast mode)",id:"discoverymdns-bonjour--mdns-broadcast-mode",level:3},{value:"<code>discovery.wideArea</code> (Wide-Area Bonjour / unicast DNS\u2011SD)",id:"discoverywidearea-wide-area-bonjour--unicast-dnssd",level:3},{value:"Template variables",id:"template-variables-1",level:2},{value:"Cron (Gateway scheduler)",id:"cron-gateway-scheduler",level:2}];function t(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"configuration-",children:"Configuration \ud83d\udd27"})}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot reads an optional ",(0,i.jsx)(n.strong,{children:"JSON5"})," config from ",(0,i.jsx)(n.code,{children:"~/.clawdbot/moltbot.json"})," (comments + trailing commas allowed)."]}),"\n",(0,i.jsxs)(n.p,{children:["If the file is missing, Moltbot uses safe-ish defaults (embedded Pi agent + per-sender sessions + workspace ",(0,i.jsx)(n.code,{children:"~/clawd"}),"). You usually only need a config to:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["restrict who can trigger the bot (",(0,i.jsx)(n.code,{children:"channels.whatsapp.allowFrom"}),", ",(0,i.jsx)(n.code,{children:"channels.telegram.allowFrom"}),", etc.)"]}),"\n",(0,i.jsxs)(n.li,{children:["control group allowlists + mention behavior (",(0,i.jsx)(n.code,{children:"channels.whatsapp.groups"}),", ",(0,i.jsx)(n.code,{children:"channels.telegram.groups"}),", ",(0,i.jsx)(n.code,{children:"channels.discord.guilds"}),", ",(0,i.jsx)(n.code,{children:"agents.list[].groupChat"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["customize message prefixes (",(0,i.jsx)(n.code,{children:"messages"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["set the agent's workspace (",(0,i.jsx)(n.code,{children:"agents.defaults.workspace"})," or ",(0,i.jsx)(n.code,{children:"agents.list[].workspace"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["tune the embedded agent defaults (",(0,i.jsx)(n.code,{children:"agents.defaults"}),") and session behavior (",(0,i.jsx)(n.code,{children:"session"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["set per-agent identity (",(0,i.jsx)(n.code,{children:"agents.list[].identity"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"New to configuration?"})," Check out the ",(0,i.jsx)(n.a,{href:"/gateway/configuration-examples",children:"Configuration Examples"})," guide for complete examples with detailed explanations!"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"strict-config-validation",children:"Strict config validation"}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot only accepts configurations that fully match the schema.\nUnknown keys, malformed types, or invalid values cause the Gateway to ",(0,i.jsx)(n.strong,{children:"refuse to start"})," for safety."]}),"\n",(0,i.jsx)(n.p,{children:"When validation fails:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The Gateway does not boot."}),"\n",(0,i.jsxs)(n.li,{children:["Only diagnostic commands are allowed (for example: ",(0,i.jsx)(n.code,{children:"moltbot doctor"}),", ",(0,i.jsx)(n.code,{children:"moltbot logs"}),", ",(0,i.jsx)(n.code,{children:"moltbot health"}),", ",(0,i.jsx)(n.code,{children:"moltbot status"}),", ",(0,i.jsx)(n.code,{children:"moltbot service"}),", ",(0,i.jsx)(n.code,{children:"moltbot help"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"moltbot doctor"})," to see the exact issues."]}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"moltbot doctor --fix"})," (or ",(0,i.jsx)(n.code,{children:"--yes"}),") to apply migrations/repairs."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Doctor never writes changes unless you explicitly opt into ",(0,i.jsx)(n.code,{children:"--fix"}),"/",(0,i.jsx)(n.code,{children:"--yes"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"schema--ui-hints",children:"Schema + UI hints"}),"\n",(0,i.jsxs)(n.p,{children:["The Gateway exposes a JSON Schema representation of the config via ",(0,i.jsx)(n.code,{children:"config.schema"})," for UI editors.\nThe Control UI renders a form from this schema, with a ",(0,i.jsx)(n.strong,{children:"Raw JSON"})," editor as an escape hatch."]}),"\n",(0,i.jsx)(n.p,{children:"Channel plugins and extensions can register schema + UI hints for their config, so channel settings\nstay schema-driven across apps without hard-coded forms."}),"\n",(0,i.jsx)(n.p,{children:"Hints (labels, grouping, sensitive fields) ship alongside the schema so clients can render\nbetter forms without hard-coding config knowledge."}),"\n",(0,i.jsx)(n.h2,{id:"apply--restart-rpc",children:"Apply + restart (RPC)"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"config.apply"})," to validate + write the full config and restart the Gateway in one step.\nIt writes a restart sentinel and pings the last active session after the Gateway comes back."]}),"\n",(0,i.jsxs)(n.p,{children:["Warning: ",(0,i.jsx)(n.code,{children:"config.apply"})," replaces the ",(0,i.jsx)(n.strong,{children:"entire config"}),". If you want to change only a few keys,\nuse ",(0,i.jsx)(n.code,{children:"config.patch"})," or ",(0,i.jsx)(n.code,{children:"moltbot config set"}),". Keep a backup of ",(0,i.jsx)(n.code,{children:"~/.clawdbot/moltbot.json"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Params:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"raw"})," (string) \u2014 JSON5 payload for the entire config"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"baseHash"})," (optional) \u2014 config hash from ",(0,i.jsx)(n.code,{children:"config.get"})," (required when a config already exists)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sessionKey"})," (optional) \u2014 last active session key for the wake-up ping"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"note"})," (optional) \u2014 note to include in the restart sentinel"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"restartDelayMs"})," (optional) \u2014 delay before restart (default 2000)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Example (via ",(0,i.jsx)(n.code,{children:"gateway call"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'moltbot gateway call config.get --params \'{}\' # capture payload.hash\nmoltbot gateway call config.apply --params \'{\n  "raw": "{\\\\n  agents: { defaults: { workspace: \\\\"~/clawd\\\\" } }\\\\n}\\\\n",\n  "baseHash": "<hash-from-config.get>",\n  "sessionKey": "agent:main:whatsapp:dm:+15555550123",\n  "restartDelayMs": 1000\n}\'\n'})}),"\n",(0,i.jsx)(n.h2,{id:"partial-updates-rpc",children:"Partial updates (RPC)"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"config.patch"})," to merge a partial update into the existing config without clobbering\nunrelated keys. It applies JSON merge patch semantics:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"objects merge recursively"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"null"})," deletes a key"]}),"\n",(0,i.jsxs)(n.li,{children:["arrays replace\nLike ",(0,i.jsx)(n.code,{children:"config.apply"}),", it validates, writes the config, stores a restart sentinel, and schedules\nthe Gateway restart (with an optional wake when ",(0,i.jsx)(n.code,{children:"sessionKey"})," is provided)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Params:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"raw"})," (string) \u2014 JSON5 payload containing just the keys to change"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"baseHash"})," (required) \u2014 config hash from ",(0,i.jsx)(n.code,{children:"config.get"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sessionKey"})," (optional) \u2014 last active session key for the wake-up ping"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"note"})," (optional) \u2014 note to include in the restart sentinel"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"restartDelayMs"})," (optional) \u2014 delay before restart (default 2000)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'moltbot gateway call config.get --params \'{}\' # capture payload.hash\nmoltbot gateway call config.patch --params \'{\n  "raw": "{\\\\n  channels: { telegram: { groups: { \\\\"*\\\\": { requireMention: false } } } }\\\\n}\\\\n",\n  "baseHash": "<hash-from-config.get>",\n  "sessionKey": "agent:main:whatsapp:dm:+15555550123",\n  "restartDelayMs": 1000\n}\'\n'})}),"\n",(0,i.jsx)(n.h2,{id:"minimal-config-recommended-starting-point",children:"Minimal config (recommended starting point)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { workspace: "~/clawd" } },\n  channels: { whatsapp: { allowFrom: ["+15555550123"] } }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Build the default image once with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"scripts/sandbox-setup.sh\n"})}),"\n",(0,i.jsx)(n.h2,{id:"self-chat-mode-recommended-for-group-control",children:"Self-chat mode (recommended for group control)"}),"\n",(0,i.jsx)(n.p,{children:"To prevent the bot from responding to WhatsApp @-mentions in groups (only respond to specific text triggers):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: { workspace: "~/clawd" },\n    list: [\n      {\n        id: "main",\n        groupChat: { mentionPatterns: ["@clawd", "reisponde"] }\n      }\n    ]\n  },\n  channels: {\n    whatsapp: {\n      // Allowlist is DMs only; including your own number enables self-chat mode.\n      allowFrom: ["+15555550123"],\n      groups: { "*": { requireMention: true } }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"config-includes-include",children:["Config Includes (",(0,i.jsx)(n.code,{children:"$include"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Split your config into multiple files using the ",(0,i.jsx)(n.code,{children:"$include"})," directive. This is useful for:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Organizing large configs (e.g., per-client agent definitions)"}),"\n",(0,i.jsx)(n.li,{children:"Sharing common settings across environments"}),"\n",(0,i.jsx)(n.li,{children:"Keeping sensitive configs separate"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'// ~/.clawdbot/moltbot.json\n{\n  gateway: { port: 18789 },\n  \n  // Include a single file (replaces the key\'s value)\n  agents: { "$include": "./agents.json5" },\n  \n  // Include multiple files (deep-merged in order)\n  broadcast: { \n    "$include": [\n      "./clients/mueller.json5",\n      "./clients/schmidt.json5"\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'// ~/.clawdbot/agents.json5\n{\n  defaults: { sandbox: { mode: "all", scope: "session" } },\n  list: [\n    { id: "main", workspace: "~/clawd" }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"merge-behavior",children:"Merge behavior"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Single file"}),": Replaces the object containing ",(0,i.jsx)(n.code,{children:"$include"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Array of files"}),": Deep-merges files in order (later files override earlier ones)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"With sibling keys"}),": Sibling keys are merged after includes (override included values)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sibling keys + arrays/primitives"}),": Not supported (included content must be an object)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'// Sibling keys override included values\n{\n  "$include": "./base.json5",   // { a: 1, b: 2 }\n  b: 99                          // Result: { a: 1, b: 99 }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"nested-includes",children:"Nested includes"}),"\n",(0,i.jsxs)(n.p,{children:["Included files can themselves contain ",(0,i.jsx)(n.code,{children:"$include"})," directives (up to 10 levels deep):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'// clients/mueller.json5\n{\n  agents: { "$include": "./mueller/agents.json5" },\n  broadcast: { "$include": "./mueller/broadcast.json5" }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"path-resolution",children:"Path resolution"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relative paths"}),": Resolved relative to the including file"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Absolute paths"}),": Used as-is"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Parent directories"}),": ",(0,i.jsx)(n.code,{children:"../"})," references work as expected"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{ "$include": "./sub/config.json5" }      // relative\n{ "$include": "/etc/moltbot/base.json5" } // absolute\n{ "$include": "../shared/common.json5" }   // parent dir\n'})}),"\n",(0,i.jsx)(n.h3,{id:"error-handling",children:"Error handling"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Missing file"}),": Clear error with resolved path"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Parse error"}),": Shows which included file failed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Circular includes"}),": Detected and reported with include chain"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-multi-client-legal-setup",children:"Example: Multi-client legal setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'// ~/.clawdbot/moltbot.json\n{\n  gateway: { port: 18789, auth: { token: "secret" } },\n  \n  // Common agent defaults\n  agents: {\n    defaults: {\n      sandbox: { mode: "all", scope: "session" }\n    },\n    // Merge agent lists from all clients\n    list: { "$include": [\n      "./clients/mueller/agents.json5",\n      "./clients/schmidt/agents.json5"\n    ]}\n  },\n  \n  // Merge broadcast configs\n  broadcast: { "$include": [\n    "./clients/mueller/broadcast.json5",\n    "./clients/schmidt/broadcast.json5"\n  ]},\n  \n  channels: { whatsapp: { groupPolicy: "allowlist" } }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'// ~/.clawdbot/clients/mueller/agents.json5\n[\n  { id: "mueller-transcribe", workspace: "~/clients/mueller/transcribe" },\n  { id: "mueller-docs", workspace: "~/clients/mueller/docs" }\n]\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'// ~/.clawdbot/clients/mueller/broadcast.json5\n{\n  "120363403215116621@g.us": ["mueller-transcribe", "mueller-docs"]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"common-options",children:"Common options"}),"\n",(0,i.jsxs)(n.h3,{id:"env-vars--env",children:["Env vars + ",(0,i.jsx)(n.code,{children:".env"})]}),"\n",(0,i.jsx)(n.p,{children:"Moltbot reads env vars from the parent process (shell, launchd/systemd, CI, etc.)."}),"\n",(0,i.jsx)(n.p,{children:"Additionally, it loads:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".env"})," from the current working directory (if present)"]}),"\n",(0,i.jsxs)(n.li,{children:["a global fallback ",(0,i.jsx)(n.code,{children:".env"})," from ",(0,i.jsx)(n.code,{children:"~/.clawdbot/.env"})," (aka ",(0,i.jsx)(n.code,{children:"$CLAWDBOT_STATE_DIR/.env"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Neither ",(0,i.jsx)(n.code,{children:".env"})," file overrides existing env vars."]}),"\n",(0,i.jsx)(n.p,{children:"You can also provide inline env vars in config. These are only applied if the\nprocess env is missing the key (same non-overriding rule):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  env: {\n    OPENROUTER_API_KEY: "sk-or-...",\n    vars: {\n      GROQ_API_KEY: "gsk-..."\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/environment",children:"/environment"})," for full precedence and sources."]}),"\n",(0,i.jsxs)(n.h3,{id:"envshellenv-optional",children:[(0,i.jsx)(n.code,{children:"env.shellEnv"})," (optional)"]}),"\n",(0,i.jsx)(n.p,{children:"Opt-in convenience: if enabled and none of the expected keys are set yet, Moltbot runs your login shell and imports only the missing expected keys (never overrides).\nThis effectively sources your shell profile."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  env: {\n    shellEnv: {\n      enabled: true,\n      timeoutMs: 15000\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Env var equivalent:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"CLAWDBOT_LOAD_SHELL_ENV=1"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"CLAWDBOT_SHELL_ENV_TIMEOUT_MS=15000"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"env-var-substitution-in-config",children:"Env var substitution in config"}),"\n",(0,i.jsxs)(n.p,{children:["You can reference environment variables directly in any config string value using\n",(0,i.jsx)(n.code,{children:"${VAR_NAME}"})," syntax. Variables are substituted at config load time, before validation."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  models: {\n    providers: {\n      "vercel-gateway": {\n        apiKey: "${VERCEL_GATEWAY_API_KEY}"\n      }\n    }\n  },\n  gateway: {\n    auth: {\n      token: "${CLAWDBOT_GATEWAY_TOKEN}"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rules:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Only uppercase env var names are matched: ",(0,i.jsx)(n.code,{children:"[A-Z_][A-Z0-9_]*"})]}),"\n",(0,i.jsx)(n.li,{children:"Missing or empty env vars throw an error at config load"}),"\n",(0,i.jsxs)(n.li,{children:["Escape with ",(0,i.jsx)(n.code,{children:"$${VAR}"})," to output a literal ",(0,i.jsx)(n.code,{children:"${VAR}"})]}),"\n",(0,i.jsxs)(n.li,{children:["Works with ",(0,i.jsx)(n.code,{children:"$include"})," (included files also get substitution)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Inline substitution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  models: {\n    providers: {\n      custom: {\n        baseUrl: "${CUSTOM_API_BASE}/v1"  // \u2192 "https://api.example.com/v1"\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"auth-storage-oauth--api-keys",children:"Auth storage (OAuth + API keys)"}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot stores ",(0,i.jsx)(n.strong,{children:"per-agent"})," auth profiles (OAuth + API keys) in:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<agentDir>/auth-profiles.json"})," (default: ",(0,i.jsx)(n.code,{children:"~/.clawdbot/agents/<agentId>/agent/auth-profiles.json"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See also: ",(0,i.jsx)(n.a,{href:"/concepts/oauth",children:"/concepts/oauth"})]}),"\n",(0,i.jsx)(n.p,{children:"Legacy OAuth imports:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"~/.clawdbot/credentials/oauth.json"})," (or ",(0,i.jsx)(n.code,{children:"$CLAWDBOT_STATE_DIR/credentials/oauth.json"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The embedded Pi agent maintains a runtime cache at:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<agentDir>/auth.json"})," (managed automatically; don\u2019t edit manually)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Legacy agent dir (pre multi-agent):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"~/.clawdbot/agent/*"})," (migrated by ",(0,i.jsx)(n.code,{children:"moltbot doctor"})," into ",(0,i.jsx)(n.code,{children:"~/.clawdbot/agents/<defaultAgentId>/agent/*"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Overrides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OAuth dir (legacy import only): ",(0,i.jsx)(n.code,{children:"CLAWDBOT_OAUTH_DIR"})]}),"\n",(0,i.jsxs)(n.li,{children:["Agent dir (default agent root override): ",(0,i.jsx)(n.code,{children:"CLAWDBOT_AGENT_DIR"})," (preferred), ",(0,i.jsx)(n.code,{children:"PI_CODING_AGENT_DIR"})," (legacy)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["On first use, Moltbot imports ",(0,i.jsx)(n.code,{children:"oauth.json"})," entries into ",(0,i.jsx)(n.code,{children:"auth-profiles.json"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"auth",children:(0,i.jsx)(n.code,{children:"auth"})}),"\n",(0,i.jsxs)(n.p,{children:["Optional metadata for auth profiles. This does ",(0,i.jsx)(n.strong,{children:"not"})," store secrets; it maps\nprofile IDs to a provider + mode (and optional email) and defines the provider\nrotation order used for failover."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  auth: {\n    profiles: {\n      "anthropic:me@example.com": { provider: "anthropic", mode: "oauth", email: "me@example.com" },\n      "anthropic:work": { provider: "anthropic", mode: "api_key" }\n    },\n    order: {\n      anthropic: ["anthropic:me@example.com", "anthropic:work"]\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"agentslistidentity",children:(0,i.jsx)(n.code,{children:"agents.list[].identity"})}),"\n",(0,i.jsx)(n.p,{children:"Optional per-agent identity used for defaults and UX. This is written by the macOS onboarding assistant."}),"\n",(0,i.jsx)(n.p,{children:"If set, Moltbot derives defaults (only when you haven\u2019t set them explicitly):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"messages.ackReaction"})," from the ",(0,i.jsx)(n.strong,{children:"active agent"}),"\u2019s ",(0,i.jsx)(n.code,{children:"identity.emoji"})," (falls back to \ud83d\udc40)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.list[].groupChat.mentionPatterns"})," from the agent\u2019s ",(0,i.jsx)(n.code,{children:"identity.name"}),"/",(0,i.jsx)(n.code,{children:"identity.emoji"})," (so \u201c@Samantha\u201d works in groups across Telegram/Slack/Discord/Google Chat/iMessage/WhatsApp)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"identity.avatar"})," accepts a workspace-relative image path or a remote URL/data URL. Local files must live inside the agent workspace."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"identity.avatar"})," accepts:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Workspace-relative path (must stay within the agent workspace)"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"http(s)"})," URL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data:"})," URI"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    list: [\n      {\n        id: "main",\n        identity: {\n          name: "Samantha",\n          theme: "helpful sloth",\n          emoji: "\ud83e\udda5",\n          avatar: "avatars/samantha.png"\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"wizard",children:(0,i.jsx)(n.code,{children:"wizard"})}),"\n",(0,i.jsxs)(n.p,{children:["Metadata written by CLI wizards (",(0,i.jsx)(n.code,{children:"onboard"}),", ",(0,i.jsx)(n.code,{children:"configure"}),", ",(0,i.jsx)(n.code,{children:"doctor"}),")."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  wizard: {\n    lastRunAt: "2026-01-01T00:00:00.000Z",\n    lastRunVersion: "2026.1.4",\n    lastRunCommit: "abc1234",\n    lastRunCommand: "configure",\n    lastRunMode: "local"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"logging",children:(0,i.jsx)(n.code,{children:"logging"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Default log file: ",(0,i.jsx)(n.code,{children:"/tmp/moltbot/moltbot-YYYY-MM-DD.log"})]}),"\n",(0,i.jsxs)(n.li,{children:["If you want a stable path, set ",(0,i.jsx)(n.code,{children:"logging.file"})," to ",(0,i.jsx)(n.code,{children:"/tmp/moltbot/moltbot.log"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Console output can be tuned separately via:\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"logging.consoleLevel"})," (defaults to ",(0,i.jsx)(n.code,{children:"info"}),", bumps to ",(0,i.jsx)(n.code,{children:"debug"})," when ",(0,i.jsx)(n.code,{children:"--verbose"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"logging.consoleStyle"})," (",(0,i.jsx)(n.code,{children:"pretty"})," | ",(0,i.jsx)(n.code,{children:"compact"})," | ",(0,i.jsx)(n.code,{children:"json"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Tool summaries can be redacted to avoid leaking secrets:\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"logging.redactSensitive"})," (",(0,i.jsx)(n.code,{children:"off"})," | ",(0,i.jsx)(n.code,{children:"tools"}),", default: ",(0,i.jsx)(n.code,{children:"tools"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"logging.redactPatterns"})," (array of regex strings; overrides defaults)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  logging: {\n    level: "info",\n    file: "/tmp/moltbot/moltbot.log",\n    consoleLevel: "info",\n    consoleStyle: "pretty",\n    redactSensitive: "tools",\n    redactPatterns: [\n      // Example: override defaults with your own rules.\n      "\\\\bTOKEN\\\\b\\\\s*[=:]\\\\s*([\\"\']?)([^\\\\s\\"\']+)\\\\1",\n      "/\\\\bsk-[A-Za-z0-9_-]{8,}\\\\b/gi"\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"channelswhatsappdmpolicy",children:(0,i.jsx)(n.code,{children:"channels.whatsapp.dmPolicy"})}),"\n",(0,i.jsx)(n.p,{children:"Controls how WhatsApp direct chats (DMs) are handled:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"pairing"'})," (default): unknown senders get a pairing code; owner must approve"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"allowlist"'}),": only allow senders in ",(0,i.jsx)(n.code,{children:"channels.whatsapp.allowFrom"})," (or paired allow store)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"open"'}),": allow all inbound DMs (",(0,i.jsx)(n.strong,{children:"requires"})," ",(0,i.jsx)(n.code,{children:"channels.whatsapp.allowFrom"})," to include ",(0,i.jsx)(n.code,{children:'"*"'}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"disabled"'}),": ignore all inbound DMs"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Pairing codes expire after 1 hour; the bot only sends a pairing code when a new request is created. Pending DM pairing requests are capped at ",(0,i.jsx)(n.strong,{children:"3 per channel"})," by default."]}),"\n",(0,i.jsx)(n.p,{children:"Pairing approvals:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"moltbot pairing list whatsapp"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"moltbot pairing approve whatsapp <code>"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"channelswhatsappallowfrom",children:(0,i.jsx)(n.code,{children:"channels.whatsapp.allowFrom"})}),"\n",(0,i.jsxs)(n.p,{children:["Allowlist of E.164 phone numbers that may trigger WhatsApp auto-replies (",(0,i.jsx)(n.strong,{children:"DMs only"}),").\nIf empty and ",(0,i.jsx)(n.code,{children:'channels.whatsapp.dmPolicy="pairing"'}),", unknown senders will receive a pairing code.\nFor groups, use ",(0,i.jsx)(n.code,{children:"channels.whatsapp.groupPolicy"})," + ",(0,i.jsx)(n.code,{children:"channels.whatsapp.groupAllowFrom"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      dmPolicy: "pairing", // pairing | allowlist | open | disabled\n      allowFrom: ["+15555550123", "+447700900123"],\n      textChunkLimit: 4000, // optional outbound chunk size (chars)\n      chunkMode: "length", // optional chunking mode (length | newline)\n      mediaMaxMb: 50 // optional inbound media cap (MB)\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"channelswhatsappsendreadreceipts",children:(0,i.jsx)(n.code,{children:"channels.whatsapp.sendReadReceipts"})}),"\n",(0,i.jsxs)(n.p,{children:["Controls whether inbound WhatsApp messages are marked as read (blue ticks). Default: ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Self-chat mode always skips read receipts, even when enabled."}),"\n",(0,i.jsxs)(n.p,{children:["Per-account override: ",(0,i.jsx)(n.code,{children:"channels.whatsapp.accounts.<id>.sendReadReceipts"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  channels: {\n    whatsapp: { sendReadReceipts: false }\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"channelswhatsappaccounts-multi-account",children:[(0,i.jsx)(n.code,{children:"channels.whatsapp.accounts"})," (multi-account)"]}),"\n",(0,i.jsx)(n.p,{children:"Run multiple WhatsApp accounts in one gateway:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      accounts: {\n        default: {}, // optional; keeps the default id stable\n        personal: {},\n        biz: {\n          // Optional override. Default: ~/.clawdbot/credentials/whatsapp/biz\n          // authDir: "~/.clawdbot/credentials/whatsapp/biz",\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Outbound commands default to account ",(0,i.jsx)(n.code,{children:"default"})," if present; otherwise the first configured account id (sorted)."]}),"\n",(0,i.jsxs)(n.li,{children:["The legacy single-account Baileys auth dir is migrated by ",(0,i.jsx)(n.code,{children:"moltbot doctor"})," into ",(0,i.jsx)(n.code,{children:"whatsapp/default"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"channelstelegramaccounts--channelsdiscordaccounts--channelsgooglechataccounts--channelsslackaccounts--channelsmattermostaccounts--channelssignalaccounts--channelsimessageaccounts",children:[(0,i.jsx)(n.code,{children:"channels.telegram.accounts"})," / ",(0,i.jsx)(n.code,{children:"channels.discord.accounts"})," / ",(0,i.jsx)(n.code,{children:"channels.googlechat.accounts"})," / ",(0,i.jsx)(n.code,{children:"channels.slack.accounts"})," / ",(0,i.jsx)(n.code,{children:"channels.mattermost.accounts"})," / ",(0,i.jsx)(n.code,{children:"channels.signal.accounts"})," / ",(0,i.jsx)(n.code,{children:"channels.imessage.accounts"})]}),"\n",(0,i.jsxs)(n.p,{children:["Run multiple accounts per channel (each account has its own ",(0,i.jsx)(n.code,{children:"accountId"})," and optional ",(0,i.jsx)(n.code,{children:"name"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    telegram: {\n      accounts: {\n        default: {\n          name: "Primary bot",\n          botToken: "123456:ABC..."\n        },\n        alerts: {\n          name: "Alerts bot",\n          botToken: "987654:XYZ..."\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"default"})," is used when ",(0,i.jsx)(n.code,{children:"accountId"})," is omitted (CLI + routing)."]}),"\n",(0,i.jsxs)(n.li,{children:["Env tokens only apply to the ",(0,i.jsx)(n.strong,{children:"default"})," account."]}),"\n",(0,i.jsx)(n.li,{children:"Base channel settings (group policy, mention gating, etc.) apply to all accounts unless overridden per account."}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"bindings[].match.accountId"})," to route each account to a different agents.defaults."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"group-chat-mention-gating-agentslistgroupchat--messagesgroupchat",children:["Group chat mention gating (",(0,i.jsx)(n.code,{children:"agents.list[].groupChat"})," + ",(0,i.jsx)(n.code,{children:"messages.groupChat"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Group messages default to ",(0,i.jsx)(n.strong,{children:"require mention"})," (either metadata mention or regex patterns). Applies to WhatsApp, Telegram, Discord, Google Chat, and iMessage group chats."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Mention types:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metadata mentions"}),": Native platform @-mentions (e.g., WhatsApp tap-to-mention). Ignored in WhatsApp self-chat mode (see ",(0,i.jsx)(n.code,{children:"channels.whatsapp.allowFrom"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Text patterns"}),": Regex patterns defined in ",(0,i.jsx)(n.code,{children:"agents.list[].groupChat.mentionPatterns"}),". Always checked regardless of self-chat mode."]}),"\n",(0,i.jsxs)(n.li,{children:["Mention gating is enforced only when mention detection is possible (native mentions or at least one ",(0,i.jsx)(n.code,{children:"mentionPattern"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  messages: {\n    groupChat: { historyLimit: 50 }\n  },\n  agents: {\n    list: [\n      { id: "main", groupChat: { mentionPatterns: ["@clawd", "moltbot", "clawd"] } }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"messages.groupChat.historyLimit"})," sets the global default for group history context. Channels can override with ",(0,i.jsx)(n.code,{children:"channels.<channel>.historyLimit"})," (or ",(0,i.jsx)(n.code,{children:"channels.<channel>.accounts.*.historyLimit"})," for multi-account). Set ",(0,i.jsx)(n.code,{children:"0"})," to disable history wrapping."]}),"\n",(0,i.jsx)(n.h4,{id:"dm-history-limits",children:"DM history limits"}),"\n",(0,i.jsx)(n.p,{children:"DM conversations use session-based history managed by the agent. You can limit the number of user turns retained per DM session:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    telegram: {\n      dmHistoryLimit: 30,  // limit DM sessions to 30 user turns\n      dms: {\n        "123456789": { historyLimit: 50 }  // per-user override (user ID)\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Resolution order:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Per-DM override: ",(0,i.jsx)(n.code,{children:"channels.<provider>.dms[userId].historyLimit"})]}),"\n",(0,i.jsxs)(n.li,{children:["Provider default: ",(0,i.jsx)(n.code,{children:"channels.<provider>.dmHistoryLimit"})]}),"\n",(0,i.jsx)(n.li,{children:"No limit (all history retained)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Supported providers: ",(0,i.jsx)(n.code,{children:"telegram"}),", ",(0,i.jsx)(n.code,{children:"whatsapp"}),", ",(0,i.jsx)(n.code,{children:"discord"}),", ",(0,i.jsx)(n.code,{children:"slack"}),", ",(0,i.jsx)(n.code,{children:"signal"}),", ",(0,i.jsx)(n.code,{children:"imessage"}),", ",(0,i.jsx)(n.code,{children:"msteams"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Per-agent override (takes precedence when set, even ",(0,i.jsx)(n.code,{children:"[]"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    list: [\n      { id: "work", groupChat: { mentionPatterns: ["@workbot", "\\\\+15555550123"] } },\n      { id: "personal", groupChat: { mentionPatterns: ["@homebot", "\\\\+15555550999"] } }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Mention gating defaults live per channel (",(0,i.jsx)(n.code,{children:"channels.whatsapp.groups"}),", ",(0,i.jsx)(n.code,{children:"channels.telegram.groups"}),", ",(0,i.jsx)(n.code,{children:"channels.imessage.groups"}),", ",(0,i.jsx)(n.code,{children:"channels.discord.guilds"}),"). When ",(0,i.jsx)(n.code,{children:"*.groups"})," is set, it also acts as a group allowlist; include ",(0,i.jsx)(n.code,{children:'"*"'})," to allow all groups."]}),"\n",(0,i.jsxs)(n.p,{children:["To respond ",(0,i.jsx)(n.strong,{children:"only"})," to specific text triggers (ignoring native @-mentions):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      // Include your own number to enable self-chat mode (ignore native @-mentions).\n      allowFrom: ["+15555550123"],\n      groups: { "*": { requireMention: true } }\n    }\n  },\n  agents: {\n    list: [\n      {\n        id: "main",\n        groupChat: {\n          // Only these text patterns will trigger responses\n          mentionPatterns: ["reisponde", "@clawd"]\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"group-policy-per-channel",children:"Group policy (per channel)"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"channels.*.groupPolicy"})," to control whether group/room messages are accepted at all:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["+15551234567"]\n    },\n    telegram: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["tg:123456789", "@alice"]\n    },\n    signal: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["+15551234567"]\n    },\n    imessage: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["chat_id:123"]\n    },\n    msteams: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["user@org.com"]\n    },\n    discord: {\n      groupPolicy: "allowlist",\n      guilds: {\n        "GUILD_ID": {\n          channels: { help: { allow: true } }\n        }\n      }\n    },\n    slack: {\n      groupPolicy: "allowlist",\n      channels: { "#general": { allow: true } }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"open"'}),": groups bypass allowlists; mention-gating still applies."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"disabled"'}),": block all group/room messages."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"allowlist"'}),": only allow groups/rooms that match the configured allowlist."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"channels.defaults.groupPolicy"})," sets the default when a provider\u2019s ",(0,i.jsx)(n.code,{children:"groupPolicy"})," is unset."]}),"\n",(0,i.jsxs)(n.li,{children:["WhatsApp/Telegram/Signal/iMessage/Microsoft Teams use ",(0,i.jsx)(n.code,{children:"groupAllowFrom"})," (fallback: explicit ",(0,i.jsx)(n.code,{children:"allowFrom"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Discord/Slack use channel allowlists (",(0,i.jsx)(n.code,{children:"channels.discord.guilds.*.channels"}),", ",(0,i.jsx)(n.code,{children:"channels.slack.channels"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Group DMs (Discord/Slack) are still controlled by ",(0,i.jsx)(n.code,{children:"dm.groupEnabled"})," + ",(0,i.jsx)(n.code,{children:"dm.groupChannels"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Default is ",(0,i.jsx)(n.code,{children:'groupPolicy: "allowlist"'})," (unless overridden by ",(0,i.jsx)(n.code,{children:"channels.defaults.groupPolicy"}),"); if no allowlist is configured, group messages are blocked."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"multi-agent-routing-agentslist--bindings",children:["Multi-agent routing (",(0,i.jsx)(n.code,{children:"agents.list"})," + ",(0,i.jsx)(n.code,{children:"bindings"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Run multiple isolated agents (separate workspace, ",(0,i.jsx)(n.code,{children:"agentDir"}),", sessions) inside one Gateway.\nInbound messages are routed to an agent via bindings."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.list[]"}),": per-agent overrides.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"id"}),": stable agent id (required)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"default"}),": optional; when multiple are set, the first wins and a warning is logged.\nIf none are set, the ",(0,i.jsx)(n.strong,{children:"first entry"})," in the list is the default agent."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"name"}),": display name for the agent."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"workspace"}),": default ",(0,i.jsx)(n.code,{children:"~/clawd-<agentId>"})," (for ",(0,i.jsx)(n.code,{children:"main"}),", falls back to ",(0,i.jsx)(n.code,{children:"agents.defaults.workspace"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agentDir"}),": default ",(0,i.jsx)(n.code,{children:"~/.clawdbot/agents/<agentId>/agent"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"model"}),": per-agent default model, overrides ",(0,i.jsx)(n.code,{children:"agents.defaults.model"})," for that agent.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["string form: ",(0,i.jsx)(n.code,{children:'"provider/model"'}),", overrides only ",(0,i.jsx)(n.code,{children:"agents.defaults.model.primary"})]}),"\n",(0,i.jsxs)(n.li,{children:["object form: ",(0,i.jsx)(n.code,{children:"{ primary, fallbacks }"})," (fallbacks override ",(0,i.jsx)(n.code,{children:"agents.defaults.model.fallbacks"}),"; ",(0,i.jsx)(n.code,{children:"[]"})," disables global fallbacks for that agent)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"identity"}),": per-agent name/theme/emoji (used for mention patterns + ack reactions)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"groupChat"}),": per-agent mention-gating (",(0,i.jsx)(n.code,{children:"mentionPatterns"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sandbox"}),": per-agent sandbox config (overrides ",(0,i.jsx)(n.code,{children:"agents.defaults.sandbox"}),").\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mode"}),": ",(0,i.jsx)(n.code,{children:'"off"'})," | ",(0,i.jsx)(n.code,{children:'"non-main"'})," | ",(0,i.jsx)(n.code,{children:'"all"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"workspaceAccess"}),": ",(0,i.jsx)(n.code,{children:'"none"'})," | ",(0,i.jsx)(n.code,{children:'"ro"'})," | ",(0,i.jsx)(n.code,{children:'"rw"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scope"}),": ",(0,i.jsx)(n.code,{children:'"session"'})," | ",(0,i.jsx)(n.code,{children:'"agent"'})," | ",(0,i.jsx)(n.code,{children:'"shared"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"workspaceRoot"}),": custom sandbox workspace root"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"docker"}),": per-agent docker overrides (e.g. ",(0,i.jsx)(n.code,{children:"image"}),", ",(0,i.jsx)(n.code,{children:"network"}),", ",(0,i.jsx)(n.code,{children:"env"}),", ",(0,i.jsx)(n.code,{children:"setupCommand"}),", limits; ignored when ",(0,i.jsx)(n.code,{children:'scope: "shared"'}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"browser"}),": per-agent sandboxed browser overrides (ignored when ",(0,i.jsx)(n.code,{children:'scope: "shared"'}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prune"}),": per-agent sandbox pruning overrides (ignored when ",(0,i.jsx)(n.code,{children:'scope: "shared"'}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"subagents"}),": per-agent sub-agent defaults.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowAgents"}),": allowlist of agent ids for ",(0,i.jsx)(n.code,{children:"sessions_spawn"})," from this agent (",(0,i.jsx)(n.code,{children:'["*"]'})," = allow any; default: only same agent)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools"}),": per-agent tool restrictions (applied before sandbox tool policy).\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"profile"}),": base tool profile (applied before allow/deny)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allow"}),": array of allowed tool names"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deny"}),": array of denied tool names (deny wins)"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults"}),": shared agent defaults (model, workspace, sandbox, etc.)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bindings[]"}),": routes inbound messages to an ",(0,i.jsx)(n.code,{children:"agentId"}),".\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match.channel"})," (required)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match.accountId"})," (optional; ",(0,i.jsx)(n.code,{children:"*"})," = any account; omitted = default account)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match.peer"})," (optional; ",(0,i.jsx)(n.code,{children:"{ kind: dm|group|channel, id }"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match.guildId"})," / ",(0,i.jsx)(n.code,{children:"match.teamId"})," (optional; channel-specific)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Deterministic match order:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"match.peer"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"match.guildId"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"match.teamId"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match.accountId"})," (exact, no peer/guild/team)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'match.accountId: "*"'})," (channel-wide, no peer/guild/team)"]}),"\n",(0,i.jsxs)(n.li,{children:["default agent (",(0,i.jsx)(n.code,{children:"agents.list[].default"}),", else first list entry, else ",(0,i.jsx)(n.code,{children:'"main"'}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Within each match tier, the first matching entry in ",(0,i.jsx)(n.code,{children:"bindings"})," wins."]}),"\n",(0,i.jsx)(n.h4,{id:"per-agent-access-profiles-multi-agent",children:"Per-agent access profiles (multi-agent)"}),"\n",(0,i.jsx)(n.p,{children:"Each agent can carry its own sandbox + tool policy. Use this to mix access\nlevels in one gateway:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Full access"})," (personal agent)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Read-only"})," tools + workspace"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No filesystem access"})," (messaging/session tools only)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/multi-agent-sandbox-tools",children:"Multi-Agent Sandbox & Tools"})," for precedence and\nadditional examples."]}),"\n",(0,i.jsx)(n.p,{children:"Full access (no sandbox):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    list: [\n      {\n        id: "personal",\n        workspace: "~/clawd-personal",\n        sandbox: { mode: "off" }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Read-only tools + read-only workspace:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    list: [\n      {\n        id: "family",\n        workspace: "~/clawd-family",\n        sandbox: {\n          mode: "all",\n          scope: "agent",\n          workspaceAccess: "ro"\n        },\n        tools: {\n          allow: ["read", "sessions_list", "sessions_history", "sessions_send", "sessions_spawn", "session_status"],\n          deny: ["write", "edit", "apply_patch", "exec", "process", "browser"]\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"No filesystem access (messaging/session tools enabled):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    list: [\n      {\n        id: "public",\n        workspace: "~/clawd-public",\n        sandbox: {\n          mode: "all",\n          scope: "agent",\n          workspaceAccess: "none"\n        },\n        tools: {\n          allow: ["sessions_list", "sessions_history", "sessions_send", "sessions_spawn", "session_status", "whatsapp", "telegram", "slack", "discord", "gateway"],\n          deny: ["read", "write", "edit", "apply_patch", "exec", "process", "browser", "canvas", "nodes", "cron", "gateway", "image"]\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Example: two WhatsApp accounts \u2192 two agents:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    list: [\n      { id: "home", default: true, workspace: "~/clawd-home" },\n      { id: "work", workspace: "~/clawd-work" }\n    ]\n  },\n  bindings: [\n    { agentId: "home", match: { channel: "whatsapp", accountId: "personal" } },\n    { agentId: "work", match: { channel: "whatsapp", accountId: "biz" } }\n  ],\n  channels: {\n    whatsapp: {\n      accounts: {\n        personal: {},\n        biz: {},\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"toolsagenttoagent-optional",children:[(0,i.jsx)(n.code,{children:"tools.agentToAgent"})," (optional)"]}),"\n",(0,i.jsx)(n.p,{children:"Agent-to-agent messaging is opt-in:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: {\n    agentToAgent: {\n      enabled: false,\n      allow: ["home", "work"]\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"messagesqueue",children:(0,i.jsx)(n.code,{children:"messages.queue"})}),"\n",(0,i.jsx)(n.p,{children:"Controls how inbound messages behave when an agent run is already active."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  messages: {\n    queue: {\n      mode: "collect", // steer | followup | collect | steer-backlog (steer+backlog ok) | interrupt (queue=steer legacy)\n      debounceMs: 1000,\n      cap: 20,\n      drop: "summarize", // old | new | summarize\n      byChannel: {\n        whatsapp: "collect",\n        telegram: "collect",\n        discord: "collect",\n        imessage: "collect",\n        webchat: "collect"\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"messagesinbound",children:(0,i.jsx)(n.code,{children:"messages.inbound"})}),"\n",(0,i.jsxs)(n.p,{children:["Debounce rapid inbound messages from the ",(0,i.jsx)(n.strong,{children:"same sender"})," so multiple back-to-back\nmessages become a single agent turn. Debouncing is scoped per channel + conversation\nand uses the most recent message for reply threading/IDs."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  messages: {\n    inbound: {\n      debounceMs: 2000, // 0 disables\n      byChannel: {\n        whatsapp: 5000,\n        slack: 1500,\n        discord: 1500\n      }\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Debounce batches ",(0,i.jsx)(n.strong,{children:"text-only"})," messages; media/attachments flush immediately."]}),"\n",(0,i.jsxs)(n.li,{children:["Control commands (e.g. ",(0,i.jsx)(n.code,{children:"/queue"}),", ",(0,i.jsx)(n.code,{children:"/new"}),") bypass debouncing so they stay standalone."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"commands-chat-command-handling",children:[(0,i.jsx)(n.code,{children:"commands"})," (chat command handling)"]}),"\n",(0,i.jsx)(n.p,{children:"Controls how chat commands are enabled across connectors."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  commands: {\n    native: "auto",         // register native commands when supported (auto)\n    text: true,             // parse slash commands in chat messages\n    bash: false,            // allow ! (alias: /bash) (host-only; requires tools.elevated allowlists)\n    bashForegroundMs: 2000, // bash foreground window (0 backgrounds immediately)\n    config: false,          // allow /config (writes to disk)\n    debug: false,           // allow /debug (runtime-only overrides)\n    restart: false,         // allow /restart + gateway restart tool\n    useAccessGroups: true   // enforce access-group allowlists/policies for commands\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Text commands must be sent as a ",(0,i.jsx)(n.strong,{children:"standalone"})," message and use the leading ",(0,i.jsx)(n.code,{children:"/"})," (no plain-text aliases)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commands.text: false"})," disables parsing chat messages for commands."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'commands.native: "auto"'})," (default) turns on native commands for Discord/Telegram and leaves Slack off; unsupported channels stay text-only."]}),"\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"commands.native: true|false"})," to force all, or override per channel with ",(0,i.jsx)(n.code,{children:"channels.discord.commands.native"}),", ",(0,i.jsx)(n.code,{children:"channels.telegram.commands.native"}),", ",(0,i.jsx)(n.code,{children:"channels.slack.commands.native"})," (bool or ",(0,i.jsx)(n.code,{children:'"auto"'}),"). ",(0,i.jsx)(n.code,{children:"false"})," clears previously registered commands on Discord/Telegram at startup; Slack commands are managed in the Slack app."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"channels.telegram.customCommands"})," adds extra Telegram bot menu entries. Names are normalized; conflicts with native commands are ignored."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commands.bash: true"})," enables ",(0,i.jsx)(n.code,{children:"! <cmd>"})," to run host shell commands (",(0,i.jsx)(n.code,{children:"/bash <cmd>"})," also works as an alias). Requires ",(0,i.jsx)(n.code,{children:"tools.elevated.enabled"})," and allowlisting the sender in ",(0,i.jsx)(n.code,{children:"tools.elevated.allowFrom.<channel>"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commands.bashForegroundMs"})," controls how long bash waits before backgrounding. While a bash job is running, new ",(0,i.jsx)(n.code,{children:"! <cmd>"})," requests are rejected (one at a time)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commands.config: true"})," enables ",(0,i.jsx)(n.code,{children:"/config"})," (reads/writes ",(0,i.jsx)(n.code,{children:"moltbot.json"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"channels.<provider>.configWrites"})," gates config mutations initiated by that channel (default: true). This applies to ",(0,i.jsx)(n.code,{children:"/config set|unset"})," plus provider-specific auto-migrations (Telegram supergroup ID changes, Slack channel ID changes)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commands.debug: true"})," enables ",(0,i.jsx)(n.code,{children:"/debug"})," (runtime-only overrides)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commands.restart: true"})," enables ",(0,i.jsx)(n.code,{children:"/restart"})," and the gateway tool restart action."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commands.useAccessGroups: false"})," allows commands to bypass access-group allowlists/policies."]}),"\n",(0,i.jsxs)(n.li,{children:["Slash commands and directives are only honored for ",(0,i.jsx)(n.strong,{children:"authorized senders"}),". Authorization is derived from\nchannel allowlists/pairing plus ",(0,i.jsx)(n.code,{children:"commands.useAccessGroups"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"web-whatsapp-web-channel-runtime",children:[(0,i.jsx)(n.code,{children:"web"})," (WhatsApp web channel runtime)"]}),"\n",(0,i.jsxs)(n.p,{children:["WhatsApp runs through the gateway\u2019s web channel (Baileys Web). It starts automatically when a linked session exists.\nSet ",(0,i.jsx)(n.code,{children:"web.enabled: false"})," to keep it off by default."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  web: {\n    enabled: true,\n    heartbeatSeconds: 60,\n    reconnect: {\n      initialMs: 2000,\n      maxMs: 120000,\n      factor: 1.4,\n      jitter: 0.2,\n      maxAttempts: 0\n    }\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"channelstelegram-bot-transport",children:[(0,i.jsx)(n.code,{children:"channels.telegram"})," (bot transport)"]}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot starts Telegram only when a ",(0,i.jsx)(n.code,{children:"channels.telegram"})," config section exists. The bot token is resolved from ",(0,i.jsx)(n.code,{children:"channels.telegram.botToken"})," (or ",(0,i.jsx)(n.code,{children:"channels.telegram.tokenFile"}),"), with ",(0,i.jsx)(n.code,{children:"TELEGRAM_BOT_TOKEN"})," as a fallback for the default account.\nSet ",(0,i.jsx)(n.code,{children:"channels.telegram.enabled: false"})," to disable automatic startup.\nMulti-account support lives under ",(0,i.jsx)(n.code,{children:"channels.telegram.accounts"})," (see the multi-account section above). Env tokens only apply to the default account.\nSet ",(0,i.jsx)(n.code,{children:"channels.telegram.configWrites: false"})," to block Telegram-initiated config writes (including supergroup ID migrations and ",(0,i.jsx)(n.code,{children:"/config set|unset"}),")."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    telegram: {\n      enabled: true,\n      botToken: "your-bot-token",\n      dmPolicy: "pairing",                 // pairing | allowlist | open | disabled\n      allowFrom: ["tg:123456789"],         // optional; "open" requires ["*"]\n      groups: {\n        "*": { requireMention: true },\n        "-1001234567890": {\n          allowFrom: ["@admin"],\n          systemPrompt: "Keep answers brief.",\n          topics: {\n            "99": {\n              requireMention: false,\n              skills: ["search"],\n              systemPrompt: "Stay on topic."\n            }\n          }\n        }\n      },\n      customCommands: [\n        { command: "backup", description: "Git backup" },\n        { command: "generate", description: "Create an image" }\n      ],\n      historyLimit: 50,                     // include last N group messages as context (0 disables)\n      replyToMode: "first",                 // off | first | all\n      linkPreview: true,                   // toggle outbound link previews\n      streamMode: "partial",               // off | partial | block (draft streaming; separate from block streaming)\n      draftChunk: {                        // optional; only for streamMode=block\n        minChars: 200,\n        maxChars: 800,\n        breakPreference: "paragraph"       // paragraph | newline | sentence\n      },\n      actions: { reactions: true, sendMessage: true }, // tool action gates (false disables)\n      reactionNotifications: "own",   // off | own | all\n      mediaMaxMb: 5,\n      retry: {                             // outbound retry policy\n        attempts: 3,\n        minDelayMs: 400,\n        maxDelayMs: 30000,\n        jitter: 0.1\n      },\n      network: {                           // transport overrides\n        autoSelectFamily: false\n      },\n      proxy: "socks5://localhost:9050",\n      webhookUrl: "https://example.com/telegram-webhook",\n      webhookSecret: "secret",\n      webhookPath: "/telegram-webhook"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Draft streaming notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uses Telegram ",(0,i.jsx)(n.code,{children:"sendMessageDraft"})," (draft bubble, not a real message)."]}),"\n",(0,i.jsxs)(n.li,{children:["Requires ",(0,i.jsx)(n.strong,{children:"private chat topics"})," (message_thread_id in DMs; bot has topics enabled)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/reasoning stream"})," streams reasoning into the draft, then sends the final answer.\nRetry policy defaults and behavior are documented in ",(0,i.jsx)(n.a,{href:"/concepts/retry",children:"Retry policy"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"channelsdiscord-bot-transport",children:[(0,i.jsx)(n.code,{children:"channels.discord"})," (bot transport)"]}),"\n",(0,i.jsxs)(n.p,{children:["Configure the Discord bot by setting the bot token and optional gating:\nMulti-account support lives under ",(0,i.jsx)(n.code,{children:"channels.discord.accounts"})," (see the multi-account section above). Env tokens only apply to the default account."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    discord: {\n      enabled: true,\n      token: "your-bot-token",\n      mediaMaxMb: 8,                          // clamp inbound media size\n      allowBots: false,                       // allow bot-authored messages\n      actions: {                              // tool action gates (false disables)\n        reactions: true,\n        stickers: true,\n        polls: true,\n        permissions: true,\n        messages: true,\n        threads: true,\n        pins: true,\n        search: true,\n        memberInfo: true,\n        roleInfo: true,\n        roles: false,\n        channelInfo: true,\n        voiceStatus: true,\n        events: true,\n        moderation: false\n      },\n      replyToMode: "off",                     // off | first | all\n      dm: {\n        enabled: true,                        // disable all DMs when false\n        policy: "pairing",                    // pairing | allowlist | open | disabled\n        allowFrom: ["1234567890", "steipete"], // optional DM allowlist ("open" requires ["*"])\n        groupEnabled: false,                 // enable group DMs\n        groupChannels: ["clawd-dm"]          // optional group DM allowlist\n      },\n      guilds: {\n        "123456789012345678": {               // guild id (preferred) or slug\n          slug: "friends-of-clawd",\n          requireMention: false,              // per-guild default\n          reactionNotifications: "own",       // off | own | all | allowlist\n          users: ["987654321098765432"],      // optional per-guild user allowlist\n          channels: {\n            general: { allow: true },\n            help: {\n              allow: true,\n              requireMention: true,\n              users: ["987654321098765432"],\n              skills: ["docs"],\n              systemPrompt: "Short answers only."\n            }\n          }\n        }\n      },\n      historyLimit: 20,                       // include last N guild messages as context\n      textChunkLimit: 2000,                   // optional outbound text chunk size (chars)\n      chunkMode: "length",                    // optional chunking mode (length | newline)\n      maxLinesPerMessage: 17,                 // soft max lines per message (Discord UI clipping)\n      retry: {                                // outbound retry policy\n        attempts: 3,\n        minDelayMs: 500,\n        maxDelayMs: 30000,\n        jitter: 0.1\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot starts Discord only when a ",(0,i.jsx)(n.code,{children:"channels.discord"})," config section exists. The token is resolved from ",(0,i.jsx)(n.code,{children:"channels.discord.token"}),", with ",(0,i.jsx)(n.code,{children:"DISCORD_BOT_TOKEN"})," as a fallback for the default account (unless ",(0,i.jsx)(n.code,{children:"channels.discord.enabled"})," is ",(0,i.jsx)(n.code,{children:"false"}),"). Use ",(0,i.jsx)(n.code,{children:"user:<id>"})," (DM) or ",(0,i.jsx)(n.code,{children:"channel:<id>"})," (guild channel) when specifying delivery targets for cron/CLI commands; bare numeric IDs are ambiguous and rejected.\nGuild slugs are lowercase with spaces replaced by ",(0,i.jsx)(n.code,{children:"-"}),"; channel keys use the slugged channel name (no leading ",(0,i.jsx)(n.code,{children:"#"}),"). Prefer guild ids as keys to avoid rename ambiguity.\nBot-authored messages are ignored by default. Enable with ",(0,i.jsx)(n.code,{children:"channels.discord.allowBots"})," (own messages are still filtered to prevent self-reply loops).\nReaction notification modes:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"off"}),": no reaction events."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"own"}),": reactions on the bot's own messages (default)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"all"}),": all reactions on all messages."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowlist"}),": reactions from ",(0,i.jsx)(n.code,{children:"guilds.<id>.users"})," on all messages (empty list disables).\nOutbound text is chunked by ",(0,i.jsx)(n.code,{children:"channels.discord.textChunkLimit"})," (default 2000). Set ",(0,i.jsx)(n.code,{children:'channels.discord.chunkMode="newline"'})," to split on blank lines (paragraph boundaries) before length chunking. Discord clients can clip very tall messages, so ",(0,i.jsx)(n.code,{children:"channels.discord.maxLinesPerMessage"})," (default 17) splits long multi-line replies even when under 2000 chars.\nRetry policy defaults and behavior are documented in ",(0,i.jsx)(n.a,{href:"/concepts/retry",children:"Retry policy"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"channelsgooglechat-chat-api-webhook",children:[(0,i.jsx)(n.code,{children:"channels.googlechat"})," (Chat API webhook)"]}),"\n",(0,i.jsxs)(n.p,{children:["Google Chat runs over HTTP webhooks with app-level auth (service account).\nMulti-account support lives under ",(0,i.jsx)(n.code,{children:"channels.googlechat.accounts"})," (see the multi-account section above). Env vars only apply to the default account."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    "googlechat": {\n      enabled: true,\n      serviceAccountFile: "/path/to/service-account.json",\n      audienceType: "app-url",             // app-url | project-number\n      audience: "https://gateway.example.com/googlechat",\n      webhookPath: "/googlechat",\n      botUser: "users/1234567890",        // optional; improves mention detection\n      dm: {\n        enabled: true,\n        policy: "pairing",                // pairing | allowlist | open | disabled\n        allowFrom: ["users/1234567890"]   // optional; "open" requires ["*"]\n      },\n      groupPolicy: "allowlist",\n      groups: {\n        "spaces/AAAA": { allow: true, requireMention: true }\n      },\n      actions: { reactions: true },\n      typingIndicator: "message",\n      mediaMaxMb: 20\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Service account JSON can be inline (",(0,i.jsx)(n.code,{children:"serviceAccount"}),") or file-based (",(0,i.jsx)(n.code,{children:"serviceAccountFile"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Env fallbacks for the default account: ",(0,i.jsx)(n.code,{children:"GOOGLE_CHAT_SERVICE_ACCOUNT"})," or ",(0,i.jsx)(n.code,{children:"GOOGLE_CHAT_SERVICE_ACCOUNT_FILE"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"audienceType"})," + ",(0,i.jsx)(n.code,{children:"audience"})," must match the Chat app\u2019s webhook auth config."]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"spaces/<spaceId>"})," or ",(0,i.jsx)(n.code,{children:"users/<userId|email>"})," when setting delivery targets."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"channelsslack-socket-mode",children:[(0,i.jsx)(n.code,{children:"channels.slack"})," (socket mode)"]}),"\n",(0,i.jsx)(n.p,{children:"Slack runs in Socket Mode and requires both a bot token and app token:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    slack: {\n      enabled: true,\n      botToken: "xoxb-...",\n      appToken: "xapp-...",\n      dm: {\n        enabled: true,\n        policy: "pairing", // pairing | allowlist | open | disabled\n        allowFrom: ["U123", "U456", "*"], // optional; "open" requires ["*"]\n        groupEnabled: false,\n        groupChannels: ["G123"]\n      },\n      channels: {\n        C123: { allow: true, requireMention: true, allowBots: false },\n        "#general": {\n          allow: true,\n          requireMention: true,\n          allowBots: false,\n          users: ["U123"],\n          skills: ["docs"],\n          systemPrompt: "Short answers only."\n        }\n      },\n      historyLimit: 50,          // include last N channel/group messages as context (0 disables)\n      allowBots: false,\n      reactionNotifications: "own", // off | own | all | allowlist\n      reactionAllowlist: ["U123"],\n      replyToMode: "off",           // off | first | all\n      thread: {\n        historyScope: "thread",     // thread | channel\n        inheritParent: false\n      },\n      actions: {\n        reactions: true,\n        messages: true,\n        pins: true,\n        memberInfo: true,\n        emojiList: true\n      },\n      slashCommand: {\n        enabled: true,\n        name: "clawd",\n        sessionPrefix: "slack:slash",\n        ephemeral: true\n      },\n      textChunkLimit: 4000,\n      chunkMode: "length",\n      mediaMaxMb: 20\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Multi-account support lives under ",(0,i.jsx)(n.code,{children:"channels.slack.accounts"})," (see the multi-account section above). Env tokens only apply to the default account."]}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot starts Slack when the provider is enabled and both tokens are set (via config or ",(0,i.jsx)(n.code,{children:"SLACK_BOT_TOKEN"})," + ",(0,i.jsx)(n.code,{children:"SLACK_APP_TOKEN"}),"). Use ",(0,i.jsx)(n.code,{children:"user:<id>"})," (DM) or ",(0,i.jsx)(n.code,{children:"channel:<id>"})," when specifying delivery targets for cron/CLI commands.\nSet ",(0,i.jsx)(n.code,{children:"channels.slack.configWrites: false"})," to block Slack-initiated config writes (including channel ID migrations and ",(0,i.jsx)(n.code,{children:"/config set|unset"}),")."]}),"\n",(0,i.jsxs)(n.p,{children:["Bot-authored messages are ignored by default. Enable with ",(0,i.jsx)(n.code,{children:"channels.slack.allowBots"})," or ",(0,i.jsx)(n.code,{children:"channels.slack.channels.<id>.allowBots"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Reaction notification modes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"off"}),": no reaction events."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"own"}),": reactions on the bot's own messages (default)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"all"}),": all reactions on all messages."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowlist"}),": reactions from ",(0,i.jsx)(n.code,{children:"channels.slack.reactionAllowlist"})," on all messages (empty list disables)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Thread session isolation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"channels.slack.thread.historyScope"})," controls whether thread history is per-thread (",(0,i.jsx)(n.code,{children:"thread"}),", default) or shared across the channel (",(0,i.jsx)(n.code,{children:"channel"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"channels.slack.thread.inheritParent"})," controls whether new thread sessions inherit the parent channel transcript (default: false)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Slack action groups (gate ",(0,i.jsx)(n.code,{children:"slack"})," tool actions):"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Action group"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"reactions"}),(0,i.jsx)(n.td,{children:"enabled"}),(0,i.jsx)(n.td,{children:"React + list reactions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"messages"}),(0,i.jsx)(n.td,{children:"enabled"}),(0,i.jsx)(n.td,{children:"Read/send/edit/delete"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"pins"}),(0,i.jsx)(n.td,{children:"enabled"}),(0,i.jsx)(n.td,{children:"Pin/unpin/list"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"memberInfo"}),(0,i.jsx)(n.td,{children:"enabled"}),(0,i.jsx)(n.td,{children:"Member info"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"emojiList"}),(0,i.jsx)(n.td,{children:"enabled"}),(0,i.jsx)(n.td,{children:"Custom emoji list"})]})]})]}),"\n",(0,i.jsxs)(n.h3,{id:"channelsmattermost-bot-token",children:[(0,i.jsx)(n.code,{children:"channels.mattermost"})," (bot token)"]}),"\n",(0,i.jsxs)(n.p,{children:["Mattermost ships as a plugin and is not bundled with the core install.\nInstall it first: ",(0,i.jsx)(n.code,{children:"moltbot plugins install @moltbot/mattermost"})," (or ",(0,i.jsx)(n.code,{children:"./extensions/mattermost"})," from a git checkout)."]}),"\n",(0,i.jsx)(n.p,{children:"Mattermost requires a bot token plus the base URL for your server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    mattermost: {\n      enabled: true,\n      botToken: "mm-token",\n      baseUrl: "https://chat.example.com",\n      dmPolicy: "pairing",\n      chatmode: "oncall", // oncall | onmessage | onchar\n      oncharPrefixes: [">", "!"],\n      textChunkLimit: 4000,\n      chunkMode: "length"\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot starts Mattermost when the account is configured (bot token + base URL) and enabled. The token + base URL are resolved from ",(0,i.jsx)(n.code,{children:"channels.mattermost.botToken"})," + ",(0,i.jsx)(n.code,{children:"channels.mattermost.baseUrl"})," or ",(0,i.jsx)(n.code,{children:"MATTERMOST_BOT_TOKEN"})," + ",(0,i.jsx)(n.code,{children:"MATTERMOST_URL"})," for the default account (unless ",(0,i.jsx)(n.code,{children:"channels.mattermost.enabled"})," is ",(0,i.jsx)(n.code,{children:"false"}),")."]}),"\n",(0,i.jsx)(n.p,{children:"Chat modes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"oncall"})," (default): respond to channel messages only when @mentioned."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"onmessage"}),": respond to every channel message."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"onchar"}),": respond when a message starts with a trigger prefix (",(0,i.jsx)(n.code,{children:"channels.mattermost.oncharPrefixes"}),", default ",(0,i.jsx)(n.code,{children:'[">", "!"]'}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Access control:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Default DMs: ",(0,i.jsx)(n.code,{children:'channels.mattermost.dmPolicy="pairing"'})," (unknown senders get a pairing code)."]}),"\n",(0,i.jsxs)(n.li,{children:["Public DMs: ",(0,i.jsx)(n.code,{children:'channels.mattermost.dmPolicy="open"'})," plus ",(0,i.jsx)(n.code,{children:'channels.mattermost.allowFrom=["*"]'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Groups: ",(0,i.jsx)(n.code,{children:'channels.mattermost.groupPolicy="allowlist"'})," by default (mention-gated). Use ",(0,i.jsx)(n.code,{children:"channels.mattermost.groupAllowFrom"})," to restrict senders."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Multi-account support lives under ",(0,i.jsx)(n.code,{children:"channels.mattermost.accounts"})," (see the multi-account section above). Env vars only apply to the default account.\nUse ",(0,i.jsx)(n.code,{children:"channel:<id>"})," or ",(0,i.jsx)(n.code,{children:"user:<id>"})," (or ",(0,i.jsx)(n.code,{children:"@username"}),") when specifying delivery targets; bare ids are treated as channel ids."]}),"\n",(0,i.jsxs)(n.h3,{id:"channelssignal-signal-cli",children:[(0,i.jsx)(n.code,{children:"channels.signal"})," (signal-cli)"]}),"\n",(0,i.jsx)(n.p,{children:"Signal reactions can emit system events (shared reaction tooling):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    signal: {\n      reactionNotifications: "own", // off | own | all | allowlist\n      reactionAllowlist: ["+15551234567", "uuid:123e4567-e89b-12d3-a456-426614174000"],\n      historyLimit: 50 // include last N group messages as context (0 disables)\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Reaction notification modes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"off"}),": no reaction events."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"own"}),": reactions on the bot's own messages (default)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"all"}),": all reactions on all messages."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowlist"}),": reactions from ",(0,i.jsx)(n.code,{children:"channels.signal.reactionAllowlist"})," on all messages (empty list disables)."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"channelsimessage-imsg-cli",children:[(0,i.jsx)(n.code,{children:"channels.imessage"})," (imsg CLI)"]}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot spawns ",(0,i.jsx)(n.code,{children:"imsg rpc"})," (JSON-RPC over stdio). No daemon or port required."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    imessage: {\n      enabled: true,\n      cliPath: "imsg",\n      dbPath: "~/Library/Messages/chat.db",\n      remoteHost: "user@gateway-host", // SCP for remote attachments when using SSH wrapper\n      dmPolicy: "pairing", // pairing | allowlist | open | disabled\n      allowFrom: ["+15555550123", "user@example.com", "chat_id:123"],\n      historyLimit: 50,    // include last N group messages as context (0 disables)\n      includeAttachments: false,\n      mediaMaxMb: 16,\n      service: "auto",\n      region: "US"\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Multi-account support lives under ",(0,i.jsx)(n.code,{children:"channels.imessage.accounts"})," (see the multi-account section above)."]}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Requires Full Disk Access to the Messages DB."}),"\n",(0,i.jsx)(n.li,{children:"The first send will prompt for Messages automation permission."}),"\n",(0,i.jsxs)(n.li,{children:["Prefer ",(0,i.jsx)(n.code,{children:"chat_id:<id>"})," targets. Use ",(0,i.jsx)(n.code,{children:"imsg chats --limit 20"})," to list chats."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"channels.imessage.cliPath"})," can point to a wrapper script (e.g. ",(0,i.jsx)(n.code,{children:"ssh"})," to another Mac that runs ",(0,i.jsx)(n.code,{children:"imsg rpc"}),"); use SSH keys to avoid password prompts."]}),"\n",(0,i.jsxs)(n.li,{children:["For remote SSH wrappers, set ",(0,i.jsx)(n.code,{children:"channels.imessage.remoteHost"})," to fetch attachments via SCP when ",(0,i.jsx)(n.code,{children:"includeAttachments"})," is enabled."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example wrapper:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'#!/usr/bin/env bash\nexec ssh -T gateway-host imsg "$@"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaultsworkspace",children:(0,i.jsx)(n.code,{children:"agents.defaults.workspace"})}),"\n",(0,i.jsxs)(n.p,{children:["Sets the ",(0,i.jsx)(n.strong,{children:"single global workspace directory"})," used by the agent for file operations."]}),"\n",(0,i.jsxs)(n.p,{children:["Default: ",(0,i.jsx)(n.code,{children:"~/clawd"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { workspace: "~/clawd" } }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"agents.defaults.sandbox"})," is enabled, non-main sessions can override this with their\nown per-scope workspaces under ",(0,i.jsx)(n.code,{children:"agents.defaults.sandbox.workspaceRoot"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaultsreporoot",children:(0,i.jsx)(n.code,{children:"agents.defaults.repoRoot"})}),"\n",(0,i.jsxs)(n.p,{children:["Optional repository root to show in the system prompt\u2019s Runtime line. If unset, Moltbot\ntries to detect a ",(0,i.jsx)(n.code,{children:".git"})," directory by walking upward from the workspace (and current\nworking directory). The path must exist to be used."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { repoRoot: "~/Projects/moltbot" } }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaultsskipbootstrap",children:(0,i.jsx)(n.code,{children:"agents.defaults.skipBootstrap"})}),"\n",(0,i.jsxs)(n.p,{children:["Disables automatic creation of the workspace bootstrap files (",(0,i.jsx)(n.code,{children:"AGENTS.md"}),", ",(0,i.jsx)(n.code,{children:"SOUL.md"}),", ",(0,i.jsx)(n.code,{children:"TOOLS.md"}),", ",(0,i.jsx)(n.code,{children:"IDENTITY.md"}),", ",(0,i.jsx)(n.code,{children:"USER.md"}),", and ",(0,i.jsx)(n.code,{children:"BOOTSTRAP.md"}),")."]}),"\n",(0,i.jsx)(n.p,{children:"Use this for pre-seeded deployments where your workspace files come from a repo."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  agents: { defaults: { skipBootstrap: true } }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaultsbootstrapmaxchars",children:(0,i.jsx)(n.code,{children:"agents.defaults.bootstrapMaxChars"})}),"\n",(0,i.jsxs)(n.p,{children:["Max characters of each workspace bootstrap file injected into the system prompt\nbefore truncation. Default: ",(0,i.jsx)(n.code,{children:"20000"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"When a file exceeds this limit, Moltbot logs a warning and injects a truncated\nhead/tail with a marker."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  agents: { defaults: { bootstrapMaxChars: 20000 } }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaultsusertimezone",children:(0,i.jsx)(n.code,{children:"agents.defaults.userTimezone"})}),"\n",(0,i.jsxs)(n.p,{children:["Sets the user\u2019s timezone for ",(0,i.jsx)(n.strong,{children:"system prompt context"})," (not for timestamps in\nmessage envelopes). If unset, Moltbot uses the host timezone at runtime."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { userTimezone: "America/Chicago" } }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaultstimeformat",children:(0,i.jsx)(n.code,{children:"agents.defaults.timeFormat"})}),"\n",(0,i.jsxs)(n.p,{children:["Controls the ",(0,i.jsx)(n.strong,{children:"time format"})," shown in the system prompt\u2019s Current Date & Time section.\nDefault: ",(0,i.jsx)(n.code,{children:"auto"})," (OS preference)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { timeFormat: "auto" } } // auto | 12 | 24\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"messages",children:(0,i.jsx)(n.code,{children:"messages"})}),"\n",(0,i.jsxs)(n.p,{children:["Controls inbound/outbound prefixes and optional ack reactions.\nSee ",(0,i.jsx)(n.a,{href:"/concepts/messages",children:"Messages"})," for queueing, sessions, and streaming context."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  messages: {\n    responsePrefix: "\ud83e\udd9e", // or "auto"\n    ackReaction: "\ud83d\udc40",\n    ackReactionScope: "group-mentions",\n    removeAckAfterReply: false\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"responsePrefix"})," is applied to ",(0,i.jsx)(n.strong,{children:"all outbound replies"})," (tool summaries, block\nstreaming, final replies) across channels unless already present."]}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"messages.responsePrefix"})," is unset, no prefix is applied by default. WhatsApp self-chat\nreplies are the exception: they default to ",(0,i.jsx)(n.code,{children:"[{identity.name}]"})," when set, otherwise\n",(0,i.jsx)(n.code,{children:"[moltbot]"}),", so same-phone conversations stay legible.\nSet it to ",(0,i.jsx)(n.code,{children:'"auto"'})," to derive ",(0,i.jsx)(n.code,{children:"[{identity.name}]"})," for the routed agent (when set)."]}),"\n",(0,i.jsx)(n.h4,{id:"template-variables",children:"Template variables"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"responsePrefix"})," string can include template variables that resolve dynamically:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{model}"})}),(0,i.jsx)(n.td,{children:"Short model name"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"claude-opus-4-5"}),", ",(0,i.jsx)(n.code,{children:"gpt-4o"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{modelFull}"})}),(0,i.jsx)(n.td,{children:"Full model identifier"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"anthropic/claude-opus-4-5"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{provider}"})}),(0,i.jsx)(n.td,{children:"Provider name"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"anthropic"}),", ",(0,i.jsx)(n.code,{children:"openai"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{thinkingLevel}"})}),(0,i.jsx)(n.td,{children:"Current thinking level"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"high"}),", ",(0,i.jsx)(n.code,{children:"low"}),", ",(0,i.jsx)(n.code,{children:"off"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{identity.name}"})}),(0,i.jsx)(n.td,{children:"Agent identity name"}),(0,i.jsxs)(n.td,{children:["(same as ",(0,i.jsx)(n.code,{children:'"auto"'})," mode)"]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Variables are case-insensitive (",(0,i.jsx)(n.code,{children:"{MODEL}"})," = ",(0,i.jsx)(n.code,{children:"{model}"}),"). ",(0,i.jsx)(n.code,{children:"{think}"})," is an alias for ",(0,i.jsx)(n.code,{children:"{thinkingLevel}"}),".\nUnresolved variables remain as literal text."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  messages: {\n    responsePrefix: "[{model} | think:{thinkingLevel}]"\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Example output: ",(0,i.jsx)(n.code,{children:"[claude-opus-4-5 | think:high] Here's my response..."})]}),"\n",(0,i.jsxs)(n.p,{children:["WhatsApp inbound prefix is configured via ",(0,i.jsx)(n.code,{children:"channels.whatsapp.messagePrefix"})," (deprecated:\n",(0,i.jsx)(n.code,{children:"messages.messagePrefix"}),"). Default stays ",(0,i.jsx)(n.strong,{children:"unchanged"}),": ",(0,i.jsx)(n.code,{children:'"[moltbot]"'})," when\n",(0,i.jsx)(n.code,{children:"channels.whatsapp.allowFrom"})," is empty, otherwise ",(0,i.jsx)(n.code,{children:'""'})," (no prefix). When using\n",(0,i.jsx)(n.code,{children:'"[moltbot]"'}),", Moltbot will instead use ",(0,i.jsx)(n.code,{children:"[{identity.name}]"})," when the routed\nagent has ",(0,i.jsx)(n.code,{children:"identity.name"})," set."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ackReaction"})," sends a best-effort emoji reaction to acknowledge inbound messages\non channels that support reactions (Slack/Discord/Telegram/Google Chat). Defaults to the\nactive agent\u2019s ",(0,i.jsx)(n.code,{children:"identity.emoji"})," when set, otherwise ",(0,i.jsx)(n.code,{children:'"\ud83d\udc40"'}),". Set it to ",(0,i.jsx)(n.code,{children:'""'})," to disable."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ackReactionScope"})," controls when reactions fire:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group-mentions"})," (default): only when a group/room requires mentions ",(0,i.jsx)(n.strong,{children:"and"})," the bot was mentioned"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group-all"}),": all group/room messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"direct"}),": direct messages only"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"all"}),": all messages"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"removeAckAfterReply"})," removes the bot\u2019s ack reaction after a reply is sent\n(Slack/Discord/Telegram/Google Chat only). Default: ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"messagestts",children:(0,i.jsx)(n.code,{children:"messages.tts"})}),"\n",(0,i.jsx)(n.p,{children:"Enable text-to-speech for outbound replies. When on, Moltbot generates audio\nusing ElevenLabs or OpenAI and attaches it to responses. Telegram uses Opus\nvoice notes; other channels send MP3 audio."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  messages: {\n    tts: {\n      auto: "always", // off | always | inbound | tagged\n      mode: "final", // final | all (include tool/block replies)\n      provider: "elevenlabs",\n      summaryModel: "openai/gpt-4.1-mini",\n      modelOverrides: {\n        enabled: true\n      },\n      maxTextLength: 4000,\n      timeoutMs: 30000,\n      prefsPath: "~/.clawdbot/settings/tts.json",\n      elevenlabs: {\n        apiKey: "elevenlabs_api_key",\n        baseUrl: "https://api.elevenlabs.io",\n        voiceId: "voice_id",\n        modelId: "eleven_multilingual_v2",\n        seed: 42,\n        applyTextNormalization: "auto",\n        languageCode: "en",\n        voiceSettings: {\n          stability: 0.5,\n          similarityBoost: 0.75,\n          style: 0.0,\n          useSpeakerBoost: true,\n          speed: 1.0\n        }\n      },\n      openai: {\n        apiKey: "openai_api_key",\n        model: "gpt-4o-mini-tts",\n        voice: "alloy"\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"messages.tts.auto"})," controls auto\u2011TTS (",(0,i.jsx)(n.code,{children:"off"}),", ",(0,i.jsx)(n.code,{children:"always"}),", ",(0,i.jsx)(n.code,{children:"inbound"}),", ",(0,i.jsx)(n.code,{children:"tagged"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/tts off|always|inbound|tagged"})," sets the per\u2011session auto mode (overrides config)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"messages.tts.enabled"})," is legacy; doctor migrates it to ",(0,i.jsx)(n.code,{children:"messages.tts.auto"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prefsPath"})," stores local overrides (provider/limit/summarize)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"maxTextLength"})," is a hard cap for TTS input; summaries are truncated to fit."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"summaryModel"})," overrides ",(0,i.jsx)(n.code,{children:"agents.defaults.model.primary"})," for auto-summary.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Accepts ",(0,i.jsx)(n.code,{children:"provider/model"})," or an alias from ",(0,i.jsx)(n.code,{children:"agents.defaults.models"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"modelOverrides"})," enables model-driven overrides like ",(0,i.jsx)(n.code,{children:"[[tts:...]]"})," tags (on by default)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/tts limit"})," and ",(0,i.jsx)(n.code,{children:"/tts summary"})," control per-user summarization settings."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"apiKey"})," values fall back to ",(0,i.jsx)(n.code,{children:"ELEVENLABS_API_KEY"}),"/",(0,i.jsx)(n.code,{children:"XI_API_KEY"})," and ",(0,i.jsx)(n.code,{children:"OPENAI_API_KEY"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"elevenlabs.baseUrl"})," overrides the ElevenLabs API base URL."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"elevenlabs.voiceSettings"})," supports ",(0,i.jsx)(n.code,{children:"stability"}),"/",(0,i.jsx)(n.code,{children:"similarityBoost"}),"/",(0,i.jsx)(n.code,{children:"style"})," (0..1),\n",(0,i.jsx)(n.code,{children:"useSpeakerBoost"}),", and ",(0,i.jsx)(n.code,{children:"speed"})," (0.5..2.0)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"talk",children:(0,i.jsx)(n.code,{children:"talk"})}),"\n",(0,i.jsxs)(n.p,{children:["Defaults for Talk mode (macOS/iOS/Android). Voice IDs fall back to ",(0,i.jsx)(n.code,{children:"ELEVENLABS_VOICE_ID"})," or ",(0,i.jsx)(n.code,{children:"SAG_VOICE_ID"})," when unset.\n",(0,i.jsx)(n.code,{children:"apiKey"})," falls back to ",(0,i.jsx)(n.code,{children:"ELEVENLABS_API_KEY"})," (or the gateway\u2019s shell profile) when unset.\n",(0,i.jsx)(n.code,{children:"voiceAliases"})," lets Talk directives use friendly names (e.g. ",(0,i.jsx)(n.code,{children:'"voice":"Clawd"'}),")."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  talk: {\n    voiceId: "elevenlabs_voice_id",\n    voiceAliases: {\n      Clawd: "EXAVITQu4vr4xnSDxMaL",\n      Roger: "CwhRBWXzGAHq8TQ4Fs17"\n    },\n    modelId: "eleven_v3",\n    outputFormat: "mp3_44100_128",\n    apiKey: "elevenlabs_api_key",\n    interruptOnSpeech: true\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaults",children:(0,i.jsx)(n.code,{children:"agents.defaults"})}),"\n",(0,i.jsxs)(n.p,{children:["Controls the embedded agent runtime (model/thinking/verbose/timeouts).\n",(0,i.jsx)(n.code,{children:"agents.defaults.models"})," defines the configured model catalog (and acts as the allowlist for ",(0,i.jsx)(n.code,{children:"/model"}),").\n",(0,i.jsx)(n.code,{children:"agents.defaults.model.primary"})," sets the default model; ",(0,i.jsx)(n.code,{children:"agents.defaults.model.fallbacks"})," are global failovers.\n",(0,i.jsx)(n.code,{children:"agents.defaults.imageModel"})," is optional and is ",(0,i.jsx)(n.strong,{children:"only used if the primary model lacks image input"}),".\nEach ",(0,i.jsx)(n.code,{children:"agents.defaults.models"})," entry can include:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"alias"})," (optional model shortcut, e.g. ",(0,i.jsx)(n.code,{children:"/opus"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"params"})," (optional provider-specific API params passed through to the model request)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"params"})," is also applied to streaming runs (embedded agent + compaction). Supported keys today: ",(0,i.jsx)(n.code,{children:"temperature"}),", ",(0,i.jsx)(n.code,{children:"maxTokens"}),". These merge with call-time options; caller-supplied values win. ",(0,i.jsx)(n.code,{children:"temperature"})," is an advanced knob\u2014leave unset unless you know the model\u2019s defaults and need a change."]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      models: {\n        "anthropic/claude-sonnet-4-5-20250929": {\n          params: { temperature: 0.6 }\n        },\n        "openai/gpt-5.2": {\n          params: { maxTokens: 8192 }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Z.AI GLM-4.x models automatically enable thinking mode unless you:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["set ",(0,i.jsx)(n.code,{children:"--thinking off"}),", or"]}),"\n",(0,i.jsxs)(n.li,{children:["define ",(0,i.jsx)(n.code,{children:'agents.defaults.models["zai/<model>"].params.thinking'})," yourself."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot also ships a few built-in alias shorthands. Defaults only apply when the model\nis already present in ",(0,i.jsx)(n.code,{children:"agents.defaults.models"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"opus"})," -> ",(0,i.jsx)(n.code,{children:"anthropic/claude-opus-4-5"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sonnet"})," -> ",(0,i.jsx)(n.code,{children:"anthropic/claude-sonnet-4-5"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gpt"})," -> ",(0,i.jsx)(n.code,{children:"openai/gpt-5.2"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gpt-mini"})," -> ",(0,i.jsx)(n.code,{children:"openai/gpt-5-mini"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gemini"})," -> ",(0,i.jsx)(n.code,{children:"google/gemini-3-pro-preview"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gemini-flash"})," -> ",(0,i.jsx)(n.code,{children:"google/gemini-3-flash-preview"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If you configure the same alias name (case-insensitive) yourself, your value wins (defaults never override)."}),"\n",(0,i.jsx)(n.p,{children:"Example: Opus 4.5 primary with MiniMax M2.1 fallback (hosted MiniMax):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      models: {\n        "anthropic/claude-opus-4-5": { alias: "opus" },\n        "minimax/MiniMax-M2.1": { alias: "minimax" }\n      },\n      model: {\n        primary: "anthropic/claude-opus-4-5",\n        fallbacks: ["minimax/MiniMax-M2.1"]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["MiniMax auth: set ",(0,i.jsx)(n.code,{children:"MINIMAX_API_KEY"})," (env) or configure ",(0,i.jsx)(n.code,{children:"models.providers.minimax"}),"."]}),"\n",(0,i.jsxs)(n.h4,{id:"agentsdefaultsclibackends-cli-fallback",children:[(0,i.jsx)(n.code,{children:"agents.defaults.cliBackends"})," (CLI fallback)"]}),"\n",(0,i.jsxs)(n.p,{children:["Optional CLI backends for text-only fallback runs (no tool calls). These are useful as a\nbackup path when API providers fail. Image pass-through is supported when you configure\nan ",(0,i.jsx)(n.code,{children:"imageArg"})," that accepts file paths."]}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["CLI backends are ",(0,i.jsx)(n.strong,{children:"text-first"}),"; tools are always disabled."]}),"\n",(0,i.jsxs)(n.li,{children:["Sessions are supported when ",(0,i.jsx)(n.code,{children:"sessionArg"})," is set; session ids are persisted per backend."]}),"\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.code,{children:"claude-cli"}),", defaults are wired in. Override the command path if PATH is minimal\n(launchd/systemd)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      cliBackends: {\n        "claude-cli": {\n          command: "/opt/homebrew/bin/claude"\n        },\n        "my-cli": {\n          command: "my-cli",\n          args: ["--json"],\n          output: "json",\n          modelArg: "--model",\n          sessionArg: "--session",\n          sessionMode: "existing",\n          systemPromptArg: "--system",\n          systemPromptWhen: "first",\n          imageArg: "--image",\n          imageMode: "repeat"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      models: {\n        "anthropic/claude-opus-4-5": { alias: "Opus" },\n        "anthropic/claude-sonnet-4-1": { alias: "Sonnet" },\n        "openrouter/deepseek/deepseek-r1:free": {},\n        "zai/glm-4.7": {\n          alias: "GLM",\n          params: {\n            thinking: {\n              type: "enabled",\n              clear_thinking: false\n            }\n          }\n        }\n      },\n      model: {\n        primary: "anthropic/claude-opus-4-5",\n        fallbacks: [\n          "openrouter/deepseek/deepseek-r1:free",\n          "openrouter/meta-llama/llama-3.3-70b-instruct:free"\n        ]\n      },\n      imageModel: {\n        primary: "openrouter/qwen/qwen-2.5-vl-72b-instruct:free",\n        fallbacks: [\n          "openrouter/google/gemini-2.0-flash-vision:free"\n        ]\n      },\n      thinkingDefault: "low",\n      verboseDefault: "off",\n      elevatedDefault: "on",\n      timeoutSeconds: 600,\n      mediaMaxMb: 5,\n      heartbeat: {\n        every: "30m",\n        target: "last"\n      },\n      maxConcurrent: 3,\n      subagents: {\n        model: "minimax/MiniMax-M2.1",\n        maxConcurrent: 1,\n        archiveAfterMinutes: 60\n      },\n      exec: {\n        backgroundMs: 10000,\n        timeoutSec: 1800,\n        cleanupMs: 1800000\n      },\n      contextTokens: 200000\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h4,{id:"agentsdefaultscontextpruning-tool-result-pruning",children:[(0,i.jsx)(n.code,{children:"agents.defaults.contextPruning"})," (tool-result pruning)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.contextPruning"})," prunes ",(0,i.jsx)(n.strong,{children:"old tool results"})," from the in-memory context right before a request is sent to the LLM.\nIt does ",(0,i.jsx)(n.strong,{children:"not"})," modify the session history on disk (",(0,i.jsx)(n.code,{children:"*.jsonl"})," remains complete)."]}),"\n",(0,i.jsx)(n.p,{children:"This is intended to reduce token usage for chatty agents that accumulate large tool outputs over time."}),"\n",(0,i.jsx)(n.p,{children:"High level:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Never touches user/assistant messages."}),"\n",(0,i.jsxs)(n.li,{children:["Protects the last ",(0,i.jsx)(n.code,{children:"keepLastAssistants"})," assistant messages (no tool results after that point are pruned)."]}),"\n",(0,i.jsx)(n.li,{children:"Protects the bootstrap prefix (nothing before the first user message is pruned)."}),"\n",(0,i.jsxs)(n.li,{children:["Modes:\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"adaptive"}),": soft-trims oversized tool results (keep head/tail) when the estimated context ratio crosses ",(0,i.jsx)(n.code,{children:"softTrimRatio"}),".\nThen hard-clears the oldest eligible tool results when the estimated context ratio crosses ",(0,i.jsx)(n.code,{children:"hardClearRatio"})," ",(0,i.jsx)(n.strong,{children:"and"}),"\nthere\u2019s enough prunable tool-result bulk (",(0,i.jsx)(n.code,{children:"minPrunableToolChars"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"aggressive"}),": always replaces eligible tool results before the cutoff with the ",(0,i.jsx)(n.code,{children:"hardClear.placeholder"})," (no ratio checks)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Soft vs hard pruning (what changes in the context sent to the LLM):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Soft-trim"}),": only for ",(0,i.jsx)(n.em,{children:"oversized"})," tool results. Keeps the beginning + end and inserts ",(0,i.jsx)(n.code,{children:"..."})," in the middle.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Before: ",(0,i.jsx)(n.code,{children:'toolResult("\u2026very long output\u2026")'})]}),"\n",(0,i.jsxs)(n.li,{children:["After: ",(0,i.jsx)(n.code,{children:'toolResult("HEAD\u2026\\n...\\n\u2026TAIL\\n\\n[Tool result trimmed: \u2026]")'})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Hard-clear"}),": replaces the entire tool result with the placeholder.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Before: ",(0,i.jsx)(n.code,{children:'toolResult("\u2026very long output\u2026")'})]}),"\n",(0,i.jsxs)(n.li,{children:["After: ",(0,i.jsx)(n.code,{children:'toolResult("[Old tool result content cleared]")'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Notes / current limitations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Tool results containing ",(0,i.jsx)(n.strong,{children:"image blocks are skipped"})," (never trimmed/cleared) right now."]}),"\n",(0,i.jsxs)(n.li,{children:["The estimated \u201ccontext ratio\u201d is based on ",(0,i.jsx)(n.strong,{children:"characters"})," (approximate), not exact tokens."]}),"\n",(0,i.jsxs)(n.li,{children:["If the session doesn\u2019t contain at least ",(0,i.jsx)(n.code,{children:"keepLastAssistants"})," assistant messages yet, pruning is skipped."]}),"\n",(0,i.jsxs)(n.li,{children:["In ",(0,i.jsx)(n.code,{children:"aggressive"})," mode, ",(0,i.jsx)(n.code,{children:"hardClear.enabled"})," is ignored (eligible tool results are always replaced with ",(0,i.jsx)(n.code,{children:"hardClear.placeholder"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Default (adaptive):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { contextPruning: { mode: "adaptive" } } }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"To disable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { contextPruning: { mode: "off" } } }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Defaults (when ",(0,i.jsx)(n.code,{children:"mode"})," is ",(0,i.jsx)(n.code,{children:'"adaptive"'})," or ",(0,i.jsx)(n.code,{children:'"aggressive"'}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"keepLastAssistants"}),": ",(0,i.jsx)(n.code,{children:"3"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"softTrimRatio"}),": ",(0,i.jsx)(n.code,{children:"0.3"})," (adaptive only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hardClearRatio"}),": ",(0,i.jsx)(n.code,{children:"0.5"})," (adaptive only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"minPrunableToolChars"}),": ",(0,i.jsx)(n.code,{children:"50000"})," (adaptive only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"softTrim"}),": ",(0,i.jsx)(n.code,{children:"{ maxChars: 4000, headChars: 1500, tailChars: 1500 }"})," (adaptive only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hardClear"}),": ",(0,i.jsx)(n.code,{children:'{ enabled: true, placeholder: "[Old tool result content cleared]" }'})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example (aggressive, minimal):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { contextPruning: { mode: "aggressive" } } }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Example (adaptive tuned):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      contextPruning: {\n        mode: "adaptive",\n        keepLastAssistants: 3,\n        softTrimRatio: 0.3,\n        hardClearRatio: 0.5,\n        minPrunableToolChars: 50000,\n        softTrim: { maxChars: 4000, headChars: 1500, tailChars: 1500 },\n        hardClear: { enabled: true, placeholder: "[Old tool result content cleared]" },\n        // Optional: restrict pruning to specific tools (deny wins; supports "*" wildcards)\n        tools: { deny: ["browser", "canvas"] },\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/concepts/session-pruning",children:"/concepts/session-pruning"})," for behavior details."]}),"\n",(0,i.jsxs)(n.h4,{id:"agentsdefaultscompaction-reserve-headroom--memory-flush",children:[(0,i.jsx)(n.code,{children:"agents.defaults.compaction"})," (reserve headroom + memory flush)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.compaction.mode"})," selects the compaction summarization strategy. Defaults to ",(0,i.jsx)(n.code,{children:"default"}),"; set ",(0,i.jsx)(n.code,{children:"safeguard"})," to enable chunked summarization for very long histories. See ",(0,i.jsx)(n.a,{href:"/concepts/compaction",children:"/concepts/compaction"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.compaction.reserveTokensFloor"})," enforces a minimum ",(0,i.jsx)(n.code,{children:"reserveTokens"}),"\nvalue for Pi compaction (default: ",(0,i.jsx)(n.code,{children:"20000"}),"). Set it to ",(0,i.jsx)(n.code,{children:"0"})," to disable the floor."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.compaction.memoryFlush"})," runs a ",(0,i.jsx)(n.strong,{children:"silent"})," agentic turn before\nauto-compaction, instructing the model to store durable memories on disk (e.g.\n",(0,i.jsx)(n.code,{children:"memory/YYYY-MM-DD.md"}),"). It triggers when the session token estimate crosses a\nsoft threshold below the compaction limit."]}),"\n",(0,i.jsx)(n.p,{children:"Legacy defaults:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"memoryFlush.enabled"}),": ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"memoryFlush.softThresholdTokens"}),": ",(0,i.jsx)(n.code,{children:"4000"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"memoryFlush.prompt"})," / ",(0,i.jsx)(n.code,{children:"memoryFlush.systemPrompt"}),": built-in defaults with ",(0,i.jsx)(n.code,{children:"NO_REPLY"})]}),"\n",(0,i.jsxs)(n.li,{children:["Note: memory flush is skipped when the session workspace is read-only\n(",(0,i.jsx)(n.code,{children:'agents.defaults.sandbox.workspaceAccess: "ro"'})," or ",(0,i.jsx)(n.code,{children:'"none"'}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example (tuned):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      compaction: {\n        mode: "safeguard",\n        reserveTokensFloor: 24000,\n        memoryFlush: {\n          enabled: true,\n          softThresholdTokens: 6000,\n          systemPrompt: "Session nearing compaction. Store durable memories now.",\n          prompt: "Write any lasting notes to memory/YYYY-MM-DD.md; reply with NO_REPLY if nothing to store."\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Block streaming:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.blockStreamingDefault"}),": ",(0,i.jsx)(n.code,{children:'"on"'}),"/",(0,i.jsx)(n.code,{children:'"off"'})," (default off)."]}),"\n",(0,i.jsxs)(n.li,{children:["Channel overrides: ",(0,i.jsx)(n.code,{children:"*.blockStreaming"})," (and per-account variants) to force block streaming on/off.\nNon-Telegram channels require an explicit ",(0,i.jsx)(n.code,{children:"*.blockStreaming: true"})," to enable block replies."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.blockStreamingBreak"}),": ",(0,i.jsx)(n.code,{children:'"text_end"'})," or ",(0,i.jsx)(n.code,{children:'"message_end"'})," (default: text_end)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.blockStreamingChunk"}),": soft chunking for streamed blocks. Defaults to\n800\u20131200 chars, prefers paragraph breaks (",(0,i.jsx)(n.code,{children:"\\n\\n"}),"), then newlines, then sentences.\nExample:\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  agents: { defaults: { blockStreamingChunk: { minChars: 800, maxChars: 1200 } } }\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.blockStreamingCoalesce"}),": merge streamed blocks before sending.\nDefaults to ",(0,i.jsx)(n.code,{children:"{ idleMs: 1000 }"})," and inherits ",(0,i.jsx)(n.code,{children:"minChars"})," from ",(0,i.jsx)(n.code,{children:"blockStreamingChunk"}),"\nwith ",(0,i.jsx)(n.code,{children:"maxChars"})," capped to the channel text limit. Signal/Slack/Discord/Google Chat default\nto ",(0,i.jsx)(n.code,{children:"minChars: 1500"})," unless overridden.\nChannel overrides: ",(0,i.jsx)(n.code,{children:"channels.whatsapp.blockStreamingCoalesce"}),", ",(0,i.jsx)(n.code,{children:"channels.telegram.blockStreamingCoalesce"}),",\n",(0,i.jsx)(n.code,{children:"channels.discord.blockStreamingCoalesce"}),", ",(0,i.jsx)(n.code,{children:"channels.slack.blockStreamingCoalesce"}),", ",(0,i.jsx)(n.code,{children:"channels.mattermost.blockStreamingCoalesce"}),",\n",(0,i.jsx)(n.code,{children:"channels.signal.blockStreamingCoalesce"}),", ",(0,i.jsx)(n.code,{children:"channels.imessage.blockStreamingCoalesce"}),", ",(0,i.jsx)(n.code,{children:"channels.msteams.blockStreamingCoalesce"}),",\n",(0,i.jsx)(n.code,{children:"channels.googlechat.blockStreamingCoalesce"}),"\n(and per-account variants)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.humanDelay"}),": randomized pause between ",(0,i.jsx)(n.strong,{children:"block replies"})," after the first.\nModes: ",(0,i.jsx)(n.code,{children:"off"})," (default), ",(0,i.jsx)(n.code,{children:"natural"})," (800\u20132500ms), ",(0,i.jsx)(n.code,{children:"custom"})," (use ",(0,i.jsx)(n.code,{children:"minMs"}),"/",(0,i.jsx)(n.code,{children:"maxMs"}),").\nPer-agent override: ",(0,i.jsx)(n.code,{children:"agents.list[].humanDelay"}),".\nExample:\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { humanDelay: { mode: "natural" } } }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/concepts/streaming",children:"/concepts/streaming"})," for behavior + chunking details."]}),"\n",(0,i.jsx)(n.p,{children:"Typing indicators:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.typingMode"}),": ",(0,i.jsx)(n.code,{children:'"never" | "instant" | "thinking" | "message"'}),". Defaults to\n",(0,i.jsx)(n.code,{children:"instant"})," for direct chats / mentions and ",(0,i.jsx)(n.code,{children:"message"})," for unmentioned group chats."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"session.typingMode"}),": per-session override for the mode."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.typingIntervalSeconds"}),": how often the typing signal is refreshed (default: 6s)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"session.typingIntervalSeconds"}),": per-session override for the refresh interval.\nSee ",(0,i.jsx)(n.a,{href:"/concepts/typing-indicators",children:"/concepts/typing-indicators"})," for behavior details."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.model.primary"})," should be set as ",(0,i.jsx)(n.code,{children:"provider/model"})," (e.g. ",(0,i.jsx)(n.code,{children:"anthropic/claude-opus-4-5"}),").\nAliases come from ",(0,i.jsx)(n.code,{children:"agents.defaults.models.*.alias"})," (e.g. ",(0,i.jsx)(n.code,{children:"Opus"}),").\nIf you omit the provider, Moltbot currently assumes ",(0,i.jsx)(n.code,{children:"anthropic"})," as a temporary\ndeprecation fallback.\nZ.AI models are available as ",(0,i.jsx)(n.code,{children:"zai/<model>"})," (e.g. ",(0,i.jsx)(n.code,{children:"zai/glm-4.7"}),") and require\n",(0,i.jsx)(n.code,{children:"ZAI_API_KEY"})," (or legacy ",(0,i.jsx)(n.code,{children:"Z_AI_API_KEY"}),") in the environment."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.heartbeat"})," configures periodic heartbeat runs:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"every"}),": duration string (",(0,i.jsx)(n.code,{children:"ms"}),", ",(0,i.jsx)(n.code,{children:"s"}),", ",(0,i.jsx)(n.code,{children:"m"}),", ",(0,i.jsx)(n.code,{children:"h"}),"); default unit minutes. Default:\n",(0,i.jsx)(n.code,{children:"30m"}),". Set ",(0,i.jsx)(n.code,{children:"0m"})," to disable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"model"}),": optional override model for heartbeat runs (",(0,i.jsx)(n.code,{children:"provider/model"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"includeReasoning"}),": when ",(0,i.jsx)(n.code,{children:"true"}),", heartbeats will also deliver the separate ",(0,i.jsx)(n.code,{children:"Reasoning:"})," message when available (same shape as ",(0,i.jsx)(n.code,{children:"/reasoning on"}),"). Default: ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"session"}),": optional session key to control which session the heartbeat runs in. Default: ",(0,i.jsx)(n.code,{children:"main"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"to"}),": optional recipient override (channel-specific id, e.g. E.164 for WhatsApp, chat id for Telegram)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"target"}),": optional delivery channel (",(0,i.jsx)(n.code,{children:"last"}),", ",(0,i.jsx)(n.code,{children:"whatsapp"}),", ",(0,i.jsx)(n.code,{children:"telegram"}),", ",(0,i.jsx)(n.code,{children:"discord"}),", ",(0,i.jsx)(n.code,{children:"slack"}),", ",(0,i.jsx)(n.code,{children:"msteams"}),", ",(0,i.jsx)(n.code,{children:"signal"}),", ",(0,i.jsx)(n.code,{children:"imessage"}),", ",(0,i.jsx)(n.code,{children:"none"}),"). Default: ",(0,i.jsx)(n.code,{children:"last"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prompt"}),": optional override for the heartbeat body (default: ",(0,i.jsx)(n.code,{children:"Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK."}),"). Overrides are sent verbatim; include a ",(0,i.jsx)(n.code,{children:"Read HEARTBEAT.md"})," line if you still want the file read."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ackMaxChars"}),": max chars allowed after ",(0,i.jsx)(n.code,{children:"HEARTBEAT_OK"})," before delivery (default: 300)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Per-agent heartbeats:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"agents.list[].heartbeat"})," to enable or override heartbeat settings for a specific agent."]}),"\n",(0,i.jsxs)(n.li,{children:["If any agent entry defines ",(0,i.jsx)(n.code,{children:"heartbeat"}),", ",(0,i.jsx)(n.strong,{children:"only those agents"})," run heartbeats; defaults\nbecome the shared baseline for those agents."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Heartbeats run full agent turns. Shorter intervals burn more tokens; be mindful\nof ",(0,i.jsx)(n.code,{children:"every"}),", keep ",(0,i.jsx)(n.code,{children:"HEARTBEAT.md"})," tiny, and/or choose a cheaper ",(0,i.jsx)(n.code,{children:"model"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tools.exec"})," configures background exec defaults:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"backgroundMs"}),": time before auto-background (ms, default 10000)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timeoutSec"}),": auto-kill after this runtime (seconds, default 1800)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cleanupMs"}),": how long to keep finished sessions in memory (ms, default 1800000)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"notifyOnExit"}),": enqueue a system event + request heartbeat when backgrounded exec exits (default true)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"applyPatch.enabled"}),": enable experimental ",(0,i.jsx)(n.code,{children:"apply_patch"})," (OpenAI/OpenAI Codex only; default false)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"applyPatch.allowModels"}),": optional allowlist of model ids (e.g. ",(0,i.jsx)(n.code,{children:"gpt-5.2"})," or ",(0,i.jsx)(n.code,{children:"openai/gpt-5.2"}),")\nNote: ",(0,i.jsx)(n.code,{children:"applyPatch"})," is only under ",(0,i.jsx)(n.code,{children:"tools.exec"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tools.web"})," configures web search + fetch tools:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.search.enabled"})," (default: true when key is present)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.search.apiKey"})," (recommended: set via ",(0,i.jsx)(n.code,{children:"moltbot configure --section web"}),", or use ",(0,i.jsx)(n.code,{children:"BRAVE_API_KEY"})," env var)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.search.maxResults"})," (1\u201310, default 5)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.search.timeoutSeconds"})," (default 30)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.search.cacheTtlMinutes"})," (default 15)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.enabled"})," (default true)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.maxChars"})," (default 50000)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.timeoutSeconds"})," (default 30)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.cacheTtlMinutes"})," (default 15)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.userAgent"})," (optional override)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.readability"})," (default true; disable to use basic HTML cleanup only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.firecrawl.enabled"})," (default true when an API key is set)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.firecrawl.apiKey"})," (optional; defaults to ",(0,i.jsx)(n.code,{children:"FIRECRAWL_API_KEY"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.firecrawl.baseUrl"})," (default ",(0,i.jsx)(n.a,{href:"https://api.firecrawl.dev",children:"https://api.firecrawl.dev"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.firecrawl.onlyMainContent"})," (default true)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.firecrawl.maxAgeMs"})," (optional)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.web.fetch.firecrawl.timeoutSeconds"})," (optional)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tools.media"})," configures inbound media understanding (image/audio/video):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.media.models"}),": shared model list (capability-tagged; used after per-cap lists)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.media.concurrency"}),": max concurrent capability runs (default 2)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.media.image"})," / ",(0,i.jsx)(n.code,{children:"tools.media.audio"})," / ",(0,i.jsx)(n.code,{children:"tools.media.video"}),":\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enabled"}),": opt-out switch (default true when models are configured)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prompt"}),": optional prompt override (image/video append a ",(0,i.jsx)(n.code,{children:"maxChars"})," hint automatically)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"maxChars"}),": max output characters (default 500 for image/video; unset for audio)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"maxBytes"}),": max media size to send (defaults: image 10MB, audio 20MB, video 50MB)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timeoutSeconds"}),": request timeout (defaults: image 60s, audio 60s, video 120s)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"language"}),": optional audio hint."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"attachments"}),": attachment policy (",(0,i.jsx)(n.code,{children:"mode"}),", ",(0,i.jsx)(n.code,{children:"maxAttachments"}),", ",(0,i.jsx)(n.code,{children:"prefer"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scope"}),": optional gating (first match wins) with ",(0,i.jsx)(n.code,{children:"match.channel"}),", ",(0,i.jsx)(n.code,{children:"match.chatType"}),", or ",(0,i.jsx)(n.code,{children:"match.keyPrefix"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"models"}),": ordered list of model entries; failures or oversize media fall back to the next entry."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Each ",(0,i.jsx)(n.code,{children:"models[]"})," entry:\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Provider entry (",(0,i.jsx)(n.code,{children:'type: "provider"'})," or omitted):\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"provider"}),": API provider id (",(0,i.jsx)(n.code,{children:"openai"}),", ",(0,i.jsx)(n.code,{children:"anthropic"}),", ",(0,i.jsx)(n.code,{children:"google"}),"/",(0,i.jsx)(n.code,{children:"gemini"}),", ",(0,i.jsx)(n.code,{children:"groq"}),", etc)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"model"}),": model id override (required for image; defaults to ",(0,i.jsx)(n.code,{children:"gpt-4o-mini-transcribe"}),"/",(0,i.jsx)(n.code,{children:"whisper-large-v3-turbo"})," for audio providers, and ",(0,i.jsx)(n.code,{children:"gemini-3-flash-preview"})," for video)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"profile"})," / ",(0,i.jsx)(n.code,{children:"preferredProfile"}),": auth profile selection."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["CLI entry (",(0,i.jsx)(n.code,{children:'type: "cli"'}),"):\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"command"}),": executable to run."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"args"}),": templated args (supports ",(0,i.jsx)(n.code,{children:"{{MediaPath}}"}),", ",(0,i.jsx)(n.code,{children:"{{Prompt}}"}),", ",(0,i.jsx)(n.code,{children:"{{MaxChars}}"}),", etc)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"capabilities"}),": optional list (",(0,i.jsx)(n.code,{children:"image"}),", ",(0,i.jsx)(n.code,{children:"audio"}),", ",(0,i.jsx)(n.code,{children:"video"}),") to gate a shared entry. Defaults when omitted: ",(0,i.jsx)(n.code,{children:"openai"}),"/",(0,i.jsx)(n.code,{children:"anthropic"}),"/",(0,i.jsx)(n.code,{children:"minimax"})," \u2192 image, ",(0,i.jsx)(n.code,{children:"google"})," \u2192 image+audio+video, ",(0,i.jsx)(n.code,{children:"groq"})," \u2192 audio."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prompt"}),", ",(0,i.jsx)(n.code,{children:"maxChars"}),", ",(0,i.jsx)(n.code,{children:"maxBytes"}),", ",(0,i.jsx)(n.code,{children:"timeoutSeconds"}),", ",(0,i.jsx)(n.code,{children:"language"})," can be overridden per entry."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If no models are configured (or ",(0,i.jsx)(n.code,{children:"enabled: false"}),"), understanding is skipped; the model still receives the original attachments."]}),"\n",(0,i.jsxs)(n.p,{children:["Provider auth follows the standard model auth order (auth profiles, env vars like ",(0,i.jsx)(n.code,{children:"OPENAI_API_KEY"}),"/",(0,i.jsx)(n.code,{children:"GROQ_API_KEY"}),"/",(0,i.jsx)(n.code,{children:"GEMINI_API_KEY"}),", or ",(0,i.jsx)(n.code,{children:"models.providers.*.apiKey"}),")."]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: {\n    media: {\n      audio: {\n        enabled: true,\n        maxBytes: 20971520,\n        scope: {\n          default: "deny",\n          rules: [{ action: "allow", match: { chatType: "direct" } }]\n        },\n        models: [\n          { provider: "openai", model: "gpt-4o-mini-transcribe" },\n          { type: "cli", command: "whisper", args: ["--model", "base", "{{MediaPath}}"] }\n        ]\n      },\n      video: {\n        enabled: true,\n        maxBytes: 52428800,\n        models: [{ provider: "google", model: "gemini-3-flash-preview" }]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.subagents"})," configures sub-agent defaults:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"model"}),": default model for spawned sub-agents (string or ",(0,i.jsx)(n.code,{children:"{ primary, fallbacks }"}),"). If omitted, sub-agents inherit the caller\u2019s model unless overridden per agent or per call."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"maxConcurrent"}),": max concurrent sub-agent runs (default 1)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"archiveAfterMinutes"}),": auto-archive sub-agent sessions after N minutes (default 60; set ",(0,i.jsx)(n.code,{children:"0"})," to disable)"]}),"\n",(0,i.jsxs)(n.li,{children:["Per-subagent tool policy: ",(0,i.jsx)(n.code,{children:"tools.subagents.tools.allow"})," / ",(0,i.jsx)(n.code,{children:"tools.subagents.tools.deny"})," (deny wins)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tools.profile"})," sets a ",(0,i.jsx)(n.strong,{children:"base tool allowlist"})," before ",(0,i.jsx)(n.code,{children:"tools.allow"}),"/",(0,i.jsx)(n.code,{children:"tools.deny"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"minimal"}),": ",(0,i.jsx)(n.code,{children:"session_status"})," only"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"coding"}),": ",(0,i.jsx)(n.code,{children:"group:fs"}),", ",(0,i.jsx)(n.code,{children:"group:runtime"}),", ",(0,i.jsx)(n.code,{children:"group:sessions"}),", ",(0,i.jsx)(n.code,{children:"group:memory"}),", ",(0,i.jsx)(n.code,{children:"image"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"messaging"}),": ",(0,i.jsx)(n.code,{children:"group:messaging"}),", ",(0,i.jsx)(n.code,{children:"sessions_list"}),", ",(0,i.jsx)(n.code,{children:"sessions_history"}),", ",(0,i.jsx)(n.code,{children:"sessions_send"}),", ",(0,i.jsx)(n.code,{children:"session_status"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"full"}),": no restriction (same as unset)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Per-agent override: ",(0,i.jsx)(n.code,{children:"agents.list[].tools.profile"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Example (messaging-only by default, allow Slack + Discord tools too):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: {\n    profile: "messaging",\n    allow: ["slack", "discord"]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Example (coding profile, but deny exec/process everywhere):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: {\n    profile: "coding",\n    deny: ["group:runtime"]\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tools.byProvider"})," lets you ",(0,i.jsx)(n.strong,{children:"further restrict"})," tools for specific providers (or a single ",(0,i.jsx)(n.code,{children:"provider/model"}),").\nPer-agent override: ",(0,i.jsx)(n.code,{children:"agents.list[].tools.byProvider"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Order: base profile \u2192 provider profile \u2192 allow/deny policies.\nProvider keys accept either ",(0,i.jsx)(n.code,{children:"provider"})," (e.g. ",(0,i.jsx)(n.code,{children:"google-antigravity"}),") or ",(0,i.jsx)(n.code,{children:"provider/model"}),"\n(e.g. ",(0,i.jsx)(n.code,{children:"openai/gpt-5.2"}),")."]}),"\n",(0,i.jsx)(n.p,{children:"Example (keep global coding profile, but minimal tools for Google Antigravity):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: {\n    profile: "coding",\n    byProvider: {\n      "google-antigravity": { profile: "minimal" }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Example (provider/model-specific allowlist):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: {\n    allow: ["group:fs", "group:runtime", "sessions_list"],\n    byProvider: {\n      "openai/gpt-5.2": { allow: ["group:fs", "sessions_list"] }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tools.allow"})," / ",(0,i.jsx)(n.code,{children:"tools.deny"})," configure a global tool allow/deny policy (deny wins).\nMatching is case-insensitive and supports ",(0,i.jsx)(n.code,{children:"*"})," wildcards (",(0,i.jsx)(n.code,{children:'"*"'})," means all tools).\nThis is applied even when the Docker sandbox is ",(0,i.jsx)(n.strong,{children:"off"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Example (disable browser/canvas everywhere):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: { deny: ["browser", "canvas"] }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Tool groups (shorthands) work in ",(0,i.jsx)(n.strong,{children:"global"})," and ",(0,i.jsx)(n.strong,{children:"per-agent"})," tool policies:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:runtime"}),": ",(0,i.jsx)(n.code,{children:"exec"}),", ",(0,i.jsx)(n.code,{children:"bash"}),", ",(0,i.jsx)(n.code,{children:"process"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:fs"}),": ",(0,i.jsx)(n.code,{children:"read"}),", ",(0,i.jsx)(n.code,{children:"write"}),", ",(0,i.jsx)(n.code,{children:"edit"}),", ",(0,i.jsx)(n.code,{children:"apply_patch"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:sessions"}),": ",(0,i.jsx)(n.code,{children:"sessions_list"}),", ",(0,i.jsx)(n.code,{children:"sessions_history"}),", ",(0,i.jsx)(n.code,{children:"sessions_send"}),", ",(0,i.jsx)(n.code,{children:"sessions_spawn"}),", ",(0,i.jsx)(n.code,{children:"session_status"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:memory"}),": ",(0,i.jsx)(n.code,{children:"memory_search"}),", ",(0,i.jsx)(n.code,{children:"memory_get"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:web"}),": ",(0,i.jsx)(n.code,{children:"web_search"}),", ",(0,i.jsx)(n.code,{children:"web_fetch"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:ui"}),": ",(0,i.jsx)(n.code,{children:"browser"}),", ",(0,i.jsx)(n.code,{children:"canvas"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:automation"}),": ",(0,i.jsx)(n.code,{children:"cron"}),", ",(0,i.jsx)(n.code,{children:"gateway"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:messaging"}),": ",(0,i.jsx)(n.code,{children:"message"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:nodes"}),": ",(0,i.jsx)(n.code,{children:"nodes"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"group:moltbot"}),": all built-in Moltbot tools (excludes provider plugins)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"tools.elevated"})," controls elevated (host) exec access:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enabled"}),": allow elevated mode (default true)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowFrom"}),": per-channel allowlists (empty = disabled)\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"whatsapp"}),": E.164 numbers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"telegram"}),": chat ids or usernames"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"discord"}),": user ids or usernames (falls back to ",(0,i.jsx)(n.code,{children:"channels.discord.dm.allowFrom"})," if omitted)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"signal"}),": E.164 numbers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"imessage"}),": handles/chat ids"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"webchat"}),": session ids or usernames"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  tools: {\n    elevated: {\n      enabled: true,\n      allowFrom: {\n        whatsapp: ["+15555550123"],\n        discord: ["steipete", "1234567890123"]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Per-agent override (further restrict):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    list: [\n      {\n        id: "family",\n        tools: {\n          elevated: { enabled: false }\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tools.elevated"})," is the global baseline. ",(0,i.jsx)(n.code,{children:"agents.list[].tools.elevated"})," can only further restrict (both must allow)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/elevated on|off|ask|full"})," stores state per session key; inline directives apply to a single message."]}),"\n",(0,i.jsxs)(n.li,{children:["Elevated ",(0,i.jsx)(n.code,{children:"exec"})," runs on the host and bypasses sandboxing."]}),"\n",(0,i.jsxs)(n.li,{children:["Tool policy still applies; if ",(0,i.jsx)(n.code,{children:"exec"})," is denied, elevated cannot be used."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.maxConcurrent"})," sets the maximum number of embedded agent runs that can\nexecute in parallel across sessions. Each session is still serialized (one run\nper session key at a time). Default: 1."]}),"\n",(0,i.jsx)(n.h3,{id:"agentsdefaultssandbox",children:(0,i.jsx)(n.code,{children:"agents.defaults.sandbox"})}),"\n",(0,i.jsxs)(n.p,{children:["Optional ",(0,i.jsx)(n.strong,{children:"Docker sandboxing"})," for the embedded agent. Intended for non-main\nsessions so they cannot access your host system."]}),"\n",(0,i.jsxs)(n.p,{children:["Details: ",(0,i.jsx)(n.a,{href:"/gateway/sandboxing",children:"Sandboxing"})]}),"\n",(0,i.jsx)(n.p,{children:"Defaults (if enabled):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["scope: ",(0,i.jsx)(n.code,{children:'"agent"'})," (one container + workspace per agent)"]}),"\n",(0,i.jsx)(n.li,{children:"Debian bookworm-slim based image"}),"\n",(0,i.jsxs)(n.li,{children:["agent workspace access: ",(0,i.jsx)(n.code,{children:'workspaceAccess: "none"'})," (default)\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"none"'}),": use a per-scope sandbox workspace under ",(0,i.jsx)(n.code,{children:"~/.clawdbot/sandboxes"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"ro"'}),": keep the sandbox workspace at ",(0,i.jsx)(n.code,{children:"/workspace"}),", and mount the agent workspace read-only at ",(0,i.jsx)(n.code,{children:"/agent"})," (disables ",(0,i.jsx)(n.code,{children:"write"}),"/",(0,i.jsx)(n.code,{children:"edit"}),"/",(0,i.jsx)(n.code,{children:"apply_patch"}),")\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'"rw"'}),": mount the agent workspace read/write at ",(0,i.jsx)(n.code,{children:"/workspace"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"auto-prune: idle > 24h OR age > 7d"}),"\n",(0,i.jsxs)(n.li,{children:["tool policy: allow only ",(0,i.jsx)(n.code,{children:"exec"}),", ",(0,i.jsx)(n.code,{children:"process"}),", ",(0,i.jsx)(n.code,{children:"read"}),", ",(0,i.jsx)(n.code,{children:"write"}),", ",(0,i.jsx)(n.code,{children:"edit"}),", ",(0,i.jsx)(n.code,{children:"apply_patch"}),", ",(0,i.jsx)(n.code,{children:"sessions_list"}),", ",(0,i.jsx)(n.code,{children:"sessions_history"}),", ",(0,i.jsx)(n.code,{children:"sessions_send"}),", ",(0,i.jsx)(n.code,{children:"sessions_spawn"}),", ",(0,i.jsx)(n.code,{children:"session_status"})," (deny wins)\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["configure via ",(0,i.jsx)(n.code,{children:"tools.sandbox.tools"}),", override per-agent via ",(0,i.jsx)(n.code,{children:"agents.list[].tools.sandbox.tools"})]}),"\n",(0,i.jsxs)(n.li,{children:["tool group shorthands supported in sandbox policy: ",(0,i.jsx)(n.code,{children:"group:runtime"}),", ",(0,i.jsx)(n.code,{children:"group:fs"}),", ",(0,i.jsx)(n.code,{children:"group:sessions"}),", ",(0,i.jsx)(n.code,{children:"group:memory"})," (see ",(0,i.jsx)(n.a,{href:"/gateway/sandbox-vs-tool-policy-vs-elevated#tool-groups-shorthands",children:"Sandbox vs Tool Policy vs Elevated"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"optional sandboxed browser (Chromium + CDP, noVNC observer)"}),"\n",(0,i.jsxs)(n.li,{children:["hardening knobs: ",(0,i.jsx)(n.code,{children:"network"}),", ",(0,i.jsx)(n.code,{children:"user"}),", ",(0,i.jsx)(n.code,{children:"pidsLimit"}),", ",(0,i.jsx)(n.code,{children:"memory"}),", ",(0,i.jsx)(n.code,{children:"cpus"}),", ",(0,i.jsx)(n.code,{children:"ulimits"}),", ",(0,i.jsx)(n.code,{children:"seccompProfile"}),", ",(0,i.jsx)(n.code,{children:"apparmorProfile"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Warning: ",(0,i.jsx)(n.code,{children:'scope: "shared"'})," means a shared container and shared workspace. No\ncross-session isolation. Use ",(0,i.jsx)(n.code,{children:'scope: "session"'})," for per-session isolation."]}),"\n",(0,i.jsxs)(n.p,{children:["Legacy: ",(0,i.jsx)(n.code,{children:"perSession"})," is still supported (",(0,i.jsx)(n.code,{children:"true"})," \u2192 ",(0,i.jsx)(n.code,{children:'scope: "session"'}),",\n",(0,i.jsx)(n.code,{children:"false"})," \u2192 ",(0,i.jsx)(n.code,{children:'scope: "shared"'}),")."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"setupCommand"})," runs ",(0,i.jsx)(n.strong,{children:"once"})," after the container is created (inside the container via ",(0,i.jsx)(n.code,{children:"sh -lc"}),").\nFor package installs, ensure network egress, a writable root FS, and a root user."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      sandbox: {\n        mode: "non-main", // off | non-main | all\n        scope: "agent", // session | agent | shared (agent is default)\n        workspaceAccess: "none", // none | ro | rw\n        workspaceRoot: "~/.clawdbot/sandboxes",\n        docker: {\n          image: "moltbot-sandbox:bookworm-slim",\n          containerPrefix: "moltbot-sbx-",\n          workdir: "/workspace",\n          readOnlyRoot: true,\n          tmpfs: ["/tmp", "/var/tmp", "/run"],\n          network: "none",\n          user: "1000:1000",\n          capDrop: ["ALL"],\n          env: { LANG: "C.UTF-8" },\n          setupCommand: "apt-get update && apt-get install -y git curl jq",\n          // Per-agent override (multi-agent): agents.list[].sandbox.docker.*\n          pidsLimit: 256,\n          memory: "1g",\n          memorySwap: "2g",\n          cpus: 1,\n          ulimits: {\n            nofile: { soft: 1024, hard: 2048 },\n            nproc: 256\n          },\n          seccompProfile: "/path/to/seccomp.json",\n          apparmorProfile: "moltbot-sandbox",\n          dns: ["1.1.1.1", "8.8.8.8"],\n          extraHosts: ["internal.service:10.0.0.5"],\n          binds: ["/var/run/docker.sock:/var/run/docker.sock", "/home/user/source:/source:rw"]\n        },\n        browser: {\n          enabled: false,\n          image: "moltbot-sandbox-browser:bookworm-slim",\n          containerPrefix: "moltbot-sbx-browser-",\n          cdpPort: 9222,\n          vncPort: 5900,\n          noVncPort: 6080,\n          headless: false,\n          enableNoVnc: true,\n          allowHostControl: false,\n          allowedControlUrls: ["http://10.0.0.42:18791"],\n          allowedControlHosts: ["browser.lab.local", "10.0.0.42"],\n          allowedControlPorts: [18791],\n          autoStart: true,\n          autoStartTimeoutMs: 12000\n        },\n        prune: {\n          idleHours: 24,  // 0 disables idle pruning\n          maxAgeDays: 7   // 0 disables max-age pruning\n        }\n      }\n    }\n  },\n  tools: {\n    sandbox: {\n      tools: {\n        allow: ["exec", "process", "read", "write", "edit", "apply_patch", "sessions_list", "sessions_history", "sessions_send", "sessions_spawn", "session_status"],\n        deny: ["browser", "canvas", "nodes", "cron", "discord", "gateway"]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Build the default sandbox image once with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"scripts/sandbox-setup.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note: sandbox containers default to ",(0,i.jsx)(n.code,{children:'network: "none"'}),"; set ",(0,i.jsx)(n.code,{children:"agents.defaults.sandbox.docker.network"}),"\nto ",(0,i.jsx)(n.code,{children:'"bridge"'})," (or your custom network) if the agent needs outbound access."]}),"\n",(0,i.jsxs)(n.p,{children:["Note: inbound attachments are staged into the active workspace at ",(0,i.jsx)(n.code,{children:"media/inbound/*"}),". With ",(0,i.jsx)(n.code,{children:'workspaceAccess: "rw"'}),", that means files are written into the agent workspace."]}),"\n",(0,i.jsxs)(n.p,{children:["Note: ",(0,i.jsx)(n.code,{children:"docker.binds"})," mounts additional host directories; global and per-agent binds are merged."]}),"\n",(0,i.jsx)(n.p,{children:"Build the optional browser image with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"scripts/sandbox-browser-setup.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"agents.defaults.sandbox.browser.enabled=true"}),", the browser tool uses a sandboxed\nChromium instance (CDP). If noVNC is enabled (default when headless=false),\nthe noVNC URL is injected into the system prompt so the agent can reference it.\nThis does not require ",(0,i.jsx)(n.code,{children:"browser.enabled"})," in the main config; the sandbox control\nURL is injected per session."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.sandbox.browser.allowHostControl"})," (default: false) allows\nsandboxed sessions to explicitly target the ",(0,i.jsx)(n.strong,{children:"host"})," browser control server\nvia the browser tool (",(0,i.jsx)(n.code,{children:'target: "host"'}),"). Leave this off if you want strict\nsandbox isolation."]}),"\n",(0,i.jsx)(n.p,{children:"Allowlists for remote control:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowedControlUrls"}),": exact control URLs permitted for ",(0,i.jsx)(n.code,{children:'target: "custom"'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowedControlHosts"}),": hostnames permitted (hostname only, no port)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowedControlPorts"}),": ports permitted (defaults: http=80, https=443).\nDefaults: all allowlists are unset (no restriction). ",(0,i.jsx)(n.code,{children:"allowHostControl"})," defaults to false."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"models-custom-providers--base-urls",children:[(0,i.jsx)(n.code,{children:"models"})," (custom providers + base URLs)"]}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot uses the ",(0,i.jsx)(n.strong,{children:"pi-coding-agent"})," model catalog. You can add custom providers\n(LiteLLM, local OpenAI-compatible servers, Anthropic proxies, etc.) by writing\n",(0,i.jsx)(n.code,{children:"~/.clawdbot/agents/<agentId>/agent/models.json"})," or by defining the same schema inside your\nMoltbot config under ",(0,i.jsx)(n.code,{children:"models.providers"}),".\nProvider-by-provider overview + examples: ",(0,i.jsx)(n.a,{href:"/concepts/model-providers",children:"/concepts/model-providers"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"models.providers"})," is present, Moltbot writes/merges a ",(0,i.jsx)(n.code,{children:"models.json"})," into\n",(0,i.jsx)(n.code,{children:"~/.clawdbot/agents/<agentId>/agent/"})," on startup:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["default behavior: ",(0,i.jsx)(n.strong,{children:"merge"})," (keeps existing providers, overrides on name)"]}),"\n",(0,i.jsxs)(n.li,{children:["set ",(0,i.jsx)(n.code,{children:'models.mode: "replace"'})," to overwrite the file contents"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Select the model via ",(0,i.jsx)(n.code,{children:"agents.defaults.model.primary"})," (provider/model)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      model: { primary: "custom-proxy/llama-3.1-8b" },\n      models: {\n        "custom-proxy/llama-3.1-8b": {}\n      }\n    }\n  },\n  models: {\n    mode: "merge",\n    providers: {\n      "custom-proxy": {\n        baseUrl: "http://localhost:4000/v1",\n        apiKey: "LITELLM_KEY",\n        api: "openai-completions",\n        models: [\n          {\n            id: "llama-3.1-8b",\n            name: "Llama 3.1 8B",\n            reasoning: false,\n            input: ["text"],\n            cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 },\n            contextWindow: 128000,\n            maxTokens: 32000\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"opencode-zen-multi-model-proxy",children:"OpenCode Zen (multi-model proxy)"}),"\n",(0,i.jsxs)(n.p,{children:["OpenCode Zen is a multi-model gateway with per-model endpoints. Moltbot uses\nthe built-in ",(0,i.jsx)(n.code,{children:"opencode"})," provider from pi-ai; set ",(0,i.jsx)(n.code,{children:"OPENCODE_API_KEY"})," (or\n",(0,i.jsx)(n.code,{children:"OPENCODE_ZEN_API_KEY"}),") from ",(0,i.jsx)(n.a,{href:"https://opencode.ai/auth",children:"https://opencode.ai/auth"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Model refs use ",(0,i.jsx)(n.code,{children:"opencode/<modelId>"})," (example: ",(0,i.jsx)(n.code,{children:"opencode/claude-opus-4-5"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["If you enable an allowlist via ",(0,i.jsx)(n.code,{children:"agents.defaults.models"}),", add each model you plan to use."]}),"\n",(0,i.jsxs)(n.li,{children:["Shortcut: ",(0,i.jsx)(n.code,{children:"moltbot onboard --auth-choice opencode-zen"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      model: { primary: "opencode/claude-opus-4-5" },\n      models: { "opencode/claude-opus-4-5": { alias: "Opus" } }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"zai-glm-47--provider-alias-support",children:"Z.AI (GLM-4.7) \u2014 provider alias support"}),"\n",(0,i.jsxs)(n.p,{children:["Z.AI models are available via the built-in ",(0,i.jsx)(n.code,{children:"zai"})," provider. Set ",(0,i.jsx)(n.code,{children:"ZAI_API_KEY"}),"\nin your environment and reference the model by provider/model."]}),"\n",(0,i.jsxs)(n.p,{children:["Shortcut: ",(0,i.jsx)(n.code,{children:"moltbot onboard --auth-choice zai-api-key"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      model: { primary: "zai/glm-4.7" },\n      models: { "zai/glm-4.7": {} }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"z.ai/*"})," and ",(0,i.jsx)(n.code,{children:"z-ai/*"})," are accepted aliases and normalize to ",(0,i.jsx)(n.code,{children:"zai/*"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"ZAI_API_KEY"})," is missing, requests to ",(0,i.jsx)(n.code,{children:"zai/*"})," will fail with an auth error at runtime."]}),"\n",(0,i.jsxs)(n.li,{children:["Example error: ",(0,i.jsx)(n.code,{children:'No API key found for provider "zai".'})]}),"\n",(0,i.jsxs)(n.li,{children:["Z.AI\u2019s general API endpoint is ",(0,i.jsx)(n.code,{children:"https://api.z.ai/api/paas/v4"}),". GLM coding\nrequests use the dedicated Coding endpoint ",(0,i.jsx)(n.code,{children:"https://api.z.ai/api/coding/paas/v4"}),".\nThe built-in ",(0,i.jsx)(n.code,{children:"zai"})," provider uses the Coding endpoint. If you need the general\nendpoint, define a custom provider in ",(0,i.jsx)(n.code,{children:"models.providers"})," with the base URL\noverride (see the custom providers section above)."]}),"\n",(0,i.jsx)(n.li,{children:"Use a fake placeholder in docs/configs; never commit real API keys."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"moonshot-ai-kimi",children:"Moonshot AI (Kimi)"}),"\n",(0,i.jsx)(n.p,{children:"Use Moonshot's OpenAI-compatible endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  env: { MOONSHOT_API_KEY: "sk-..." },\n  agents: {\n    defaults: {\n      model: { primary: "moonshot/kimi-k2.5" },\n      models: { "moonshot/kimi-k2.5": { alias: "Kimi K2.5" } }\n    }\n  },\n  models: {\n    mode: "merge",\n    providers: {\n      moonshot: {\n        baseUrl: "https://api.moonshot.ai/v1",\n        apiKey: "${MOONSHOT_API_KEY}",\n        api: "openai-completions",\n        models: [\n          {\n            id: "kimi-k2.5",\n            name: "Kimi K2.5",\n            reasoning: false,\n            input: ["text"],\n            cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 },\n            contextWindow: 256000,\n            maxTokens: 8192\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"MOONSHOT_API_KEY"})," in the environment or use ",(0,i.jsx)(n.code,{children:"moltbot onboard --auth-choice moonshot-api-key"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Model ref: ",(0,i.jsx)(n.code,{children:"moonshot/kimi-k2.5"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"https://api.moonshot.cn/v1"})," if you need the China endpoint."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"kimi-code",children:"Kimi Code"}),"\n",(0,i.jsx)(n.p,{children:"Use Kimi Code's dedicated OpenAI-compatible endpoint (separate from Moonshot):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  env: { KIMICODE_API_KEY: "sk-..." },\n  agents: {\n    defaults: {\n      model: { primary: "kimi-code/kimi-for-coding" },\n      models: { "kimi-code/kimi-for-coding": { alias: "Kimi Code" } }\n    }\n  },\n  models: {\n    mode: "merge",\n    providers: {\n      "kimi-code": {\n        baseUrl: "https://api.kimi.com/coding/v1",\n        apiKey: "${KIMICODE_API_KEY}",\n        api: "openai-completions",\n        models: [\n          {\n            id: "kimi-for-coding",\n            name: "Kimi For Coding",\n            reasoning: true,\n            input: ["text"],\n            cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 },\n            contextWindow: 262144,\n            maxTokens: 32768,\n            headers: { "User-Agent": "KimiCLI/0.77" },\n            compat: { supportsDeveloperRole: false }\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"KIMICODE_API_KEY"})," in the environment or use ",(0,i.jsx)(n.code,{children:"moltbot onboard --auth-choice kimi-code-api-key"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Model ref: ",(0,i.jsx)(n.code,{children:"kimi-code/kimi-for-coding"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"synthetic-anthropic-compatible",children:"Synthetic (Anthropic-compatible)"}),"\n",(0,i.jsx)(n.p,{children:"Use Synthetic's Anthropic-compatible endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  env: { SYNTHETIC_API_KEY: "sk-..." },\n  agents: {\n    defaults: {\n      model: { primary: "synthetic/hf:MiniMaxAI/MiniMax-M2.1" },\n      models: { "synthetic/hf:MiniMaxAI/MiniMax-M2.1": { alias: "MiniMax M2.1" } }\n    }\n  },\n  models: {\n    mode: "merge",\n    providers: {\n      synthetic: {\n        baseUrl: "https://api.synthetic.new/anthropic",\n        apiKey: "${SYNTHETIC_API_KEY}",\n        api: "anthropic-messages",\n        models: [\n          {\n            id: "hf:MiniMaxAI/MiniMax-M2.1",\n            name: "MiniMax M2.1",\n            reasoning: false,\n            input: ["text"],\n            cost: { input: 0, output: 0, cacheRead: 0, cacheWrite: 0 },\n            contextWindow: 192000,\n            maxTokens: 65536\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"SYNTHETIC_API_KEY"})," or use ",(0,i.jsx)(n.code,{children:"moltbot onboard --auth-choice synthetic-api-key"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Model ref: ",(0,i.jsx)(n.code,{children:"synthetic/hf:MiniMaxAI/MiniMax-M2.1"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Base URL should omit ",(0,i.jsx)(n.code,{children:"/v1"})," because the Anthropic client appends it."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"local-models-lm-studio--recommended-setup",children:"Local models (LM Studio) \u2014 recommended setup"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/gateway/local-models",children:"/gateway/local-models"})," for the current local guidance. TL;DR: run MiniMax M2.1 via LM Studio Responses API on serious hardware; keep hosted models merged for fallback."]}),"\n",(0,i.jsx)(n.h3,{id:"minimax-m21",children:"MiniMax M2.1"}),"\n",(0,i.jsx)(n.p,{children:"Use MiniMax M2.1 directly without LM Studio:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  agent: {\n    model: { primary: "minimax/MiniMax-M2.1" },\n    models: {\n      "anthropic/claude-opus-4-5": { alias: "Opus" },\n      "minimax/MiniMax-M2.1": { alias: "Minimax" }\n    }\n  },\n  models: {\n    mode: "merge",\n    providers: {\n      minimax: {\n        baseUrl: "https://api.minimax.io/anthropic",\n        apiKey: "${MINIMAX_API_KEY}",\n        api: "anthropic-messages",\n        models: [\n          {\n            id: "MiniMax-M2.1",\n            name: "MiniMax M2.1",\n            reasoning: false,\n            input: ["text"],\n            // Pricing: update in models.json if you need exact cost tracking.\n            cost: { input: 15, output: 60, cacheRead: 2, cacheWrite: 10 },\n            contextWindow: 200000,\n            maxTokens: 8192\n          }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"MINIMAX_API_KEY"})," environment variable or use ",(0,i.jsx)(n.code,{children:"moltbot onboard --auth-choice minimax-api"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Available model: ",(0,i.jsx)(n.code,{children:"MiniMax-M2.1"})," (default)."]}),"\n",(0,i.jsxs)(n.li,{children:["Update pricing in ",(0,i.jsx)(n.code,{children:"models.json"})," if you need exact cost tracking."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cerebras-glm-46--47",children:"Cerebras (GLM 4.6 / 4.7)"}),"\n",(0,i.jsx)(n.p,{children:"Use Cerebras via their OpenAI-compatible endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  env: { CEREBRAS_API_KEY: "sk-..." },\n  agents: {\n    defaults: {\n      model: {\n        primary: "cerebras/zai-glm-4.7",\n        fallbacks: ["cerebras/zai-glm-4.6"]\n      },\n      models: {\n        "cerebras/zai-glm-4.7": { alias: "GLM 4.7 (Cerebras)" },\n        "cerebras/zai-glm-4.6": { alias: "GLM 4.6 (Cerebras)" }\n      }\n    }\n  },\n  models: {\n    mode: "merge",\n    providers: {\n      cerebras: {\n        baseUrl: "https://api.cerebras.ai/v1",\n        apiKey: "${CEREBRAS_API_KEY}",\n        api: "openai-completions",\n        models: [\n          { id: "zai-glm-4.7", name: "GLM 4.7 (Cerebras)" },\n          { id: "zai-glm-4.6", name: "GLM 4.6 (Cerebras)" }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"cerebras/zai-glm-4.7"})," for Cerebras; use ",(0,i.jsx)(n.code,{children:"zai/glm-4.7"})," for Z.AI direct."]}),"\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"CEREBRAS_API_KEY"})," in the environment or config."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Supported APIs: ",(0,i.jsx)(n.code,{children:"openai-completions"}),", ",(0,i.jsx)(n.code,{children:"openai-responses"}),", ",(0,i.jsx)(n.code,{children:"anthropic-messages"}),",\n",(0,i.jsx)(n.code,{children:"google-generative-ai"})]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"authHeader: true"})," + ",(0,i.jsx)(n.code,{children:"headers"})," for custom auth needs."]}),"\n",(0,i.jsxs)(n.li,{children:["Override the agent config root with ",(0,i.jsx)(n.code,{children:"CLAWDBOT_AGENT_DIR"})," (or ",(0,i.jsx)(n.code,{children:"PI_CODING_AGENT_DIR"}),")\nif you want ",(0,i.jsx)(n.code,{children:"models.json"})," stored elsewhere (default: ",(0,i.jsx)(n.code,{children:"~/.clawdbot/agents/main/agent"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"session",children:(0,i.jsx)(n.code,{children:"session"})}),"\n",(0,i.jsx)(n.p,{children:"Controls session scoping, reset policy, reset triggers, and where the session store is written."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  session: {\n    scope: "per-sender",\n    dmScope: "main",\n    identityLinks: {\n      alice: ["telegram:123456789", "discord:987654321012345678"]\n    },\n    reset: {\n      mode: "daily",\n      atHour: 4,\n      idleMinutes: 60\n    },\n    resetByType: {\n      thread: { mode: "daily", atHour: 4 },\n      dm: { mode: "idle", idleMinutes: 240 },\n      group: { mode: "idle", idleMinutes: 120 }\n    },\n    resetTriggers: ["/new", "/reset"],\n    // Default is already per-agent under ~/.clawdbot/agents/<agentId>/sessions/sessions.json\n    // You can override with {agentId} templating:\n    store: "~/.clawdbot/agents/{agentId}/sessions/sessions.json",\n    // Direct chats collapse to agent:<agentId>:<mainKey> (default: "main").\n    mainKey: "main",\n    agentToAgent: {\n      // Max ping-pong reply turns between requester/target (0\u20135).\n      maxPingPongTurns: 5\n    },\n    sendPolicy: {\n      rules: [\n        { action: "deny", match: { channel: "discord", chatType: "group" } }\n      ],\n      default: "allow"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Fields:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mainKey"}),": direct-chat bucket key (default: ",(0,i.jsx)(n.code,{children:'"main"'}),"). Useful when you want to \u201crename\u201d the primary DM thread without changing ",(0,i.jsx)(n.code,{children:"agentId"}),".\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Sandbox note: ",(0,i.jsx)(n.code,{children:'agents.defaults.sandbox.mode: "non-main"'})," uses this key to detect the main session. Any session key that does not match ",(0,i.jsx)(n.code,{children:"mainKey"})," (groups/channels) is sandboxed."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"dmScope"}),": how DM sessions are grouped (default: ",(0,i.jsx)(n.code,{children:'"main"'}),").\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"main"}),": all DMs share the main session for continuity."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"per-peer"}),": isolate DMs by sender id across channels."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"per-channel-peer"}),": isolate DMs per channel + sender (recommended for multi-user inboxes)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"per-account-channel-peer"}),": isolate DMs per account + channel + sender (recommended for multi-account inboxes)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"identityLinks"}),": map canonical ids to provider-prefixed peers so the same person shares a DM session across channels when using ",(0,i.jsx)(n.code,{children:"per-peer"}),", ",(0,i.jsx)(n.code,{children:"per-channel-peer"}),", or ",(0,i.jsx)(n.code,{children:"per-account-channel-peer"}),".\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Example: ",(0,i.jsx)(n.code,{children:'alice: ["telegram:123456789", "discord:987654321012345678"]'}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"reset"}),": primary reset policy. Defaults to daily resets at 4:00 AM local time on the gateway host.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mode"}),": ",(0,i.jsx)(n.code,{children:"daily"})," or ",(0,i.jsx)(n.code,{children:"idle"})," (default: ",(0,i.jsx)(n.code,{children:"daily"})," when ",(0,i.jsx)(n.code,{children:"reset"})," is present)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"atHour"}),": local hour (0-23) for the daily reset boundary."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"idleMinutes"}),": sliding idle window in minutes. When daily + idle are both configured, whichever expires first wins."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"resetByType"}),": per-session overrides for ",(0,i.jsx)(n.code,{children:"dm"}),", ",(0,i.jsx)(n.code,{children:"group"}),", and ",(0,i.jsx)(n.code,{children:"thread"}),".\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If you only set legacy ",(0,i.jsx)(n.code,{children:"session.idleMinutes"})," without any ",(0,i.jsx)(n.code,{children:"reset"}),"/",(0,i.jsx)(n.code,{children:"resetByType"}),", Moltbot stays in idle-only mode for backward compatibility."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"heartbeatIdleMinutes"}),": optional idle override for heartbeat checks (daily reset still applies when enabled)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agentToAgent.maxPingPongTurns"}),": max reply-back turns between requester/target (0\u20135, default 5)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sendPolicy.default"}),": ",(0,i.jsx)(n.code,{children:"allow"})," or ",(0,i.jsx)(n.code,{children:"deny"})," fallback when no rule matches."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sendPolicy.rules[]"}),": match by ",(0,i.jsx)(n.code,{children:"channel"}),", ",(0,i.jsx)(n.code,{children:"chatType"})," (",(0,i.jsx)(n.code,{children:"direct|group|room"}),"), or ",(0,i.jsx)(n.code,{children:"keyPrefix"})," (e.g. ",(0,i.jsx)(n.code,{children:"cron:"}),"). First deny wins; otherwise allow."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"skills-skills-config",children:[(0,i.jsx)(n.code,{children:"skills"})," (skills config)"]}),"\n",(0,i.jsxs)(n.p,{children:["Controls bundled allowlist, install preferences, extra skill folders, and per-skill\noverrides. Applies to ",(0,i.jsx)(n.strong,{children:"bundled"})," skills and ",(0,i.jsx)(n.code,{children:"~/.clawdbot/skills"})," (workspace skills\nstill win on name conflicts)."]}),"\n",(0,i.jsx)(n.p,{children:"Fields:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allowBundled"}),": optional allowlist for ",(0,i.jsx)(n.strong,{children:"bundled"})," skills only. If set, only those\nbundled skills are eligible (managed/workspace skills unaffected)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"load.extraDirs"}),": additional skill directories to scan (lowest precedence)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"install.preferBrew"}),": prefer brew installers when available (default: true)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"install.nodeManager"}),": node installer preference (",(0,i.jsx)(n.code,{children:"npm"})," | ",(0,i.jsx)(n.code,{children:"pnpm"})," | ",(0,i.jsx)(n.code,{children:"yarn"}),", default: npm)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"entries.<skillKey>"}),": per-skill config overrides."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Per-skill fields:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enabled"}),": set ",(0,i.jsx)(n.code,{children:"false"})," to disable a skill even if it\u2019s bundled/installed."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"env"}),": environment variables injected for the agent run (only if not already set)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"apiKey"}),": optional convenience for skills that declare a primary env var (e.g. ",(0,i.jsx)(n.code,{children:"nano-banana-pro"})," \u2192 ",(0,i.jsx)(n.code,{children:"GEMINI_API_KEY"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  skills: {\n    allowBundled: ["gemini", "peekaboo"],\n    load: {\n      extraDirs: [\n        "~/Projects/agent-scripts/skills",\n        "~/Projects/oss/some-skill-pack/skills"\n      ]\n    },\n    install: {\n      preferBrew: true,\n      nodeManager: "npm"\n    },\n    entries: {\n      "nano-banana-pro": {\n        apiKey: "GEMINI_KEY_HERE",\n        env: {\n          GEMINI_API_KEY: "GEMINI_KEY_HERE"\n        }\n      },\n      peekaboo: { enabled: true },\n      sag: { enabled: false }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"plugins-extensions",children:[(0,i.jsx)(n.code,{children:"plugins"})," (extensions)"]}),"\n",(0,i.jsxs)(n.p,{children:["Controls plugin discovery, allow/deny, and per-plugin config. Plugins are loaded\nfrom ",(0,i.jsx)(n.code,{children:"~/.clawdbot/extensions"}),", ",(0,i.jsx)(n.code,{children:"<workspace>/.clawdbot/extensions"}),", plus any\n",(0,i.jsx)(n.code,{children:"plugins.load.paths"})," entries. ",(0,i.jsx)(n.strong,{children:"Config changes require a gateway restart."}),"\nSee ",(0,i.jsx)(n.a,{href:"/plugin",children:"/plugin"})," for full usage."]}),"\n",(0,i.jsx)(n.p,{children:"Fields:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enabled"}),": master toggle for plugin loading (default: true)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"allow"}),": optional allowlist of plugin ids; when set, only listed plugins load."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deny"}),": optional denylist of plugin ids (deny wins)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"load.paths"}),": extra plugin files or directories to load (absolute or ",(0,i.jsx)(n.code,{children:"~"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"entries.<pluginId>"}),": per-plugin overrides.\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enabled"}),": set ",(0,i.jsx)(n.code,{children:"false"})," to disable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"config"}),": plugin-specific config object (validated by the plugin if provided)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  plugins: {\n    enabled: true,\n    allow: ["voice-call"],\n    load: {\n      paths: ["~/Projects/oss/voice-call-extension"]\n    },\n    entries: {\n      "voice-call": {\n        enabled: true,\n        config: {\n          provider: "twilio"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"browser-clawd-managed-browser",children:[(0,i.jsx)(n.code,{children:"browser"})," (clawd-managed browser)"]}),"\n",(0,i.jsxs)(n.p,{children:["Moltbot can start a ",(0,i.jsx)(n.strong,{children:"dedicated, isolated"})," Chrome/Brave/Edge/Chromium instance for clawd and expose a small loopback control service.\nProfiles can point at a ",(0,i.jsx)(n.strong,{children:"remote"})," Chromium-based browser via ",(0,i.jsx)(n.code,{children:"profiles.<name>.cdpUrl"}),". Remote\nprofiles are attach-only (start/stop/reset are disabled)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"browser.cdpUrl"})," remains for legacy single-profile configs and as the base\nscheme/host for profiles that only set ",(0,i.jsx)(n.code,{children:"cdpPort"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Defaults:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["enabled: ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsxs)(n.li,{children:["evaluateEnabled: ",(0,i.jsx)(n.code,{children:"true"})," (set ",(0,i.jsx)(n.code,{children:"false"})," to disable ",(0,i.jsx)(n.code,{children:"act:evaluate"})," and ",(0,i.jsx)(n.code,{children:"wait --fn"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["control service: loopback only (port derived from ",(0,i.jsx)(n.code,{children:"gateway.port"}),", default ",(0,i.jsx)(n.code,{children:"18791"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["CDP URL: ",(0,i.jsx)(n.code,{children:"http://127.0.0.1:18792"})," (control service + 1, legacy single-profile)"]}),"\n",(0,i.jsxs)(n.li,{children:["profile color: ",(0,i.jsx)(n.code,{children:"#FF4500"})," (lobster-orange)"]}),"\n",(0,i.jsxs)(n.li,{children:["Note: the control server is started by the running gateway (Moltbot.app menubar, or ",(0,i.jsx)(n.code,{children:"moltbot gateway"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"Auto-detect order: default browser if Chromium-based; otherwise Chrome \u2192 Brave \u2192 Edge \u2192 Chromium \u2192 Chrome Canary."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  browser: {\n    enabled: true,\n    evaluateEnabled: true,\n    // cdpUrl: "http://127.0.0.1:18792", // legacy single-profile override\n    defaultProfile: "chrome",\n    profiles: {\n      clawd: { cdpPort: 18800, color: "#FF4500" },\n      work: { cdpPort: 18801, color: "#0066CC" },\n      remote: { cdpUrl: "http://10.0.0.42:9222", color: "#00AA00" }\n    },\n    color: "#FF4500",\n    // Advanced:\n    // headless: false,\n    // noSandbox: false,\n    // executablePath: "/Applications/Brave Browser.app/Contents/MacOS/Brave Browser",\n    // attachOnly: false, // set true when tunneling a remote CDP to localhost\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"ui-appearance",children:[(0,i.jsx)(n.code,{children:"ui"})," (Appearance)"]}),"\n",(0,i.jsx)(n.p,{children:"Optional accent color used by the native apps for UI chrome (e.g. Talk Mode bubble tint)."}),"\n",(0,i.jsx)(n.p,{children:"If unset, clients fall back to a muted light-blue."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  ui: {\n    seamColor: "#FF4500", // hex (RRGGBB or #RRGGBB)\n    // Optional: Control UI assistant identity override.\n    // If unset, the Control UI uses the active agent identity (config or IDENTITY.md).\n    assistant: {\n      name: "Moltbot",\n      avatar: "CB" // emoji, short text, or image URL/data URI\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"gateway-gateway-server-mode--bind",children:[(0,i.jsx)(n.code,{children:"gateway"})," (Gateway server mode + bind)"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"gateway.mode"})," to explicitly declare whether this machine should run the Gateway."]}),"\n",(0,i.jsx)(n.p,{children:"Defaults:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["mode: ",(0,i.jsx)(n.strong,{children:"unset"})," (treated as \u201cdo not auto-start\u201d)"]}),"\n",(0,i.jsxs)(n.li,{children:["bind: ",(0,i.jsx)(n.code,{children:"loopback"})]}),"\n",(0,i.jsxs)(n.li,{children:["port: ",(0,i.jsx)(n.code,{children:"18789"})," (single port for WS + HTTP)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  gateway: {\n    mode: "local", // or "remote"\n    port: 18789, // WS + HTTP multiplex\n    bind: "loopback",\n    // controlUi: { enabled: true, basePath: "/moltbot" }\n    // auth: { mode: "token", token: "your-token" } // token gates WS + Control UI access\n    // tailscale: { mode: "off" | "serve" | "funnel" }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Control UI base path:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.controlUi.basePath"})," sets the URL prefix where the Control UI is served."]}),"\n",(0,i.jsxs)(n.li,{children:["Examples: ",(0,i.jsx)(n.code,{children:'"/ui"'}),", ",(0,i.jsx)(n.code,{children:'"/moltbot"'}),", ",(0,i.jsx)(n.code,{children:'"/apps/moltbot"'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Default: root (",(0,i.jsx)(n.code,{children:"/"}),") (unchanged)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.controlUi.allowInsecureAuth"})," allows token-only auth for the Control UI when\ndevice identity is omitted (typically over HTTP). Default: ",(0,i.jsx)(n.code,{children:"false"}),". Prefer HTTPS\n(Tailscale Serve) or ",(0,i.jsx)(n.code,{children:"127.0.0.1"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.controlUi.dangerouslyDisableDeviceAuth"})," disables device identity checks for the\nControl UI (token/password only). Default: ",(0,i.jsx)(n.code,{children:"false"}),". Break-glass only."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Related docs:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/web/control-ui",children:"Control UI"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/web",children:"Web overview"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/gateway/tailscale",children:"Tailscale"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/gateway/remote",children:"Remote access"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Trusted proxies:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.trustedProxies"}),": list of reverse proxy IPs that terminate TLS in front of the Gateway."]}),"\n",(0,i.jsxs)(n.li,{children:["When a connection comes from one of these IPs, Moltbot uses ",(0,i.jsx)(n.code,{children:"x-forwarded-for"})," (or ",(0,i.jsx)(n.code,{children:"x-real-ip"}),") to determine the client IP for local pairing checks and HTTP auth/local checks."]}),"\n",(0,i.jsxs)(n.li,{children:["Only list proxies you fully control, and ensure they ",(0,i.jsx)(n.strong,{children:"overwrite"})," incoming ",(0,i.jsx)(n.code,{children:"x-forwarded-for"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"moltbot gateway"})," refuses to start unless ",(0,i.jsx)(n.code,{children:"gateway.mode"})," is set to ",(0,i.jsx)(n.code,{children:"local"})," (or you pass the override flag)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.port"})," controls the single multiplexed port used for WebSocket + HTTP (control UI, hooks, A2UI)."]}),"\n",(0,i.jsxs)(n.li,{children:["OpenAI Chat Completions endpoint: ",(0,i.jsx)(n.strong,{children:"disabled by default"}),"; enable with ",(0,i.jsx)(n.code,{children:"gateway.http.endpoints.chatCompletions.enabled: true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Precedence: ",(0,i.jsx)(n.code,{children:"--port"})," > ",(0,i.jsx)(n.code,{children:"CLAWDBOT_GATEWAY_PORT"})," > ",(0,i.jsx)(n.code,{children:"gateway.port"})," > default ",(0,i.jsx)(n.code,{children:"18789"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Gateway auth is required by default (token/password or Tailscale Serve identity). Non-loopback binds require a shared token/password."}),"\n",(0,i.jsx)(n.li,{children:"The onboarding wizard generates a gateway token by default (even on loopback)."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.remote.token"})," is ",(0,i.jsx)(n.strong,{children:"only"})," for remote CLI calls; it does not enable local gateway auth. ",(0,i.jsx)(n.code,{children:"gateway.token"})," is ignored."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Auth and Tailscale:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.auth.mode"})," sets the handshake requirements (",(0,i.jsx)(n.code,{children:"token"})," or ",(0,i.jsx)(n.code,{children:"password"}),"). When unset, token auth is assumed."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.auth.token"})," stores the shared token for token auth (used by the CLI on the same machine)."]}),"\n",(0,i.jsxs)(n.li,{children:["When ",(0,i.jsx)(n.code,{children:"gateway.auth.mode"})," is set, only that method is accepted (plus optional Tailscale headers)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.auth.password"})," can be set here, or via ",(0,i.jsx)(n.code,{children:"CLAWDBOT_GATEWAY_PASSWORD"})," (recommended)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.auth.allowTailscale"})," allows Tailscale Serve identity headers\n(",(0,i.jsx)(n.code,{children:"tailscale-user-login"}),") to satisfy auth when the request arrives on loopback\nwith ",(0,i.jsx)(n.code,{children:"x-forwarded-for"}),", ",(0,i.jsx)(n.code,{children:"x-forwarded-proto"}),", and ",(0,i.jsx)(n.code,{children:"x-forwarded-host"}),". Moltbot\nverifies the identity by resolving the ",(0,i.jsx)(n.code,{children:"x-forwarded-for"})," address via\n",(0,i.jsx)(n.code,{children:"tailscale whois"})," before accepting it. When ",(0,i.jsx)(n.code,{children:"true"}),", Serve requests do not need\na token/password; set ",(0,i.jsx)(n.code,{children:"false"})," to require explicit credentials. Defaults to\n",(0,i.jsx)(n.code,{children:"true"})," when ",(0,i.jsx)(n.code,{children:'tailscale.mode = "serve"'})," and auth mode is not ",(0,i.jsx)(n.code,{children:"password"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'gateway.tailscale.mode: "serve"'})," uses Tailscale Serve (tailnet only, loopback bind)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'gateway.tailscale.mode: "funnel"'})," exposes the dashboard publicly; requires auth."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.tailscale.resetOnExit"})," resets Serve/Funnel config on shutdown."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Remote client defaults (CLI):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.remote.url"})," sets the default Gateway WebSocket URL for CLI calls when ",(0,i.jsx)(n.code,{children:'gateway.mode = "remote"'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.remote.transport"})," selects the macOS remote transport (",(0,i.jsx)(n.code,{children:"ssh"})," default, ",(0,i.jsx)(n.code,{children:"direct"})," for ws/wss). When ",(0,i.jsx)(n.code,{children:"direct"}),", ",(0,i.jsx)(n.code,{children:"gateway.remote.url"})," must be ",(0,i.jsx)(n.code,{children:"ws://"})," or ",(0,i.jsx)(n.code,{children:"wss://"}),". ",(0,i.jsx)(n.code,{children:"ws://host"})," defaults to port ",(0,i.jsx)(n.code,{children:"18789"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.remote.token"})," supplies the token for remote calls (leave unset for no auth)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.remote.password"})," supplies the password for remote calls (leave unset for no auth)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"macOS app behavior:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Moltbot.app watches ",(0,i.jsx)(n.code,{children:"~/.clawdbot/moltbot.json"})," and switches modes live when ",(0,i.jsx)(n.code,{children:"gateway.mode"})," or ",(0,i.jsx)(n.code,{children:"gateway.remote.url"})," changes."]}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"gateway.mode"})," is unset but ",(0,i.jsx)(n.code,{children:"gateway.remote.url"})," is set, the macOS app treats it as remote mode."]}),"\n",(0,i.jsxs)(n.li,{children:["When you change connection mode in the macOS app, it writes ",(0,i.jsx)(n.code,{children:"gateway.mode"})," (and ",(0,i.jsx)(n.code,{children:"gateway.remote.url"})," + ",(0,i.jsx)(n.code,{children:"gateway.remote.transport"})," in remote mode) back to the config file."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  gateway: {\n    mode: "remote",\n    remote: {\n      url: "ws://gateway.tailnet:18789",\n      token: "your-token",\n      password: "your-password"\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Direct transport example (macOS app):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  gateway: {\n    mode: "remote",\n    remote: {\n      transport: "direct",\n      url: "wss://gateway.example.ts.net",\n      token: "your-token"\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"gatewayreload-config-hot-reload",children:[(0,i.jsx)(n.code,{children:"gateway.reload"})," (Config hot reload)"]}),"\n",(0,i.jsxs)(n.p,{children:["The Gateway watches ",(0,i.jsx)(n.code,{children:"~/.clawdbot/moltbot.json"})," (or ",(0,i.jsx)(n.code,{children:"CLAWDBOT_CONFIG_PATH"}),") and applies changes automatically."]}),"\n",(0,i.jsx)(n.p,{children:"Modes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hybrid"})," (default): hot-apply safe changes; restart the Gateway for critical changes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hot"}),": only apply hot-safe changes; log when a restart is required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"restart"}),": restart the Gateway on any config change."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"off"}),": disable hot reload."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  gateway: {\n    reload: {\n      mode: "hybrid",\n      debounceMs: 300\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"hot-reload-matrix-files--impact",children:"Hot reload matrix (files + impact)"}),"\n",(0,i.jsx)(n.p,{children:"Files watched:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"~/.clawdbot/moltbot.json"})," (or ",(0,i.jsx)(n.code,{children:"CLAWDBOT_CONFIG_PATH"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Hot-applied (no full gateway restart):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hooks"})," (webhook auth/path/mappings) + ",(0,i.jsx)(n.code,{children:"hooks.gmail"})," (Gmail watcher restarted)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"browser"})," (browser control server restart)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cron"})," (cron service restart + concurrency update)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.heartbeat"})," (heartbeat runner restart)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"web"})," (WhatsApp web channel restart)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"telegram"}),", ",(0,i.jsx)(n.code,{children:"discord"}),", ",(0,i.jsx)(n.code,{children:"signal"}),", ",(0,i.jsx)(n.code,{children:"imessage"})," (channel restarts)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agent"}),", ",(0,i.jsx)(n.code,{children:"models"}),", ",(0,i.jsx)(n.code,{children:"routing"}),", ",(0,i.jsx)(n.code,{children:"messages"}),", ",(0,i.jsx)(n.code,{children:"session"}),", ",(0,i.jsx)(n.code,{children:"whatsapp"}),", ",(0,i.jsx)(n.code,{children:"logging"}),", ",(0,i.jsx)(n.code,{children:"skills"}),", ",(0,i.jsx)(n.code,{children:"ui"}),", ",(0,i.jsx)(n.code,{children:"talk"}),", ",(0,i.jsx)(n.code,{children:"identity"}),", ",(0,i.jsx)(n.code,{children:"wizard"})," (dynamic reads)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Requires full Gateway restart:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway"})," (port/bind/auth/control UI/tailscale)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bridge"})," (legacy)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"discovery"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"canvasHost"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"plugins"})}),"\n",(0,i.jsx)(n.li,{children:"Any unknown/unsupported config path (defaults to restart for safety)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"multi-instance-isolation",children:"Multi-instance isolation"}),"\n",(0,i.jsx)(n.p,{children:"To run multiple gateways on one host (for redundancy or a rescue bot), isolate per-instance state + config and use unique ports:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CLAWDBOT_CONFIG_PATH"})," (per-instance config)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CLAWDBOT_STATE_DIR"})," (sessions/creds)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"agents.defaults.workspace"})," (memories)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gateway.port"})," (unique per instance)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Convenience flags (CLI):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"moltbot --dev \u2026"})," \u2192 uses ",(0,i.jsx)(n.code,{children:"~/.clawdbot-dev"})," + shifts ports from base ",(0,i.jsx)(n.code,{children:"19001"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"moltbot --profile <name> \u2026"})," \u2192 uses ",(0,i.jsx)(n.code,{children:"~/.clawdbot-<name>"})," (port via config/env/flags)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/gateway",children:"Gateway runbook"})," for the derived port mapping (gateway/browser/canvas).\nSee ",(0,i.jsx)(n.a,{href:"/gateway/multiple-gateways",children:"Multiple gateways"})," for browser/CDP port isolation details."]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"CLAWDBOT_CONFIG_PATH=~/.clawdbot/a.json \\\nCLAWDBOT_STATE_DIR=~/.clawdbot-a \\\nmoltbot gateway --port 19001\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"hooks-gateway-webhooks",children:[(0,i.jsx)(n.code,{children:"hooks"})," (Gateway webhooks)"]}),"\n",(0,i.jsx)(n.p,{children:"Enable a simple HTTP webhook endpoint on the Gateway HTTP server."}),"\n",(0,i.jsx)(n.p,{children:"Defaults:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["enabled: ",(0,i.jsx)(n.code,{children:"false"})]}),"\n",(0,i.jsxs)(n.li,{children:["path: ",(0,i.jsx)(n.code,{children:"/hooks"})]}),"\n",(0,i.jsxs)(n.li,{children:["maxBodyBytes: ",(0,i.jsx)(n.code,{children:"262144"})," (256 KB)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  hooks: {\n    enabled: true,\n    token: "shared-secret",\n    path: "/hooks",\n    presets: ["gmail"],\n    transformsDir: "~/.clawdbot/hooks",\n    mappings: [\n      {\n        match: { path: "gmail" },\n        action: "agent",\n        wakeMode: "now",\n        name: "Gmail",\n        sessionKey: "hook:gmail:{{messages[0].id}}",\n        messageTemplate:\n          "From: {{messages[0].from}}\\nSubject: {{messages[0].subject}}\\n{{messages[0].snippet}}",\n        deliver: true,\n        channel: "last",\n        model: "openai/gpt-5.2-mini",\n      },\n    ],\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Requests must include the hook token:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Authorization: Bearer <token>"})," ",(0,i.jsx)(n.strong,{children:"or"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"x-moltbot-token: <token>"})," ",(0,i.jsx)(n.strong,{children:"or"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"?token=<token>"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Endpoints:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /hooks/wake"})," \u2192 ",(0,i.jsx)(n.code,{children:'{ text, mode?: "now"|"next-heartbeat" }'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /hooks/agent"})," \u2192 ",(0,i.jsx)(n.code,{children:"{ message, name?, sessionKey?, wakeMode?, deliver?, channel?, to?, model?, thinking?, timeoutSeconds? }"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /hooks/<name>"})," \u2192 resolved via ",(0,i.jsx)(n.code,{children:"hooks.mappings"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"/hooks/agent"})," always posts a summary into the main session (and can optionally trigger an immediate heartbeat via ",(0,i.jsx)(n.code,{children:'wakeMode: "now"'}),")."]}),"\n",(0,i.jsx)(n.p,{children:"Mapping notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match.path"})," matches the sub-path after ",(0,i.jsx)(n.code,{children:"/hooks"})," (e.g. ",(0,i.jsx)(n.code,{children:"/hooks/gmail"})," \u2192 ",(0,i.jsx)(n.code,{children:"gmail"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match.source"})," matches a payload field (e.g. ",(0,i.jsx)(n.code,{children:'{ source: "gmail" }'}),") so you can use a generic ",(0,i.jsx)(n.code,{children:"/hooks/ingest"})," path."]}),"\n",(0,i.jsxs)(n.li,{children:["Templates like ",(0,i.jsx)(n.code,{children:"{{messages[0].subject}}"})," read from the payload."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"transform"})," can point to a JS/TS module that returns a hook action."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deliver: true"})," sends the final reply to a channel; ",(0,i.jsx)(n.code,{children:"channel"})," defaults to ",(0,i.jsx)(n.code,{children:"last"})," (falls back to WhatsApp)."]}),"\n",(0,i.jsxs)(n.li,{children:["If there is no prior delivery route, set ",(0,i.jsx)(n.code,{children:"channel"})," + ",(0,i.jsx)(n.code,{children:"to"})," explicitly (required for Telegram/Discord/Google Chat/Slack/Signal/iMessage/MS Teams)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"model"})," overrides the LLM for this hook run (",(0,i.jsx)(n.code,{children:"provider/model"})," or alias; must be allowed if ",(0,i.jsx)(n.code,{children:"agents.defaults.models"})," is set)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Gmail helper config (used by ",(0,i.jsx)(n.code,{children:"moltbot webhooks gmail setup"})," / ",(0,i.jsx)(n.code,{children:"run"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  hooks: {\n    gmail: {\n      account: "moltbot@gmail.com",\n      topic: "projects/<project-id>/topics/gog-gmail-watch",\n      subscription: "gog-gmail-watch-push",\n      pushToken: "shared-push-token",\n      hookUrl: "http://127.0.0.1:18789/hooks/gmail",\n      includeBody: true,\n      maxBytes: 20000,\n      renewEveryMinutes: 720,\n      serve: { bind: "127.0.0.1", port: 8788, path: "/" },\n      tailscale: { mode: "funnel", path: "/gmail-pubsub" },\n\n      // Optional: use a cheaper model for Gmail hook processing\n      // Falls back to agents.defaults.model.fallbacks, then primary, on auth/rate-limit/timeout\n      model: "openrouter/meta-llama/llama-3.3-70b-instruct:free",\n      // Optional: default thinking level for Gmail hooks\n      thinking: "off",\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Model override for Gmail hooks:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hooks.gmail.model"})," specifies a model to use for Gmail hook processing (defaults to session primary)."]}),"\n",(0,i.jsxs)(n.li,{children:["Accepts ",(0,i.jsx)(n.code,{children:"provider/model"})," refs or aliases from ",(0,i.jsx)(n.code,{children:"agents.defaults.models"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Falls back to ",(0,i.jsx)(n.code,{children:"agents.defaults.model.fallbacks"}),", then ",(0,i.jsx)(n.code,{children:"agents.defaults.model.primary"}),", on auth/rate-limit/timeouts."]}),"\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"agents.defaults.models"})," is set, include the hooks model in the allowlist."]}),"\n",(0,i.jsx)(n.li,{children:"At startup, warns if the configured model is not in the model catalog or allowlist."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"hooks.gmail.thinking"})," sets the default thinking level for Gmail hooks and is overridden by per-hook ",(0,i.jsx)(n.code,{children:"thinking"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Gateway auto-start:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If ",(0,i.jsx)(n.code,{children:"hooks.enabled=true"})," and ",(0,i.jsx)(n.code,{children:"hooks.gmail.account"})," is set, the Gateway starts\n",(0,i.jsx)(n.code,{children:"gog gmail watch serve"})," on boot and auto-renews the watch."]}),"\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.code,{children:"CLAWDBOT_SKIP_GMAIL_WATCHER=1"})," to disable the auto-start (for manual runs)."]}),"\n",(0,i.jsxs)(n.li,{children:["Avoid running a separate ",(0,i.jsx)(n.code,{children:"gog gmail watch serve"})," alongside the Gateway; it will\nfail with ",(0,i.jsx)(n.code,{children:"listen tcp 127.0.0.1:8788: bind: address already in use"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Note: when ",(0,i.jsx)(n.code,{children:"tailscale.mode"})," is on, Moltbot defaults ",(0,i.jsx)(n.code,{children:"serve.path"})," to ",(0,i.jsx)(n.code,{children:"/"})," so\nTailscale can proxy ",(0,i.jsx)(n.code,{children:"/gmail-pubsub"})," correctly (it strips the set-path prefix).\nIf you need the backend to receive the prefixed path, set\n",(0,i.jsx)(n.code,{children:"hooks.gmail.tailscale.target"})," to a full URL (and align ",(0,i.jsx)(n.code,{children:"serve.path"}),")."]}),"\n",(0,i.jsxs)(n.h3,{id:"canvashost-lantailnet-canvas-file-server--live-reload",children:[(0,i.jsx)(n.code,{children:"canvasHost"})," (LAN/tailnet Canvas file server + live reload)"]}),"\n",(0,i.jsxs)(n.p,{children:["The Gateway serves a directory of HTML/CSS/JS over HTTP so iOS/Android nodes can simply ",(0,i.jsx)(n.code,{children:"canvas.navigate"})," to it."]}),"\n",(0,i.jsxs)(n.p,{children:["Default root: ",(0,i.jsx)(n.code,{children:"~/clawd/canvas"}),(0,i.jsx)(n.br,{}),"\nDefault port: ",(0,i.jsx)(n.code,{children:"18793"})," (chosen to avoid the clawd browser CDP port ",(0,i.jsx)(n.code,{children:"18792"}),")",(0,i.jsx)(n.br,{}),"\nThe server listens on the ",(0,i.jsx)(n.strong,{children:"gateway bind host"})," (LAN or Tailnet) so nodes can reach it."]}),"\n",(0,i.jsx)(n.p,{children:"The server:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["serves files under ",(0,i.jsx)(n.code,{children:"canvasHost.root"})]}),"\n",(0,i.jsx)(n.li,{children:"injects a tiny live-reload client into served HTML"}),"\n",(0,i.jsxs)(n.li,{children:["watches the directory and broadcasts reloads over a WebSocket endpoint at ",(0,i.jsx)(n.code,{children:"/__moltbot/ws"})]}),"\n",(0,i.jsxs)(n.li,{children:["auto-creates a starter ",(0,i.jsx)(n.code,{children:"index.html"})," when the directory is empty (so you see something immediately)"]}),"\n",(0,i.jsxs)(n.li,{children:["also serves A2UI at ",(0,i.jsx)(n.code,{children:"/__moltbot__/a2ui/"})," and is advertised to nodes as ",(0,i.jsx)(n.code,{children:"canvasHostUrl"}),"\n(always used by nodes for Canvas/A2UI)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Disable live reload (and file watching) if the directory is large or you hit ",(0,i.jsx)(n.code,{children:"EMFILE"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["config: ",(0,i.jsx)(n.code,{children:"canvasHost: { liveReload: false }"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  canvasHost: {\n    root: "~/clawd/canvas",\n    port: 18793,\n    liveReload: true\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Changes to ",(0,i.jsx)(n.code,{children:"canvasHost.*"})," require a gateway restart (config reload will restart)."]}),"\n",(0,i.jsx)(n.p,{children:"Disable with:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["config: ",(0,i.jsx)(n.code,{children:"canvasHost: { enabled: false }"})]}),"\n",(0,i.jsxs)(n.li,{children:["env: ",(0,i.jsx)(n.code,{children:"CLAWDBOT_SKIP_CANVAS_HOST=1"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"bridge-legacy-tcp-bridge-removed",children:[(0,i.jsx)(n.code,{children:"bridge"})," (legacy TCP bridge, removed)"]}),"\n",(0,i.jsxs)(n.p,{children:["Current builds no longer include the TCP bridge listener; ",(0,i.jsx)(n.code,{children:"bridge.*"})," config keys are ignored.\nNodes connect over the Gateway WebSocket. This section is kept for historical reference."]}),"\n",(0,i.jsx)(n.p,{children:"Legacy behavior:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The Gateway could expose a simple TCP bridge for nodes (iOS/Android), typically on port ",(0,i.jsx)(n.code,{children:"18790"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Defaults:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["enabled: ",(0,i.jsx)(n.code,{children:"true"})]}),"\n",(0,i.jsxs)(n.li,{children:["port: ",(0,i.jsx)(n.code,{children:"18790"})]}),"\n",(0,i.jsxs)(n.li,{children:["bind: ",(0,i.jsx)(n.code,{children:"lan"})," (binds to ",(0,i.jsx)(n.code,{children:"0.0.0.0"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Bind modes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"lan"}),": ",(0,i.jsx)(n.code,{children:"0.0.0.0"})," (reachable on any interface, including LAN/Wi\u2011Fi and Tailscale)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tailnet"}),": bind only to the machine\u2019s Tailscale IP (recommended for Vienna \u21c4 London)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"loopback"}),": ",(0,i.jsx)(n.code,{children:"127.0.0.1"})," (local only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"auto"}),": prefer tailnet IP if present, else ",(0,i.jsx)(n.code,{children:"lan"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"TLS:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bridge.tls.enabled"}),": enable TLS for bridge connections (TLS-only when enabled)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bridge.tls.autoGenerate"}),": generate a self-signed cert when no cert/key are present (default: true)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bridge.tls.certPath"})," / ",(0,i.jsx)(n.code,{children:"bridge.tls.keyPath"}),": PEM paths for the bridge certificate + private key."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bridge.tls.caPath"}),": optional PEM CA bundle (custom roots or future mTLS)."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["When TLS is enabled, the Gateway advertises ",(0,i.jsx)(n.code,{children:"bridgeTls=1"})," and ",(0,i.jsx)(n.code,{children:"bridgeTlsSha256"})," in discovery TXT\nrecords so nodes can pin the certificate. Manual connections use trust-on-first-use if no\nfingerprint is stored yet.\nAuto-generated certs require ",(0,i.jsx)(n.code,{children:"openssl"})," on PATH; if generation fails, the bridge will not start."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  bridge: {\n    enabled: true,\n    port: 18790,\n    bind: "tailnet",\n    tls: {\n      enabled: true,\n      // Uses ~/.clawdbot/bridge/tls/bridge-{cert,key}.pem when omitted.\n      // certPath: "~/.clawdbot/bridge/tls/bridge-cert.pem",\n      // keyPath: "~/.clawdbot/bridge/tls/bridge-key.pem"\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"discoverymdns-bonjour--mdns-broadcast-mode",children:[(0,i.jsx)(n.code,{children:"discovery.mdns"})," (Bonjour / mDNS broadcast mode)"]}),"\n",(0,i.jsxs)(n.p,{children:["Controls LAN mDNS discovery broadcasts (",(0,i.jsx)(n.code,{children:"_moltbot-gw._tcp"}),")."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"minimal"})," (default): omit ",(0,i.jsx)(n.code,{children:"cliPath"})," + ",(0,i.jsx)(n.code,{children:"sshPort"})," from TXT records"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"full"}),": include ",(0,i.jsx)(n.code,{children:"cliPath"})," + ",(0,i.jsx)(n.code,{children:"sshPort"})," in TXT records"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"off"}),": disable mDNS broadcasts entirely"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:'{\n  discovery: { mdns: { mode: "minimal" } }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"discoverywidearea-wide-area-bonjour--unicast-dnssd",children:[(0,i.jsx)(n.code,{children:"discovery.wideArea"})," (Wide-Area Bonjour / unicast DNS\u2011SD)"]}),"\n",(0,i.jsxs)(n.p,{children:["When enabled, the Gateway writes a unicast DNS-SD zone for ",(0,i.jsx)(n.code,{children:"_moltbot-bridge._tcp"})," under ",(0,i.jsx)(n.code,{children:"~/.clawdbot/dns/"})," using the standard discovery domain ",(0,i.jsx)(n.code,{children:"moltbot.internal."})]}),"\n",(0,i.jsx)(n.p,{children:"To make iOS/Android discover across networks (Vienna \u21c4 London), pair this with:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["a DNS server on the gateway host serving ",(0,i.jsx)(n.code,{children:"moltbot.internal."})," (CoreDNS is recommended)"]}),"\n",(0,i.jsxs)(n.li,{children:["Tailscale ",(0,i.jsx)(n.strong,{children:"split DNS"})," so clients resolve ",(0,i.jsx)(n.code,{children:"moltbot.internal"})," via that server"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"One-time setup helper (gateway host):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"moltbot dns setup --apply\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  discovery: { wideArea: { enabled: true } }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"template-variables-1",children:"Template variables"}),"\n",(0,i.jsxs)(n.p,{children:["Template placeholders are expanded in ",(0,i.jsx)(n.code,{children:"tools.media.*.models[].args"})," and ",(0,i.jsx)(n.code,{children:"tools.media.models[].args"})," (and any future templated argument fields)."]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{Body}}"})}),(0,i.jsx)(n.td,{children:"Full inbound message body"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{RawBody}}"})}),(0,i.jsx)(n.td,{children:"Raw inbound message body (no history/sender wrappers; best for command parsing)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{BodyStripped}}"})}),(0,i.jsx)(n.td,{children:"Body with group mentions stripped (best default for agents)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{From}}"})}),(0,i.jsx)(n.td,{children:"Sender identifier (E.164 for WhatsApp; may differ per channel)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{To}}"})}),(0,i.jsx)(n.td,{children:"Destination identifier"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{MessageSid}}"})}),(0,i.jsx)(n.td,{children:"Channel message id (when available)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{SessionId}}"})}),(0,i.jsx)(n.td,{children:"Current session UUID"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{IsNewSession}}"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"true"'})," when a new session was created"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{MediaUrl}}"})}),(0,i.jsx)(n.td,{children:"Inbound media pseudo-URL (if present)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{MediaPath}}"})}),(0,i.jsx)(n.td,{children:"Local media path (if downloaded)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{MediaType}}"})}),(0,i.jsx)(n.td,{children:"Media type (image/audio/document/\u2026)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{Transcript}}"})}),(0,i.jsx)(n.td,{children:"Audio transcript (when enabled)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{Prompt}}"})}),(0,i.jsx)(n.td,{children:"Resolved media prompt for CLI entries"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{MaxChars}}"})}),(0,i.jsx)(n.td,{children:"Resolved max output chars for CLI entries"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{ChatType}}"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"direct"'})," or ",(0,i.jsx)(n.code,{children:'"group"'})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{GroupSubject}}"})}),(0,i.jsx)(n.td,{children:"Group subject (best effort)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{GroupMembers}}"})}),(0,i.jsx)(n.td,{children:"Group members preview (best effort)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{SenderName}}"})}),(0,i.jsx)(n.td,{children:"Sender display name (best effort)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{SenderE164}}"})}),(0,i.jsx)(n.td,{children:"Sender phone number (best effort)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{{Provider}}"})}),(0,i.jsx)(n.td,{children:"Provider hint (whatsapp"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"cron-gateway-scheduler",children:"Cron (Gateway scheduler)"}),"\n",(0,i.jsxs)(n.p,{children:["Cron is a Gateway-owned scheduler for wakeups and scheduled jobs. See ",(0,i.jsx)(n.a,{href:"/automation/cron-jobs",children:"Cron jobs"})," for the feature overview and CLI examples."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json5",children:"{\n  cron: {\n    enabled: true,\n    maxConcurrentRuns: 2\n  }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.em,{children:["Next: ",(0,i.jsx)(n.a,{href:"/concepts/agent",children:"Agent Runtime"})]})," \ud83e\udd9e"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},28453(e,n,s){s.d(n,{R:()=>d,x:()=>r});var l=s(96540);const i={},o=l.createContext(i);function d(e){const n=l.useContext(o);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);