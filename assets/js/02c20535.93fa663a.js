"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[7403],{99879(e,o,s){s.r(o),s.d(o,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"gateway/sandbox-vs-tool-policy-vs-elevated","title":"Sandbox vs Tool Policy vs Elevated","description":"Moltbot has three related (but different) controls:","source":"@site/content/moltbot/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md","sourceDirName":"gateway","slug":"/gateway/sandbox-vs-tool-policy-vs-elevated","permalink":"/moltbot-doc/docs/gateway/sandbox-vs-tool-policy-vs-elevated","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Sandbox vs Tool Policy vs Elevated","summary":"Why a tool is blocked: sandbox runtime, tool allow/deny policy, and elevated exec gates","read_when":"You hit \'sandbox jail\' or see a tool/elevated refusal and want the exact config key to change.","status":"active"}}');var l=s(74848),d=s(28453);const i={title:"Sandbox vs Tool Policy vs Elevated",summary:"Why a tool is blocked: sandbox runtime, tool allow/deny policy, and elevated exec gates",read_when:"You hit 'sandbox jail' or see a tool/elevated refusal and want the exact config key to change.",status:"active"},r="Sandbox vs Tool Policy vs Elevated",c={},t=[{value:"Quick debug",id:"quick-debug",level:2},{value:"Sandbox: where tools run",id:"sandbox-where-tools-run",level:2},{value:"Bind mounts (security quick check)",id:"bind-mounts-security-quick-check",level:3},{value:"Tool policy: which tools exist/are callable",id:"tool-policy-which-tools-existare-callable",level:2},{value:"Tool groups (shorthands)",id:"tool-groups-shorthands",level:3},{value:"Elevated: exec-only \u201crun on host\u201d",id:"elevated-exec-only-run-on-host",level:2},{value:"Common \u201csandbox jail\u201d fixes",id:"common-sandbox-jail-fixes",level:2},{value:"\u201cTool X blocked by sandbox tool policy\u201d",id:"tool-x-blocked-by-sandbox-tool-policy",level:3},{value:"\u201cI thought this was main, why is it sandboxed?\u201d",id:"i-thought-this-was-main-why-is-it-sandboxed",level:3}];function a(e){const o={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.header,{children:(0,l.jsx)(o.h1,{id:"sandbox-vs-tool-policy-vs-elevated",children:"Sandbox vs Tool Policy vs Elevated"})}),"\n",(0,l.jsx)(o.p,{children:"Moltbot has three related (but different) controls:"}),"\n",(0,l.jsxs)(o.ol,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Sandbox"})," (",(0,l.jsx)(o.code,{children:"agents.defaults.sandbox.*"})," / ",(0,l.jsx)(o.code,{children:"agents.list[].sandbox.*"}),") decides ",(0,l.jsx)(o.strong,{children:"where tools run"})," (Docker vs host)."]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Tool policy"})," (",(0,l.jsx)(o.code,{children:"tools.*"}),", ",(0,l.jsx)(o.code,{children:"tools.sandbox.tools.*"}),", ",(0,l.jsx)(o.code,{children:"agents.list[].tools.*"}),") decides ",(0,l.jsx)(o.strong,{children:"which tools are available/allowed"}),"."]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Elevated"})," (",(0,l.jsx)(o.code,{children:"tools.elevated.*"}),", ",(0,l.jsx)(o.code,{children:"agents.list[].tools.elevated.*"}),") is an ",(0,l.jsx)(o.strong,{children:"exec-only escape hatch"})," to run on the host when you\u2019re sandboxed."]}),"\n"]}),"\n",(0,l.jsx)(o.h2,{id:"quick-debug",children:"Quick debug"}),"\n",(0,l.jsxs)(o.p,{children:["Use the inspector to see what Moltbot is ",(0,l.jsx)(o.em,{children:"actually"})," doing:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-bash",children:"moltbot sandbox explain\nmoltbot sandbox explain --session agent:main:main\nmoltbot sandbox explain --agent work\nmoltbot sandbox explain --json\n"})}),"\n",(0,l.jsx)(o.p,{children:"It prints:"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsx)(o.li,{children:"effective sandbox mode/scope/workspace access"}),"\n",(0,l.jsx)(o.li,{children:"whether the session is currently sandboxed (main vs non-main)"}),"\n",(0,l.jsx)(o.li,{children:"effective sandbox tool allow/deny (and whether it came from agent/global/default)"}),"\n",(0,l.jsx)(o.li,{children:"elevated gates and fix-it key paths"}),"\n"]}),"\n",(0,l.jsx)(o.h2,{id:"sandbox-where-tools-run",children:"Sandbox: where tools run"}),"\n",(0,l.jsxs)(o.p,{children:["Sandboxing is controlled by ",(0,l.jsx)(o.code,{children:"agents.defaults.sandbox.mode"}),":"]}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:'"off"'}),": everything runs on the host."]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:'"non-main"'}),": only non-main sessions are sandboxed (common \u201csurprise\u201d for groups/channels)."]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:'"all"'}),": everything is sandboxed."]}),"\n"]}),"\n",(0,l.jsxs)(o.p,{children:["See ",(0,l.jsx)(o.a,{href:"/gateway/sandboxing",children:"Sandboxing"})," for the full matrix (scope, workspace mounts, images)."]}),"\n",(0,l.jsx)(o.h3,{id:"bind-mounts-security-quick-check",children:"Bind mounts (security quick check)"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"docker.binds"})," ",(0,l.jsx)(o.em,{children:"pierces"})," the sandbox filesystem: whatever you mount is visible inside the container with the mode you set (",(0,l.jsx)(o.code,{children:":ro"})," or ",(0,l.jsx)(o.code,{children:":rw"}),")."]}),"\n",(0,l.jsxs)(o.li,{children:["Default is read-write if you omit the mode; prefer ",(0,l.jsx)(o.code,{children:":ro"})," for source/secrets."]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:'scope: "shared"'})," ignores per-agent binds (only global binds apply)."]}),"\n",(0,l.jsxs)(o.li,{children:["Binding ",(0,l.jsx)(o.code,{children:"/var/run/docker.sock"})," effectively hands host control to the sandbox; only do this intentionally."]}),"\n",(0,l.jsxs)(o.li,{children:["Workspace access (",(0,l.jsx)(o.code,{children:'workspaceAccess: "ro"'}),"/",(0,l.jsx)(o.code,{children:'"rw"'}),") is independent of bind modes."]}),"\n"]}),"\n",(0,l.jsx)(o.h2,{id:"tool-policy-which-tools-existare-callable",children:"Tool policy: which tools exist/are callable"}),"\n",(0,l.jsx)(o.p,{children:"Two layers matter:"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Tool profile"}),": ",(0,l.jsx)(o.code,{children:"tools.profile"})," and ",(0,l.jsx)(o.code,{children:"agents.list[].tools.profile"})," (base allowlist)"]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Provider tool profile"}),": ",(0,l.jsx)(o.code,{children:"tools.byProvider[provider].profile"})," and ",(0,l.jsx)(o.code,{children:"agents.list[].tools.byProvider[provider].profile"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Global/per-agent tool policy"}),": ",(0,l.jsx)(o.code,{children:"tools.allow"}),"/",(0,l.jsx)(o.code,{children:"tools.deny"})," and ",(0,l.jsx)(o.code,{children:"agents.list[].tools.allow"}),"/",(0,l.jsx)(o.code,{children:"agents.list[].tools.deny"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Provider tool policy"}),": ",(0,l.jsx)(o.code,{children:"tools.byProvider[provider].allow/deny"})," and ",(0,l.jsx)(o.code,{children:"agents.list[].tools.byProvider[provider].allow/deny"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.strong,{children:"Sandbox tool policy"})," (only applies when sandboxed): ",(0,l.jsx)(o.code,{children:"tools.sandbox.tools.allow"}),"/",(0,l.jsx)(o.code,{children:"tools.sandbox.tools.deny"})," and ",(0,l.jsx)(o.code,{children:"agents.list[].tools.sandbox.tools.*"})]}),"\n"]}),"\n",(0,l.jsx)(o.p,{children:"Rules of thumb:"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"deny"})," always wins."]}),"\n",(0,l.jsxs)(o.li,{children:["If ",(0,l.jsx)(o.code,{children:"allow"})," is non-empty, everything else is treated as blocked."]}),"\n",(0,l.jsxs)(o.li,{children:["Tool policy is the hard stop: ",(0,l.jsx)(o.code,{children:"/exec"})," cannot override a denied ",(0,l.jsx)(o.code,{children:"exec"})," tool."]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"/exec"})," only changes session defaults for authorized senders; it does not grant tool access.\nProvider tool keys accept either ",(0,l.jsx)(o.code,{children:"provider"})," (e.g. ",(0,l.jsx)(o.code,{children:"google-antigravity"}),") or ",(0,l.jsx)(o.code,{children:"provider/model"})," (e.g. ",(0,l.jsx)(o.code,{children:"openai/gpt-5.2"}),")."]}),"\n"]}),"\n",(0,l.jsx)(o.h3,{id:"tool-groups-shorthands",children:"Tool groups (shorthands)"}),"\n",(0,l.jsxs)(o.p,{children:["Tool policies (global, agent, sandbox) support ",(0,l.jsx)(o.code,{children:"group:*"})," entries that expand to multiple tools:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-json5",children:'{\n  tools: {\n    sandbox: {\n      tools: {\n        allow: ["group:runtime", "group:fs", "group:sessions", "group:memory"]\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(o.p,{children:"Available groups:"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:runtime"}),": ",(0,l.jsx)(o.code,{children:"exec"}),", ",(0,l.jsx)(o.code,{children:"bash"}),", ",(0,l.jsx)(o.code,{children:"process"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:fs"}),": ",(0,l.jsx)(o.code,{children:"read"}),", ",(0,l.jsx)(o.code,{children:"write"}),", ",(0,l.jsx)(o.code,{children:"edit"}),", ",(0,l.jsx)(o.code,{children:"apply_patch"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:sessions"}),": ",(0,l.jsx)(o.code,{children:"sessions_list"}),", ",(0,l.jsx)(o.code,{children:"sessions_history"}),", ",(0,l.jsx)(o.code,{children:"sessions_send"}),", ",(0,l.jsx)(o.code,{children:"sessions_spawn"}),", ",(0,l.jsx)(o.code,{children:"session_status"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:memory"}),": ",(0,l.jsx)(o.code,{children:"memory_search"}),", ",(0,l.jsx)(o.code,{children:"memory_get"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:ui"}),": ",(0,l.jsx)(o.code,{children:"browser"}),", ",(0,l.jsx)(o.code,{children:"canvas"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:automation"}),": ",(0,l.jsx)(o.code,{children:"cron"}),", ",(0,l.jsx)(o.code,{children:"gateway"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:messaging"}),": ",(0,l.jsx)(o.code,{children:"message"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:nodes"}),": ",(0,l.jsx)(o.code,{children:"nodes"})]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"group:moltbot"}),": all built-in Moltbot tools (excludes provider plugins)"]}),"\n"]}),"\n",(0,l.jsx)(o.h2,{id:"elevated-exec-only-run-on-host",children:"Elevated: exec-only \u201crun on host\u201d"}),"\n",(0,l.jsxs)(o.p,{children:["Elevated does ",(0,l.jsx)(o.strong,{children:"not"})," grant extra tools; it only affects ",(0,l.jsx)(o.code,{children:"exec"}),"."]}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:["If you\u2019re sandboxed, ",(0,l.jsx)(o.code,{children:"/elevated on"})," (or ",(0,l.jsx)(o.code,{children:"exec"})," with ",(0,l.jsx)(o.code,{children:"elevated: true"}),") runs on the host (approvals may still apply)."]}),"\n",(0,l.jsxs)(o.li,{children:["Use ",(0,l.jsx)(o.code,{children:"/elevated full"})," to skip exec approvals for the session."]}),"\n",(0,l.jsx)(o.li,{children:"If you\u2019re already running direct, elevated is effectively a no-op (still gated)."}),"\n",(0,l.jsxs)(o.li,{children:["Elevated is ",(0,l.jsx)(o.strong,{children:"not"})," skill-scoped and does ",(0,l.jsx)(o.strong,{children:"not"})," override tool allow/deny."]}),"\n",(0,l.jsxs)(o.li,{children:[(0,l.jsx)(o.code,{children:"/exec"})," is separate from elevated. It only adjusts per-session exec defaults for authorized senders."]}),"\n"]}),"\n",(0,l.jsx)(o.p,{children:"Gates:"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:["Enablement: ",(0,l.jsx)(o.code,{children:"tools.elevated.enabled"})," (and optionally ",(0,l.jsx)(o.code,{children:"agents.list[].tools.elevated.enabled"}),")"]}),"\n",(0,l.jsxs)(o.li,{children:["Sender allowlists: ",(0,l.jsx)(o.code,{children:"tools.elevated.allowFrom.<provider>"})," (and optionally ",(0,l.jsx)(o.code,{children:"agents.list[].tools.elevated.allowFrom.<provider>"}),")"]}),"\n"]}),"\n",(0,l.jsxs)(o.p,{children:["See ",(0,l.jsx)(o.a,{href:"/tools/elevated",children:"Elevated Mode"}),"."]}),"\n",(0,l.jsx)(o.h2,{id:"common-sandbox-jail-fixes",children:"Common \u201csandbox jail\u201d fixes"}),"\n",(0,l.jsx)(o.h3,{id:"tool-x-blocked-by-sandbox-tool-policy",children:"\u201cTool X blocked by sandbox tool policy\u201d"}),"\n",(0,l.jsx)(o.p,{children:"Fix-it keys (pick one):"}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:["Disable sandbox: ",(0,l.jsx)(o.code,{children:"agents.defaults.sandbox.mode=off"})," (or per-agent ",(0,l.jsx)(o.code,{children:"agents.list[].sandbox.mode=off"}),")"]}),"\n",(0,l.jsxs)(o.li,{children:["Allow the tool inside sandbox:\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:["remove it from ",(0,l.jsx)(o.code,{children:"tools.sandbox.tools.deny"})," (or per-agent ",(0,l.jsx)(o.code,{children:"agents.list[].tools.sandbox.tools.deny"}),")"]}),"\n",(0,l.jsxs)(o.li,{children:["or add it to ",(0,l.jsx)(o.code,{children:"tools.sandbox.tools.allow"})," (or per-agent allow)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(o.h3,{id:"i-thought-this-was-main-why-is-it-sandboxed",children:"\u201cI thought this was main, why is it sandboxed?\u201d"}),"\n",(0,l.jsxs)(o.p,{children:["In ",(0,l.jsx)(o.code,{children:'"non-main"'})," mode, group/channel keys are ",(0,l.jsx)(o.em,{children:"not"})," main. Use the main session key (shown by ",(0,l.jsx)(o.code,{children:"sandbox explain"}),") or switch mode to ",(0,l.jsx)(o.code,{children:'"off"'}),"."]})]})}function h(e={}){const{wrapper:o}={...(0,d.R)(),...e.components};return o?(0,l.jsx)(o,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},28453(e,o,s){s.d(o,{R:()=>i,x:()=>r});var n=s(96540);const l={},d=n.createContext(l);function i(e){const o=n.useContext(d);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),n.createElement(d.Provider,{value:o},e.children)}}}]);