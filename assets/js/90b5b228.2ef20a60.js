"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[1549],{69009(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>t,default:()=>g,frontMatter:()=>i,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"gateway/logging","title":"Logging","description":"For a user-facing overview (CLI + Control UI + config), see /logging.","source":"@site/content/moltbot/docs/gateway/logging.md","sourceDirName":"gateway","slug":"/gateway/logging","permalink":"/moltbot-doc/docs/gateway/logging","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Logging surfaces, file logs, WS log styles, and console formatting","read_when":["Changing logging output or formats","Debugging CLI or gateway output"]}}');var o=n(74848),r=n(28453);const i={summary:"Logging surfaces, file logs, WS log styles, and console formatting",read_when:["Changing logging output or formats","Debugging CLI or gateway output"]},t="Logging",c={},d=[{value:"File-based logger",id:"file-based-logger",level:2},{value:"Console capture",id:"console-capture",level:2},{value:"Tool summary redaction",id:"tool-summary-redaction",level:2},{value:"Gateway WebSocket logs",id:"gateway-websocket-logs",level:2},{value:"WS log style",id:"ws-log-style",level:3},{value:"Console formatting (subsystem logging)",id:"console-formatting-subsystem-logging",level:2}];function a(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"logging",children:"Logging"})}),"\n",(0,o.jsxs)(s.p,{children:["For a user-facing overview (CLI + Control UI + config), see ",(0,o.jsx)(s.a,{href:"/logging",children:"/logging"}),"."]}),"\n",(0,o.jsx)(s.p,{children:"Moltbot has two log \u201csurfaces\u201d:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Console output"})," (what you see in the terminal / Debug UI)."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"File logs"})," (JSON lines) written by the gateway logger."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"file-based-logger",children:"File-based logger"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Default rolling log file is under ",(0,o.jsx)(s.code,{children:"/tmp/moltbot/"})," (one file per day): ",(0,o.jsx)(s.code,{children:"moltbot-YYYY-MM-DD.log"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Date uses the gateway host's local timezone."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["The log file path and level can be configured via ",(0,o.jsx)(s.code,{children:"~/.clawdbot/moltbot.json"}),":\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.code,{children:"logging.file"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.code,{children:"logging.level"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"The file format is one JSON object per line."}),"\n",(0,o.jsxs)(s.p,{children:["The Control UI Logs tab tails this file via the gateway (",(0,o.jsx)(s.code,{children:"logs.tail"}),").\nCLI can do the same:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"moltbot logs --follow\n"})}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.strong,{children:"Verbose vs. log levels"})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"File logs"})," are controlled exclusively by ",(0,o.jsx)(s.code,{children:"logging.level"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--verbose"})," only affects ",(0,o.jsx)(s.strong,{children:"console verbosity"})," (and WS log style); it does ",(0,o.jsx)(s.strong,{children:"not"}),"\nraise the file log level."]}),"\n",(0,o.jsxs)(s.li,{children:["To capture verbose-only details in file logs, set ",(0,o.jsx)(s.code,{children:"logging.level"})," to ",(0,o.jsx)(s.code,{children:"debug"})," or\n",(0,o.jsx)(s.code,{children:"trace"}),"."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"console-capture",children:"Console capture"}),"\n",(0,o.jsxs)(s.p,{children:["The CLI captures ",(0,o.jsx)(s.code,{children:"console.log/info/warn/error/debug/trace"})," and writes them to file logs,\nwhile still printing to stdout/stderr."]}),"\n",(0,o.jsx)(s.p,{children:"You can tune console verbosity independently via:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"logging.consoleLevel"})," (default ",(0,o.jsx)(s.code,{children:"info"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"logging.consoleStyle"})," (",(0,o.jsx)(s.code,{children:"pretty"})," | ",(0,o.jsx)(s.code,{children:"compact"})," | ",(0,o.jsx)(s.code,{children:"json"}),")"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"tool-summary-redaction",children:"Tool summary redaction"}),"\n",(0,o.jsxs)(s.p,{children:["Verbose tool summaries (e.g. ",(0,o.jsx)(s.code,{children:"\ud83d\udee0\ufe0f Exec: ..."}),") can mask sensitive tokens before they hit the\nconsole stream. This is ",(0,o.jsx)(s.strong,{children:"tools-only"})," and does not alter file logs."]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"logging.redactSensitive"}),": ",(0,o.jsx)(s.code,{children:"off"})," | ",(0,o.jsx)(s.code,{children:"tools"})," (default: ",(0,o.jsx)(s.code,{children:"tools"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"logging.redactPatterns"}),": array of regex strings (overrides defaults)\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Use raw regex strings (auto ",(0,o.jsx)(s.code,{children:"gi"}),"), or ",(0,o.jsx)(s.code,{children:"/pattern/flags"})," if you need custom flags."]}),"\n",(0,o.jsxs)(s.li,{children:["Matches are masked by keeping the first 6 + last 4 chars (length >= 18), otherwise ",(0,o.jsx)(s.code,{children:"***"}),"."]}),"\n",(0,o.jsx)(s.li,{children:"Defaults cover common key assignments, CLI flags, JSON fields, bearer headers, PEM blocks, and popular token prefixes."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"gateway-websocket-logs",children:"Gateway WebSocket logs"}),"\n",(0,o.jsx)(s.p,{children:"The gateway prints WebSocket protocol logs in two modes:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsxs)(s.strong,{children:["Normal mode (no ",(0,o.jsx)(s.code,{children:"--verbose"}),")"]}),": only \u201cinteresting\u201d RPC results are printed:\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["errors (",(0,o.jsx)(s.code,{children:"ok=false"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:["slow calls (default threshold: ",(0,o.jsx)(s.code,{children:">= 50ms"}),")"]}),"\n",(0,o.jsx)(s.li,{children:"parse errors"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsxs)(s.strong,{children:["Verbose mode (",(0,o.jsx)(s.code,{children:"--verbose"}),")"]}),": prints all WS request/response traffic."]}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"ws-log-style",children:"WS log style"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"moltbot gateway"})," supports a per-gateway style switch:"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--ws-log auto"})," (default): normal mode is optimized; verbose mode uses compact output"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--ws-log compact"}),": compact output (paired request/response) when verbose"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--ws-log full"}),": full per-frame output when verbose"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"--compact"}),": alias for ",(0,o.jsx)(s.code,{children:"--ws-log compact"})]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Examples:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# optimized (only errors/slow)\nmoltbot gateway\n\n# show all WS traffic (paired)\nmoltbot gateway --verbose --ws-log compact\n\n# show all WS traffic (full meta)\nmoltbot gateway --verbose --ws-log full\n"})}),"\n",(0,o.jsx)(s.h2,{id:"console-formatting-subsystem-logging",children:"Console formatting (subsystem logging)"}),"\n",(0,o.jsxs)(s.p,{children:["The console formatter is ",(0,o.jsx)(s.strong,{children:"TTY-aware"})," and prints consistent, prefixed lines.\nSubsystem loggers keep output grouped and scannable."]}),"\n",(0,o.jsx)(s.p,{children:"Behavior:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Subsystem prefixes"})," on every line (e.g. ",(0,o.jsx)(s.code,{children:"[gateway]"}),", ",(0,o.jsx)(s.code,{children:"[canvas]"}),", ",(0,o.jsx)(s.code,{children:"[tailscale]"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Subsystem colors"})," (stable per subsystem) plus level coloring"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Color when output is a TTY or the environment looks like a rich terminal"})," (",(0,o.jsx)(s.code,{children:"TERM"}),"/",(0,o.jsx)(s.code,{children:"COLORTERM"}),"/",(0,o.jsx)(s.code,{children:"TERM_PROGRAM"}),"), respects ",(0,o.jsx)(s.code,{children:"NO_COLOR"})]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Shortened subsystem prefixes"}),": drops leading ",(0,o.jsx)(s.code,{children:"gateway/"})," + ",(0,o.jsx)(s.code,{children:"channels/"}),", keeps last 2 segments (e.g. ",(0,o.jsx)(s.code,{children:"whatsapp/outbound"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Sub-loggers by subsystem"})," (auto prefix + structured field ",(0,o.jsx)(s.code,{children:"{ subsystem }"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:(0,o.jsx)(s.code,{children:"logRaw()"})})," for QR/UX output (no prefix, no formatting)"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Console styles"})," (e.g. ",(0,o.jsx)(s.code,{children:"pretty | compact | json"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Console log level"})," separate from file log level (file keeps full detail when ",(0,o.jsx)(s.code,{children:"logging.level"})," is set to ",(0,o.jsx)(s.code,{children:"debug"}),"/",(0,o.jsx)(s.code,{children:"trace"}),")"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"WhatsApp message bodies"})," are logged at ",(0,o.jsx)(s.code,{children:"debug"})," (use ",(0,o.jsx)(s.code,{children:"--verbose"})," to see them)"]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"This keeps existing file logs stable while making interactive output scannable."})]})}function g(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},28453(e,s,n){n.d(s,{R:()=>i,x:()=>t});var l=n(96540);const o={},r=l.createContext(o);function i(e){const s=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),l.createElement(r.Provider,{value:s},e.children)}}}]);