"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[175],{82906(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"debug/node-issue","title":"Node + tsx \\"__name is not a function\\" crash","description":"Summary","source":"@site/content/moltbot/docs/debug/node-issue.md","sourceDirName":"debug","slug":"/debug/node-issue","permalink":"/moltbot-doc/docs/debug/node-issue","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Node + tsx \\"__name is not a function\\" crash notes and workarounds","read_when":["Debugging Node-only dev scripts or watch mode failures","Investigating tsx/esbuild loader crashes in Moltbot"]}}');var r=s(74848),o=s(28453);const t={summary:'Node + tsx "__name is not a function" crash notes and workarounds',read_when:["Debugging Node-only dev scripts or watch mode failures","Investigating tsx/esbuild loader crashes in Moltbot"]},d='Node + tsx "__name is not a function" crash',l={},c=[{value:"Summary",id:"summary",level:2},{value:"Environment",id:"environment",level:2},{value:"Repro (Node-only)",id:"repro-node-only",level:2},{value:"Minimal repro in repo",id:"minimal-repro-in-repo",level:2},{value:"Node version check",id:"node-version-check",level:2},{value:"Notes / hypothesis",id:"notes--hypothesis",level:2},{value:"Regression history",id:"regression-history",level:2},{value:"Workarounds",id:"workarounds",level:2},{value:"References",id:"references",level:2},{value:"Next steps",id:"next-steps",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"node--tsx-__name-is-not-a-function-crash",children:'Node + tsx "__name is not a function" crash'})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:["Running Moltbot via Node with ",(0,r.jsx)(n.code,{children:"tsx"})," fails at startup with:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[moltbot] Failed to start CLI: TypeError: __name is not a function\n    at createSubsystemLogger (.../src/logging/subsystem.ts:203:25)\n    at .../src/agents/auth-profiles/constants.ts:25:20\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This began after switching dev scripts from Bun to ",(0,r.jsx)(n.code,{children:"tsx"})," (commit ",(0,r.jsx)(n.code,{children:"2871657e"}),", 2026-01-06). The same runtime path worked with Bun."]}),"\n",(0,r.jsx)(n.h2,{id:"environment",children:"Environment"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node: v25.x (observed on v25.3.0)"}),"\n",(0,r.jsx)(n.li,{children:"tsx: 4.21.0"}),"\n",(0,r.jsx)(n.li,{children:"OS: macOS (repro also likely on other platforms that run Node 25)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"repro-node-only",children:"Repro (Node-only)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# in repo root\nnode --version\npnpm install\nnode --import tsx src/entry.ts status\n"})}),"\n",(0,r.jsx)(n.h2,{id:"minimal-repro-in-repo",children:"Minimal repro in repo"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"node --import tsx scripts/repro/tsx-name-repro.ts\n"})}),"\n",(0,r.jsx)(n.h2,{id:"node-version-check",children:"Node version check"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node 25.3.0: fails"}),"\n",(0,r.jsxs)(n.li,{children:["Node 22.22.0 (Homebrew ",(0,r.jsx)(n.code,{children:"node@22"}),"): fails"]}),"\n",(0,r.jsx)(n.li,{children:"Node 24: not installed here yet; needs verification"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"notes--hypothesis",children:"Notes / hypothesis"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tsx"})," uses esbuild to transform TS/ESM. esbuild\u2019s ",(0,r.jsx)(n.code,{children:"keepNames"})," emits a ",(0,r.jsx)(n.code,{children:"__name"})," helper and wraps function definitions with ",(0,r.jsx)(n.code,{children:"__name(...)"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The crash indicates ",(0,r.jsx)(n.code,{children:"__name"})," exists but is not a function at runtime, which implies the helper is missing or overwritten for this module in the Node 25 loader path."]}),"\n",(0,r.jsxs)(n.li,{children:["Similar ",(0,r.jsx)(n.code,{children:"__name"})," helper issues have been reported in other esbuild consumers when the helper is missing or rewritten."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"regression-history",children:"Regression history"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"2871657e"})," (2026-01-06): scripts changed from Bun to tsx to make Bun optional."]}),"\n",(0,r.jsxs)(n.li,{children:["Before that (Bun path), ",(0,r.jsx)(n.code,{children:"moltbot status"})," and ",(0,r.jsx)(n.code,{children:"gateway:watch"})," worked."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"workarounds",children:"Workarounds"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use Bun for dev scripts (current temporary revert)."}),"\n",(0,r.jsxs)(n.li,{children:["Use Node + tsc watch, then run compiled output:\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm exec tsc --watch --preserveWatchOutput\nnode --watch moltbot.mjs status\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Confirmed locally: ",(0,r.jsx)(n.code,{children:"pnpm exec tsc -p tsconfig.json"})," + ",(0,r.jsx)(n.code,{children:"node moltbot.mjs status"})," works on Node 25."]}),"\n",(0,r.jsxs)(n.li,{children:["Disable esbuild keepNames in the TS loader if possible (prevents ",(0,r.jsx)(n.code,{children:"__name"})," helper insertion); tsx does not currently expose this."]}),"\n",(0,r.jsxs)(n.li,{children:["Test Node LTS (22/24) with ",(0,r.jsx)(n.code,{children:"tsx"})," to see if the issue is Node 25\u2013specific."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://opennext.js.org/cloudflare/howtos/keep_names",children:"https://opennext.js.org/cloudflare/howtos/keep_names"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://esbuild.github.io/api/#keep-names",children:"https://esbuild.github.io/api/#keep-names"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/evanw/esbuild/issues/1031",children:"https://github.com/evanw/esbuild/issues/1031"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Repro on Node 22/24 to confirm Node 25 regression."}),"\n",(0,r.jsxs)(n.li,{children:["Test ",(0,r.jsx)(n.code,{children:"tsx"})," nightly or pin to earlier version if a known regression exists."]}),"\n",(0,r.jsxs)(n.li,{children:["If reproduces on Node LTS, file a minimal repro upstream with the ",(0,r.jsx)(n.code,{children:"__name"})," stack trace."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>t,x:()=>d});var i=s(96540);const r={},o=i.createContext(r);function t(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);