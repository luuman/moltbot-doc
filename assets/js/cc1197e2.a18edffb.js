"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[9158],{10659(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"experiments/plans/cron-add-hardening","title":"Cron Add Hardening & Schema Alignment","description":"Context","source":"@site/content/moltbot/docs/experiments/plans/cron-add-hardening.md","sourceDirName":"experiments/plans","slug":"/experiments/plans/cron-add-hardening","permalink":"/moltbot-doc/docs/experiments/plans/cron-add-hardening","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Harden cron.add input handling, align schemas, and improve cron UI/agent tooling","owner":"moltbot","status":"complete","last_updated":"2026-01-05"}}');var i=s(74848),o=s(28453);const d={summary:"Harden cron.add input handling, align schemas, and improve cron UI/agent tooling",owner:"moltbot",status:"complete",last_updated:"2026-01-05"},l="Cron Add Hardening & Schema Alignment",a={},c=[{value:"Context",id:"context",level:2},{value:"Goals",id:"goals",level:2},{value:"Non-goals",id:"non-goals",level:2},{value:"Findings (current gaps)",id:"findings-current-gaps",level:2},{value:"What changed",id:"what-changed",level:2},{value:"Current behavior",id:"current-behavior",level:2},{value:"Verification",id:"verification",level:2},{value:"Optional Follow-ups",id:"optional-follow-ups",level:2},{value:"Open Questions",id:"open-questions",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cron-add-hardening--schema-alignment",children:"Cron Add Hardening & Schema Alignment"})}),"\n",(0,i.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,i.jsxs)(n.p,{children:["Recent gateway logs show repeated ",(0,i.jsx)(n.code,{children:"cron.add"})," failures with invalid parameters (missing ",(0,i.jsx)(n.code,{children:"sessionTarget"}),", ",(0,i.jsx)(n.code,{children:"wakeMode"}),", ",(0,i.jsx)(n.code,{children:"payload"}),", and malformed ",(0,i.jsx)(n.code,{children:"schedule"}),"). This indicates that at least one client (likely the agent tool call path) is sending wrapped or partially specified job payloads. Separately, there is drift between cron provider enums in TypeScript, gateway schema, CLI flags, and UI form types, plus a UI mismatch for ",(0,i.jsx)(n.code,{children:"cron.status"})," (expects ",(0,i.jsx)(n.code,{children:"jobCount"})," while gateway returns ",(0,i.jsx)(n.code,{children:"jobs"}),")."]}),"\n",(0,i.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Stop ",(0,i.jsx)(n.code,{children:"cron.add"})," INVALID_REQUEST spam by normalizing common wrapper payloads and inferring missing ",(0,i.jsx)(n.code,{children:"kind"})," fields."]}),"\n",(0,i.jsx)(n.li,{children:"Align cron provider lists across gateway schema, cron types, CLI docs, and UI forms."}),"\n",(0,i.jsx)(n.li,{children:"Make agent cron tool schema explicit so the LLM produces correct job payloads."}),"\n",(0,i.jsx)(n.li,{children:"Fix the Control UI cron status job count display."}),"\n",(0,i.jsx)(n.li,{children:"Add tests to cover normalization and tool behavior."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"non-goals",children:"Non-goals"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Change cron scheduling semantics or job execution behavior."}),"\n",(0,i.jsx)(n.li,{children:"Add new schedule kinds or cron expression parsing."}),"\n",(0,i.jsx)(n.li,{children:"Overhaul the UI/UX for cron beyond the necessary field fixes."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"findings-current-gaps",children:"Findings (current gaps)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CronPayloadSchema"})," in gateway excludes ",(0,i.jsx)(n.code,{children:"signal"})," + ",(0,i.jsx)(n.code,{children:"imessage"}),", while TS types include them."]}),"\n",(0,i.jsxs)(n.li,{children:["Control UI CronStatus expects ",(0,i.jsx)(n.code,{children:"jobCount"}),", but gateway returns ",(0,i.jsx)(n.code,{children:"jobs"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Agent cron tool schema allows arbitrary ",(0,i.jsx)(n.code,{children:"job"})," objects, enabling malformed inputs."]}),"\n",(0,i.jsxs)(n.li,{children:["Gateway strictly validates ",(0,i.jsx)(n.code,{children:"cron.add"})," with no normalization, so wrapped payloads fail."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"what-changed",children:"What changed"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cron.add"})," and ",(0,i.jsx)(n.code,{children:"cron.update"})," now normalize common wrapper shapes and infer missing ",(0,i.jsx)(n.code,{children:"kind"})," fields."]}),"\n",(0,i.jsx)(n.li,{children:"Agent cron tool schema matches the gateway schema, which reduces invalid payloads."}),"\n",(0,i.jsx)(n.li,{children:"Provider enums are aligned across gateway, CLI, UI, and macOS picker."}),"\n",(0,i.jsxs)(n.li,{children:["Control UI uses the gateway\u2019s ",(0,i.jsx)(n.code,{children:"jobs"})," count field for status."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"current-behavior",children:"Current behavior"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Normalization:"})," wrapped ",(0,i.jsx)(n.code,{children:"data"}),"/",(0,i.jsx)(n.code,{children:"job"})," payloads are unwrapped; ",(0,i.jsx)(n.code,{children:"schedule.kind"})," and ",(0,i.jsx)(n.code,{children:"payload.kind"})," are inferred when safe."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Defaults:"})," safe defaults are applied for ",(0,i.jsx)(n.code,{children:"wakeMode"})," and ",(0,i.jsx)(n.code,{children:"sessionTarget"})," when missing."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Providers:"})," Discord/Slack/Signal/iMessage are now consistently surfaced across CLI/UI."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/automation/cron-jobs",children:"Cron jobs"})," for the normalized shape and examples."]}),"\n",(0,i.jsx)(n.h2,{id:"verification",children:"Verification"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Watch gateway logs for reduced ",(0,i.jsx)(n.code,{children:"cron.add"})," INVALID_REQUEST errors."]}),"\n",(0,i.jsx)(n.li,{children:"Confirm Control UI cron status shows job count after refresh."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"optional-follow-ups",children:"Optional Follow-ups"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Manual Control UI smoke: add a cron job per provider + verify status job count."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"open-questions",children:"Open Questions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Should ",(0,i.jsx)(n.code,{children:"cron.add"})," accept explicit ",(0,i.jsx)(n.code,{children:"state"})," from clients (currently disallowed by schema)?"]}),"\n",(0,i.jsxs)(n.li,{children:["Should we allow ",(0,i.jsx)(n.code,{children:"webchat"})," as an explicit delivery provider (currently filtered in delivery resolution)?"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},28453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var r=s(96540);const i={},o=r.createContext(i);function d(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);