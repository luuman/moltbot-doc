"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[4140],{82006(e,n,s){s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"concepts/markdown-formatting","title":"Markdown formatting","description":"Moltbot formats outbound Markdown by converting it into a shared intermediate","source":"@site/content/moltbot/docs/concepts/markdown-formatting.md","sourceDirName":"concepts","slug":"/concepts/markdown-formatting","permalink":"/moltbot-doc/docs/concepts/markdown-formatting","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Markdown formatting pipeline for outbound channels","read_when":["You are changing markdown formatting or chunking for outbound channels","You are adding a new channel formatter or style mapping","You are debugging formatting regressions across channels"]}}');var l=s(74848),i=s(28453);const o={summary:"Markdown formatting pipeline for outbound channels",read_when:["You are changing markdown formatting or chunking for outbound channels","You are adding a new channel formatter or style mapping","You are debugging formatting regressions across channels"]},a="Markdown formatting",t={},d=[{value:"Goals",id:"goals",level:2},{value:"Pipeline",id:"pipeline",level:2},{value:"IR example",id:"ir-example",level:2},{value:"Where it is used",id:"where-it-is-used",level:2},{value:"Table handling",id:"table-handling",level:2},{value:"Chunking rules",id:"chunking-rules",level:2},{value:"Link policy",id:"link-policy",level:2},{value:"Spoilers",id:"spoilers",level:2},{value:"How to add or update a channel formatter",id:"how-to-add-or-update-a-channel-formatter",level:2},{value:"Common gotchas",id:"common-gotchas",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"markdown-formatting",children:"Markdown formatting"})}),"\n",(0,l.jsx)(n.p,{children:"Moltbot formats outbound Markdown by converting it into a shared intermediate\nrepresentation (IR) before rendering channel-specific output. The IR keeps the\nsource text intact while carrying style/link spans so chunking and rendering can\nstay consistent across channels."}),"\n",(0,l.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Consistency:"})," one parse step, multiple renderers."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Safe chunking:"})," split text before rendering so inline formatting never\nbreaks across chunks."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Channel fit:"})," map the same IR to Slack mrkdwn, Telegram HTML, and Signal\nstyle ranges without re-parsing Markdown."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"pipeline",children:"Pipeline"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Parse Markdown -> IR"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"IR is plain text plus style spans (bold/italic/strike/code/spoiler) and link spans."}),"\n",(0,l.jsx)(n.li,{children:"Offsets are UTF-16 code units so Signal style ranges align with its API."}),"\n",(0,l.jsx)(n.li,{children:"Tables are parsed only when a channel opts into table conversion."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Chunk IR (format-first)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Chunking happens on the IR text before rendering."}),"\n",(0,l.jsx)(n.li,{children:"Inline formatting does not split across chunks; spans are sliced per chunk."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Render per channel"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Slack:"})," mrkdwn tokens (bold/italic/strike/code), links as ",(0,l.jsx)(n.code,{children:"<url|label>"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Telegram:"})," HTML tags (",(0,l.jsx)(n.code,{children:"<b>"}),", ",(0,l.jsx)(n.code,{children:"<i>"}),", ",(0,l.jsx)(n.code,{children:"<s>"}),", ",(0,l.jsx)(n.code,{children:"<code>"}),", ",(0,l.jsx)(n.code,{children:"<pre><code>"}),", ",(0,l.jsx)(n.code,{children:"<a href>"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Signal:"})," plain text + ",(0,l.jsx)(n.code,{children:"text-style"})," ranges; links become ",(0,l.jsx)(n.code,{children:"label (url)"})," when label differs."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"ir-example",children:"IR example"}),"\n",(0,l.jsx)(n.p,{children:"Input Markdown:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-markdown",children:"Hello **world** \u2014 see [docs](https://docs.molt.bot).\n"})}),"\n",(0,l.jsx)(n.p,{children:"IR (schematic):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "text": "Hello world \u2014 see docs.",\n  "styles": [\n    { "start": 6, "end": 11, "style": "bold" }\n  ],\n  "links": [\n    { "start": 19, "end": 23, "href": "https://docs.molt.bot" }\n  ]\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"where-it-is-used",children:"Where it is used"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Slack, Telegram, and Signal outbound adapters render from the IR."}),"\n",(0,l.jsx)(n.li,{children:"Other channels (WhatsApp, iMessage, MS Teams, Discord) still use plain text or\ntheir own formatting rules, with Markdown table conversion applied before\nchunking when enabled."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"table-handling",children:"Table handling"}),"\n",(0,l.jsxs)(n.p,{children:["Markdown tables are not consistently supported across chat clients. Use\n",(0,l.jsx)(n.code,{children:"markdown.tables"})," to control conversion per channel (and per account)."]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"code"}),": render tables as code blocks (default for most channels)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"bullets"}),": convert each row into bullet points (default for Signal + WhatsApp)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"off"}),": disable table parsing and conversion; raw table text passes through."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Config keys:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"channels:\n  discord:\n    markdown:\n      tables: code\n    accounts:\n      work:\n        markdown:\n          tables: off\n"})}),"\n",(0,l.jsx)(n.h2,{id:"chunking-rules",children:"Chunking rules"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Chunk limits come from channel adapters/config and are applied to the IR text."}),"\n",(0,l.jsx)(n.li,{children:"Code fences are preserved as a single block with a trailing newline so channels\nrender them correctly."}),"\n",(0,l.jsx)(n.li,{children:"List prefixes and blockquote prefixes are part of the IR text, so chunking\ndoes not split mid-prefix."}),"\n",(0,l.jsx)(n.li,{children:"Inline styles (bold/italic/strike/inline-code/spoiler) are never split across\nchunks; the renderer reopens styles inside each chunk."}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["If you need more on chunking behavior across channels, see\n",(0,l.jsx)(n.a,{href:"/concepts/streaming",children:"Streaming + chunking"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"link-policy",children:"Link policy"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Slack:"})," ",(0,l.jsx)(n.code,{children:"[label](url)"})," -> ",(0,l.jsx)(n.code,{children:"<url|label>"}),"; bare URLs remain bare. Autolink\nis disabled during parse to avoid double-linking."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Telegram:"})," ",(0,l.jsx)(n.code,{children:"[label](url)"})," -> ",(0,l.jsx)(n.code,{children:'<a href="url">label</a>'})," (HTML parse mode)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Signal:"})," ",(0,l.jsx)(n.code,{children:"[label](url)"})," -> ",(0,l.jsx)(n.code,{children:"label (url)"})," unless label matches the URL."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"spoilers",children:"Spoilers"}),"\n",(0,l.jsxs)(n.p,{children:["Spoiler markers (",(0,l.jsx)(n.code,{children:"||spoiler||"}),") are parsed only for Signal, where they map to\nSPOILER style ranges. Other channels treat them as plain text."]}),"\n",(0,l.jsx)(n.h2,{id:"how-to-add-or-update-a-channel-formatter",children:"How to add or update a channel formatter"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Parse once:"})," use the shared ",(0,l.jsx)(n.code,{children:"markdownToIR(...)"})," helper with channel-appropriate\noptions (autolink, heading style, blockquote prefix)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Render:"})," implement a renderer with ",(0,l.jsx)(n.code,{children:"renderMarkdownWithMarkers(...)"})," and a\nstyle marker map (or Signal style ranges)."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Chunk:"})," call ",(0,l.jsx)(n.code,{children:"chunkMarkdownIR(...)"})," before rendering; render each chunk."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Wire adapter:"})," update the channel outbound adapter to use the new chunker\nand renderer."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Test:"})," add or update format tests and an outbound delivery test if the\nchannel uses chunking."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"common-gotchas",children:"Common gotchas"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Slack angle-bracket tokens (",(0,l.jsx)(n.code,{children:"<@U123>"}),", ",(0,l.jsx)(n.code,{children:"<#C123>"}),", ",(0,l.jsx)(n.code,{children:"<https://...>"}),") must be\npreserved; escape raw HTML safely."]}),"\n",(0,l.jsx)(n.li,{children:"Telegram HTML requires escaping text outside tags to avoid broken markup."}),"\n",(0,l.jsx)(n.li,{children:"Signal style ranges depend on UTF-16 offsets; do not use code point offsets."}),"\n",(0,l.jsx)(n.li,{children:"Preserve trailing newlines for fenced code blocks so closing markers land on\ntheir own line."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453(e,n,s){s.d(n,{R:()=>o,x:()=>a});var r=s(96540);const l={},i=r.createContext(l);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);