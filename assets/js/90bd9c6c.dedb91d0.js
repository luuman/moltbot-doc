"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[1619],{8848(e,s,n){n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"channels/imessage","title":"iMessage (imsg)","description":"Status: external CLI integration. Gateway spawns imsg rpc (JSON-RPC over stdio).","source":"@site/content/moltbot/docs/channels/imessage.md","sourceDirName":"channels","slug":"/channels/imessage","permalink":"/moltbot-doc/docs/channels/imessage","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"iMessage support via imsg (JSON-RPC over stdio), setup, and chat_id routing","read_when":["Setting up iMessage support","Debugging iMessage send/receive"]}}');var a=n(74848),t=n(28453);const l={summary:"iMessage support via imsg (JSON-RPC over stdio), setup, and chat_id routing",read_when:["Setting up iMessage support","Debugging iMessage send/receive"]},c="iMessage (imsg)",r={},o=[{value:"Quick setup (beginner)",id:"quick-setup-beginner",level:2},{value:"What it is",id:"what-it-is",level:2},{value:"Config writes",id:"config-writes",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Setup (fast path)",id:"setup-fast-path",level:2},{value:"Dedicated bot macOS user (for isolated identity)",id:"dedicated-bot-macos-user-for-isolated-identity",level:3},{value:"Remote/SSH variant (optional)",id:"remotessh-variant-optional",level:3},{value:"Remote Mac via Tailscale (example)",id:"remote-mac-via-tailscale-example",level:4},{value:"Access control (DMs + groups)",id:"access-control-dms--groups",level:2},{value:"How it works (behavior)",id:"how-it-works-behavior",level:2},{value:"Group-ish threads (<code>is_group=false</code>)",id:"group-ish-threads-is_groupfalse",level:2},{value:"Media + limits",id:"media--limits",level:2},{value:"Limits",id:"limits",level:2},{value:"Addressing / delivery targets",id:"addressing--delivery-targets",level:2},{value:"Configuration reference (iMessage)",id:"configuration-reference-imessage",level:2}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"imessage-imsg",children:"iMessage (imsg)"})}),"\n",(0,a.jsxs)(s.p,{children:["Status: external CLI integration. Gateway spawns ",(0,a.jsx)(s.code,{children:"imsg rpc"})," (JSON-RPC over stdio)."]}),"\n",(0,a.jsx)(s.h2,{id:"quick-setup-beginner",children:"Quick setup (beginner)"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Ensure Messages is signed in on this Mac."}),"\n",(0,a.jsxs)(s.li,{children:["Install ",(0,a.jsx)(s.code,{children:"imsg"}),":\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"brew install steipete/tap/imsg"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["Configure Moltbot with ",(0,a.jsx)(s.code,{children:"channels.imessage.cliPath"})," and ",(0,a.jsx)(s.code,{children:"channels.imessage.dbPath"}),"."]}),"\n",(0,a.jsx)(s.li,{children:"Start the gateway and approve any macOS prompts (Automation + Full Disk Access)."}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Minimal config:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json5",children:'{\n  channels: {\n    imessage: {\n      enabled: true,\n      cliPath: "/usr/local/bin/imsg",\n      dbPath: "/Users/<you>/Library/Messages/chat.db"\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(s.h2,{id:"what-it-is",children:"What it is"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["iMessage channel backed by ",(0,a.jsx)(s.code,{children:"imsg"})," on macOS."]}),"\n",(0,a.jsx)(s.li,{children:"Deterministic routing: replies always go back to iMessage."}),"\n",(0,a.jsxs)(s.li,{children:["DMs share the agent's main session; groups are isolated (",(0,a.jsx)(s.code,{children:"agent:<agentId>:imessage:group:<chat_id>"}),")."]}),"\n",(0,a.jsxs)(s.li,{children:["If a multi-participant thread arrives with ",(0,a.jsx)(s.code,{children:"is_group=false"}),", you can still isolate it by ",(0,a.jsx)(s.code,{children:"chat_id"})," using ",(0,a.jsx)(s.code,{children:"channels.imessage.groups"})," (see \u201cGroup-ish threads\u201d below)."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"config-writes",children:"Config writes"}),"\n",(0,a.jsxs)(s.p,{children:["By default, iMessage is allowed to write config updates triggered by ",(0,a.jsx)(s.code,{children:"/config set|unset"})," (requires ",(0,a.jsx)(s.code,{children:"commands.config: true"}),")."]}),"\n",(0,a.jsx)(s.p,{children:"Disable with:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json5",children:"{\n  channels: { imessage: { configWrites: false } }\n}\n"})}),"\n",(0,a.jsx)(s.h2,{id:"requirements",children:"Requirements"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"macOS with Messages signed in."}),"\n",(0,a.jsxs)(s.li,{children:["Full Disk Access for Moltbot + ",(0,a.jsx)(s.code,{children:"imsg"})," (Messages DB access)."]}),"\n",(0,a.jsx)(s.li,{children:"Automation permission when sending."}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.cliPath"})," can point to any command that proxies stdin/stdout (for example, a wrapper script that SSHes to another Mac and runs ",(0,a.jsx)(s.code,{children:"imsg rpc"}),")."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"setup-fast-path",children:"Setup (fast path)"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Ensure Messages is signed in on this Mac."}),"\n",(0,a.jsx)(s.li,{children:"Configure iMessage and start the gateway."}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"dedicated-bot-macos-user-for-isolated-identity",children:"Dedicated bot macOS user (for isolated identity)"}),"\n",(0,a.jsxs)(s.p,{children:["If you want the bot to send from a ",(0,a.jsx)(s.strong,{children:"separate iMessage identity"})," (and keep your personal Messages clean), use a dedicated Apple ID + a dedicated macOS user."]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Create a dedicated Apple ID (example: ",(0,a.jsx)(s.code,{children:"my-cool-bot@icloud.com"}),").\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Apple may require a phone number for verification / 2FA."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["Create a macOS user (example: ",(0,a.jsx)(s.code,{children:"clawdshome"}),") and sign into it."]}),"\n",(0,a.jsx)(s.li,{children:"Open Messages in that macOS user and sign into iMessage using the bot Apple ID."}),"\n",(0,a.jsx)(s.li,{children:"Enable Remote Login (System Settings \u2192 General \u2192 Sharing \u2192 Remote Login)."}),"\n",(0,a.jsxs)(s.li,{children:["Install ",(0,a.jsx)(s.code,{children:"imsg"}),":\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"brew install steipete/tap/imsg"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["Set up SSH so ",(0,a.jsx)(s.code,{children:"ssh <bot-macos-user>@localhost true"})," works without a password."]}),"\n",(0,a.jsxs)(s.li,{children:["Point ",(0,a.jsx)(s.code,{children:"channels.imessage.accounts.bot.cliPath"})," at an SSH wrapper that runs ",(0,a.jsx)(s.code,{children:"imsg"})," as the bot user."]}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["First-run note: sending/receiving may require GUI approvals (Automation + Full Disk Access) in the ",(0,a.jsx)(s.em,{children:"bot macOS user"}),". If ",(0,a.jsx)(s.code,{children:"imsg rpc"})," looks stuck or exits, log into that user (Screen Sharing helps), run a one-time ",(0,a.jsx)(s.code,{children:"imsg chats --limit 1"})," / ",(0,a.jsx)(s.code,{children:"imsg send ..."}),", approve prompts, then retry."]}),"\n",(0,a.jsxs)(s.p,{children:["Example wrapper (",(0,a.jsx)(s.code,{children:"chmod +x"}),"). Replace ",(0,a.jsx)(s.code,{children:"<bot-macos-user>"})," with your actual macOS username:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'#!/usr/bin/env bash\nset -euo pipefail\n\n# Run an interactive SSH once first to accept host keys:\n#   ssh <bot-macos-user>@localhost true\nexec /usr/bin/ssh -o BatchMode=yes -o ConnectTimeout=5 -T <bot-macos-user>@localhost \\\n  "/usr/local/bin/imsg" "$@"\n'})}),"\n",(0,a.jsx)(s.p,{children:"Example config:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json5",children:'{\n  channels: {\n    imessage: {\n      enabled: true,\n      accounts: {\n        bot: {\n          name: "Bot",\n          enabled: true,\n          cliPath: "/path/to/imsg-bot",\n          dbPath: "/Users/<bot-macos-user>/Library/Messages/chat.db"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(s.p,{children:["For single-account setups, use flat options (",(0,a.jsx)(s.code,{children:"channels.imessage.cliPath"}),", ",(0,a.jsx)(s.code,{children:"channels.imessage.dbPath"}),") instead of the ",(0,a.jsx)(s.code,{children:"accounts"})," map."]}),"\n",(0,a.jsx)(s.h3,{id:"remotessh-variant-optional",children:"Remote/SSH variant (optional)"}),"\n",(0,a.jsxs)(s.p,{children:["If you want iMessage on another Mac, set ",(0,a.jsx)(s.code,{children:"channels.imessage.cliPath"})," to a wrapper that runs ",(0,a.jsx)(s.code,{children:"imsg"})," on the remote macOS host over SSH. Moltbot only needs stdio."]}),"\n",(0,a.jsx)(s.p,{children:"Example wrapper:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'#!/usr/bin/env bash\nexec ssh -T gateway-host imsg "$@"\n'})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Remote attachments:"})," When ",(0,a.jsx)(s.code,{children:"cliPath"})," points to a remote host via SSH, attachment paths in the Messages database reference files on the remote machine. Moltbot can automatically fetch these over SCP by setting ",(0,a.jsx)(s.code,{children:"channels.imessage.remoteHost"}),":"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json5",children:'{\n  channels: {\n    imessage: {\n      cliPath: "~/imsg-ssh",                     // SSH wrapper to remote Mac\n      remoteHost: "user@gateway-host",           // for SCP file transfer\n      includeAttachments: true\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(s.p,{children:["If ",(0,a.jsx)(s.code,{children:"remoteHost"})," is not set, Moltbot attempts to auto-detect it by parsing the SSH command in your wrapper script. Explicit configuration is recommended for reliability."]}),"\n",(0,a.jsx)(s.h4,{id:"remote-mac-via-tailscale-example",children:"Remote Mac via Tailscale (example)"}),"\n",(0,a.jsxs)(s.p,{children:["If the Gateway runs on a Linux host/VM but iMessage must run on a Mac, Tailscale is the simplest bridge: the Gateway talks to the Mac over the tailnet, runs ",(0,a.jsx)(s.code,{children:"imsg"})," via SSH, and SCPs attachments back."]}),"\n",(0,a.jsx)(s.p,{children:"Architecture:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          SSH (imsg rpc)          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Gateway host (Linux/VM)      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Mac with Messages + imsg \u2502\n\u2502 - moltbot gateway           \u2502          SCP (attachments)        \u2502 - Messages signed in     \u2502\n\u2502 - channels.imessage.cliPath  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502 - Remote Login enabled   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u25b2\n              \u2502 Tailscale tailnet (hostname or 100.x.y.z)\n              \u25bc\n        user@gateway-host\n"})}),"\n",(0,a.jsx)(s.p,{children:"Concrete config example (Tailscale hostname):"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json5",children:'{\n  channels: {\n    imessage: {\n      enabled: true,\n      cliPath: "~/.clawdbot/scripts/imsg-ssh",\n      remoteHost: "bot@mac-mini.tailnet-1234.ts.net",\n      includeAttachments: true,\n      dbPath: "/Users/bot/Library/Messages/chat.db"\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(s.p,{children:["Example wrapper (",(0,a.jsx)(s.code,{children:"~/.clawdbot/scripts/imsg-ssh"}),"):"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'#!/usr/bin/env bash\nexec ssh -T bot@mac-mini.tailnet-1234.ts.net imsg "$@"\n'})}),"\n",(0,a.jsx)(s.p,{children:"Notes:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Ensure the Mac is signed in to Messages, and Remote Login is enabled."}),"\n",(0,a.jsxs)(s.li,{children:["Use SSH keys so ",(0,a.jsx)(s.code,{children:"ssh bot@mac-mini.tailnet-1234.ts.net"})," works without prompts."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"remoteHost"})," should match the SSH target so SCP can fetch attachments."]}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["Multi-account support: use ",(0,a.jsx)(s.code,{children:"channels.imessage.accounts"})," with per-account config and optional ",(0,a.jsx)(s.code,{children:"name"}),". See ",(0,a.jsx)(s.a,{href:"/gateway/configuration#telegramaccounts--discordaccounts--slackaccounts--signalaccounts--imessageaccounts",children:(0,a.jsx)(s.code,{children:"gateway/configuration"})})," for the shared pattern. Don't commit ",(0,a.jsx)(s.code,{children:"~/.clawdbot/moltbot.json"})," (it often contains tokens)."]}),"\n",(0,a.jsx)(s.h2,{id:"access-control-dms--groups",children:"Access control (DMs + groups)"}),"\n",(0,a.jsx)(s.p,{children:"DMs:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Default: ",(0,a.jsx)(s.code,{children:'channels.imessage.dmPolicy = "pairing"'}),"."]}),"\n",(0,a.jsx)(s.li,{children:"Unknown senders receive a pairing code; messages are ignored until approved (codes expire after 1 hour)."}),"\n",(0,a.jsxs)(s.li,{children:["Approve via:\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"moltbot pairing list imessage"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"moltbot pairing approve imessage <CODE>"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["Pairing is the default token exchange for iMessage DMs. Details: ",(0,a.jsx)(s.a,{href:"/start/pairing",children:"Pairing"})]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Groups:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.groupPolicy = open | allowlist | disabled"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.groupAllowFrom"})," controls who can trigger in groups when ",(0,a.jsx)(s.code,{children:"allowlist"})," is set."]}),"\n",(0,a.jsxs)(s.li,{children:["Mention gating uses ",(0,a.jsx)(s.code,{children:"agents.list[].groupChat.mentionPatterns"})," (or ",(0,a.jsx)(s.code,{children:"messages.groupChat.mentionPatterns"}),") because iMessage has no native mention metadata."]}),"\n",(0,a.jsxs)(s.li,{children:["Multi-agent override: set per-agent patterns on ",(0,a.jsx)(s.code,{children:"agents.list[].groupChat.mentionPatterns"}),"."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"how-it-works-behavior",children:"How it works (behavior)"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"imsg"})," streams message events; the gateway normalizes them into the shared channel envelope."]}),"\n",(0,a.jsx)(s.li,{children:"Replies always route back to the same chat id or handle."}),"\n"]}),"\n",(0,a.jsxs)(s.h2,{id:"group-ish-threads-is_groupfalse",children:["Group-ish threads (",(0,a.jsx)(s.code,{children:"is_group=false"}),")"]}),"\n",(0,a.jsxs)(s.p,{children:["Some iMessage threads can have multiple participants but still arrive with ",(0,a.jsx)(s.code,{children:"is_group=false"})," depending on how Messages stores the chat identifier."]}),"\n",(0,a.jsxs)(s.p,{children:["If you explicitly configure a ",(0,a.jsx)(s.code,{children:"chat_id"})," under ",(0,a.jsx)(s.code,{children:"channels.imessage.groups"}),", Moltbot treats that thread as a \u201cgroup\u201d for:"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["session isolation (separate ",(0,a.jsx)(s.code,{children:"agent:<agentId>:imessage:group:<chat_id>"})," session key)"]}),"\n",(0,a.jsx)(s.li,{children:"group allowlisting / mention gating behavior"}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Example:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json5",children:'{\n  channels: {\n    imessage: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["+15555550123"],\n      groups: {\n        "42": { "requireMention": false }\n      }\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(s.p,{children:["This is useful when you want an isolated personality/model for a specific thread (see ",(0,a.jsx)(s.a,{href:"/concepts/multi-agent",children:"Multi-agent routing"}),"). For filesystem isolation, see ",(0,a.jsx)(s.a,{href:"/gateway/sandboxing",children:"Sandboxing"}),"."]}),"\n",(0,a.jsx)(s.h2,{id:"media--limits",children:"Media + limits"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Optional attachment ingestion via ",(0,a.jsx)(s.code,{children:"channels.imessage.includeAttachments"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:["Media cap via ",(0,a.jsx)(s.code,{children:"channels.imessage.mediaMaxMb"}),"."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"limits",children:"Limits"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Outbound text is chunked to ",(0,a.jsx)(s.code,{children:"channels.imessage.textChunkLimit"})," (default 4000)."]}),"\n",(0,a.jsxs)(s.li,{children:["Optional newline chunking: set ",(0,a.jsx)(s.code,{children:'channels.imessage.chunkMode="newline"'})," to split on blank lines (paragraph boundaries) before length chunking."]}),"\n",(0,a.jsxs)(s.li,{children:["Media uploads are capped by ",(0,a.jsx)(s.code,{children:"channels.imessage.mediaMaxMb"})," (default 16)."]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"addressing--delivery-targets",children:"Addressing / delivery targets"}),"\n",(0,a.jsxs)(s.p,{children:["Prefer ",(0,a.jsx)(s.code,{children:"chat_id"})," for stable routing:"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"chat_id:123"})," (preferred)"]}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"chat_guid:..."})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"chat_identifier:..."})}),"\n",(0,a.jsxs)(s.li,{children:["direct handles: ",(0,a.jsx)(s.code,{children:"imessage:+1555"})," / ",(0,a.jsx)(s.code,{children:"sms:+1555"})," / ",(0,a.jsx)(s.code,{children:"user@example.com"})]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"List chats:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"imsg chats --limit 20\n"})}),"\n",(0,a.jsx)(s.h2,{id:"configuration-reference-imessage",children:"Configuration reference (iMessage)"}),"\n",(0,a.jsxs)(s.p,{children:["Full configuration: ",(0,a.jsx)(s.a,{href:"/gateway/configuration",children:"Configuration"})]}),"\n",(0,a.jsx)(s.p,{children:"Provider options:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.enabled"}),": enable/disable channel startup."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.cliPath"}),": path to ",(0,a.jsx)(s.code,{children:"imsg"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.dbPath"}),": Messages DB path."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.remoteHost"}),": SSH host for SCP attachment transfer when ",(0,a.jsx)(s.code,{children:"cliPath"})," points to a remote Mac (e.g., ",(0,a.jsx)(s.code,{children:"user@gateway-host"}),"). Auto-detected from SSH wrapper if not set."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.service"}),": ",(0,a.jsx)(s.code,{children:"imessage | sms | auto"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.region"}),": SMS region."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.dmPolicy"}),": ",(0,a.jsx)(s.code,{children:"pairing | allowlist | open | disabled"})," (default: pairing)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.allowFrom"}),": DM allowlist (handles, emails, E.164 numbers, or ",(0,a.jsx)(s.code,{children:"chat_id:*"}),"). ",(0,a.jsx)(s.code,{children:"open"})," requires ",(0,a.jsx)(s.code,{children:'"*"'}),". iMessage has no usernames; use handles or chat targets."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.groupPolicy"}),": ",(0,a.jsx)(s.code,{children:"open | allowlist | disabled"})," (default: allowlist)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.groupAllowFrom"}),": group sender allowlist."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.historyLimit"})," / ",(0,a.jsx)(s.code,{children:"channels.imessage.accounts.*.historyLimit"}),": max group messages to include as context (0 disables)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.dmHistoryLimit"}),": DM history limit in user turns. Per-user overrides: ",(0,a.jsx)(s.code,{children:'channels.imessage.dms["<handle>"].historyLimit'}),"."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.groups"}),": per-group defaults + allowlist (use ",(0,a.jsx)(s.code,{children:'"*"'})," for global defaults)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.includeAttachments"}),": ingest attachments into context."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.mediaMaxMb"}),": inbound/outbound media cap (MB)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.textChunkLimit"}),": outbound chunk size (chars)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"channels.imessage.chunkMode"}),": ",(0,a.jsx)(s.code,{children:"length"})," (default) or ",(0,a.jsx)(s.code,{children:"newline"})," to split on blank lines (paragraph boundaries) before length chunking."]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Related global options:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"agents.list[].groupChat.mentionPatterns"})," (or ",(0,a.jsx)(s.code,{children:"messages.groupChat.mentionPatterns"}),")."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"messages.responsePrefix"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453(e,s,n){n.d(s,{R:()=>l,x:()=>c});var i=n(96540);const a={},t=i.createContext(a);function l(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);