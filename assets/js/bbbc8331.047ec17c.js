"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[5637],{92072(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"gateway/pairing","title":"Gateway-owned pairing (Option B)","description":"In Gateway-owned pairing, the Gateway is the source of truth for which nodes","source":"@site/content/moltbot/docs/gateway/pairing.md","sourceDirName":"gateway","slug":"/gateway/pairing","permalink":"/moltbot-doc/docs/gateway/pairing","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Gateway-owned node pairing (Option B) for iOS and other remote nodes","read_when":["Implementing node pairing approvals without macOS UI","Adding CLI flows for approving remote nodes","Extending gateway protocol with node management"]}}');var i=r(74848),o=r(28453);const t={summary:"Gateway-owned node pairing (Option B) for iOS and other remote nodes",read_when:["Implementing node pairing approvals without macOS UI","Adding CLI flows for approving remote nodes","Extending gateway protocol with node management"]},a="Gateway-owned pairing (Option B)",d={},l=[{value:"Concepts",id:"concepts",level:2},{value:"How pairing works",id:"how-pairing-works",level:2},{value:"CLI workflow (headless friendly)",id:"cli-workflow-headless-friendly",level:2},{value:"API surface (gateway protocol)",id:"api-surface-gateway-protocol",level:2},{value:"Auto-approval (macOS app)",id:"auto-approval-macos-app",level:2},{value:"Storage (local, private)",id:"storage-local-private",level:2},{value:"Transport behavior",id:"transport-behavior",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"gateway-owned-pairing-option-b",children:"Gateway-owned pairing (Option B)"})}),"\n",(0,i.jsxs)(n.p,{children:["In Gateway-owned pairing, the ",(0,i.jsx)(n.strong,{children:"Gateway"})," is the source of truth for which nodes\nare allowed to join. UIs (macOS app, future clients) are just frontends that\napprove or reject pending requests."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important:"})," WS nodes use ",(0,i.jsx)(n.strong,{children:"device pairing"})," (role ",(0,i.jsx)(n.code,{children:"node"}),") during ",(0,i.jsx)(n.code,{children:"connect"}),".\n",(0,i.jsx)(n.code,{children:"node.pair.*"})," is a separate pairing store and does ",(0,i.jsx)(n.strong,{children:"not"})," gate the WS handshake.\nOnly clients that explicitly call ",(0,i.jsx)(n.code,{children:"node.pair.*"})," use this flow."]}),"\n",(0,i.jsx)(n.h2,{id:"concepts",children:"Concepts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pending request"}),": a node asked to join; requires approval."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Paired node"}),": approved node with an issued auth token."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Transport"}),": the Gateway WS endpoint forwards requests but does not decide\nmembership. (Legacy TCP bridge support is deprecated/removed.)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-pairing-works",children:"How pairing works"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"A node connects to the Gateway WS and requests pairing."}),"\n",(0,i.jsxs)(n.li,{children:["The Gateway stores a ",(0,i.jsx)(n.strong,{children:"pending request"})," and emits ",(0,i.jsx)(n.code,{children:"node.pair.requested"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"You approve or reject the request (CLI or UI)."}),"\n",(0,i.jsxs)(n.li,{children:["On approval, the Gateway issues a ",(0,i.jsx)(n.strong,{children:"new token"})," (tokens are rotated on re\u2011pair)."]}),"\n",(0,i.jsx)(n.li,{children:"The node reconnects using the token and is now \u201cpaired\u201d."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Pending requests expire automatically after ",(0,i.jsx)(n.strong,{children:"5 minutes"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"cli-workflow-headless-friendly",children:"CLI workflow (headless friendly)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'moltbot nodes pending\nmoltbot nodes approve <requestId>\nmoltbot nodes reject <requestId>\nmoltbot nodes status\nmoltbot nodes rename --node <id|name|ip> --name "Living Room iPad"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"nodes status"})," shows paired/connected nodes and their capabilities."]}),"\n",(0,i.jsx)(n.h2,{id:"api-surface-gateway-protocol",children:"API surface (gateway protocol)"}),"\n",(0,i.jsx)(n.p,{children:"Events:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.requested"})," \u2014 emitted when a new pending request is created."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.resolved"})," \u2014 emitted when a request is approved/rejected/expired."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Methods:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.request"})," \u2014 create or reuse a pending request."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.list"})," \u2014 list pending + paired nodes."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.approve"})," \u2014 approve a pending request (issues token)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.reject"})," \u2014 reject a pending request."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.verify"})," \u2014 verify ",(0,i.jsx)(n.code,{children:"{ nodeId, token }"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.pair.request"})," is idempotent per node: repeated calls return the same\npending request."]}),"\n",(0,i.jsxs)(n.li,{children:["Approval ",(0,i.jsx)(n.strong,{children:"always"})," generates a fresh token; no token is ever returned from\n",(0,i.jsx)(n.code,{children:"node.pair.request"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Requests may include ",(0,i.jsx)(n.code,{children:"silent: true"})," as a hint for auto-approval flows."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"auto-approval-macos-app",children:"Auto-approval (macOS app)"}),"\n",(0,i.jsxs)(n.p,{children:["The macOS app can optionally attempt a ",(0,i.jsx)(n.strong,{children:"silent approval"})," when:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["the request is marked ",(0,i.jsx)(n.code,{children:"silent"}),", and"]}),"\n",(0,i.jsx)(n.li,{children:"the app can verify an SSH connection to the gateway host using the same user."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If silent approval fails, it falls back to the normal \u201cApprove/Reject\u201d prompt."}),"\n",(0,i.jsx)(n.h2,{id:"storage-local-private",children:"Storage (local, private)"}),"\n",(0,i.jsxs)(n.p,{children:["Pairing state is stored under the Gateway state directory (default ",(0,i.jsx)(n.code,{children:"~/.clawdbot"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"~/.clawdbot/nodes/paired.json"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"~/.clawdbot/nodes/pending.json"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If you override ",(0,i.jsx)(n.code,{children:"CLAWDBOT_STATE_DIR"}),", the ",(0,i.jsx)(n.code,{children:"nodes/"})," folder moves with it."]}),"\n",(0,i.jsx)(n.p,{children:"Security notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Tokens are secrets; treat ",(0,i.jsx)(n.code,{children:"paired.json"})," as sensitive."]}),"\n",(0,i.jsx)(n.li,{children:"Rotating a token requires re-approval (or deleting the node entry)."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"transport-behavior",children:"Transport behavior"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The transport is ",(0,i.jsx)(n.strong,{children:"stateless"}),"; it does not store membership."]}),"\n",(0,i.jsx)(n.li,{children:"If the Gateway is offline or pairing is disabled, nodes cannot pair."}),"\n",(0,i.jsx)(n.li,{children:"If the Gateway is in remote mode, pairing still happens against the remote Gateway\u2019s store."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453(e,n,r){r.d(n,{R:()=>t,x:()=>a});var s=r(96540);const i={},o=s.createContext(i);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);