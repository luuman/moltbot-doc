"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[7607],{7872(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"gateway/gateway-lock","title":"Gateway lock","description":"Last updated: 2025-12-11","source":"@site/content/moltbot/docs/gateway/gateway-lock.md","sourceDirName":"gateway","slug":"/gateway/gateway-lock","permalink":"/moltbot-doc/docs/gateway/gateway-lock","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Gateway singleton guard using the WebSocket listener bind","read_when":["Running or debugging the gateway process","Investigating single-instance enforcement"]}}');var r=t(74848),a=t(28453);const o={summary:"Gateway singleton guard using the WebSocket listener bind",read_when:["Running or debugging the gateway process","Investigating single-instance enforcement"]},i="Gateway lock",l={},c=[{value:"Why",id:"why",level:2},{value:"Mechanism",id:"mechanism",level:2},{value:"Error surface",id:"error-surface",level:2},{value:"Operational notes",id:"operational-notes",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"gateway-lock",children:"Gateway lock"})}),"\n",(0,r.jsx)(n.p,{children:"Last updated: 2025-12-11"}),"\n",(0,r.jsx)(n.h2,{id:"why",children:"Why"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure only one gateway instance runs per base port on the same host; additional gateways must use isolated profiles and unique ports."}),"\n",(0,r.jsx)(n.li,{children:"Survive crashes/SIGKILL without leaving stale lock files."}),"\n",(0,r.jsx)(n.li,{children:"Fail fast with a clear error when the control port is already occupied."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"mechanism",children:"Mechanism"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The gateway binds the WebSocket listener (default ",(0,r.jsx)(n.code,{children:"ws://127.0.0.1:18789"}),") immediately on startup using an exclusive TCP listener."]}),"\n",(0,r.jsxs)(n.li,{children:["If the bind fails with ",(0,r.jsx)(n.code,{children:"EADDRINUSE"}),", startup throws ",(0,r.jsx)(n.code,{children:'GatewayLockError("another gateway instance is already listening on ws://127.0.0.1:<port>")'}),"."]}),"\n",(0,r.jsx)(n.li,{children:"The OS releases the listener automatically on any process exit, including crashes and SIGKILL\u2014no separate lock file or cleanup step is needed."}),"\n",(0,r.jsx)(n.li,{children:"On shutdown the gateway closes the WebSocket server and underlying HTTP server to free the port promptly."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"error-surface",children:"Error surface"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If another process holds the port, startup throws ",(0,r.jsx)(n.code,{children:'GatewayLockError("another gateway instance is already listening on ws://127.0.0.1:<port>")'}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Other bind failures surface as ",(0,r.jsx)(n.code,{children:'GatewayLockError("failed to bind gateway socket on ws://127.0.0.1:<port>: \u2026")'}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"operational-notes",children:"Operational notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If the port is occupied by ",(0,r.jsx)(n.em,{children:"another"})," process, the error is the same; free the port or choose another with ",(0,r.jsx)(n.code,{children:"moltbot gateway --port <port>"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"The macOS app still maintains its own lightweight PID guard before spawning the gateway; the runtime lock is enforced by the WebSocket bind."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>o,x:()=>i});var s=t(96540);const r={},a=s.createContext(r);function o(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);