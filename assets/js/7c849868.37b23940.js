"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[4292],{36429(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>t});const o=JSON.parse('{"id":"gateway/background-process","title":"Background Exec + Process Tool","description":"Moltbot runs shell commands through the exec tool and keeps long\u2011running tasks in memory. The process tool manages those background sessions.","source":"@site/content/moltbot/docs/gateway/background-process.md","sourceDirName":"gateway","slug":"/gateway/background-process","permalink":"/moltbot-doc/docs/gateway/background-process","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Background exec execution and process management","read_when":["Adding or modifying background exec behavior","Debugging long-running exec tasks"]}}');var r=n(74848),d=n(28453);const i={summary:"Background exec execution and process management",read_when:["Adding or modifying background exec behavior","Debugging long-running exec tasks"]},c="Background Exec + Process Tool",l={},t=[{value:"exec tool",id:"exec-tool",level:2},{value:"Child process bridging",id:"child-process-bridging",level:2},{value:"process tool",id:"process-tool",level:2},{value:"Examples",id:"examples",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"background-exec--process-tool",children:"Background Exec + Process Tool"})}),"\n",(0,r.jsxs)(s.p,{children:["Moltbot runs shell commands through the ",(0,r.jsx)(s.code,{children:"exec"})," tool and keeps long\u2011running tasks in memory. The ",(0,r.jsx)(s.code,{children:"process"})," tool manages those background sessions."]}),"\n",(0,r.jsx)(s.h2,{id:"exec-tool",children:"exec tool"}),"\n",(0,r.jsx)(s.p,{children:"Key parameters:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"command"})," (required)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"yieldMs"})," (default 10000): auto\u2011background after this delay"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"background"})," (bool): background immediately"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"timeout"})," (seconds, default 1800): kill the process after this timeout"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"elevated"})," (bool): run on host if elevated mode is enabled/allowed"]}),"\n",(0,r.jsxs)(s.li,{children:["Need a real TTY? Set ",(0,r.jsx)(s.code,{children:"pty: true"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"workdir"}),", ",(0,r.jsx)(s.code,{children:"env"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Behavior:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Foreground runs return output directly."}),"\n",(0,r.jsxs)(s.li,{children:["When backgrounded (explicit or timeout), the tool returns ",(0,r.jsx)(s.code,{children:'status: "running"'})," + ",(0,r.jsx)(s.code,{children:"sessionId"})," and a short tail."]}),"\n",(0,r.jsx)(s.li,{children:"Output is kept in memory until the session is polled or cleared."}),"\n",(0,r.jsxs)(s.li,{children:["If the ",(0,r.jsx)(s.code,{children:"process"})," tool is disallowed, ",(0,r.jsx)(s.code,{children:"exec"})," runs synchronously and ignores ",(0,r.jsx)(s.code,{children:"yieldMs"}),"/",(0,r.jsx)(s.code,{children:"background"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"child-process-bridging",children:"Child process bridging"}),"\n",(0,r.jsx)(s.p,{children:"When spawning long-running child processes outside the exec/process tools (for example, CLI respawns or gateway helpers), attach the child-process bridge helper so termination signals are forwarded and listeners are detached on exit/error. This avoids orphaned processes on systemd and keeps shutdown behavior consistent across platforms."}),"\n",(0,r.jsx)(s.p,{children:"Environment overrides:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PI_BASH_YIELD_MS"}),": default yield (ms)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PI_BASH_MAX_OUTPUT_CHARS"}),": in\u2011memory output cap (chars)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"CLAWDBOT_BASH_PENDING_MAX_OUTPUT_CHARS"}),": pending stdout/stderr cap per stream (chars)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"PI_BASH_JOB_TTL_MS"}),": TTL for finished sessions (ms, bounded to 1m\u20133h)"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Config (preferred):"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"tools.exec.backgroundMs"})," (default 10000)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"tools.exec.timeoutSec"})," (default 1800)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"tools.exec.cleanupMs"})," (default 1800000)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"tools.exec.notifyOnExit"})," (default true): enqueue a system event + request heartbeat when a backgrounded exec exits."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"process-tool",children:"process tool"}),"\n",(0,r.jsx)(s.p,{children:"Actions:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"list"}),": running + finished sessions"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"poll"}),": drain new output for a session (also reports exit status)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"log"}),": read the aggregated output (supports ",(0,r.jsx)(s.code,{children:"offset"})," + ",(0,r.jsx)(s.code,{children:"limit"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"write"}),": send stdin (",(0,r.jsx)(s.code,{children:"data"}),", optional ",(0,r.jsx)(s.code,{children:"eof"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"kill"}),": terminate a background session"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"clear"}),": remove a finished session from memory"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"remove"}),": kill if running, otherwise clear if finished"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Notes:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Only backgrounded sessions are listed/persisted in memory."}),"\n",(0,r.jsx)(s.li,{children:"Sessions are lost on process restart (no disk persistence)."}),"\n",(0,r.jsxs)(s.li,{children:["Session logs are only saved to chat history if you run ",(0,r.jsx)(s.code,{children:"process poll/log"})," and the tool result is recorded."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"process"})," is scoped per agent; it only sees sessions started by that agent."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"process list"})," includes a derived ",(0,r.jsx)(s.code,{children:"name"})," (command verb + target) for quick scans."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"process log"})," uses line-based ",(0,r.jsx)(s.code,{children:"offset"}),"/",(0,r.jsx)(s.code,{children:"limit"})," (omit ",(0,r.jsx)(s.code,{children:"offset"})," to grab the last N lines)."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(s.p,{children:"Run a long task and poll later:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{"tool": "exec", "command": "sleep 5 && echo done", "yieldMs": 1000}\n'})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{"tool": "process", "action": "poll", "sessionId": "<id>"}\n'})}),"\n",(0,r.jsx)(s.p,{children:"Start immediately in background:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{"tool": "exec", "command": "npm run build", "background": true}\n'})}),"\n",(0,r.jsx)(s.p,{children:"Send stdin:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{"tool": "process", "action": "write", "sessionId": "<id>", "data": "y\\n"}\n'})})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453(e,s,n){n.d(s,{R:()=>i,x:()=>c});var o=n(96540);const r={},d=o.createContext(r);function i(e){const s=o.useContext(d);return o.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(d.Provider,{value:s},e.children)}}}]);