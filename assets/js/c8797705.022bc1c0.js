"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[3497],{52580(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"reference/test","title":"Tests","description":"- Full testing kit (suites, live, Docker): Testing","source":"@site/content/moltbot/docs/reference/test.md","sourceDirName":"reference","slug":"/reference/test","permalink":"/moltbot-doc/docs/reference/test","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"How to run tests locally (vitest) and when to use force/coverage modes","read_when":["Running or fixing tests"]}}');var r=s(74848),i=s(28453);const o={summary:"How to run tests locally (vitest) and when to use force/coverage modes",read_when:["Running or fixing tests"]},c="Tests",l={},d=[{value:"Model latency bench (local keys)",id:"model-latency-bench-local-keys",level:2},{value:"Onboarding E2E (Docker)",id:"onboarding-e2e-docker",level:2},{value:"QR import smoke (Docker)",id:"qr-import-smoke-docker",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"tests",children:"Tests"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Full testing kit (suites, live, Docker): ",(0,r.jsx)(n.a,{href:"/testing",children:"Testing"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pnpm test:force"}),": Kills any lingering gateway process holding the default control port, then runs the full Vitest suite with an isolated gateway port so server tests don\u2019t collide with a running instance. Use this when a prior gateway run left port 18789 occupied."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pnpm test:coverage"}),": Runs Vitest with V8 coverage. Global thresholds are 70% lines/branches/functions/statements. Coverage excludes integration-heavy entrypoints (CLI wiring, gateway/telegram bridges, webchat static server) to keep the target focused on unit-testable logic."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pnpm test:e2e"}),": Runs gateway end-to-end smoke tests (multi-instance WS/HTTP/node pairing)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pnpm test:live"}),": Runs provider live tests (minimax/zai). Requires API keys and ",(0,r.jsx)(n.code,{children:"LIVE=1"})," (or provider-specific ",(0,r.jsx)(n.code,{children:"*_LIVE_TEST=1"}),") to unskip."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"model-latency-bench-local-keys",children:"Model latency bench (local keys)"}),"\n",(0,r.jsxs)(n.p,{children:["Script: ",(0,r.jsx)(n.a,{href:"https://github.com/moltbot/moltbot/blob/main/scripts/bench-model.ts",children:(0,r.jsx)(n.code,{children:"scripts/bench-model.ts"})})]}),"\n",(0,r.jsx)(n.p,{children:"Usage:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"source ~/.profile && pnpm tsx scripts/bench-model.ts --runs 10"})}),"\n",(0,r.jsxs)(n.li,{children:["Optional env: ",(0,r.jsx)(n.code,{children:"MINIMAX_API_KEY"}),", ",(0,r.jsx)(n.code,{children:"MINIMAX_BASE_URL"}),", ",(0,r.jsx)(n.code,{children:"MINIMAX_MODEL"}),", ",(0,r.jsx)(n.code,{children:"ANTHROPIC_API_KEY"})]}),"\n",(0,r.jsx)(n.li,{children:"Default prompt: \u201cReply with a single word: ok. No punctuation or extra text.\u201d"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Last run (2025-12-31, 20 runs):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"minimax median 1279ms (min 1114, max 2431)"}),"\n",(0,r.jsx)(n.li,{children:"opus median 2454ms (min 1224, max 3170)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"onboarding-e2e-docker",children:"Onboarding E2E (Docker)"}),"\n",(0,r.jsx)(n.p,{children:"Docker is optional; this is only needed for containerized onboarding smoke tests."}),"\n",(0,r.jsx)(n.p,{children:"Full cold-start flow in a clean Linux container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"scripts/e2e/onboard-docker.sh\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This script drives the interactive wizard via a pseudo-tty, verifies config/workspace/session files, then starts the gateway and runs ",(0,r.jsx)(n.code,{children:"moltbot health"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"qr-import-smoke-docker",children:"QR import smoke (Docker)"}),"\n",(0,r.jsxs)(n.p,{children:["Ensures ",(0,r.jsx)(n.code,{children:"qrcode-terminal"})," loads under Node 22+ in Docker:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm test:docker:qr\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>o,x:()=>c});var t=s(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);