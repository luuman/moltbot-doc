"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[5433],{79281(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"nodes/images","title":"Image & Media Support \u2014 2025-12-05","description":"The WhatsApp channel runs via Baileys Web. This document captures the current media handling rules for send, gateway, and agent replies.","source":"@site/content/moltbot/docs/nodes/images.md","sourceDirName":"nodes","slug":"/nodes/images","permalink":"/moltbot-doc/docs/nodes/images","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Image and media handling rules for send, gateway, and agent replies","read_when":["Modifying media pipeline or attachments"]}}');var d=s(74848),l=s(28453);const a={summary:"Image and media handling rules for send, gateway, and agent replies",read_when:["Modifying media pipeline or attachments"]},r="Image & Media Support \u2014 2025-12-05",o={},t=[{value:"Goals",id:"goals",level:2},{value:"CLI Surface",id:"cli-surface",level:2},{value:"WhatsApp Web channel behavior",id:"whatsapp-web-channel-behavior",level:2},{value:"Auto-Reply Pipeline",id:"auto-reply-pipeline",level:2},{value:"Inbound Media to Commands (Pi)",id:"inbound-media-to-commands-pi",level:2},{value:"Limits &amp; Errors",id:"limits--errors",level:2},{value:"Notes for Tests",id:"notes-for-tests",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"image--media-support--2025-12-05",children:"Image & Media Support \u2014 2025-12-05"})}),"\n",(0,d.jsxs)(n.p,{children:["The WhatsApp channel runs via ",(0,d.jsx)(n.strong,{children:"Baileys Web"}),". This document captures the current media handling rules for send, gateway, and agent replies."]}),"\n",(0,d.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Send media with optional captions via ",(0,d.jsx)(n.code,{children:"moltbot message send --media"}),"."]}),"\n",(0,d.jsx)(n.li,{children:"Allow auto-replies from the web inbox to include media alongside text."}),"\n",(0,d.jsx)(n.li,{children:"Keep per-type limits sane and predictable."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"cli-surface",children:"CLI Surface"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"moltbot message send --media <path-or-url> [--message <caption>]"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"--media"})," optional; caption can be empty for media-only sends."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"--dry-run"})," prints the resolved payload; ",(0,d.jsx)(n.code,{children:"--json"})," emits ",(0,d.jsx)(n.code,{children:"{ channel, to, messageId, mediaUrl, caption }"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"whatsapp-web-channel-behavior",children:"WhatsApp Web channel behavior"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Input: local file path ",(0,d.jsx)(n.strong,{children:"or"})," HTTP(S) URL."]}),"\n",(0,d.jsxs)(n.li,{children:["Flow: load into a Buffer, detect media kind, and build the correct payload:\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Images:"})," resize & recompress to JPEG (max side 2048px) targeting ",(0,d.jsx)(n.code,{children:"agents.defaults.mediaMaxMb"})," (default 5\u202fMB), capped at 6\u202fMB."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Audio/Voice/Video:"})," pass-through up to 16\u202fMB; audio is sent as a voice note (",(0,d.jsx)(n.code,{children:"ptt: true"}),")."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Documents:"})," anything else, up to 100\u202fMB, with filename preserved when available."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["WhatsApp GIF-style playback: send an MP4 with ",(0,d.jsx)(n.code,{children:"gifPlayback: true"})," (CLI: ",(0,d.jsx)(n.code,{children:"--gif-playback"}),") so mobile clients loop inline."]}),"\n",(0,d.jsx)(n.li,{children:"MIME detection prefers magic bytes, then headers, then file extension."}),"\n",(0,d.jsxs)(n.li,{children:["Caption comes from ",(0,d.jsx)(n.code,{children:"--message"})," or ",(0,d.jsx)(n.code,{children:"reply.text"}),"; empty caption is allowed."]}),"\n",(0,d.jsxs)(n.li,{children:["Logging: non-verbose shows ",(0,d.jsx)(n.code,{children:"\u21a9\ufe0f"}),"/",(0,d.jsx)(n.code,{children:"\u2705"}),"; verbose includes size and source path/URL."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"auto-reply-pipeline",children:"Auto-Reply Pipeline"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"getReplyFromConfig"})," returns ",(0,d.jsx)(n.code,{children:"{ text?, mediaUrl?, mediaUrls? }"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["When media is present, the web sender resolves local paths or URLs using the same pipeline as ",(0,d.jsx)(n.code,{children:"moltbot message send"}),"."]}),"\n",(0,d.jsx)(n.li,{children:"Multiple media entries are sent sequentially if provided."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"inbound-media-to-commands-pi",children:"Inbound Media to Commands (Pi)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["When inbound web messages include media, Moltbot downloads to a temp file and exposes templating variables:\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"{{MediaUrl}}"})," pseudo-URL for the inbound media."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"{{MediaPath}}"})," local temp path written before running the command."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["When a per-session Docker sandbox is enabled, inbound media is copied into the sandbox workspace and ",(0,d.jsx)(n.code,{children:"MediaPath"}),"/",(0,d.jsx)(n.code,{children:"MediaUrl"})," are rewritten to a relative path like ",(0,d.jsx)(n.code,{children:"media/inbound/<filename>"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Media understanding (if configured via ",(0,d.jsx)(n.code,{children:"tools.media.*"})," or shared ",(0,d.jsx)(n.code,{children:"tools.media.models"}),") runs before templating and can insert ",(0,d.jsx)(n.code,{children:"[Image]"}),", ",(0,d.jsx)(n.code,{children:"[Audio]"}),", and ",(0,d.jsx)(n.code,{children:"[Video]"})," blocks into ",(0,d.jsx)(n.code,{children:"Body"}),".\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Audio sets ",(0,d.jsx)(n.code,{children:"{{Transcript}}"})," and uses the transcript for command parsing so slash commands still work."]}),"\n",(0,d.jsx)(n.li,{children:"Video and image descriptions preserve any caption text for command parsing."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["By default only the first matching image/audio/video attachment is processed; set ",(0,d.jsx)(n.code,{children:"tools.media.<cap>.attachments"})," to process multiple attachments."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"limits--errors",children:"Limits & Errors"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Outbound send caps (WhatsApp web send)"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Images: ~6\u202fMB cap after recompression."}),"\n",(0,d.jsx)(n.li,{children:"Audio/voice/video: 16\u202fMB cap; documents: 100\u202fMB cap."}),"\n",(0,d.jsx)(n.li,{children:"Oversize or unreadable media \u2192 clear error in logs and the reply is skipped."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Media understanding caps (transcription/description)"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Image default: 10\u202fMB (",(0,d.jsx)(n.code,{children:"tools.media.image.maxBytes"}),")."]}),"\n",(0,d.jsxs)(n.li,{children:["Audio default: 20\u202fMB (",(0,d.jsx)(n.code,{children:"tools.media.audio.maxBytes"}),")."]}),"\n",(0,d.jsxs)(n.li,{children:["Video default: 50\u202fMB (",(0,d.jsx)(n.code,{children:"tools.media.video.maxBytes"}),")."]}),"\n",(0,d.jsx)(n.li,{children:"Oversize media skips understanding, but replies still go through with the original body."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"notes-for-tests",children:"Notes for Tests"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Cover send + reply flows for image/audio/document cases."}),"\n",(0,d.jsx)(n.li,{children:"Validate recompression for images (size bound) and voice-note flag for audio."}),"\n",(0,d.jsx)(n.li,{children:"Ensure multi-media replies fan out as sequential sends."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},28453(e,n,s){s.d(n,{R:()=>a,x:()=>r});var i=s(96540);const d={},l=i.createContext(d);function a(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);