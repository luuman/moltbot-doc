"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[7608],{53187(e,n,s){s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"experiments/plans/openresponses-gateway","title":"OpenResponses Gateway Integration Plan","description":"Context","source":"@site/content/moltbot/docs/experiments/plans/openresponses-gateway.md","sourceDirName":"experiments/plans","slug":"/experiments/plans/openresponses-gateway","permalink":"/moltbot-doc/docs/experiments/plans/openresponses-gateway","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Plan: Add OpenResponses /v1/responses endpoint and deprecate chat completions cleanly","owner":"moltbot","status":"draft","last_updated":"2026-01-19"}}');var t=s(74848),o=s(28453);const d={summary:"Plan: Add OpenResponses /v1/responses endpoint and deprecate chat completions cleanly",owner:"moltbot",status:"draft",last_updated:"2026-01-19"},l="OpenResponses Gateway Integration Plan",r={},c=[{value:"Context",id:"context",level:2},{value:"Goals",id:"goals",level:2},{value:"Non-goals",id:"non-goals",level:2},{value:"Research Summary",id:"research-summary",level:2},{value:"Proposed Architecture",id:"proposed-architecture",level:2},{value:"Deprecation Path for Chat Completions",id:"deprecation-path-for-chat-completions",level:2},{value:"Phase 1 Support Subset",id:"phase-1-support-subset",level:2},{value:"Validation Strategy (No SDK)",id:"validation-strategy-no-sdk",level:2},{value:"Streaming Implementation (Phase 1)",id:"streaming-implementation-phase-1",level:2},{value:"Tests and Verification Plan",id:"tests-and-verification-plan",level:2},{value:"Doc Updates (Follow-up)",id:"doc-updates-follow-up",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"openresponses-gateway-integration-plan",children:"OpenResponses Gateway Integration Plan"})}),"\n",(0,t.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,t.jsxs)(n.p,{children:["Moltbot Gateway currently exposes a minimal OpenAI-compatible Chat Completions endpoint at\n",(0,t.jsx)(n.code,{children:"/v1/chat/completions"})," (see ",(0,t.jsx)(n.a,{href:"/gateway/openai-http-api",children:"OpenAI Chat Completions"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:["Open Responses is an open inference standard based on the OpenAI Responses API. It is designed\nfor agentic workflows and uses item-based inputs plus semantic streaming events. The OpenResponses\nspec defines ",(0,t.jsx)(n.code,{children:"/v1/responses"}),", not ",(0,t.jsx)(n.code,{children:"/v1/chat/completions"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"goals",children:"Goals"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add a ",(0,t.jsx)(n.code,{children:"/v1/responses"})," endpoint that adheres to OpenResponses semantics."]}),"\n",(0,t.jsx)(n.li,{children:"Keep Chat Completions as a compatibility layer that is easy to disable and eventually remove."}),"\n",(0,t.jsx)(n.li,{children:"Standardize validation and parsing with isolated, reusable schemas."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"non-goals",children:"Non-goals"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Full OpenResponses feature parity in the first pass (images, files, hosted tools)."}),"\n",(0,t.jsx)(n.li,{children:"Replacing internal agent execution logic or tool orchestration."}),"\n",(0,t.jsxs)(n.li,{children:["Changing the existing ",(0,t.jsx)(n.code,{children:"/v1/chat/completions"})," behavior during the first phase."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"research-summary",children:"Research Summary"}),"\n",(0,t.jsx)(n.p,{children:"Sources: OpenResponses OpenAPI, OpenResponses specification site, and the Hugging Face blog post."}),"\n",(0,t.jsx)(n.p,{children:"Key points extracted:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"POST /v1/responses"})," accepts ",(0,t.jsx)(n.code,{children:"CreateResponseBody"})," fields like ",(0,t.jsx)(n.code,{children:"model"}),", ",(0,t.jsx)(n.code,{children:"input"})," (string or\n",(0,t.jsx)(n.code,{children:"ItemParam[]"}),"), ",(0,t.jsx)(n.code,{children:"instructions"}),", ",(0,t.jsx)(n.code,{children:"tools"}),", ",(0,t.jsx)(n.code,{children:"tool_choice"}),", ",(0,t.jsx)(n.code,{children:"stream"}),", ",(0,t.jsx)(n.code,{children:"max_output_tokens"}),", and\n",(0,t.jsx)(n.code,{children:"max_tool_calls"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ItemParam"})," is a discriminated union of:\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"message"})," items with roles ",(0,t.jsx)(n.code,{children:"system"}),", ",(0,t.jsx)(n.code,{children:"developer"}),", ",(0,t.jsx)(n.code,{children:"user"}),", ",(0,t.jsx)(n.code,{children:"assistant"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"function_call"})," and ",(0,t.jsx)(n.code,{children:"function_call_output"})]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"reasoning"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"item_reference"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Successful responses return a ",(0,t.jsx)(n.code,{children:"ResponseResource"})," with ",(0,t.jsx)(n.code,{children:'object: "response"'}),", ",(0,t.jsx)(n.code,{children:"status"}),", and\n",(0,t.jsx)(n.code,{children:"output"})," items."]}),"\n",(0,t.jsxs)(n.li,{children:["Streaming uses semantic events such as:\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"response.created"}),", ",(0,t.jsx)(n.code,{children:"response.in_progress"}),", ",(0,t.jsx)(n.code,{children:"response.completed"}),", ",(0,t.jsx)(n.code,{children:"response.failed"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"response.output_item.added"}),", ",(0,t.jsx)(n.code,{children:"response.output_item.done"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"response.content_part.added"}),", ",(0,t.jsx)(n.code,{children:"response.content_part.done"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"response.output_text.delta"}),", ",(0,t.jsx)(n.code,{children:"response.output_text.done"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["The spec requires:\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"Content-Type: text/event-stream"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"event:"})," must match the JSON ",(0,t.jsx)(n.code,{children:"type"})," field"]}),"\n",(0,t.jsxs)(n.li,{children:["terminal event must be literal ",(0,t.jsx)(n.code,{children:"[DONE]"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Reasoning items may expose ",(0,t.jsx)(n.code,{children:"content"}),", ",(0,t.jsx)(n.code,{children:"encrypted_content"}),", and ",(0,t.jsx)(n.code,{children:"summary"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["HF examples include ",(0,t.jsx)(n.code,{children:"OpenResponses-Version: latest"})," in requests (optional header)."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"proposed-architecture",children:"Proposed Architecture"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add ",(0,t.jsx)(n.code,{children:"src/gateway/open-responses.schema.ts"})," containing Zod schemas only (no gateway imports)."]}),"\n",(0,t.jsxs)(n.li,{children:["Add ",(0,t.jsx)(n.code,{children:"src/gateway/openresponses-http.ts"})," (or ",(0,t.jsx)(n.code,{children:"open-responses-http.ts"}),") for ",(0,t.jsx)(n.code,{children:"/v1/responses"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Keep ",(0,t.jsx)(n.code,{children:"src/gateway/openai-http.ts"})," intact as a legacy compatibility adapter."]}),"\n",(0,t.jsxs)(n.li,{children:["Add config ",(0,t.jsx)(n.code,{children:"gateway.http.endpoints.responses.enabled"})," (default ",(0,t.jsx)(n.code,{children:"false"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Keep ",(0,t.jsx)(n.code,{children:"gateway.http.endpoints.chatCompletions.enabled"})," independent; allow both endpoints to be\ntoggled separately."]}),"\n",(0,t.jsx)(n.li,{children:"Emit a startup warning when Chat Completions is enabled to signal legacy status."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"deprecation-path-for-chat-completions",children:"Deprecation Path for Chat Completions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Maintain strict module boundaries: no shared schema types between responses and chat completions."}),"\n",(0,t.jsx)(n.li,{children:"Make Chat Completions opt-in by config so it can be disabled without code changes."}),"\n",(0,t.jsxs)(n.li,{children:["Update docs to label Chat Completions as legacy once ",(0,t.jsx)(n.code,{children:"/v1/responses"})," is stable."]}),"\n",(0,t.jsx)(n.li,{children:"Optional future step: map Chat Completions requests to the Responses handler for a simpler\nremoval path."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"phase-1-support-subset",children:"Phase 1 Support Subset"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Accept ",(0,t.jsx)(n.code,{children:"input"})," as string or ",(0,t.jsx)(n.code,{children:"ItemParam[]"})," with message roles and ",(0,t.jsx)(n.code,{children:"function_call_output"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Extract system and developer messages into ",(0,t.jsx)(n.code,{children:"extraSystemPrompt"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Use the most recent ",(0,t.jsx)(n.code,{children:"user"})," or ",(0,t.jsx)(n.code,{children:"function_call_output"})," as the current message for agent runs."]}),"\n",(0,t.jsxs)(n.li,{children:["Reject unsupported content parts (image/file) with ",(0,t.jsx)(n.code,{children:"invalid_request_error"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Return a single assistant message with ",(0,t.jsx)(n.code,{children:"output_text"})," content."]}),"\n",(0,t.jsxs)(n.li,{children:["Return ",(0,t.jsx)(n.code,{children:"usage"})," with zeroed values until token accounting is wired."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"validation-strategy-no-sdk",children:"Validation Strategy (No SDK)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Implement Zod schemas for the supported subset of:\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"CreateResponseBody"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ItemParam"})," + message content part unions"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"ResponseResource"})}),"\n",(0,t.jsx)(n.li,{children:"Streaming event shapes used by the gateway"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Keep schemas in a single, isolated module to avoid drift and allow future codegen."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"streaming-implementation-phase-1",children:"Streaming Implementation (Phase 1)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["SSE lines with both ",(0,t.jsx)(n.code,{children:"event:"})," and ",(0,t.jsx)(n.code,{children:"data:"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Required sequence (minimum viable):\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"response.created"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"response.output_item.added"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"response.content_part.added"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"response.output_text.delta"})," (repeat as needed)"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"response.output_text.done"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"response.content_part.done"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"response.completed"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"[DONE]"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"tests-and-verification-plan",children:"Tests and Verification Plan"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add e2e coverage for ",(0,t.jsx)(n.code,{children:"/v1/responses"}),":\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Auth required"}),"\n",(0,t.jsx)(n.li,{children:"Non-stream response shape"}),"\n",(0,t.jsxs)(n.li,{children:["Stream event ordering and ",(0,t.jsx)(n.code,{children:"[DONE]"})]}),"\n",(0,t.jsxs)(n.li,{children:["Session routing with headers and ",(0,t.jsx)(n.code,{children:"user"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Keep ",(0,t.jsx)(n.code,{children:"src/gateway/openai-http.e2e.test.ts"})," unchanged."]}),"\n",(0,t.jsxs)(n.li,{children:["Manual: curl to ",(0,t.jsx)(n.code,{children:"/v1/responses"})," with ",(0,t.jsx)(n.code,{children:"stream: true"})," and verify event ordering and terminal\n",(0,t.jsx)(n.code,{children:"[DONE]"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"doc-updates-follow-up",children:"Doc Updates (Follow-up)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Add a new docs page for ",(0,t.jsx)(n.code,{children:"/v1/responses"})," usage and examples."]}),"\n",(0,t.jsxs)(n.li,{children:["Update ",(0,t.jsx)(n.code,{children:"/gateway/openai-http-api"})," with a legacy note and pointer to ",(0,t.jsx)(n.code,{children:"/v1/responses"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var i=s(96540);const t={},o=i.createContext(t);function d(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);