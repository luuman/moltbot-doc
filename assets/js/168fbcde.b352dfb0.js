"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[6760],{1889(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>x,frontMatter:()=>l,metadata:()=>c,toc:()=>t});const c=JSON.parse('{"id":"concepts/typebox","title":"TypeBox \u4f5c\u4e3a\u534f\u8bae\u771f\u76f8\u6765\u6e90","description":"\u6700\u540e\u66f4\u65b0\uff1a2026-01-10","source":"@site/content/moltbot/docs/concepts/typebox.md","sourceDirName":"concepts","slug":"/concepts/typebox","permalink":"/moltbot-doc/docs/concepts/typebox","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"TypeBox \u67b6\u6784\u4f5c\u4e3a\u7f51\u5173\u534f\u8bae\u7684\u5355\u4e00\u771f\u76f8\u6765\u6e90","read_when":["\u66f4\u65b0\u534f\u8bae\u67b6\u6784\u6216\u4ee3\u7801\u751f\u6210\u65f6"]}}');var d=s(74848),r=s(28453);const l={summary:"TypeBox \u67b6\u6784\u4f5c\u4e3a\u7f51\u5173\u534f\u8bae\u7684\u5355\u4e00\u771f\u76f8\u6765\u6e90",read_when:["\u66f4\u65b0\u534f\u8bae\u67b6\u6784\u6216\u4ee3\u7801\u751f\u6210\u65f6"]},i="TypeBox \u4f5c\u4e3a\u534f\u8bae\u771f\u76f8\u6765\u6e90",o={},t=[{value:"\u5fc3\u667a\u6a21\u578b\uff0830 \u79d2\uff09",id:"\u5fc3\u667a\u6a21\u578b30-\u79d2",level:2},{value:"\u67b6\u6784\u4f4d\u7f6e",id:"\u67b6\u6784\u4f4d\u7f6e",level:2},{value:"\u5f53\u524d\u6d41\u6c34\u7ebf",id:"\u5f53\u524d\u6d41\u6c34\u7ebf",level:2},{value:"\u67b6\u6784\u5728\u8fd0\u884c\u65f6\u5982\u4f55\u4f7f\u7528",id:"\u67b6\u6784\u5728\u8fd0\u884c\u65f6\u5982\u4f55\u4f7f\u7528",level:2},{value:"\u793a\u4f8b\u5e27",id:"\u793a\u4f8b\u5e27",level:2},{value:"\u6700\u5c0f\u5ba2\u6237\u7aef\uff08Node.js\uff09",id:"\u6700\u5c0f\u5ba2\u6237\u7aefnodejs",level:2},{value:"\u5b8c\u6574\u793a\u4f8b\uff1a\u7aef\u5230\u7aef\u6dfb\u52a0\u65b9\u6cd5",id:"\u5b8c\u6574\u793a\u4f8b\u7aef\u5230\u7aef\u6dfb\u52a0\u65b9\u6cd5",level:2},{value:"Swift \u4ee3\u7801\u751f\u6210\u884c\u4e3a",id:"swift-\u4ee3\u7801\u751f\u6210\u884c\u4e3a",level:2},{value:"\u7248\u672c\u63a7\u5236 + \u517c\u5bb9\u6027",id:"\u7248\u672c\u63a7\u5236--\u517c\u5bb9\u6027",level:2},{value:"\u67b6\u6784\u6a21\u5f0f\u548c\u7ea6\u5b9a",id:"\u67b6\u6784\u6a21\u5f0f\u548c\u7ea6\u5b9a",level:2},{value:"\u6d3b\u67b6\u6784 JSON",id:"\u6d3b\u67b6\u6784-json",level:2},{value:"\u66f4\u6539\u67b6\u6784\u65f6",id:"\u66f4\u6539\u67b6\u6784\u65f6",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"typebox-\u4f5c\u4e3a\u534f\u8bae\u771f\u76f8\u6765\u6e90",children:"TypeBox \u4f5c\u4e3a\u534f\u8bae\u771f\u76f8\u6765\u6e90"})}),"\n",(0,d.jsx)(n.p,{children:"\u6700\u540e\u66f4\u65b0\uff1a2026-01-10"}),"\n",(0,d.jsxs)(n.p,{children:["TypeBox \u662f\u4e00\u4e2a\u4ee5 TypeScript \u4e3a\u4e3b\u7684\u67b6\u6784\u5e93\u3002\u6211\u4eec\u4f7f\u7528\u5b83\u6765\u5b9a\u4e49 ",(0,d.jsx)(n.strong,{children:"\u7f51\u5173\nWebSocket \u534f\u8bae"}),"\uff08\u63e1\u624b\u3001\u8bf7\u6c42/\u54cd\u5e94\u3001\u670d\u52a1\u5668\u4e8b\u4ef6\uff09\u3002\u8fd9\u4e9b\u67b6\u6784\n\u9a71\u52a8 ",(0,d.jsx)(n.strong,{children:"\u8fd0\u884c\u65f6\u9a8c\u8bc1"}),"\u3001",(0,d.jsx)(n.strong,{children:"JSON \u67b6\u6784\u5bfc\u51fa"})," \u548c ",(0,d.jsx)(n.strong,{children:"Swift \u4ee3\u7801\u751f\u6210"}),"\nmacOS \u5e94\u7528\u3002\u5355\u4e00\u771f\u76f8\u6765\u6e90\uff1b\u5176\u4ed6\u4e00\u5207\u90fd\u662f\u751f\u6210\u7684\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5982\u679c\u60a8\u60f3\u8981\u66f4\u9ad8\u7ea7\u522b\u7684\u534f\u8bae\u4e0a\u4e0b\u6587\uff0c\u8bf7\u4ece\n",(0,d.jsx)(n.a,{href:"/concepts/architecture",children:"\u7f51\u5173\u67b6\u6784"})," \u5f00\u59cb\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"\u5fc3\u667a\u6a21\u578b30-\u79d2",children:"\u5fc3\u667a\u6a21\u578b\uff0830 \u79d2\uff09"}),"\n",(0,d.jsx)(n.p,{children:"\u6bcf\u4e2a\u7f51\u5173 WS \u6d88\u606f\u90fd\u662f\u4e09\u79cd\u5e27\u4e4b\u4e00\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u8bf7\u6c42"}),"\uff1a",(0,d.jsx)(n.code,{children:'{ type: "req", id, method, params }'})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u54cd\u5e94"}),"\uff1a",(0,d.jsx)(n.code,{children:'{ type: "res", id, ok, payload | error }'})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u4e8b\u4ef6"}),"\uff1a",(0,d.jsx)(n.code,{children:'{ type: "event", event, payload, seq?, stateVersion? }'})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u7b2c\u4e00\u4e2a\u5e27 ",(0,d.jsx)(n.strong,{children:"\u5fc5\u987b"})," \u662f ",(0,d.jsx)(n.code,{children:"connect"})," \u8bf7\u6c42\u3002\u6b64\u540e\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u8c03\u7528\n\u65b9\u6cd5\uff08\u4f8b\u5982 ",(0,d.jsx)(n.code,{children:"health"}),"\u3001",(0,d.jsx)(n.code,{children:"send"}),"\u3001",(0,d.jsx)(n.code,{children:"chat.send"}),"\uff09\u5e76\u8ba2\u9605\u4e8b\u4ef6\uff08\u4f8b\u5982\n",(0,d.jsx)(n.code,{children:"presence"}),"\u3001",(0,d.jsx)(n.code,{children:"tick"}),"\u3001",(0,d.jsx)(n.code,{children:"agent"}),"\uff09\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u8fde\u63a5\u6d41\u7a0b\uff08\u6700\u5c0f\uff09\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"\u5ba2\u6237\u7aef                    \u7f51\u5173\n  |---- req:connect --------\x3e|\n  |<---- res:hello-ok --------|\n  |<---- event:tick ----------|\n  |---- req:health ----------\x3e|\n  |<---- res:health ----------|\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u5e38\u89c1\u65b9\u6cd5 + \u4e8b\u4ef6\uff1a"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u7c7b\u522b"}),(0,d.jsx)(n.th,{children:"\u793a\u4f8b"}),(0,d.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u6838\u5fc3"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"connect"}),"\u3001",(0,d.jsx)(n.code,{children:"health"}),"\u3001",(0,d.jsx)(n.code,{children:"status"})]}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"connect"})," \u5fc5\u987b\u662f\u7b2c\u4e00\u4e2a"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u6d88\u606f"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"send"}),"\u3001",(0,d.jsx)(n.code,{children:"poll"}),"\u3001",(0,d.jsx)(n.code,{children:"agent"}),"\u3001",(0,d.jsx)(n.code,{children:"agent.wait"})]}),(0,d.jsxs)(n.td,{children:["\u526f\u4f5c\u7528\u9700\u8981 ",(0,d.jsx)(n.code,{children:"idempotencyKey"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u804a\u5929"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"chat.history"}),"\u3001",(0,d.jsx)(n.code,{children:"chat.send"}),"\u3001",(0,d.jsx)(n.code,{children:"chat.abort"}),"\u3001",(0,d.jsx)(n.code,{children:"chat.inject"})]}),(0,d.jsx)(n.td,{children:"WebChat \u4f7f\u7528\u8fd9\u4e9b"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4f1a\u8bdd"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"sessions.list"}),"\u3001",(0,d.jsx)(n.code,{children:"sessions.patch"}),"\u3001",(0,d.jsx)(n.code,{children:"sessions.delete"})]}),(0,d.jsx)(n.td,{children:"\u4f1a\u8bdd\u7ba1\u7406"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u8282\u70b9"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"node.list"}),"\u3001",(0,d.jsx)(n.code,{children:"node.invoke"}),"\u3001",(0,d.jsx)(n.code,{children:"node.pair.*"})]}),(0,d.jsx)(n.td,{children:"\u7f51\u5173 WS + \u8282\u70b9\u64cd\u4f5c"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4e8b\u4ef6"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"tick"}),"\u3001",(0,d.jsx)(n.code,{children:"presence"}),"\u3001",(0,d.jsx)(n.code,{children:"agent"}),"\u3001",(0,d.jsx)(n.code,{children:"chat"}),"\u3001",(0,d.jsx)(n.code,{children:"health"}),"\u3001",(0,d.jsx)(n.code,{children:"shutdown"})]}),(0,d.jsx)(n.td,{children:"\u670d\u52a1\u5668\u63a8\u9001"})]})]})]}),"\n",(0,d.jsxs)(n.p,{children:["\u6743\u5a01\u5217\u8868\u4f4d\u4e8e ",(0,d.jsx)(n.code,{children:"src/gateway/server.ts"}),"\uff08",(0,d.jsx)(n.code,{children:"METHODS"}),"\u3001",(0,d.jsx)(n.code,{children:"EVENTS"}),"\uff09\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"\u67b6\u6784\u4f4d\u7f6e",children:"\u67b6\u6784\u4f4d\u7f6e"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u6e90\u7801\uff1a",(0,d.jsx)(n.code,{children:"src/gateway/protocol/schema.ts"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u8fd0\u884c\u65f6\u9a8c\u8bc1\u5668\uff08AJV\uff09\uff1a",(0,d.jsx)(n.code,{children:"src/gateway/protocol/index.ts"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u670d\u52a1\u5668\u63e1\u624b + \u65b9\u6cd5\u8c03\u5ea6\uff1a",(0,d.jsx)(n.code,{children:"src/gateway/server.ts"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u8282\u70b9\u5ba2\u6237\u7aef\uff1a",(0,d.jsx)(n.code,{children:"src/gateway/client.ts"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u751f\u6210\u7684 JSON \u67b6\u6784\uff1a",(0,d.jsx)(n.code,{children:"dist/protocol.schema.json"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u751f\u6210\u7684 Swift \u6a21\u578b\uff1a",(0,d.jsx)(n.code,{children:"apps/macos/Sources/MoltbotProtocol/GatewayModels.swift"})]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u5f53\u524d\u6d41\u6c34\u7ebf",children:"\u5f53\u524d\u6d41\u6c34\u7ebf"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"pnpm protocol:gen"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5c06 JSON \u67b6\u6784\uff08draft\u201107\uff09\u5199\u5165 ",(0,d.jsx)(n.code,{children:"dist/protocol.schema.json"})]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"pnpm protocol:gen:swift"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u751f\u6210 Swift \u7f51\u5173\u6a21\u578b"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"pnpm protocol:check"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u8fd0\u884c\u4e24\u4e2a\u751f\u6210\u5668\u5e76\u9a8c\u8bc1\u8f93\u51fa\u5df2\u63d0\u4ea4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u67b6\u6784\u5728\u8fd0\u884c\u65f6\u5982\u4f55\u4f7f\u7528",children:"\u67b6\u6784\u5728\u8fd0\u884c\u65f6\u5982\u4f55\u4f7f\u7528"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u670d\u52a1\u5668\u7aef"}),"\uff1a\u6bcf\u4e2a\u5165\u7ad9\u5e27\u90fd\u7528 AJV \u9a8c\u8bc1\u3002\u63e1\u624b\u4ec5\u63a5\u53d7\u53c2\u6570\u5339\u914d ",(0,d.jsx)(n.code,{children:"ConnectParams"})," \u7684 ",(0,d.jsx)(n.code,{children:"connect"})," \u8bf7\u6c42\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u5ba2\u6237\u7aef"}),"\uff1aJS \u5ba2\u6237\u7aef\u5728\u4f7f\u7528\u4e8b\u4ef6\u548c\u54cd\u5e94\u5e27\u4e4b\u524d\u9a8c\u8bc1\u5b83\u4eec\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u65b9\u6cd5\u63a5\u53e3"}),"\uff1a\u7f51\u5173\u5728 ",(0,d.jsx)(n.code,{children:"hello-ok"})," \u4e2d\u516c\u5e03\u652f\u6301\u7684 ",(0,d.jsx)(n.code,{children:"methods"})," \u548c ",(0,d.jsx)(n.code,{children:"events"}),"\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u793a\u4f8b\u5e27",children:"\u793a\u4f8b\u5e27"}),"\n",(0,d.jsx)(n.p,{children:"\u8fde\u63a5\uff08\u7b2c\u4e00\u6761\u6d88\u606f\uff09\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{\n  "type": "req",\n  "id": "c1",\n  "method": "connect",\n  "params": {\n    "minProtocol": 2,\n    "maxProtocol": 2,\n    "client": {\n      "id": "moltbot-macos",\n      "displayName": "macos",\n      "version": "1.0.0",\n      "platform": "macos 15.1",\n      "mode": "ui",\n      "instanceId": "A1B2"\n    }\n  }\n}\n'})}),"\n",(0,d.jsx)(n.p,{children:"Hello-ok \u54cd\u5e94\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{\n  "type": "res",\n  "id": "c1",\n  "ok": true,\n  "payload": {\n    "type": "hello-ok",\n    "protocol": 2,\n    "server": { "version": "dev", "connId": "ws-1" },\n    "features": { "methods": ["health"], "events": ["tick"] },\n    "snapshot": { "presence": [], "health": {}, "stateVersion": { "presence": 0, "health": 0 }, "uptimeMs": 0 },\n    "policy": { "maxPayload": 1048576, "maxBufferedBytes": 1048576, "tickIntervalMs": 30000 }\n  }\n}\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u8bf7\u6c42 + \u54cd\u5e94\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{ "type": "req", "id": "r1", "method": "health" }\n'})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{ "type": "res", "id": "r1", "ok": true, "payload": { "ok": true } }\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u4e8b\u4ef6\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{ "type": "event", "event": "tick", "payload": { "ts": 1730000000 }, "seq": 12 }\n'})}),"\n",(0,d.jsx)(n.h2,{id:"\u6700\u5c0f\u5ba2\u6237\u7aefnodejs",children:"\u6700\u5c0f\u5ba2\u6237\u7aef\uff08Node.js\uff09"}),"\n",(0,d.jsx)(n.p,{children:"\u6700\u5c0f\u6709\u7528\u6d41\u7a0b\uff1a\u8fde\u63a5 + \u5065\u5eb7\u68c0\u67e5\u3002"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:'import { WebSocket } from "ws";\n\nconst ws = new WebSocket("ws://127.0.0.1:18789");\n\nws.on("open", () => {\n  ws.send(JSON.stringify({\n    type: "req",\n    id: "c1",\n    method: "connect",\n    params: {\n      minProtocol: 3,\n      maxProtocol: 3,\n      client: {\n        id: "cli",\n        displayName: "example",\n        version: "dev",\n        platform: "node",\n        mode: "cli"\n      }\n    }\n  }));\n});\n\nws.on("message", (data) => {\n  const msg = JSON.parse(String(data));\n  if (msg.type === "res" && msg.id === "c1" && msg.ok) {\n    ws.send(JSON.stringify({ type: "req", id: "h1", method: "health" }));\n  }\n  if (msg.type === "res" && msg.id === "h1") {\n    console.log("health:", msg.payload);\n    ws.close();\n  }\n});\n'})}),"\n",(0,d.jsx)(n.h2,{id:"\u5b8c\u6574\u793a\u4f8b\u7aef\u5230\u7aef\u6dfb\u52a0\u65b9\u6cd5",children:"\u5b8c\u6574\u793a\u4f8b\uff1a\u7aef\u5230\u7aef\u6dfb\u52a0\u65b9\u6cd5"}),"\n",(0,d.jsxs)(n.p,{children:["\u793a\u4f8b\uff1a\u6dfb\u52a0\u65b0\u7684 ",(0,d.jsx)(n.code,{children:"system.echo"})," \u8bf7\u6c42\uff0c\u8fd4\u56de ",(0,d.jsx)(n.code,{children:"{ ok: true, text }"}),"\u3002"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"\u67b6\u6784\uff08\u771f\u76f8\u6765\u6e90\uff09"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6dfb\u52a0\u5230 ",(0,d.jsx)(n.code,{children:"src/gateway/protocol/schema.ts"}),"\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export const SystemEchoParamsSchema = Type.Object(\n  { text: NonEmptyString },\n  { additionalProperties: false },\n);\n\nexport const SystemEchoResultSchema = Type.Object(\n  { ok: Type.Boolean(), text: NonEmptyString },\n  { additionalProperties: false },\n);\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u5c06\u4e24\u8005\u90fd\u6dfb\u52a0\u5230 ",(0,d.jsx)(n.code,{children:"ProtocolSchemas"})," \u5e76\u5bfc\u51fa\u7c7b\u578b\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"  SystemEchoParams: SystemEchoParamsSchema,\n  SystemEchoResult: SystemEchoResultSchema,\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export type SystemEchoParams = Static<typeof SystemEchoParamsSchema>;\nexport type SystemEchoResult = Static<typeof SystemEchoResultSchema>;\n"})}),"\n",(0,d.jsxs)(n.ol,{start:"2",children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"\u9a8c\u8bc1"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"src/gateway/protocol/index.ts"})," \u4e2d\uff0c\u5bfc\u51fa AJV \u9a8c\u8bc1\u5668\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:"export const validateSystemEchoParams =\n  ajv.compile<SystemEchoParams>(SystemEchoParamsSchema);\n"})}),"\n",(0,d.jsxs)(n.ol,{start:"3",children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"\u670d\u52a1\u5668\u884c\u4e3a"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"src/gateway/server-methods/system.ts"})," \u4e2d\u6dfb\u52a0\u5904\u7406\u7a0b\u5e8f\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-ts",children:'export const systemHandlers: GatewayRequestHandlers = {\n  "system.echo": ({ params, respond }) => {\n    const text = String(params.text ?? "");\n    respond(true, { ok: true, text });\n  },\n};\n'})}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"src/gateway/server-methods.ts"})," \u4e2d\u6ce8\u518c\u5b83\uff08\u5df2\u5408\u5e76 ",(0,d.jsx)(n.code,{children:"systemHandlers"}),"\uff09\uff0c\n\u7136\u540e\u5c06 ",(0,d.jsx)(n.code,{children:'"system.echo"'})," \u6dfb\u52a0\u5230 ",(0,d.jsx)(n.code,{children:"src/gateway/server.ts"})," \u4e2d\u7684 ",(0,d.jsx)(n.code,{children:"METHODS"}),"\u3002"]}),"\n",(0,d.jsxs)(n.ol,{start:"4",children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"\u91cd\u65b0\u751f\u6210"})}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"pnpm protocol:check\n"})}),"\n",(0,d.jsxs)(n.ol,{start:"5",children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"\u6d4b\u8bd5 + \u6587\u6863"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"src/gateway/server.*.test.ts"})," \u4e2d\u6dfb\u52a0\u670d\u52a1\u5668\u6d4b\u8bd5\u5e76\u5728\u6587\u6863\u4e2d\u6ce8\u660e\u8be5\u65b9\u6cd5\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"swift-\u4ee3\u7801\u751f\u6210\u884c\u4e3a",children:"Swift \u4ee3\u7801\u751f\u6210\u884c\u4e3a"}),"\n",(0,d.jsx)(n.p,{children:"Swift \u751f\u6210\u5668\u53d1\u51fa\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"GatewayFrame"})," \u679a\u4e3e\uff0c\u5e26\u6709 ",(0,d.jsx)(n.code,{children:"req"}),"\u3001",(0,d.jsx)(n.code,{children:"res"}),"\u3001",(0,d.jsx)(n.code,{children:"event"})," \u548c ",(0,d.jsx)(n.code,{children:"unknown"})," \u60c5\u51b5"]}),"\n",(0,d.jsx)(n.li,{children:"\u5f3a\u7c7b\u578b\u6709\u6548\u8f7d\u8377\u7ed3\u6784/\u679a\u4e3e"}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"ErrorCode"})," \u503c\u548c ",(0,d.jsx)(n.code,{children:"GATEWAY_PROTOCOL_VERSION"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u672a\u77e5\u5e27\u7c7b\u578b\u4f5c\u4e3a\u539f\u59cb\u6709\u6548\u8f7d\u8377\u4fdd\u7559\u4ee5\u5b9e\u73b0\u5411\u524d\u517c\u5bb9\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"\u7248\u672c\u63a7\u5236--\u517c\u5bb9\u6027",children:"\u7248\u672c\u63a7\u5236 + \u517c\u5bb9\u6027"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"PROTOCOL_VERSION"})," \u4f4d\u4e8e ",(0,d.jsx)(n.code,{children:"src/gateway/protocol/schema.ts"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5ba2\u6237\u7aef\u53d1\u9001 ",(0,d.jsx)(n.code,{children:"minProtocol"})," + ",(0,d.jsx)(n.code,{children:"maxProtocol"}),"\uff1b\u670d\u52a1\u5668\u62d2\u7edd\u4e0d\u5339\u914d\u7684\u60c5\u51b5\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"Swift \u6a21\u578b\u4fdd\u7559\u672a\u77e5\u5e27\u7c7b\u578b\u4ee5\u907f\u514d\u7834\u574f\u65e7\u5ba2\u6237\u7aef\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u67b6\u6784\u6a21\u5f0f\u548c\u7ea6\u5b9a",children:"\u67b6\u6784\u6a21\u5f0f\u548c\u7ea6\u5b9a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5927\u591a\u6570\u5bf9\u8c61\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"additionalProperties: false"})," \u4ee5\u83b7\u5f97\u4e25\u683c\u6709\u6548\u8f7d\u8377\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"NonEmptyString"})," \u662f ID \u548c\u65b9\u6cd5/\u4e8b\u4ef6\u540d\u79f0\u7684\u9ed8\u8ba4\u503c\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u9876\u5c42 ",(0,d.jsx)(n.code,{children:"GatewayFrame"})," \u5728 ",(0,d.jsx)(n.code,{children:"type"})," \u4e0a\u4f7f\u7528 ",(0,d.jsx)(n.strong,{children:"\u9274\u522b\u5668"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u6709\u526f\u4f5c\u7528\u7684\u65b9\u6cd5\u901a\u5e38\u9700\u8981\u5728\u53c2\u6570\u4e2d\u5305\u542b ",(0,d.jsx)(n.code,{children:"idempotencyKey"}),"\n\uff08\u793a\u4f8b\uff1a",(0,d.jsx)(n.code,{children:"send"}),"\u3001",(0,d.jsx)(n.code,{children:"poll"}),"\u3001",(0,d.jsx)(n.code,{children:"agent"}),"\u3001",(0,d.jsx)(n.code,{children:"chat.send"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u6d3b\u67b6\u6784-json",children:"\u6d3b\u67b6\u6784 JSON"}),"\n",(0,d.jsxs)(n.p,{children:["\u751f\u6210\u7684 JSON \u67b6\u6784\u5728\u4ed3\u5e93\u4e2d\u4f4d\u4e8e ",(0,d.jsx)(n.code,{children:"dist/protocol.schema.json"}),"\u3002\u53d1\u5e03\u7684\n\u539f\u59cb\u6587\u4ef6\u901a\u5e38\u53ef\u5728\u4ee5\u4e0b\u4f4d\u7f6e\u83b7\u5f97\uff1a"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://raw.githubusercontent.com/moltbot/moltbot/main/dist/protocol.schema.json",children:"https://raw.githubusercontent.com/moltbot/moltbot/main/dist/protocol.schema.json"})}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u66f4\u6539\u67b6\u6784\u65f6",children:"\u66f4\u6539\u67b6\u6784\u65f6"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u66f4\u65b0 TypeBox \u67b6\u6784\u3002"}),"\n",(0,d.jsxs)(n.li,{children:["\u8fd0\u884c ",(0,d.jsx)(n.code,{children:"pnpm protocol:check"}),"\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u63d0\u4ea4\u91cd\u65b0\u751f\u6210\u7684\u67b6\u6784 + Swift \u6a21\u578b\u3002"}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},28453(e,n,s){s.d(n,{R:()=>l,x:()=>i});var c=s(96540);const d={},r=c.createContext(d);function l(e){const n=c.useContext(r);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),c.createElement(r.Provider,{value:n},e.children)}}}]);