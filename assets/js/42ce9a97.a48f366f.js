"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[7215],{60029(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"concepts/groups","title":"Groups","description":"Moltbot treats group chats consistently across surfaces: WhatsApp, Telegram, Discord, Slack, Signal, iMessage, Microsoft Teams.","source":"@site/content/moltbot/docs/concepts/groups.md","sourceDirName":"concepts","slug":"/concepts/groups","permalink":"/moltbot-doc/docs/concepts/groups","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Group chat behavior across surfaces (WhatsApp/Telegram/Discord/Slack/Signal/iMessage/Microsoft Teams)","read_when":["Changing group chat behavior or mention gating"]}}');var l=s(74848),o=s(28453);const r={summary:"Group chat behavior across surfaces (WhatsApp/Telegram/Discord/Slack/Signal/iMessage/Microsoft Teams)",read_when:["Changing group chat behavior or mention gating"]},c="Groups",a={},d=[{value:"Beginner intro (2 minutes)",id:"beginner-intro-2-minutes",level:2},{value:"Session keys",id:"session-keys",level:2},{value:"Pattern: personal DMs + public groups (single agent)",id:"pattern-personal-dms--public-groups-single-agent",level:2},{value:"Display labels",id:"display-labels",level:2},{value:"Group policy",id:"group-policy",level:2},{value:"Mention gating (default)",id:"mention-gating-default",level:2},{value:"Group/channel tool restrictions (optional)",id:"groupchannel-tool-restrictions-optional",level:2},{value:"Group allowlists",id:"group-allowlists",level:2},{value:"Activation (owner-only)",id:"activation-owner-only",level:2},{value:"Context fields",id:"context-fields",level:2},{value:"iMessage specifics",id:"imessage-specifics",level:2},{value:"WhatsApp specifics",id:"whatsapp-specifics",level:2}];function t(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"groups",children:"Groups"})}),"\n",(0,l.jsx)(n.p,{children:"Moltbot treats group chats consistently across surfaces: WhatsApp, Telegram, Discord, Slack, Signal, iMessage, Microsoft Teams."}),"\n",(0,l.jsx)(n.h2,{id:"beginner-intro-2-minutes",children:"Beginner intro (2 minutes)"}),"\n",(0,l.jsxs)(n.p,{children:["Moltbot \u201clives\u201d on your own messaging accounts. There is no separate WhatsApp bot user.\nIf ",(0,l.jsx)(n.strong,{children:"you"})," are in a group, Moltbot can see that group and respond there."]}),"\n",(0,l.jsx)(n.p,{children:"Default behavior:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Groups are restricted (",(0,l.jsx)(n.code,{children:'groupPolicy: "allowlist"'}),")."]}),"\n",(0,l.jsx)(n.li,{children:"Replies require a mention unless you explicitly disable mention gating."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Translation: allowlisted senders can trigger Moltbot by mentioning it."}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"TL;DR"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"DM access"})," is controlled by ",(0,l.jsx)(n.code,{children:"*.allowFrom"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Group access"})," is controlled by ",(0,l.jsx)(n.code,{children:"*.groupPolicy"})," + allowlists (",(0,l.jsx)(n.code,{children:"*.groups"}),", ",(0,l.jsx)(n.code,{children:"*.groupAllowFrom"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Reply triggering"})," is controlled by mention gating (",(0,l.jsx)(n.code,{children:"requireMention"}),", ",(0,l.jsx)(n.code,{children:"/activation"}),")."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Quick flow (what happens to a group message):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"groupPolicy? disabled -> drop\ngroupPolicy? allowlist -> group allowed? no -> drop\nrequireMention? yes -> mentioned? no -> store for context only\notherwise -> reply\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"Group message flow",src:s(30577).A+"",width:"960",height:"260"})}),"\n",(0,l.jsx)(n.p,{children:"If you want..."}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Goal"}),(0,l.jsx)(n.th,{children:"What to set"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Allow all groups but only reply on @mentions"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'groups: { "*": { requireMention: true } }'})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Disable all group replies"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'groupPolicy: "disabled"'})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Only specific groups"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:'groups: { "<group-id>": { ... } }'})," (no ",(0,l.jsx)(n.code,{children:'"*"'})," key)"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Only you can trigger in groups"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:'groupPolicy: "allowlist"'}),", ",(0,l.jsx)(n.code,{children:'groupAllowFrom: ["+1555..."]'})]})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"session-keys",children:"Session keys"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Group sessions use ",(0,l.jsx)(n.code,{children:"agent:<agentId>:<channel>:group:<id>"})," session keys (rooms/channels use ",(0,l.jsx)(n.code,{children:"agent:<agentId>:<channel>:channel:<id>"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Telegram forum topics add ",(0,l.jsx)(n.code,{children:":topic:<threadId>"})," to the group id so each topic has its own session."]}),"\n",(0,l.jsx)(n.li,{children:"Direct chats use the main session (or per-sender if configured)."}),"\n",(0,l.jsx)(n.li,{children:"Heartbeats are skipped for group sessions."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"pattern-personal-dms--public-groups-single-agent",children:"Pattern: personal DMs + public groups (single agent)"}),"\n",(0,l.jsxs)(n.p,{children:["Yes \u2014 this works well if your \u201cpersonal\u201d traffic is ",(0,l.jsx)(n.strong,{children:"DMs"})," and your \u201cpublic\u201d traffic is ",(0,l.jsx)(n.strong,{children:"groups"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Why: in single-agent mode, DMs typically land in the ",(0,l.jsx)(n.strong,{children:"main"})," session key (",(0,l.jsx)(n.code,{children:"agent:main:main"}),"), while groups always use ",(0,l.jsx)(n.strong,{children:"non-main"})," session keys (",(0,l.jsx)(n.code,{children:"agent:main:<channel>:group:<id>"}),"). If you enable sandboxing with ",(0,l.jsx)(n.code,{children:'mode: "non-main"'}),", those group sessions run in Docker while your main DM session stays on-host."]}),"\n",(0,l.jsx)(n.p,{children:"This gives you one agent \u201cbrain\u201d (shared workspace + memory), but two execution postures:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"DMs"}),": full tools (host)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Groups"}),": sandbox + restricted tools (Docker)"]}),"\n"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["If you need truly separate workspaces/personas (\u201cpersonal\u201d and \u201cpublic\u201d must never mix), use a second agent + bindings. See ",(0,l.jsx)(n.a,{href:"/concepts/multi-agent",children:"Multi-Agent Routing"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Example (DMs on host, groups sandboxed + messaging-only tools):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      sandbox: {\n        mode: "non-main", // groups/channels are non-main -> sandboxed\n        scope: "session", // strongest isolation (one container per group/channel)\n        workspaceAccess: "none"\n      }\n    }\n  },\n  tools: {\n    sandbox: {\n      tools: {\n        // If allow is non-empty, everything else is blocked (deny still wins).\n        allow: ["group:messaging", "group:sessions"],\n        deny: ["group:runtime", "group:fs", "group:ui", "nodes", "cron", "gateway"]\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Want \u201cgroups can only see folder X\u201d instead of \u201cno host access\u201d? Keep ",(0,l.jsx)(n.code,{children:'workspaceAccess: "none"'})," and mount only allowlisted paths into the sandbox:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      sandbox: {\n        mode: "non-main",\n        scope: "session",\n        workspaceAccess: "none",\n        docker: {\n          binds: [\n            // hostPath:containerPath:mode\n            "~/FriendsShared:/data:ro"\n          ]\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Related:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Configuration keys and defaults: ",(0,l.jsx)(n.a,{href:"/gateway/configuration#agentsdefaultssandbox",children:"Gateway configuration"})]}),"\n",(0,l.jsxs)(n.li,{children:["Debugging why a tool is blocked: ",(0,l.jsx)(n.a,{href:"/gateway/sandbox-vs-tool-policy-vs-elevated",children:"Sandbox vs Tool Policy vs Elevated"})]}),"\n",(0,l.jsxs)(n.li,{children:["Bind mounts details: ",(0,l.jsx)(n.a,{href:"/gateway/sandboxing#custom-bind-mounts",children:"Sandboxing"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"display-labels",children:"Display labels"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["UI labels use ",(0,l.jsx)(n.code,{children:"displayName"})," when available, formatted as ",(0,l.jsx)(n.code,{children:"<channel>:<token>"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"#room"})," is reserved for rooms/channels; group chats use ",(0,l.jsx)(n.code,{children:"g-<slug>"})," (lowercase, spaces -> ",(0,l.jsx)(n.code,{children:"-"}),", keep ",(0,l.jsx)(n.code,{children:"#@+._-"}),")."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"group-policy",children:"Group policy"}),"\n",(0,l.jsx)(n.p,{children:"Control how group/room messages are handled per channel:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      groupPolicy: "disabled", // "open" | "disabled" | "allowlist"\n      groupAllowFrom: ["+15551234567"]\n    },\n    telegram: {\n      groupPolicy: "disabled",\n      groupAllowFrom: ["123456789", "@username"]\n    },\n    signal: {\n      groupPolicy: "disabled",\n      groupAllowFrom: ["+15551234567"]\n    },\n    imessage: {\n      groupPolicy: "disabled",\n      groupAllowFrom: ["chat_id:123"]\n    },\n    msteams: {\n      groupPolicy: "disabled",\n      groupAllowFrom: ["user@org.com"]\n    },\n    discord: {\n      groupPolicy: "allowlist",\n      guilds: {\n        "GUILD_ID": { channels: { help: { allow: true } } }\n      }\n    },\n    slack: {\n      groupPolicy: "allowlist",\n      channels: { "#general": { allow: true } }\n    },\n    matrix: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["@owner:example.org"],\n      groups: {\n        "!roomId:example.org": { allow: true },\n        "#alias:example.org": { allow: true }\n      }\n    }\n  }\n}\n'})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Policy"}),(0,l.jsx)(n.th,{children:"Behavior"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'"open"'})}),(0,l.jsx)(n.td,{children:"Groups bypass allowlists; mention-gating still applies."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'"disabled"'})}),(0,l.jsx)(n.td,{children:"Block all group messages entirely."})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'"allowlist"'})}),(0,l.jsx)(n.td,{children:"Only allow groups/rooms that match the configured allowlist."})]})]})]}),"\n",(0,l.jsx)(n.p,{children:"Notes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"groupPolicy"})," is separate from mention-gating (which requires @mentions)."]}),"\n",(0,l.jsxs)(n.li,{children:["WhatsApp/Telegram/Signal/iMessage/Microsoft Teams: use ",(0,l.jsx)(n.code,{children:"groupAllowFrom"})," (fallback: explicit ",(0,l.jsx)(n.code,{children:"allowFrom"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Discord: allowlist uses ",(0,l.jsx)(n.code,{children:"channels.discord.guilds.<id>.channels"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Slack: allowlist uses ",(0,l.jsx)(n.code,{children:"channels.slack.channels"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Matrix: allowlist uses ",(0,l.jsx)(n.code,{children:"channels.matrix.groups"})," (room IDs, aliases, or names). Use ",(0,l.jsx)(n.code,{children:"channels.matrix.groupAllowFrom"})," to restrict senders; per-room ",(0,l.jsx)(n.code,{children:"users"})," allowlists are also supported."]}),"\n",(0,l.jsxs)(n.li,{children:["Group DMs are controlled separately (",(0,l.jsx)(n.code,{children:"channels.discord.dm.*"}),", ",(0,l.jsx)(n.code,{children:"channels.slack.dm.*"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Telegram allowlist can match user IDs (",(0,l.jsx)(n.code,{children:'"123456789"'}),", ",(0,l.jsx)(n.code,{children:'"telegram:123456789"'}),", ",(0,l.jsx)(n.code,{children:'"tg:123456789"'}),") or usernames (",(0,l.jsx)(n.code,{children:'"@alice"'})," or ",(0,l.jsx)(n.code,{children:'"alice"'}),"); prefixes are case-insensitive."]}),"\n",(0,l.jsxs)(n.li,{children:["Default is ",(0,l.jsx)(n.code,{children:'groupPolicy: "allowlist"'}),"; if your group allowlist is empty, group messages are blocked."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Quick mental model (evaluation order for group messages):"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"groupPolicy"})," (open/disabled/allowlist)"]}),"\n",(0,l.jsxs)(n.li,{children:["group allowlists (",(0,l.jsx)(n.code,{children:"*.groups"}),", ",(0,l.jsx)(n.code,{children:"*.groupAllowFrom"}),", channel-specific allowlist)"]}),"\n",(0,l.jsxs)(n.li,{children:["mention gating (",(0,l.jsx)(n.code,{children:"requireMention"}),", ",(0,l.jsx)(n.code,{children:"/activation"}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"mention-gating-default",children:"Mention gating (default)"}),"\n",(0,l.jsxs)(n.p,{children:["Group messages require a mention unless overridden per group. Defaults live per subsystem under ",(0,l.jsx)(n.code,{children:'*.groups."*"'}),"."]}),"\n",(0,l.jsx)(n.p,{children:"Replying to a bot message counts as an implicit mention (when the channel supports reply metadata). This applies to Telegram, WhatsApp, Slack, Discord, and Microsoft Teams."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      groups: {\n        "*": { requireMention: true },\n        "123@g.us": { requireMention: false }\n      }\n    },\n    telegram: {\n      groups: {\n        "*": { requireMention: true },\n        "123456789": { requireMention: false }\n      }\n    },\n    imessage: {\n      groups: {\n        "*": { requireMention: true },\n        "123": { requireMention: false }\n      }\n    }\n  },\n  agents: {\n    list: [\n      {\n        id: "main",\n        groupChat: {\n          mentionPatterns: ["@clawd", "moltbot", "\\\\+15555550123"],\n          historyLimit: 50\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Notes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"mentionPatterns"})," are case-insensitive regexes."]}),"\n",(0,l.jsx)(n.li,{children:"Surfaces that provide explicit mentions still pass; patterns are a fallback."}),"\n",(0,l.jsxs)(n.li,{children:["Per-agent override: ",(0,l.jsx)(n.code,{children:"agents.list[].groupChat.mentionPatterns"})," (useful when multiple agents share a group)."]}),"\n",(0,l.jsxs)(n.li,{children:["Mention gating is only enforced when mention detection is possible (native mentions or ",(0,l.jsx)(n.code,{children:"mentionPatterns"})," are configured)."]}),"\n",(0,l.jsxs)(n.li,{children:["Discord defaults live in ",(0,l.jsx)(n.code,{children:'channels.discord.guilds."*"'})," (overridable per guild/channel)."]}),"\n",(0,l.jsxs)(n.li,{children:["Group history context is wrapped uniformly across channels and is ",(0,l.jsx)(n.strong,{children:"pending-only"})," (messages skipped due to mention gating); use ",(0,l.jsx)(n.code,{children:"messages.groupChat.historyLimit"})," for the global default and ",(0,l.jsx)(n.code,{children:"channels.<channel>.historyLimit"})," (or ",(0,l.jsx)(n.code,{children:"channels.<channel>.accounts.*.historyLimit"}),") for overrides. Set ",(0,l.jsx)(n.code,{children:"0"})," to disable."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"groupchannel-tool-restrictions-optional",children:"Group/channel tool restrictions (optional)"}),"\n",(0,l.jsxs)(n.p,{children:["Some channel configs support restricting which tools are available ",(0,l.jsx)(n.strong,{children:"inside a specific group/room/channel"}),"."]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"tools"}),": allow/deny tools for the whole group."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"toolsBySender"}),": per-sender overrides within the group (keys are sender IDs/usernames/emails/phone numbers depending on the channel). Use ",(0,l.jsx)(n.code,{children:'"*"'})," as a wildcard."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Resolution order (most specific wins):"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["group/channel ",(0,l.jsx)(n.code,{children:"toolsBySender"})," match"]}),"\n",(0,l.jsxs)(n.li,{children:["group/channel ",(0,l.jsx)(n.code,{children:"tools"})]}),"\n",(0,l.jsxs)(n.li,{children:["default (",(0,l.jsx)(n.code,{children:'"*"'}),") ",(0,l.jsx)(n.code,{children:"toolsBySender"})," match"]}),"\n",(0,l.jsxs)(n.li,{children:["default (",(0,l.jsx)(n.code,{children:'"*"'}),") ",(0,l.jsx)(n.code,{children:"tools"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Example (Telegram):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    telegram: {\n      groups: {\n        "*": { tools: { deny: ["exec"] } },\n        "-1001234567890": {\n          tools: { deny: ["exec", "read", "write"] },\n          toolsBySender: {\n            "123456789": { alsoAllow: ["exec"] }\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"Notes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Group/channel tool restrictions are applied in addition to global/agent tool policy (deny still wins)."}),"\n",(0,l.jsxs)(n.li,{children:["Some channels use different nesting for rooms/channels (e.g., Discord ",(0,l.jsx)(n.code,{children:"guilds.*.channels.*"}),", Slack ",(0,l.jsx)(n.code,{children:"channels.*"}),", MS Teams ",(0,l.jsx)(n.code,{children:"teams.*.channels.*"}),")."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"group-allowlists",children:"Group allowlists"}),"\n",(0,l.jsxs)(n.p,{children:["When ",(0,l.jsx)(n.code,{children:"channels.whatsapp.groups"}),", ",(0,l.jsx)(n.code,{children:"channels.telegram.groups"}),", or ",(0,l.jsx)(n.code,{children:"channels.imessage.groups"})," is configured, the keys act as a group allowlist. Use ",(0,l.jsx)(n.code,{children:'"*"'})," to allow all groups while still setting default mention behavior."]}),"\n",(0,l.jsx)(n.p,{children:"Common intents (copy/paste):"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Disable all group replies"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  channels: { whatsapp: { groupPolicy: "disabled" } }\n}\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"Allow only specific groups (WhatsApp)"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      groups: {\n        "123@g.us": { requireMention: true },\n        "456@g.us": { requireMention: false }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"Allow all groups but require mention (explicit)"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      groups: { "*": { requireMention: true } }\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsx)(n.li,{children:"Only the owner can trigger in groups (WhatsApp)"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json5",children:'{\n  channels: {\n    whatsapp: {\n      groupPolicy: "allowlist",\n      groupAllowFrom: ["+15551234567"],\n      groups: { "*": { requireMention: true } }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"activation-owner-only",children:"Activation (owner-only)"}),"\n",(0,l.jsx)(n.p,{children:"Group owners can toggle per-group activation:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/activation mention"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/activation always"})}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Owner is determined by ",(0,l.jsx)(n.code,{children:"channels.whatsapp.allowFrom"})," (or the bot\u2019s self E.164 when unset). Send the command as a standalone message. Other surfaces currently ignore ",(0,l.jsx)(n.code,{children:"/activation"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"context-fields",children:"Context fields"}),"\n",(0,l.jsx)(n.p,{children:"Group inbound payloads set:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ChatType=group"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GroupSubject"})," (if known)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"GroupMembers"})," (if known)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"WasMentioned"})," (mention gating result)"]}),"\n",(0,l.jsxs)(n.li,{children:["Telegram forum topics also include ",(0,l.jsx)(n.code,{children:"MessageThreadId"})," and ",(0,l.jsx)(n.code,{children:"IsForum"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The agent system prompt includes a group intro on the first turn of a new group session. It reminds the model to respond like a human, avoid Markdown tables, and avoid typing literal ",(0,l.jsx)(n.code,{children:"\\n"})," sequences."]}),"\n",(0,l.jsx)(n.h2,{id:"imessage-specifics",children:"iMessage specifics"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Prefer ",(0,l.jsx)(n.code,{children:"chat_id:<id>"})," when routing or allowlisting."]}),"\n",(0,l.jsxs)(n.li,{children:["List chats: ",(0,l.jsx)(n.code,{children:"imsg chats --limit 20"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Group replies always go back to the same ",(0,l.jsx)(n.code,{children:"chat_id"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"whatsapp-specifics",children:"WhatsApp specifics"}),"\n",(0,l.jsxs)(n.p,{children:["See ",(0,l.jsx)(n.a,{href:"/concepts/group-messages",children:"Group messages"})," for WhatsApp-only behavior (history injection, mention handling details)."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},30577(e,n,s){s.d(n,{A:()=>i});const i="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5NjAiIGhlaWdodD0iMjYwIiB2aWV3Qm94PSIwIDAgOTYwIDI2MCIgcm9sZT0iaW1nIiBhcmlhLWxhYmVsPSJHcm91cCBtZXNzYWdlIGZsb3ciPgogIDxkZWZzPgogICAgPHN0eWxlPgogICAgICAuYm94IHsgZmlsbDogI2Y2ZjVmMzsgc3Ryb2tlOiAjMmIyYjJiOyBzdHJva2Utd2lkdGg6IDI7IH0KICAgICAgLmRyb3AgeyBmaWxsOiAjZmZmMWYxOyBzdHJva2U6ICNhMzM7IHN0cm9rZS13aWR0aDogMjsgfQogICAgICAubm90ZSB7IGZpbGw6ICNmZmZhZjA7IHN0cm9rZTogIzlhN2IwMDsgc3Ryb2tlLXdpZHRoOiAyOyB9CiAgICAgIC50ZXh0IHsgZm9udDogMTRweCAiU0YgUHJvIFRleHQiLCAtYXBwbGUtc3lzdGVtLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOyBmaWxsOiAjMWExYTFhOyB9CiAgICAgIC5sYWJlbCB7IGZvbnQ6IDEycHggIlNGIFBybyBUZXh0IiwgLWFwcGxlLXN5c3RlbSwgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsgZmlsbDogIzMzMzsgfQogICAgICAuYXJyb3cgeyBzdHJva2U6ICMyYjJiMmI7IHN0cm9rZS13aWR0aDogMjsgZmlsbDogbm9uZTsgbWFya2VyLWVuZDogdXJsKCNhcnJvdyk7IH0KICAgIDwvc3R5bGU+CiAgICA8bWFya2VyIGlkPSJhcnJvdyIgbWFya2VyV2lkdGg9IjEwIiBtYXJrZXJIZWlnaHQ9IjEwIiByZWZYPSI4IiByZWZZPSIzIiBvcmllbnQ9ImF1dG8iPgogICAgICA8cGF0aCBkPSJNMCwwIEw4LDMgTDAsNiBaIiBmaWxsPSIjMmIyYjJiIiAvPgogICAgPC9tYXJrZXI+CiAgPC9kZWZzPgoKICA8cmVjdCBjbGFzcz0iYm94IiB4PSIyMCIgeT0iNDAiIHdpZHRoPSIxNDAiIGhlaWdodD0iNjAiIHJ4PSI4IiAvPgogIDx0ZXh0IGNsYXNzPSJ0ZXh0IiB4PSI5MCIgeT0iNzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkdyb3VwIG1lc3NhZ2U8L3RleHQ+CgogIDxyZWN0IGNsYXNzPSJib3giIHg9IjIwMCIgeT0iNDAiIHdpZHRoPSIxNjAiIGhlaWdodD0iNjAiIHJ4PSI4IiAvPgogIDx0ZXh0IGNsYXNzPSJ0ZXh0IiB4PSIyODAiIHk9IjY4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Hcm91cCBwb2xpY3k8L3RleHQ+CiAgPHRleHQgY2xhc3M9ImxhYmVsIiB4PSIyODAiIHk9Ijg2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5vcGVuIC8gZGlzYWJsZWQgLyBhbGxvd2xpc3Q8L3RleHQ+CgogIDxyZWN0IGNsYXNzPSJib3giIHg9IjQwMCIgeT0iNDAiIHdpZHRoPSIxNTAiIGhlaWdodD0iNjAiIHJ4PSI4IiAvPgogIDx0ZXh0IGNsYXNzPSJ0ZXh0IiB4PSI0NzUiIHk9Ijc1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5BbGxvd2xpc3Q8L3RleHQ+CgogIDxyZWN0IGNsYXNzPSJib3giIHg9IjU4MCIgeT0iNDAiIHdpZHRoPSIxNzAiIGhlaWdodD0iNjAiIHJ4PSI4IiAvPgogIDx0ZXh0IGNsYXNzPSJ0ZXh0IiB4PSI2NjUiIHk9IjY4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5NZW50aW9uIGdhdGluZzwvdGV4dD4KICA8dGV4dCBjbGFzcz0ibGFiZWwiIHg9IjY2NSIgeT0iODYiIHRleHQtYW5jaG9yPSJtaWRkbGUiPnJlcXVpcmVNZW50aW9uPC90ZXh0PgoKICA8cmVjdCBjbGFzcz0iYm94IiB4PSI3ODAiIHk9IjQwIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjYwIiByeD0iOCIgLz4KICA8dGV4dCBjbGFzcz0idGV4dCIgeD0iODUwIiB5PSI3NSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+UmVwbHk8L3RleHQ+CgogIDxsaW5lIGNsYXNzPSJhcnJvdyIgeDE9IjE2MCIgeTE9IjcwIiB4Mj0iMjAwIiB5Mj0iNzAiIC8+CiAgPGxpbmUgY2xhc3M9ImFycm93IiB4MT0iMzYwIiB5MT0iNzAiIHgyPSI0MDAiIHkyPSI3MCIgLz4KICA8bGluZSBjbGFzcz0iYXJyb3ciIHgxPSI1NTAiIHkxPSI3MCIgeDI9IjU4MCIgeTI9IjcwIiAvPgogIDxsaW5lIGNsYXNzPSJhcnJvdyIgeDE9Ijc1MCIgeTE9IjcwIiB4Mj0iNzgwIiB5Mj0iNzAiIC8+CgogIDxyZWN0IGNsYXNzPSJkcm9wIiB4PSIyMjAiIHk9IjE1MCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI1MCIgcng9IjgiIC8+CiAgPHRleHQgY2xhc3M9InRleHQiIHg9IjI4MCIgeT0iMTgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5Ecm9wPC90ZXh0PgogIDxsaW5lIGNsYXNzPSJhcnJvdyIgeDE9IjI4MCIgeTE9IjEwMCIgeDI9IjI4MCIgeTI9IjE1MCIgLz4KICA8dGV4dCBjbGFzcz0ibGFiZWwiIHg9IjI1MCIgeT0iMTMwIiB0ZXh0LWFuY2hvcj0iZW5kIj5kaXNhYmxlZDwvdGV4dD4KCiAgPHJlY3QgY2xhc3M9ImRyb3AiIHg9IjQxMCIgeT0iMTUwIiB3aWR0aD0iMTIwIiBoZWlnaHQ9IjUwIiByeD0iOCIgLz4KICA8dGV4dCBjbGFzcz0idGV4dCIgeD0iNDcwIiB5PSIxODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkRyb3A8L3RleHQ+CiAgPGxpbmUgY2xhc3M9ImFycm93IiB4MT0iNDc1IiB5MT0iMTAwIiB4Mj0iNDcwIiB5Mj0iMTUwIiAvPgogIDx0ZXh0IGNsYXNzPSJsYWJlbCIgeD0iNDQ1IiB5PSIxMzAiIHRleHQtYW5jaG9yPSJlbmQiPm5vdCBhbGxvd2VkPC90ZXh0PgoKICA8cmVjdCBjbGFzcz0ibm90ZSIgeD0iNjAwIiB5PSIxNTAiIHdpZHRoPSIyMDAiIGhlaWdodD0iNTAiIHJ4PSI4IiAvPgogIDx0ZXh0IGNsYXNzPSJ0ZXh0IiB4PSI3MDAiIHk9IjE3NSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U3RvcmUgZm9yIGNvbnRleHQ8L3RleHQ+CiAgPHRleHQgY2xhc3M9ImxhYmVsIiB4PSI3MDAiIHk9IjE5MiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+KG5vIG1lbnRpb24pPC90ZXh0PgogIDxsaW5lIGNsYXNzPSJhcnJvdyIgeDE9IjY2NSIgeTE9IjEwMCIgeDI9IjcwMCIgeTI9IjE1MCIgLz4KPC9zdmc+Cg=="},28453(e,n,s){s.d(n,{R:()=>r,x:()=>c});var i=s(96540);const l={},o=i.createContext(l);function r(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);