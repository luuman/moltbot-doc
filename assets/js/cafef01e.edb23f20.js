"use strict";(globalThis.webpackChunkdocs_workspace=globalThis.webpackChunkdocs_workspace||[]).push([[9400],{51016(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"providers/anthropic","title":"Anthropic (Claude)","description":"Anthropic builds the Claude model family and provides access via an API.","source":"@site/content/moltbot/docs/providers/anthropic.md","sourceDirName":"providers","slug":"/providers/anthropic","permalink":"/moltbot-doc/docs/providers/anthropic","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"summary":"Use Anthropic Claude via API keys or setup-token in Moltbot","read_when":["You want to use Anthropic models in Moltbot","You want setup-token instead of API keys"]}}');var s=t(74848),i=t(28453);const r={summary:"Use Anthropic Claude via API keys or setup-token in Moltbot",read_when:["You want to use Anthropic models in Moltbot","You want setup-token instead of API keys"]},a="Anthropic (Claude)",l={},c=[{value:"Option A: Anthropic API key",id:"option-a-anthropic-api-key",level:2},{value:"CLI setup",id:"cli-setup",level:3},{value:"Config snippet",id:"config-snippet",level:3},{value:"Prompt caching (Anthropic API)",id:"prompt-caching-anthropic-api",level:2},{value:"Option B: Claude setup-token",id:"option-b-claude-setup-token",level:2},{value:"Where to get a setup-token",id:"where-to-get-a-setup-token",level:3},{value:"CLI setup",id:"cli-setup-1",level:3},{value:"Config snippet",id:"config-snippet-1",level:3},{value:"Notes",id:"notes",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"anthropic-claude",children:"Anthropic (Claude)"})}),"\n",(0,s.jsxs)(n.p,{children:["Anthropic builds the ",(0,s.jsx)(n.strong,{children:"Claude"})," model family and provides access via an API.\nIn Moltbot you can authenticate with an API key or a ",(0,s.jsx)(n.strong,{children:"setup-token"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"option-a-anthropic-api-key",children:"Option A: Anthropic API key"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best for:"})," standard API access and usage-based billing.\nCreate your API key in the Anthropic Console."]}),"\n",(0,s.jsx)(n.h3,{id:"cli-setup",children:"CLI setup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'moltbot onboard\n# choose: Anthropic API key\n\n# or non-interactive\nmoltbot onboard --anthropic-api-key "$ANTHROPIC_API_KEY"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"config-snippet",children:"Config snippet"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'{\n  env: { ANTHROPIC_API_KEY: "sk-ant-..." },\n  agents: { defaults: { model: { primary: "anthropic/claude-opus-4-5" } } }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"prompt-caching-anthropic-api",children:"Prompt caching (Anthropic API)"}),"\n",(0,s.jsxs)(n.p,{children:["Moltbot does ",(0,s.jsx)(n.strong,{children:"not"})," override Anthropic\u2019s default cache TTL unless you set it.\nThis is ",(0,s.jsx)(n.strong,{children:"API-only"}),"; subscription auth does not honor TTL settings."]}),"\n",(0,s.jsxs)(n.p,{children:["To set the TTL per model, use ",(0,s.jsx)(n.code,{children:"cacheControlTtl"})," in the model ",(0,s.jsx)(n.code,{children:"params"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'{\n  agents: {\n    defaults: {\n      models: {\n        "anthropic/claude-opus-4-5": {\n          params: { cacheControlTtl: "5m" } // or "1h"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Moltbot includes the ",(0,s.jsx)(n.code,{children:"extended-cache-ttl-2025-04-11"})," beta flag for Anthropic API\nrequests; keep it if you override provider headers (see ",(0,s.jsx)(n.a,{href:"/gateway/configuration",children:"/gateway/configuration"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"option-b-claude-setup-token",children:"Option B: Claude setup-token"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best for:"})," using your Claude subscription."]}),"\n",(0,s.jsx)(n.h3,{id:"where-to-get-a-setup-token",children:"Where to get a setup-token"}),"\n",(0,s.jsxs)(n.p,{children:["Setup-tokens are created by the ",(0,s.jsx)(n.strong,{children:"Claude Code CLI"}),", not the Anthropic Console. You can run this on ",(0,s.jsx)(n.strong,{children:"any machine"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"claude setup-token\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Paste the token into Moltbot (wizard: ",(0,s.jsx)(n.strong,{children:"Anthropic token (paste setup-token)"}),"), or run it on the gateway host:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"moltbot models auth setup-token --provider anthropic\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you generated the token on a different machine, paste it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"moltbot models auth paste-token --provider anthropic\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cli-setup-1",children:"CLI setup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Paste a setup-token during onboarding\nmoltbot onboard --auth-choice setup-token\n"})}),"\n",(0,s.jsx)(n.h3,{id:"config-snippet-1",children:"Config snippet"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json5",children:'{\n  agents: { defaults: { model: { primary: "anthropic/claude-opus-4-5" } } }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Generate the setup-token with ",(0,s.jsx)(n.code,{children:"claude setup-token"})," and paste it, or run ",(0,s.jsx)(n.code,{children:"moltbot models auth setup-token"})," on the gateway host."]}),"\n",(0,s.jsxs)(n.li,{children:["If you see \u201cOAuth token refresh failed \u2026\u201d on a Claude subscription, re-auth with a setup-token. See ",(0,s.jsx)(n.a,{href:"/gateway/troubleshooting#oauth-token-refresh-failed-anthropic-claude-subscription",children:"/gateway/troubleshooting#oauth-token-refresh-failed-anthropic-claude-subscription"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Auth details + reuse rules are in ",(0,s.jsx)(n.a,{href:"/concepts/oauth",children:"/concepts/oauth"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"401 errors / token suddenly invalid"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Claude subscription auth can expire or be revoked. Re-run ",(0,s.jsx)(n.code,{children:"claude setup-token"}),"\nand paste it into the ",(0,s.jsx)(n.strong,{children:"gateway host"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["If the Claude CLI login lives on a different machine, use\n",(0,s.jsx)(n.code,{children:"moltbot models auth paste-token --provider anthropic"})," on the gateway host."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:'No API key found for provider "anthropic"'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Auth is ",(0,s.jsx)(n.strong,{children:"per agent"}),". New agents don\u2019t inherit the main agent\u2019s keys."]}),"\n",(0,s.jsxs)(n.li,{children:["Re-run onboarding for that agent, or paste a setup-token / API key on the\ngateway host, then verify with ",(0,s.jsx)(n.code,{children:"moltbot models status"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["No credentials found for profile ",(0,s.jsx)(n.code,{children:"anthropic:default"})]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"moltbot models status"})," to see which auth profile is active."]}),"\n",(0,s.jsx)(n.li,{children:"Re-run onboarding, or paste a setup-token / API key for that profile."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"No available auth profile (all in cooldown/unavailable)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Check ",(0,s.jsx)(n.code,{children:"moltbot models status --json"})," for ",(0,s.jsx)(n.code,{children:"auth.unusableProfiles"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Add another Anthropic profile or wait for cooldown."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["More: ",(0,s.jsx)(n.a,{href:"/gateway/troubleshooting",children:"/gateway/troubleshooting"})," and ",(0,s.jsx)(n.a,{href:"/help/faq",children:"/help/faq"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>r,x:()=>a});var o=t(96540);const s={},i=o.createContext(s);function r(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);